var t,e,n,r,i,o,a,s,u,c,l,h,d,p,f,m,v,g,y,x,b,w,_,E,C,I,S,k,T,N,R,A,P,D,M,O,B,F,j,z,W,U,V=t=>{throw TypeError(t)},H=(t,e,n)=>e.has(t)||V("Cannot "+n),G=(t,e,n)=>(H(t,e,"read from private field"),n?n.call(t):e.get(t)),q=(t,e,n)=>e.has(t)?V("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),K=(t,e,n,r)=>(H(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n),Z=(t,e,n)=>(H(t,e,"access private method"),n),X=(t,e,n,r)=>({set _(r){K(t,e,r,n)},get _(){return G(t,e,r)}});import{j as $,P as Y,c as J,a as Q,u as tt,B as et,b as nt,d as rt,e as it,f as ot,R as at,g as st,h as ut,i as ct,X as lt,k as ht,A as dt,D as pt,C as ft,l as mt,m as vt,S as gt,n as yt,o as xt,p as bt,q as wt,r as _t,I as Et,s as Ct,t as It,v as St,w as kt,x as Tt,L as Nt,y as Rt,z as At,T as Pt,_ as Dt,E as Mt,M as Ot,V as Lt,F as Bt,U as Ft,G as jt,H as zt,J as Wt,K as Ut,N as Vt,O as Ht,Q as Gt,W as qt,Y as Kt,Z as Zt,$ as Xt,a0 as $t,a1 as Yt,a2 as Jt,a3 as Qt,a4 as te,a5 as ee,a6 as ne,a7 as re,a8 as ie,a9 as oe,aa as ae,ab as se,ac as ue,ad as ce,ae as le,af as he,ag as de,ah as pe,ai as fe,aj as me,ak as ve,al as ge,am as ye,an as xe,ao as be,ap as we,aq as _e,ar as Ee,as as Ce}from"./ui-vendor-BM89uu8L.js";import{a as Ie,r as Se,R as ke,v as Te,u as Ne,c as Re,L as Ae,d as Pe,e as De,g as Me,f as Oe,B as Le,h as Be,i as Fe}from"./react-vendor-DHP-rUpQ.js";import{c as je,t as ze}from"./utils-BpqZfnrR.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var We=Ie;U=We.createRoot,We.hydrateRoot;let Ue=0;const Ve=new Map,He=t=>{if(Ve.has(t))return;const e=setTimeout(()=>{Ve.delete(t),Ze({type:"REMOVE_TOAST",toastId:t})},1e6);Ve.set(t,e)},Ge=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,1)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{const{toastId:n}=e;return n?He(n):t.toasts.forEach(t=>{He(t.id)}),{...t,toasts:t.toasts.map(t=>t.id===n||void 0===n?{...t,open:!1}:t)}}case"REMOVE_TOAST":return void 0===e.toastId?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(t=>t.id!==e.toastId)}}},qe=[];let Ke={toasts:[]};function Ze(t){Ke=Ge(Ke,t),qe.forEach(t=>{t(Ke)})}function Xe({...t}){const e=(Ue=(Ue+1)%Number.MAX_SAFE_INTEGER,Ue.toString()),n=()=>Ze({type:"DISMISS_TOAST",toastId:e});return Ze({type:"ADD_TOAST",toast:{...t,id:e,open:!0,onOpenChange:t=>{t||n()}}}),{id:e,dismiss:n,update:t=>Ze({type:"UPDATE_TOAST",toast:{...t,id:e}})}}function $e(){const[t,e]=Se.useState(Ke);return Se.useEffect(()=>(qe.push(e),()=>{const t=qe.indexOf(e);t>-1&&qe.splice(t,1)}),[t]),{...t,toast:Xe,dismiss:t=>Ze({type:"DISMISS_TOAST",toastId:t})}}var Ye=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Je=Se.forwardRef((t,e)=>$.jsx(Y.span,{...t,ref:e,style:{...Ye,...t.style}}));Je.displayName="VisuallyHidden";var Qe=Je,tn="ToastProvider",[en,nn,rn]=J("Toast"),[on,an]=Q("Toast",[rn]),[sn,un]=on(tn),cn=t=>{const{__scopeToast:e,label:n="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:o=50,children:a}=t,[s,u]=Se.useState(null),[c,l]=Se.useState(0),h=Se.useRef(!1),d=Se.useRef(!1);return n.trim(),$.jsx(en.Provider,{scope:e,children:$.jsx(sn,{scope:e,label:n,duration:r,swipeDirection:i,swipeThreshold:o,toastCount:c,viewport:s,onViewportChange:u,onToastAdd:Se.useCallback(()=>l(t=>t+1),[]),onToastRemove:Se.useCallback(()=>l(t=>t-1),[]),isFocusedToastEscapeKeyDownRef:h,isClosePausedRef:d,children:a})})};cn.displayName=tn;var ln="ToastViewport",hn=["F8"],dn="toast.viewportPause",pn="toast.viewportResume",fn=Se.forwardRef((t,e)=>{const{__scopeToast:n,hotkey:r=hn,label:i="Notifications ({hotkey})",...o}=t,a=un(ln,n),s=nn(n),u=Se.useRef(null),c=Se.useRef(null),l=Se.useRef(null),h=Se.useRef(null),d=tt(e,h,a.onViewportChange),p=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),f=a.toastCount>0;Se.useEffect(()=>{const t=t=>{var e;0!==r.length&&r.every(e=>t[e]||t.code===e)&&(null==(e=h.current)||e.focus())};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[r]),Se.useEffect(()=>{const t=u.current,e=h.current;if(f&&t&&e){const n=()=>{if(!a.isClosePausedRef.current){const t=new CustomEvent(dn);e.dispatchEvent(t),a.isClosePausedRef.current=!0}},r=()=>{if(a.isClosePausedRef.current){const t=new CustomEvent(pn);e.dispatchEvent(t),a.isClosePausedRef.current=!1}},i=e=>{!t.contains(e.relatedTarget)&&r()},o=()=>{t.contains(document.activeElement)||r()};return t.addEventListener("focusin",n),t.addEventListener("focusout",i),t.addEventListener("pointermove",n),t.addEventListener("pointerleave",o),window.addEventListener("blur",n),window.addEventListener("focus",r),()=>{t.removeEventListener("focusin",n),t.removeEventListener("focusout",i),t.removeEventListener("pointermove",n),t.removeEventListener("pointerleave",o),window.removeEventListener("blur",n),window.removeEventListener("focus",r)}}},[f,a.isClosePausedRef]);const m=Se.useCallback(({tabbingDirection:t})=>{const e=s().map(e=>{const n=e.ref.current,r=[n,...Pn(n)];return"forwards"===t?r:r.reverse()});return("forwards"===t?e.reverse():e).flat()},[s]);return Se.useEffect(()=>{const t=h.current;if(t){const e=e=>{var n,r,i;const o=e.altKey||e.ctrlKey||e.metaKey;if("Tab"===e.key&&!o){const o=document.activeElement,a=e.shiftKey;if(e.target===t&&a)return void(null==(n=c.current)||n.focus());const s=m({tabbingDirection:a?"backwards":"forwards"}),u=s.findIndex(t=>t===o);Dn(s.slice(u+1))?e.preventDefault():a?null==(r=c.current)||r.focus():null==(i=l.current)||i.focus()}};return t.addEventListener("keydown",e),()=>t.removeEventListener("keydown",e)}},[s,m]),$.jsxs(et,{ref:u,role:"region","aria-label":i.replace("{hotkey}",p),tabIndex:-1,style:{pointerEvents:f?void 0:"none"},children:[f&&$.jsx(vn,{ref:c,onFocusFromOutsideViewport:()=>{Dn(m({tabbingDirection:"forwards"}))}}),$.jsx(en.Slot,{scope:n,children:$.jsx(Y.ol,{tabIndex:-1,...o,ref:d})}),f&&$.jsx(vn,{ref:l,onFocusFromOutsideViewport:()=>{Dn(m({tabbingDirection:"backwards"}))}})]})});fn.displayName=ln;var mn="ToastFocusProxy",vn=Se.forwardRef((t,e)=>{const{__scopeToast:n,onFocusFromOutsideViewport:r,...i}=t,o=un(mn,n);return $.jsx(Je,{"aria-hidden":!0,tabIndex:0,...i,ref:e,style:{position:"fixed"},onFocus:t=>{var e;const n=t.relatedTarget;!(null==(e=o.viewport)?void 0:e.contains(n))&&r()}})});vn.displayName=mn;var gn="Toast",yn=Se.forwardRef((t,e)=>{const{forceMount:n,open:r,defaultOpen:i,onOpenChange:o,...a}=t,[s,u]=nt({prop:r,defaultProp:i??!0,onChange:o,caller:gn});return $.jsx(rt,{present:n||s,children:$.jsx(wn,{open:s,...a,ref:e,onClose:()=>u(!1),onPause:it(t.onPause),onResume:it(t.onResume),onSwipeStart:ot(t.onSwipeStart,t=>{t.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:ot(t.onSwipeMove,t=>{const{x:e,y:n}=t.detail.delta;t.currentTarget.setAttribute("data-swipe","move"),t.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${e}px`),t.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${n}px`)}),onSwipeCancel:ot(t.onSwipeCancel,t=>{t.currentTarget.setAttribute("data-swipe","cancel"),t.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),t.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),t.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),t.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:ot(t.onSwipeEnd,t=>{const{x:e,y:n}=t.detail.delta;t.currentTarget.setAttribute("data-swipe","end"),t.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),t.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),t.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${e}px`),t.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${n}px`),u(!1)})})})});yn.displayName=gn;var[xn,bn]=on(gn,{onClose(){}}),wn=Se.forwardRef((t,e)=>{const{__scopeToast:n,type:r="foreground",duration:i,open:o,onClose:a,onEscapeKeyDown:s,onPause:u,onResume:c,onSwipeStart:l,onSwipeMove:h,onSwipeCancel:d,onSwipeEnd:p,...f}=t,m=un(gn,n),[v,g]=Se.useState(null),y=tt(e,t=>g(t)),x=Se.useRef(null),b=Se.useRef(null),w=i||m.duration,_=Se.useRef(0),E=Se.useRef(w),C=Se.useRef(0),{onToastAdd:I,onToastRemove:S}=m,k=it(()=>{var t;(null==v?void 0:v.contains(document.activeElement))&&(null==(t=m.viewport)||t.focus()),a()}),T=Se.useCallback(t=>{t&&t!==1/0&&(window.clearTimeout(C.current),_.current=(new Date).getTime(),C.current=window.setTimeout(k,t))},[k]);Se.useEffect(()=>{const t=m.viewport;if(t){const e=()=>{T(E.current),null==c||c()},n=()=>{const t=(new Date).getTime()-_.current;E.current=E.current-t,window.clearTimeout(C.current),null==u||u()};return t.addEventListener(dn,n),t.addEventListener(pn,e),()=>{t.removeEventListener(dn,n),t.removeEventListener(pn,e)}}},[m.viewport,w,u,c,T]),Se.useEffect(()=>{o&&!m.isClosePausedRef.current&&T(w)},[o,w,m.isClosePausedRef,T]),Se.useEffect(()=>(I(),()=>S()),[I,S]);const N=Se.useMemo(()=>v?Nn(v):null,[v]);return m.viewport?$.jsxs($.Fragment,{children:[N&&$.jsx(_n,{__scopeToast:n,role:"status","aria-live":"foreground"===r?"assertive":"polite","aria-atomic":!0,children:N}),$.jsx(xn,{scope:n,onClose:k,children:Ie.createPortal($.jsx(en.ItemSlot,{scope:n,children:$.jsx(at,{asChild:!0,onEscapeKeyDown:ot(s,()=>{m.isFocusedToastEscapeKeyDownRef.current||k(),m.isFocusedToastEscapeKeyDownRef.current=!1}),children:$.jsx(Y.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":m.swipeDirection,...f,ref:y,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:ot(t.onKeyDown,t=>{"Escape"===t.key&&(null==s||s(t.nativeEvent),t.nativeEvent.defaultPrevented||(m.isFocusedToastEscapeKeyDownRef.current=!0,k()))}),onPointerDown:ot(t.onPointerDown,t=>{0===t.button&&(x.current={x:t.clientX,y:t.clientY})}),onPointerMove:ot(t.onPointerMove,t=>{if(!x.current)return;const e=t.clientX-x.current.x,n=t.clientY-x.current.y,r=Boolean(b.current),i=["left","right"].includes(m.swipeDirection),o=["left","up"].includes(m.swipeDirection)?Math.min:Math.max,a=i?o(0,e):0,s=i?0:o(0,n),u="touch"===t.pointerType?10:2,c={x:a,y:s},d={originalEvent:t,delta:c};r?(b.current=c,Rn("toast.swipeMove",h,d,{discrete:!1})):An(c,m.swipeDirection,u)?(b.current=c,Rn("toast.swipeStart",l,d,{discrete:!1}),t.target.setPointerCapture(t.pointerId)):(Math.abs(e)>u||Math.abs(n)>u)&&(x.current=null)}),onPointerUp:ot(t.onPointerUp,t=>{const e=b.current,n=t.target;if(n.hasPointerCapture(t.pointerId)&&n.releasePointerCapture(t.pointerId),b.current=null,x.current=null,e){const n=t.currentTarget,r={originalEvent:t,delta:e};An(e,m.swipeDirection,m.swipeThreshold)?Rn("toast.swipeEnd",p,r,{discrete:!0}):Rn("toast.swipeCancel",d,r,{discrete:!0}),n.addEventListener("click",t=>t.preventDefault(),{once:!0})}})})})}),m.viewport)})]}):null}),_n=t=>{const{__scopeToast:e,children:n,...r}=t,i=un(gn,e),[o,a]=Se.useState(!1),[s,u]=Se.useState(!1);return function(t=()=>{}){const e=it(t);ut(()=>{let t=0,n=0;return t=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(n)}},[e])}(()=>a(!0)),Se.useEffect(()=>{const t=window.setTimeout(()=>u(!0),1e3);return()=>window.clearTimeout(t)},[]),s?null:$.jsx(st,{asChild:!0,children:$.jsx(Je,{...r,children:o&&$.jsxs($.Fragment,{children:[i.label," ",n]})})})},En=Se.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t;return $.jsx(Y.div,{...r,ref:e})});En.displayName="ToastTitle";var Cn=Se.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t;return $.jsx(Y.div,{...r,ref:e})});Cn.displayName="ToastDescription";var In=Se.forwardRef((t,e)=>{const{altText:n,...r}=t;return n.trim()?$.jsx(Tn,{altText:n,asChild:!0,children:$.jsx(kn,{...r,ref:e})}):null});In.displayName="ToastAction";var Sn="ToastClose",kn=Se.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t,i=bn(Sn,n);return $.jsx(Tn,{asChild:!0,children:$.jsx(Y.button,{type:"button",...r,ref:e,onClick:ot(t.onClick,i.onClose)})})});kn.displayName=Sn;var Tn=Se.forwardRef((t,e)=>{const{__scopeToast:n,altText:r,...i}=t;return $.jsx(Y.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...i,ref:e})});function Nn(t){const e=[];return Array.from(t.childNodes).forEach(t=>{if(t.nodeType===t.TEXT_NODE&&t.textContent&&e.push(t.textContent),function(t){return t.nodeType===t.ELEMENT_NODE}(t)){const n=t.ariaHidden||t.hidden||"none"===t.style.display,r=""===t.dataset.radixToastAnnounceExclude;if(!n)if(r){const n=t.dataset.radixToastAnnounceAlt;n&&e.push(n)}else e.push(...Nn(t))}}),e}function Rn(t,e,n,{discrete:r}){const i=n.originalEvent.currentTarget,o=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:n});e&&i.addEventListener(t,e,{once:!0}),r?ct(i,o):i.dispatchEvent(o)}var An=(t,e,n=0)=>{const r=Math.abs(t.x),i=Math.abs(t.y),o=r>i;return"left"===e||"right"===e?o&&r>n:!o&&i>n};function Pn(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:t=>{const e="INPUT"===t.tagName&&"hidden"===t.type;return t.disabled||t.hidden||e?NodeFilter.FILTER_SKIP:t.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function Dn(t){const e=document.activeElement;return t.some(t=>t===e||(t.focus(),document.activeElement!==e))}var Mn=fn,On=yn,Ln=En,Bn=Cn,Fn=In,jn=kn;const zn=t=>"boolean"==typeof t?`${t}`:0===t?"0":t,Wn=je,Un=(t,e)=>n=>{var r;if(null==(null==e?void 0:e.variants))return Wn(t,null==n?void 0:n.class,null==n?void 0:n.className);const{variants:i,defaultVariants:o}=e,a=Object.keys(i).map(t=>{const e=null==n?void 0:n[t],r=null==o?void 0:o[t];if(null===e)return null;const a=zn(e)||zn(r);return i[t][a]}),s=n&&Object.entries(n).reduce((t,e)=>{let[n,r]=e;return void 0===r||(t[n]=r),t},{}),u=null==e||null===(r=e.compoundVariants)||void 0===r?void 0:r.reduce((t,e)=>{let{class:n,className:r,...i}=e;return Object.entries(i).every(t=>{let[e,n]=t;return Array.isArray(n)?n.includes({...o,...s}[e]):{...o,...s}[e]===n})?[...t,n,r]:t},[]);return Wn(t,a,u,null==n?void 0:n.class,null==n?void 0:n.className)};function Vn(...t){return ze(je(t))}const Hn=cn,Gn=Se.forwardRef(({className:t,...e},n)=>$.jsx(Mn,{ref:n,className:Vn("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...e}));Gn.displayName=Mn.displayName;const qn=Un("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Kn=Se.forwardRef(({className:t,variant:e,...n},r)=>$.jsx(On,{ref:r,className:Vn(qn({variant:e}),t),...n}));Kn.displayName=On.displayName;Se.forwardRef(({className:t,...e},n)=>$.jsx(Fn,{ref:n,className:Vn("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",t),...e})).displayName=Fn.displayName;const Zn=Se.forwardRef(({className:t,...e},n)=>$.jsx(jn,{ref:n,className:Vn("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...e,children:$.jsx(lt,{className:"h-4 w-4"})}));Zn.displayName=jn.displayName;const Xn=Se.forwardRef(({className:t,...e},n)=>$.jsx(Ln,{ref:n,className:Vn("text-sm font-semibold",t),...e}));Xn.displayName=Ln.displayName;const $n=Se.forwardRef(({className:t,...e},n)=>$.jsx(Bn,{ref:n,className:Vn("text-sm opacity-90",t),...e}));function Yn(){const{toasts:t}=$e();return $.jsxs(Hn,{children:[t.map(function({id:t,title:e,description:n,action:r,...i}){return $.jsxs(Kn,{...i,children:[$.jsxs("div",{className:"grid gap-1",children:[e&&$.jsx(Xn,{children:e}),n&&$.jsx($n,{children:n})]}),r,$.jsx(Zn,{})]},t)}),$.jsx(Gn,{})]})}$n.displayName=Bn.displayName;var Jn=["light","dark"],Qn=Se.createContext(void 0),tr={setTheme:t=>{},themes:[]};Se.memo(({forcedTheme:t,storageKey:e,attribute:n,enableSystem:r,enableColorScheme:i,defaultTheme:o,value:a,attrs:s,nonce:u})=>{let c="system"===o,l="class"===n?`var d=document.documentElement,c=d.classList;c.remove(${s.map(t=>`'${t}'`).join(",")});`:`var d=document.documentElement,n='${n}',s='setAttribute';`,h=i?Jn.includes(o)&&o?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${o}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",d=(t,e=!1,r=!0)=>{let o=a?a[t]:t,s=e?t+"|| ''":`'${o}'`,u="";return i&&r&&!e&&Jn.includes(t)&&(u+=`d.style.colorScheme = '${t}';`),"class"===n?u+=e||o?`c.add(${s})`:"null":o&&(u+=`d[s](n,${s})`),u},p=t?`!function(){${l}${d(t)}}()`:r?`!function(){try{${l}var e=localStorage.getItem('${e}');if('system'===e||(!e&&${c})){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){${d("dark")}}else{${d("light")}}}else if(e){${a?`var x=${JSON.stringify(a)};`:""}${d(a?"x[e]":"e",!0)}}${c?"":"else{"+d(o,!1,!1)+"}"}${h}}catch(e){}}()`:`!function(){try{${l}var e=localStorage.getItem('${e}');if(e){${a?`var x=${JSON.stringify(a)};`:""}${d(a?"x[e]":"e",!0)}}else{${d(o,!1,!1)};}${h}}catch(t){}}();`;return Se.createElement("script",{nonce:u,dangerouslySetInnerHTML:{__html:p}})});var er=Array(12).fill(0),nr=({visible:t,className:e})=>ke.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":t},ke.createElement("div",{className:"sonner-spinner"},er.map((t,e)=>ke.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${e}`})))),rr=ke.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ke.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),ir=ke.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},ke.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),or=ke.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ke.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),ar=ke.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ke.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),sr=ke.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},ke.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),ke.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),ur=1,cr=new class{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{let e=this.subscribers.indexOf(t);this.subscribers.splice(e,1)}),this.publish=t=>{this.subscribers.forEach(e=>e(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var e;let{message:n,...r}=t,i="number"==typeof(null==t?void 0:t.id)||(null==(e=t.id)?void 0:e.length)>0?t.id:ur++,o=this.toasts.find(t=>t.id===i),a=void 0===t.dismissible||t.dismissible;return this.dismissedToasts.has(i)&&this.dismissedToasts.delete(i),o?this.toasts=this.toasts.map(e=>e.id===i?(this.publish({...e,...t,id:i,title:n}),{...e,...t,id:i,dismissible:a,title:n}):e):this.addToast({title:n,...r,dismissible:a,id:i}),i},this.dismiss=t=>(this.dismissedToasts.add(t),t||this.toasts.forEach(t=>{this.subscribers.forEach(e=>e({id:t.id,dismiss:!0}))}),this.subscribers.forEach(e=>e({id:t,dismiss:!0})),t),this.message=(t,e)=>this.create({...e,message:t}),this.error=(t,e)=>this.create({...e,message:t,type:"error"}),this.success=(t,e)=>this.create({...e,type:"success",message:t}),this.info=(t,e)=>this.create({...e,type:"info",message:t}),this.warning=(t,e)=>this.create({...e,type:"warning",message:t}),this.loading=(t,e)=>this.create({...e,type:"loading",message:t}),this.promise=(t,e)=>{if(!e)return;let n;void 0!==e.loading&&(n=this.create({...e,promise:t,type:"loading",message:e.loading,description:"function"!=typeof e.description?e.description:void 0}));let r,i=t instanceof Promise?t:t(),o=void 0!==n,a=i.then(async t=>{if(r=["resolve",t],ke.isValidElement(t))o=!1,this.create({id:n,type:"default",message:t});else if(lr(t)&&!t.ok){o=!1;let r="function"==typeof e.error?await e.error(`HTTP error! status: ${t.status}`):e.error,i="function"==typeof e.description?await e.description(`HTTP error! status: ${t.status}`):e.description;this.create({id:n,type:"error",message:r,description:i})}else if(void 0!==e.success){o=!1;let r="function"==typeof e.success?await e.success(t):e.success,i="function"==typeof e.description?await e.description(t):e.description;this.create({id:n,type:"success",message:r,description:i})}}).catch(async t=>{if(r=["reject",t],void 0!==e.error){o=!1;let r="function"==typeof e.error?await e.error(t):e.error,i="function"==typeof e.description?await e.description(t):e.description;this.create({id:n,type:"error",message:r,description:i})}}).finally(()=>{var t;o&&(this.dismiss(n),n=void 0),null==(t=e.finally)||t.call(e)}),s=()=>new Promise((t,e)=>a.then(()=>"reject"===r[0]?e(r[1]):t(r[1])).catch(e));return"string"!=typeof n&&"number"!=typeof n?{unwrap:s}:Object.assign(n,{unwrap:s})},this.custom=(t,e)=>{let n=(null==e?void 0:e.id)||ur++;return this.create({jsx:t(n),id:n,...e}),n},this.getActiveToasts=()=>this.toasts.filter(t=>!this.dismissedToasts.has(t.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},lr=t=>t&&"object"==typeof t&&"ok"in t&&"boolean"==typeof t.ok&&"status"in t&&"number"==typeof t.status,hr=(t,e)=>{let n=(null==e?void 0:e.id)||ur++;return cr.addToast({title:t,...e,id:n}),n};function dr(t){return void 0!==t.label}Object.assign(hr,{success:cr.success,info:cr.info,warning:cr.warning,error:cr.error,custom:cr.custom,message:cr.message,promise:cr.promise,dismiss:cr.dismiss,loading:cr.loading},{getHistory:()=>cr.toasts,getToasts:()=>cr.getActiveToasts()}),function(t,{insertAt:e}={}){if("undefined"==typeof document)return;let n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===e&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}(':where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}\n');var pr=3,fr=14;function mr(...t){return t.filter(Boolean).join(" ")}var vr=t=>{var e,n,r,i,o,a,s,u,c,l,h;let{invert:d,toast:p,unstyled:f,interacting:m,setHeights:v,visibleToasts:g,heights:y,index:x,toasts:b,expanded:w,removeToast:_,defaultRichColors:E,closeButton:C,style:I,cancelButtonStyle:S,actionButtonStyle:k,className:T="",descriptionClassName:N="",duration:R,position:A,gap:P,loadingIcon:D,expandByDefault:M,classNames:O,icons:L,closeButtonAriaLabel:B="Close toast",pauseWhenPageIsHidden:F}=t,[j,z]=ke.useState(null),[W,U]=ke.useState(null),[V,H]=ke.useState(!1),[G,q]=ke.useState(!1),[K,Z]=ke.useState(!1),[X,$]=ke.useState(!1),[Y,J]=ke.useState(!1),[Q,tt]=ke.useState(0),[et,nt]=ke.useState(0),rt=ke.useRef(p.duration||R||4e3),it=ke.useRef(null),ot=ke.useRef(null),at=0===x,st=x+1<=g,ut=p.type,ct=!1!==p.dismissible,lt=p.className||"",ht=p.descriptionClassName||"",dt=ke.useMemo(()=>y.findIndex(t=>t.toastId===p.id)||0,[y,p.id]),pt=ke.useMemo(()=>{var t;return null!=(t=p.closeButton)?t:C},[p.closeButton,C]),ft=ke.useMemo(()=>p.duration||R||4e3,[p.duration,R]),mt=ke.useRef(0),vt=ke.useRef(0),gt=ke.useRef(0),yt=ke.useRef(null),[xt,bt]=A.split("-"),wt=ke.useMemo(()=>y.reduce((t,e,n)=>n>=dt?t:t+e.height,0),[y,dt]),_t=(()=>{let[t,e]=ke.useState(document.hidden);return ke.useEffect(()=>{let t=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",t),()=>window.removeEventListener("visibilitychange",t)},[]),t})(),Et=p.invert||d,Ct="loading"===ut;vt.current=ke.useMemo(()=>dt*P+wt,[dt,wt]),ke.useEffect(()=>{rt.current=ft},[ft]),ke.useEffect(()=>{H(!0)},[]),ke.useEffect(()=>{let t=ot.current;if(t){let e=t.getBoundingClientRect().height;return nt(e),v(t=>[{toastId:p.id,height:e,position:p.position},...t]),()=>v(t=>t.filter(t=>t.toastId!==p.id))}},[v,p.id]),ke.useLayoutEffect(()=>{if(!V)return;let t=ot.current,e=t.style.height;t.style.height="auto";let n=t.getBoundingClientRect().height;t.style.height=e,nt(n),v(t=>t.find(t=>t.toastId===p.id)?t.map(t=>t.toastId===p.id?{...t,height:n}:t):[{toastId:p.id,height:n,position:p.position},...t])},[V,p.title,p.description,v,p.id]);let It=ke.useCallback(()=>{q(!0),tt(vt.current),v(t=>t.filter(t=>t.toastId!==p.id)),setTimeout(()=>{_(p)},200)},[p,_,v,vt]);return ke.useEffect(()=>{if(p.promise&&"loading"===ut||p.duration===1/0||"loading"===p.type)return;let t;return w||m||F&&_t?(()=>{if(gt.current<mt.current){let t=(new Date).getTime()-mt.current;rt.current=rt.current-t}gt.current=(new Date).getTime()})():rt.current!==1/0&&(mt.current=(new Date).getTime(),t=setTimeout(()=>{var t;null==(t=p.onAutoClose)||t.call(p,p),It()},rt.current)),()=>clearTimeout(t)},[w,m,p,ut,F,_t,It]),ke.useEffect(()=>{p.delete&&It()},[It,p.delete]),ke.createElement("li",{tabIndex:0,ref:ot,className:mr(T,lt,null==O?void 0:O.toast,null==(e=null==p?void 0:p.classNames)?void 0:e.toast,null==O?void 0:O.default,null==O?void 0:O[ut],null==(n=null==p?void 0:p.classNames)?void 0:n[ut]),"data-sonner-toast":"","data-rich-colors":null!=(r=p.richColors)?r:E,"data-styled":!(p.jsx||p.unstyled||f),"data-mounted":V,"data-promise":!!p.promise,"data-swiped":Y,"data-removed":G,"data-visible":st,"data-y-position":xt,"data-x-position":bt,"data-index":x,"data-front":at,"data-swiping":K,"data-dismissible":ct,"data-type":ut,"data-invert":Et,"data-swipe-out":X,"data-swipe-direction":W,"data-expanded":!!(w||M&&V),style:{"--index":x,"--toasts-before":x,"--z-index":b.length-x,"--offset":`${G?Q:vt.current}px`,"--initial-height":M?"auto":`${et}px`,...I,...p.style},onDragEnd:()=>{Z(!1),z(null),yt.current=null},onPointerDown:t=>{Ct||!ct||(it.current=new Date,tt(vt.current),t.target.setPointerCapture(t.pointerId),"BUTTON"!==t.target.tagName&&(Z(!0),yt.current={x:t.clientX,y:t.clientY}))},onPointerUp:()=>{var t,e,n,r;if(X||!ct)return;yt.current=null;let i=Number((null==(t=ot.current)?void 0:t.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),o=Number((null==(e=ot.current)?void 0:e.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),a=(new Date).getTime()-(null==(n=it.current)?void 0:n.getTime()),s="x"===j?i:o,u=Math.abs(s)/a;if(Math.abs(s)>=20||u>.11)return tt(vt.current),null==(r=p.onDismiss)||r.call(p,p),U("x"===j?i>0?"right":"left":o>0?"down":"up"),It(),$(!0),void J(!1);Z(!1),z(null)},onPointerMove:e=>{var n,r,i,o;if(!yt.current||!ct||(null==(n=window.getSelection())?void 0:n.toString().length)>0)return;let a=e.clientY-yt.current.y,s=e.clientX-yt.current.x,u=null!=(r=t.swipeDirections)?r:function(t){let[e,n]=t.split("-"),r=[];return e&&r.push(e),n&&r.push(n),r}(A);!j&&(Math.abs(s)>1||Math.abs(a)>1)&&z(Math.abs(s)>Math.abs(a)?"x":"y");let c={x:0,y:0};"y"===j?(u.includes("top")||u.includes("bottom"))&&(u.includes("top")&&a<0||u.includes("bottom")&&a>0)&&(c.y=a):"x"===j&&(u.includes("left")||u.includes("right"))&&(u.includes("left")&&s<0||u.includes("right")&&s>0)&&(c.x=s),(Math.abs(c.x)>0||Math.abs(c.y)>0)&&J(!0),null==(i=ot.current)||i.style.setProperty("--swipe-amount-x",`${c.x}px`),null==(o=ot.current)||o.style.setProperty("--swipe-amount-y",`${c.y}px`)}},pt&&!p.jsx?ke.createElement("button",{"aria-label":B,"data-disabled":Ct,"data-close-button":!0,onClick:Ct||!ct?()=>{}:()=>{var t;It(),null==(t=p.onDismiss)||t.call(p,p)},className:mr(null==O?void 0:O.closeButton,null==(i=null==p?void 0:p.classNames)?void 0:i.closeButton)},null!=(o=null==L?void 0:L.close)?o:sr):null,p.jsx||Se.isValidElement(p.title)?p.jsx?p.jsx:"function"==typeof p.title?p.title():p.title:ke.createElement(ke.Fragment,null,ut||p.icon||p.promise?ke.createElement("div",{"data-icon":"",className:mr(null==O?void 0:O.icon,null==(a=null==p?void 0:p.classNames)?void 0:a.icon)},p.promise||"loading"===p.type&&!p.icon?p.icon||(null!=L&&L.loading?ke.createElement("div",{className:mr(null==O?void 0:O.loader,null==(St=null==p?void 0:p.classNames)?void 0:St.loader,"sonner-loader"),"data-visible":"loading"===ut},L.loading):D?ke.createElement("div",{className:mr(null==O?void 0:O.loader,null==(kt=null==p?void 0:p.classNames)?void 0:kt.loader,"sonner-loader"),"data-visible":"loading"===ut},D):ke.createElement(nr,{className:mr(null==O?void 0:O.loader,null==(Tt=null==p?void 0:p.classNames)?void 0:Tt.loader),visible:"loading"===ut})):null,"loading"!==p.type?p.icon||(null==L?void 0:L[ut])||(t=>{switch(t){case"success":return rr;case"info":return or;case"warning":return ir;case"error":return ar;default:return null}})(ut):null):null,ke.createElement("div",{"data-content":"",className:mr(null==O?void 0:O.content,null==(s=null==p?void 0:p.classNames)?void 0:s.content)},ke.createElement("div",{"data-title":"",className:mr(null==O?void 0:O.title,null==(u=null==p?void 0:p.classNames)?void 0:u.title)},"function"==typeof p.title?p.title():p.title),p.description?ke.createElement("div",{"data-description":"",className:mr(N,ht,null==O?void 0:O.description,null==(c=null==p?void 0:p.classNames)?void 0:c.description)},"function"==typeof p.description?p.description():p.description):null),Se.isValidElement(p.cancel)?p.cancel:p.cancel&&dr(p.cancel)?ke.createElement("button",{"data-button":!0,"data-cancel":!0,style:p.cancelButtonStyle||S,onClick:t=>{var e,n;dr(p.cancel)&&ct&&(null==(n=(e=p.cancel).onClick)||n.call(e,t),It())},className:mr(null==O?void 0:O.cancelButton,null==(l=null==p?void 0:p.classNames)?void 0:l.cancelButton)},p.cancel.label):null,Se.isValidElement(p.action)?p.action:p.action&&dr(p.action)?ke.createElement("button",{"data-button":!0,"data-action":!0,style:p.actionButtonStyle||k,onClick:t=>{var e,n;dr(p.action)&&(null==(n=(e=p.action).onClick)||n.call(e,t),!t.defaultPrevented&&It())},className:mr(null==O?void 0:O.actionButton,null==(h=null==p?void 0:p.classNames)?void 0:h.actionButton)},p.action.label):null));var St,kt,Tt};function gr(){if("undefined"==typeof window||"undefined"==typeof document)return"ltr";let t=document.documentElement.getAttribute("dir");return"auto"!==t&&t?t:window.getComputedStyle(document.documentElement).direction}function yr(t,e){let n={};return[t,e].forEach((t,e)=>{let r=1===e,i=r?"--mobile-offset":"--offset",o=r?"16px":"32px";function a(t){["top","right","bottom","left"].forEach(e=>{n[`${i}-${e}`]="number"==typeof t?`${t}px`:t})}"number"==typeof t||"string"==typeof t?a(t):"object"==typeof t?["top","right","bottom","left"].forEach(e=>{void 0===t[e]?n[`${i}-${e}`]=o:n[`${i}-${e}`]="number"==typeof t[e]?`${t[e]}px`:t[e]}):a(o)}),n}var xr=Se.forwardRef(function(t,e){let{invert:n,position:r="bottom-right",hotkey:i=["altKey","KeyT"],expand:o,closeButton:a,className:s,offset:u,mobileOffset:c,theme:l="light",richColors:h,duration:d,style:p,visibleToasts:f=pr,toastOptions:m,dir:v=gr(),gap:g=fr,loadingIcon:y,icons:x,containerAriaLabel:b="Notifications",pauseWhenPageIsHidden:w}=t,[_,E]=ke.useState([]),C=ke.useMemo(()=>Array.from(new Set([r].concat(_.filter(t=>t.position).map(t=>t.position)))),[_,r]),[I,S]=ke.useState([]),[k,T]=ke.useState(!1),[N,R]=ke.useState(!1),[A,P]=ke.useState("system"!==l?l:"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),D=ke.useRef(null),M=i.join("+").replace(/Key/g,"").replace(/Digit/g,""),O=ke.useRef(null),L=ke.useRef(!1),B=ke.useCallback(t=>{E(e=>{var n;return null!=(n=e.find(e=>e.id===t.id))&&n.delete||cr.dismiss(t.id),e.filter(({id:e})=>e!==t.id)})},[]);return ke.useEffect(()=>cr.subscribe(t=>{t.dismiss?E(e=>e.map(e=>e.id===t.id?{...e,delete:!0}:e)):setTimeout(()=>{Te.flushSync(()=>{E(e=>{let n=e.findIndex(e=>e.id===t.id);return-1!==n?[...e.slice(0,n),{...e[n],...t},...e.slice(n+1)]:[t,...e]})})})}),[]),ke.useEffect(()=>{if("system"!==l)return void P(l);if("system"===l&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?P("dark"):P("light")),"undefined"==typeof window)return;let t=window.matchMedia("(prefers-color-scheme: dark)");try{t.addEventListener("change",({matches:t})=>{P(t?"dark":"light")})}catch(e){t.addListener(({matches:t})=>{try{P(t?"dark":"light")}catch(e){}})}},[l]),ke.useEffect(()=>{_.length<=1&&T(!1)},[_]),ke.useEffect(()=>{let t=t=>{var e,n;i.every(e=>t[e]||t.code===e)&&(T(!0),null==(e=D.current)||e.focus()),"Escape"===t.code&&(document.activeElement===D.current||null!=(n=D.current)&&n.contains(document.activeElement))&&T(!1)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[i]),ke.useEffect(()=>{if(D.current)return()=>{O.current&&(O.current.focus({preventScroll:!0}),O.current=null,L.current=!1)}},[D.current]),ke.createElement("section",{ref:e,"aria-label":`${b} ${M}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},C.map((e,r)=>{var i;let[l,b]=e.split("-");return _.length?ke.createElement("ol",{key:e,dir:"auto"===v?gr():v,tabIndex:-1,ref:D,className:s,"data-sonner-toaster":!0,"data-theme":A,"data-y-position":l,"data-lifted":k&&_.length>1&&!o,"data-x-position":b,style:{"--front-toast-height":`${(null==(i=I[0])?void 0:i.height)||0}px`,"--width":"356px","--gap":`${g}px`,...p,...yr(u,c)},onBlur:t=>{L.current&&!t.currentTarget.contains(t.relatedTarget)&&(L.current=!1,O.current&&(O.current.focus({preventScroll:!0}),O.current=null))},onFocus:t=>{t.target instanceof HTMLElement&&"false"===t.target.dataset.dismissible||L.current||(L.current=!0,O.current=t.relatedTarget)},onMouseEnter:()=>T(!0),onMouseMove:()=>T(!0),onMouseLeave:()=>{N||T(!1)},onDragEnd:()=>T(!1),onPointerDown:t=>{t.target instanceof HTMLElement&&"false"===t.target.dataset.dismissible||R(!0)},onPointerUp:()=>R(!1)},_.filter(t=>!t.position&&0===r||t.position===e).map((r,i)=>{var s,u;return ke.createElement(vr,{key:r.id,icons:x,index:i,toast:r,defaultRichColors:h,duration:null!=(s=null==m?void 0:m.duration)?s:d,className:null==m?void 0:m.className,descriptionClassName:null==m?void 0:m.descriptionClassName,invert:n,visibleToasts:f,closeButton:null!=(u=null==m?void 0:m.closeButton)?u:a,interacting:N,position:e,style:null==m?void 0:m.style,unstyled:null==m?void 0:m.unstyled,classNames:null==m?void 0:m.classNames,cancelButtonStyle:null==m?void 0:m.cancelButtonStyle,actionButtonStyle:null==m?void 0:m.actionButtonStyle,removeToast:B,toasts:_.filter(t=>t.position==r.position),heights:I.filter(t=>t.position==r.position),setHeights:S,expandByDefault:o,gap:g,loadingIcon:y,expanded:k,pauseWhenPageIsHidden:w,swipeDirections:t.swipeDirections})})):null}))});const br=({...t})=>{const{theme:e="system"}=null!=(n=Se.useContext(Qn))?n:tr;var n;return $.jsx(xr,{theme:e,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})};var[wr,_r]=Q("Tooltip",[ht]),Er=ht(),Cr="TooltipProvider",Ir=700,Sr="tooltip.open",[kr,Tr]=wr(Cr),Nr=t=>{const{__scopeTooltip:e,delayDuration:n=Ir,skipDelayDuration:r=300,disableHoverableContent:i=!1,children:o}=t,a=Se.useRef(!0),s=Se.useRef(!1),u=Se.useRef(0);return Se.useEffect(()=>{const t=u.current;return()=>window.clearTimeout(t)},[]),$.jsx(kr,{scope:e,isOpenDelayedRef:a,delayDuration:n,onOpen:Se.useCallback(()=>{window.clearTimeout(u.current),a.current=!1},[]),onClose:Se.useCallback(()=>{window.clearTimeout(u.current),u.current=window.setTimeout(()=>a.current=!0,r)},[r]),isPointerInTransitRef:s,onPointerInTransitChange:Se.useCallback(t=>{s.current=t},[]),disableHoverableContent:i,children:o})};Nr.displayName=Cr;var Rr="Tooltip",[Ar,Pr]=wr(Rr),Dr="TooltipTrigger";Se.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,i=Pr(Dr,n),o=Tr(Dr,n),a=Er(n),s=Se.useRef(null),u=tt(e,s,i.onTriggerChange),c=Se.useRef(!1),l=Se.useRef(!1),h=Se.useCallback(()=>c.current=!1,[]);return Se.useEffect(()=>()=>document.removeEventListener("pointerup",h),[h]),$.jsx(dt,{asChild:!0,...a,children:$.jsx(Y.button,{"aria-describedby":i.open?i.contentId:void 0,"data-state":i.stateAttribute,...r,ref:u,onPointerMove:ot(t.onPointerMove,t=>{"touch"!==t.pointerType&&(l.current||o.isPointerInTransitRef.current||(i.onTriggerEnter(),l.current=!0))}),onPointerLeave:ot(t.onPointerLeave,()=>{i.onTriggerLeave(),l.current=!1}),onPointerDown:ot(t.onPointerDown,()=>{i.open&&i.onClose(),c.current=!0,document.addEventListener("pointerup",h,{once:!0})}),onFocus:ot(t.onFocus,()=>{c.current||i.onOpen()}),onBlur:ot(t.onBlur,i.onClose),onClick:ot(t.onClick,i.onClose)})})}).displayName=Dr;var[Mr,Or]=wr("TooltipPortal",{forceMount:void 0}),Lr="TooltipContent",Br=Se.forwardRef((t,e)=>{const n=Or(Lr,t.__scopeTooltip),{forceMount:r=n.forceMount,side:i="top",...o}=t,a=Pr(Lr,t.__scopeTooltip);return $.jsx(rt,{present:r||a.open,children:a.disableHoverableContent?$.jsx(Ur,{side:i,...o,ref:e}):$.jsx(Fr,{side:i,...o,ref:e})})}),Fr=Se.forwardRef((t,e)=>{const n=Pr(Lr,t.__scopeTooltip),r=Tr(Lr,t.__scopeTooltip),i=Se.useRef(null),o=tt(e,i),[a,s]=Se.useState(null),{trigger:u,onClose:c}=n,l=i.current,{onPointerInTransitChange:h}=r,d=Se.useCallback(()=>{s(null),h(!1)},[h]),p=Se.useCallback((t,e)=>{const n=t.currentTarget,r={x:t.clientX,y:t.clientY},i=function(t,e,n=5){const r=[];switch(e){case"top":r.push({x:t.x-n,y:t.y+n},{x:t.x+n,y:t.y+n});break;case"bottom":r.push({x:t.x-n,y:t.y-n},{x:t.x+n,y:t.y-n});break;case"left":r.push({x:t.x+n,y:t.y-n},{x:t.x+n,y:t.y+n});break;case"right":r.push({x:t.x-n,y:t.y-n},{x:t.x-n,y:t.y+n})}return r}(r,function(t,e){const n=Math.abs(e.top-t.y),r=Math.abs(e.bottom-t.y),i=Math.abs(e.right-t.x),o=Math.abs(e.left-t.x);switch(Math.min(n,r,i,o)){case o:return"left";case i:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}(r,n.getBoundingClientRect())),o=function(t){const e=t.slice();return e.sort((t,e)=>t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0),function(t){if(t.length<=1)return t.slice();const e=[];for(let r=0;r<t.length;r++){const n=t[r];for(;e.length>=2;){const t=e[e.length-1],r=e[e.length-2];if(!((t.x-r.x)*(n.y-r.y)>=(t.y-r.y)*(n.x-r.x)))break;e.pop()}e.push(n)}e.pop();const n=[];for(let r=t.length-1;r>=0;r--){const e=t[r];for(;n.length>=2;){const t=n[n.length-1],r=n[n.length-2];if(!((t.x-r.x)*(e.y-r.y)>=(t.y-r.y)*(e.x-r.x)))break;n.pop()}n.push(e)}return n.pop(),1===e.length&&1===n.length&&e[0].x===n[0].x&&e[0].y===n[0].y?e:e.concat(n)}(e)}([...i,...function(t){const{top:e,right:n,bottom:r,left:i}=t;return[{x:i,y:e},{x:n,y:e},{x:n,y:r},{x:i,y:r}]}(e.getBoundingClientRect())]);s(o),h(!0)},[h]);return Se.useEffect(()=>()=>d(),[d]),Se.useEffect(()=>{if(u&&l){const t=t=>p(t,l),e=t=>p(t,u);return u.addEventListener("pointerleave",t),l.addEventListener("pointerleave",e),()=>{u.removeEventListener("pointerleave",t),l.removeEventListener("pointerleave",e)}}},[u,l,p,d]),Se.useEffect(()=>{if(a){const t=t=>{const e=t.target,n={x:t.clientX,y:t.clientY},r=(null==u?void 0:u.contains(e))||(null==l?void 0:l.contains(e)),i=!function(t,e){const{x:n,y:r}=t;let i=!1;for(let o=0,a=e.length-1;o<e.length;a=o++){const t=e[o],s=e[a],u=t.x,c=t.y,l=s.x,h=s.y;c>r!=h>r&&n<(l-u)*(r-c)/(h-c)+u&&(i=!i)}return i}(n,a);r?d():i&&(d(),c())};return document.addEventListener("pointermove",t),()=>document.removeEventListener("pointermove",t)}},[u,l,a,c,d]),$.jsx(Ur,{...t,ref:o})}),[jr,zr]=wr(Rr,{isInside:!1}),Wr=vt("TooltipContent"),Ur=Se.forwardRef((t,e)=>{const{__scopeTooltip:n,children:r,"aria-label":i,onEscapeKeyDown:o,onPointerDownOutside:a,...s}=t,u=Pr(Lr,n),c=Er(n),{onClose:l}=u;return Se.useEffect(()=>(document.addEventListener(Sr,l),()=>document.removeEventListener(Sr,l)),[l]),Se.useEffect(()=>{if(u.trigger){const t=t=>{const e=t.target;(null==e?void 0:e.contains(u.trigger))&&l()};return window.addEventListener("scroll",t,{capture:!0}),()=>window.removeEventListener("scroll",t,{capture:!0})}},[u.trigger,l]),$.jsx(pt,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:o,onPointerDownOutside:a,onFocusOutside:t=>t.preventDefault(),onDismiss:l,children:$.jsxs(ft,{"data-state":u.stateAttribute,...c,...s,ref:e,style:{...s.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[$.jsx(Wr,{children:r}),$.jsx(jr,{scope:n,isInside:!0,children:$.jsx(Qe,{id:u.contentId,role:"tooltip",children:i||r})})]})})});Br.displayName=Lr;var Vr="TooltipArrow";Se.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,i=Er(n);return zr(Vr,n).isInside?null:$.jsx(mt,{...i,...r,ref:e})}).displayName=Vr;var Hr=Br;const Gr=Nr;Se.forwardRef(({className:t,sideOffset:e=4,...n},r)=>$.jsx(Hr,{ref:r,sideOffset:e,className:Vn("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})).displayName=Hr.displayName;var qr=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Kr="undefined"==typeof window||"Deno"in globalThis;function Zr(){}function Xr(t,e){return"function"==typeof t?t(e):t}function $r(t,e){const{type:n="all",exact:r,fetchStatus:i,predicate:o,queryKey:a,stale:s}=t;if(a)if(r){if(e.queryHash!==Jr(a,e.options))return!1}else if(!ti(e.queryKey,a))return!1;if("all"!==n){const t=e.isActive();if("active"===n&&!t)return!1;if("inactive"===n&&t)return!1}return("boolean"!=typeof s||e.isStale()===s)&&((!i||i===e.state.fetchStatus)&&!(o&&!o(e)))}function Yr(t,e){const{exact:n,status:r,predicate:i,mutationKey:o}=t;if(o){if(!e.options.mutationKey)return!1;if(n){if(Qr(e.options.mutationKey)!==Qr(o))return!1}else if(!ti(e.options.mutationKey,o))return!1}return(!r||e.state.status===r)&&!(i&&!i(e))}function Jr(t,e){return((null==e?void 0:e.queryKeyHashFn)||Qr)(t)}function Qr(t){return JSON.stringify(t,(t,e)=>ri(e)?Object.keys(e).sort().reduce((t,n)=>(t[n]=e[n],t),{}):e)}function ti(t,e){return t===e||typeof t==typeof e&&(!(!t||!e||"object"!=typeof t||"object"!=typeof e)&&Object.keys(e).every(n=>ti(t[n],e[n])))}function ei(t,e){if(t===e)return t;const n=ni(t)&&ni(e);if(n||ri(t)&&ri(e)){const r=n?t:Object.keys(t),i=r.length,o=n?e:Object.keys(e),a=o.length,s=n?[]:{},u=new Set(r);let c=0;for(let l=0;l<a;l++){const r=n?l:o[l];(!n&&u.has(r)||n)&&void 0===t[r]&&void 0===e[r]?(s[r]=void 0,c++):(s[r]=ei(t[r],e[r]),s[r]===t[r]&&void 0!==t[r]&&c++)}return i===a&&c===i?t:s}return e}function ni(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function ri(t){if(!ii(t))return!1;const e=t.constructor;if(void 0===e)return!0;const n=e.prototype;return!!ii(n)&&(!!n.hasOwnProperty("isPrototypeOf")&&Object.getPrototypeOf(t)===Object.prototype)}function ii(t){return"[object Object]"===Object.prototype.toString.call(t)}function oi(t,e,n){return"function"==typeof n.structuralSharing?n.structuralSharing(t,e):!1!==n.structuralSharing?ei(t,e):e}function ai(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function si(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var ui=Symbol();function ci(t,e){return!t.queryFn&&(null==e?void 0:e.initialPromise)?()=>e.initialPromise:t.queryFn&&t.queryFn!==ui?t.queryFn:()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`))}var li=new(r=class extends qr{constructor(){super(),q(this,t),q(this,e),q(this,n),K(this,n,t=>{if(!Kr&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}})}onSubscribe(){G(this,e)||this.setEventListener(G(this,n))}onUnsubscribe(){var t;this.hasListeners()||(null==(t=G(this,e))||t.call(this),K(this,e,void 0))}setEventListener(t){var r;K(this,n,t),null==(r=G(this,e))||r.call(this),K(this,e,t(t=>{"boolean"==typeof t?this.setFocused(t):this.onFocus()}))}setFocused(e){G(this,t)!==e&&(K(this,t,e),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){var e;return"boolean"==typeof G(this,t)?G(this,t):"hidden"!==(null==(e=globalThis.document)?void 0:e.visibilityState)}},t=new WeakMap,e=new WeakMap,n=new WeakMap,r),hi=new(s=class extends qr{constructor(){super(),q(this,i,!0),q(this,o),q(this,a),K(this,a,t=>{if(!Kr&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}})}onSubscribe(){G(this,o)||this.setEventListener(G(this,a))}onUnsubscribe(){var t;this.hasListeners()||(null==(t=G(this,o))||t.call(this),K(this,o,void 0))}setEventListener(t){var e;K(this,a,t),null==(e=G(this,o))||e.call(this),K(this,o,t(this.setOnline.bind(this)))}setOnline(t){G(this,i)!==t&&(K(this,i,t),this.listeners.forEach(e=>{e(t)}))}isOnline(){return G(this,i)}},i=new WeakMap,o=new WeakMap,a=new WeakMap,s);function di(t){return Math.min(1e3*2**t,3e4)}function pi(t){return"online"!==(t??"online")||hi.isOnline()}var fi=class extends Error{constructor(t){super("CancelledError"),this.revert=null==t?void 0:t.revert,this.silent=null==t?void 0:t.silent}};function mi(t){return t instanceof fi}function vi(t){let e,n=!1,r=0,i=!1;const o=function(){let t,e;const n=new Promise((n,r)=>{t=n,e=r});function r(t){Object.assign(n,t),delete n.resolve,delete n.reject}return n.status="pending",n.catch(()=>{}),n.resolve=e=>{r({status:"fulfilled",value:e}),t(e)},n.reject=t=>{r({status:"rejected",reason:t}),e(t)},n}(),a=()=>li.isFocused()&&("always"===t.networkMode||hi.isOnline())&&t.canRun(),s=()=>pi(t.networkMode)&&t.canRun(),u=n=>{var r;i||(i=!0,null==(r=t.onSuccess)||r.call(t,n),null==e||e(),o.resolve(n))},c=n=>{var r;i||(i=!0,null==(r=t.onError)||r.call(t,n),null==e||e(),o.reject(n))},l=()=>new Promise(n=>{var r;e=t=>{(i||a())&&n(t)},null==(r=t.onPause)||r.call(t)}).then(()=>{var n;e=void 0,i||null==(n=t.onContinue)||n.call(t)}),h=()=>{if(i)return;let e;const o=0===r?t.initialPromise:void 0;try{e=o??t.fn()}catch(s){e=Promise.reject(s)}Promise.resolve(e).then(u).catch(e=>{var o;if(i)return;const s=t.retry??(Kr?0:3),u=t.retryDelay??di,d="function"==typeof u?u(r,e):u,p=!0===s||"number"==typeof s&&r<s||"function"==typeof s&&s(r,e);var f;!n&&p?(r++,null==(o=t.onFail)||o.call(t,r,e),(f=d,new Promise(t=>{setTimeout(t,f)})).then(()=>a()?void 0:l()).then(()=>{n?c(e):h()})):c(e)})};return{promise:o,cancel:e=>{var n;i||(c(new fi(e)),null==(n=t.abort)||n.call(t))},continue:()=>(null==e||e(),o),cancelRetry:()=>{n=!0},continueRetry:()=>{n=!1},canStart:s,start:()=>(s()?h():l().then(h),o)}}var gi=t=>setTimeout(t,0);var yi=function(){let t=[],e=0,n=t=>{t()},r=t=>{t()},i=gi;const o=r=>{e?t.push(r):i(()=>{n(r)})};return{batch:o=>{let a;e++;try{a=o()}finally{e--,e||(()=>{const e=t;t=[],e.length&&i(()=>{r(()=>{e.forEach(t=>{n(t)})})})})()}return a},batchCalls:t=>(...e)=>{o(()=>{t(...e)})},schedule:o,setNotifyFunction:t=>{n=t},setBatchNotifyFunction:t=>{r=t},setScheduler:t=>{i=t}}}(),xi=(c=class{constructor(){q(this,u)}destroy(){this.clearGcTimeout()}scheduleGc(){var t;this.clearGcTimeout(),"number"==typeof(t=this.gcTime)&&t>=0&&t!==1/0&&K(this,u,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(Kr?1/0:3e5))}clearGcTimeout(){G(this,u)&&(clearTimeout(G(this,u)),K(this,u,void 0))}},u=new WeakMap,c),bi=(x=class extends xi{constructor(t){super(),q(this,g),q(this,l),q(this,h),q(this,d),q(this,p),q(this,f),q(this,m),q(this,v),K(this,v,!1),K(this,m,t.defaultOptions),this.setOptions(t.options),this.observers=[],K(this,p,t.client),K(this,d,G(this,p).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,K(this,l,function(t){const e="function"==typeof t.initialData?t.initialData():t.initialData,n=void 0!==e,r=n?"function"==typeof t.initialDataUpdatedAt?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}(this.options)),this.state=t.state??G(this,l),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return null==(t=G(this,f))?void 0:t.promise}setOptions(t){this.options={...G(this,m),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){this.observers.length||"idle"!==this.state.fetchStatus||G(this,d).remove(this)}setData(t,e){const n=oi(this.state.data,t,this.options);return Z(this,g,y).call(this,{data:n,type:"success",dataUpdatedAt:null==e?void 0:e.updatedAt,manual:null==e?void 0:e.manual}),n}setState(t,e){Z(this,g,y).call(this,{type:"setState",state:t,setStateOptions:e})}cancel(t){var e,n;const r=null==(e=G(this,f))?void 0:e.promise;return null==(n=G(this,f))||n.cancel(t),r?r.then(Zr).catch(Zr):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(G(this,l))}isActive(){return this.observers.some(t=>{return!1!==(e=t.options.enabled,n=this,"function"==typeof e?e(n):e);var e,n})}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===ui||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0&&this.observers.some(t=>"static"===Xr(t.options.staleTime,this))}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):void 0===this.state.data||this.state.isInvalidated}isStaleByTime(t=0){return void 0===this.state.data||"static"!==t&&(!!this.state.isInvalidated||!function(t,e){return Math.max(t+(e||0)-Date.now(),0)}(this.state.dataUpdatedAt,t))}onFocus(){var t;const e=this.observers.find(t=>t.shouldFetchOnWindowFocus());null==e||e.refetch({cancelRefetch:!1}),null==(t=G(this,f))||t.continue()}onOnline(){var t;const e=this.observers.find(t=>t.shouldFetchOnReconnect());null==e||e.refetch({cancelRefetch:!1}),null==(t=G(this,f))||t.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),G(this,d).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(e=>e!==t),this.observers.length||(G(this,f)&&(G(this,v)?G(this,f).cancel({revert:!0}):G(this,f).cancelRetry()),this.scheduleGc()),G(this,d).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Z(this,g,y).call(this,{type:"invalidate"})}fetch(t,e){var n,r,i;if("idle"!==this.state.fetchStatus)if(void 0!==this.state.data&&(null==e?void 0:e.cancelRefetch))this.cancel({silent:!0});else if(G(this,f))return G(this,f).continueRetry(),G(this,f).promise;if(t&&this.setOptions(t),!this.options.queryFn){const t=this.observers.find(t=>t.options.queryFn);t&&this.setOptions(t.options)}const o=new AbortController,a=t=>{Object.defineProperty(t,"signal",{enumerable:!0,get:()=>(K(this,v,!0),o.signal)})},s=()=>{const t=ci(this.options,e),n=(()=>{const t={client:G(this,p),queryKey:this.queryKey,meta:this.meta};return a(t),t})();return K(this,v,!1),this.options.persister?this.options.persister(t,n,this):t(n)},u=(()=>{const t={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:G(this,p),state:this.state,fetchFn:s};return a(t),t})();null==(n=this.options.behavior)||n.onFetch(u,this),K(this,h,this.state),"idle"!==this.state.fetchStatus&&this.state.fetchMeta===(null==(r=u.fetchOptions)?void 0:r.meta)||Z(this,g,y).call(this,{type:"fetch",meta:null==(i=u.fetchOptions)?void 0:i.meta});const c=t=>{var e,n,r,i;mi(t)&&t.silent||Z(this,g,y).call(this,{type:"error",error:t}),mi(t)||(null==(n=(e=G(this,d).config).onError)||n.call(e,t,this),null==(i=(r=G(this,d).config).onSettled)||i.call(r,this.state.data,t,this)),this.scheduleGc()};return K(this,f,vi({initialPromise:null==e?void 0:e.initialPromise,fn:u.fetchFn,abort:o.abort.bind(o),onSuccess:t=>{var e,n,r,i;if(void 0!==t){try{this.setData(t)}catch(o){return void c(o)}null==(n=(e=G(this,d).config).onSuccess)||n.call(e,t,this),null==(i=(r=G(this,d).config).onSettled)||i.call(r,t,this.state.error,this),this.scheduleGc()}else c(new Error(`${this.queryHash} data is undefined`))},onError:c,onFail:(t,e)=>{Z(this,g,y).call(this,{type:"failed",failureCount:t,error:e})},onPause:()=>{Z(this,g,y).call(this,{type:"pause"})},onContinue:()=>{Z(this,g,y).call(this,{type:"continue"})},retry:u.options.retry,retryDelay:u.options.retryDelay,networkMode:u.options.networkMode,canRun:()=>!0})),G(this,f).start()}},l=new WeakMap,h=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,v=new WeakMap,g=new WeakSet,y=function(t){this.state=(e=>{switch(t.type){case"failed":return{...e,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...e,fetchStatus:"paused"};case"continue":return{...e,fetchStatus:"fetching"};case"fetch":return{...e,...(n=e.data,r=this.options,{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:pi(r.networkMode)?"fetching":"paused",...void 0===n&&{error:null,status:"pending"}}),fetchMeta:t.meta??null};case"success":return K(this,h,void 0),{...e,data:t.data,dataUpdateCount:e.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const i=t.error;return mi(i)&&i.revert&&G(this,h)?{...G(this,h),fetchStatus:"idle"}:{...e,error:i,errorUpdateCount:e.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:e.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...e,isInvalidated:!0};case"setState":return{...e,...t.state}}var n,r})(this.state),yi.batch(()=>{this.observers.forEach(t=>{t.onQueryUpdate()}),G(this,d).notify({query:this,type:"updated",action:t})})},x);var wi=(w=class extends qr{constructor(t={}){super(),q(this,b),this.config=t,K(this,b,new Map)}build(t,e,n){const r=e.queryKey,i=e.queryHash??Jr(r,e);let o=this.get(i);return o||(o=new bi({client:t,queryKey:r,queryHash:i,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(r)}),this.add(o)),o}add(t){G(this,b).has(t.queryHash)||(G(this,b).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=G(this,b).get(t.queryHash);e&&(t.destroy(),e===t&&G(this,b).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){yi.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return G(this,b).get(t)}getAll(){return[...G(this,b).values()]}find(t){const e={exact:!0,...t};return this.getAll().find(t=>$r(e,t))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(e=>$r(t,e)):e}notify(t){yi.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){yi.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){yi.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},b=new WeakMap,w),_i=(k=class extends xi{constructor(t){super(),q(this,I),q(this,_),q(this,E),q(this,C),this.mutationId=t.mutationId,K(this,E,t.mutationCache),K(this,_,[]),this.state=t.state||{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0},this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){G(this,_).includes(t)||(G(this,_).push(t),this.clearGcTimeout(),G(this,E).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){K(this,_,G(this,_).filter(e=>e!==t)),this.scheduleGc(),G(this,E).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){G(this,_).length||("pending"===this.state.status?this.scheduleGc():G(this,E).remove(this))}continue(){var t;return(null==(t=G(this,C))?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var e,n,r,i,o,a,s,u,c,l,h,d,p,f,m,v,g,y,x,b;const w=()=>{Z(this,I,S).call(this,{type:"continue"})};K(this,C,vi({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(t,e)=>{Z(this,I,S).call(this,{type:"failed",failureCount:t,error:e})},onPause:()=>{Z(this,I,S).call(this,{type:"pause"})},onContinue:w,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>G(this,E).canRun(this)}));const _="pending"===this.state.status,k=!G(this,C).canStart();try{if(_)w();else{Z(this,I,S).call(this,{type:"pending",variables:t,isPaused:k}),await(null==(n=(e=G(this,E).config).onMutate)?void 0:n.call(e,t,this));const o=await(null==(i=(r=this.options).onMutate)?void 0:i.call(r,t));o!==this.state.context&&Z(this,I,S).call(this,{type:"pending",context:o,variables:t,isPaused:k})}const p=await G(this,C).start();return await(null==(a=(o=G(this,E).config).onSuccess)?void 0:a.call(o,p,t,this.state.context,this)),await(null==(u=(s=this.options).onSuccess)?void 0:u.call(s,p,t,this.state.context)),await(null==(l=(c=G(this,E).config).onSettled)?void 0:l.call(c,p,null,this.state.variables,this.state.context,this)),await(null==(d=(h=this.options).onSettled)?void 0:d.call(h,p,null,t,this.state.context)),Z(this,I,S).call(this,{type:"success",data:p}),p}catch(T){try{throw await(null==(f=(p=G(this,E).config).onError)?void 0:f.call(p,T,t,this.state.context,this)),await(null==(v=(m=this.options).onError)?void 0:v.call(m,T,t,this.state.context)),await(null==(y=(g=G(this,E).config).onSettled)?void 0:y.call(g,void 0,T,this.state.variables,this.state.context,this)),await(null==(b=(x=this.options).onSettled)?void 0:b.call(x,void 0,T,t,this.state.context)),T}finally{Z(this,I,S).call(this,{type:"error",error:T})}}finally{G(this,E).runNext(this)}}},_=new WeakMap,E=new WeakMap,C=new WeakMap,I=new WeakSet,S=function(t){this.state=(e=>{switch(t.type){case"failed":return{...e,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...e,isPaused:!0};case"continue":return{...e,isPaused:!1};case"pending":return{...e,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...e,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...e,data:void 0,error:t.error,failureCount:e.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}})(this.state),yi.batch(()=>{G(this,_).forEach(e=>{e.onMutationUpdate(t)}),G(this,E).notify({mutation:this,type:"updated",action:t})})},k);var Ei=(A=class extends qr{constructor(t={}){super(),q(this,T),q(this,N),q(this,R),this.config=t,K(this,T,new Set),K(this,N,new Map),K(this,R,0)}build(t,e,n){const r=new _i({mutationCache:this,mutationId:++X(this,R)._,options:t.defaultMutationOptions(e),state:n});return this.add(r),r}add(t){G(this,T).add(t);const e=Ci(t);if("string"==typeof e){const n=G(this,N).get(e);n?n.push(t):G(this,N).set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(G(this,T).delete(t)){const e=Ci(t);if("string"==typeof e){const n=G(this,N).get(e);if(n)if(n.length>1){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}else n[0]===t&&G(this,N).delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=Ci(t);if("string"==typeof e){const n=G(this,N).get(e),r=null==n?void 0:n.find(t=>"pending"===t.state.status);return!r||r===t}return!0}runNext(t){var e;const n=Ci(t);if("string"==typeof n){const r=null==(e=G(this,N).get(n))?void 0:e.find(e=>e!==t&&e.state.isPaused);return(null==r?void 0:r.continue())??Promise.resolve()}return Promise.resolve()}clear(){yi.batch(()=>{G(this,T).forEach(t=>{this.notify({type:"removed",mutation:t})}),G(this,T).clear(),G(this,N).clear()})}getAll(){return Array.from(G(this,T))}find(t){const e={exact:!0,...t};return this.getAll().find(t=>Yr(e,t))}findAll(t={}){return this.getAll().filter(e=>Yr(t,e))}notify(t){yi.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(t=>t.state.isPaused);return yi.batch(()=>Promise.all(t.map(t=>t.continue().catch(Zr))))}},T=new WeakMap,N=new WeakMap,R=new WeakMap,A);function Ci(t){var e;return null==(e=t.options.scope)?void 0:e.id}function Ii(t){return{onFetch:(e,n)=>{var r,i,o,a,s;const u=e.options,c=null==(o=null==(i=null==(r=e.fetchOptions)?void 0:r.meta)?void 0:i.fetchMore)?void 0:o.direction,l=(null==(a=e.state.data)?void 0:a.pages)||[],h=(null==(s=e.state.data)?void 0:s.pageParams)||[];let d={pages:[],pageParams:[]},p=0;const f=async()=>{let n=!1;const r=ci(e.options,e.fetchOptions),i=async(t,i,o)=>{if(n)return Promise.reject();if(null==i&&t.pages.length)return Promise.resolve(t);const a=(()=>{const t={client:e.client,queryKey:e.queryKey,pageParam:i,direction:o?"backward":"forward",meta:e.options.meta};var r;return r=t,Object.defineProperty(r,"signal",{enumerable:!0,get:()=>(e.signal.aborted?n=!0:e.signal.addEventListener("abort",()=>{n=!0}),e.signal)}),t})(),s=await r(a),{maxPages:u}=e.options,c=o?si:ai;return{pages:c(t.pages,s,u),pageParams:c(t.pageParams,i,u)}};if(c&&l.length){const t="backward"===c,e={pages:l,pageParams:h},n=(t?ki:Si)(u,e);d=await i(e,n,t)}else{const e=t??l.length;do{const t=0===p?h[0]??u.initialPageParam:Si(u,d);if(p>0&&null==t)break;d=await i(d,t),p++}while(p<e)}return d};e.options.persister?e.fetchFn=()=>{var t,r;return null==(r=(t=e.options).persister)?void 0:r.call(t,f,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n)}:e.fetchFn=f}}}function Si(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function ki(t,{pages:e,pageParams:n}){var r;return e.length>0?null==(r=t.getPreviousPageParam)?void 0:r.call(t,e[0],e,n[0],n):void 0}var Ti=(W=class{constructor(t={}){q(this,P),q(this,D),q(this,M),q(this,O),q(this,B),q(this,F),q(this,j),q(this,z),K(this,P,t.queryCache||new wi),K(this,D,t.mutationCache||new Ei),K(this,M,t.defaultOptions||{}),K(this,O,new Map),K(this,B,new Map),K(this,F,0)}mount(){X(this,F)._++,1===G(this,F)&&(K(this,j,li.subscribe(async t=>{t&&(await this.resumePausedMutations(),G(this,P).onFocus())})),K(this,z,hi.subscribe(async t=>{t&&(await this.resumePausedMutations(),G(this,P).onOnline())})))}unmount(){var t,e;X(this,F)._--,0===G(this,F)&&(null==(t=G(this,j))||t.call(this),K(this,j,void 0),null==(e=G(this,z))||e.call(this),K(this,z,void 0))}isFetching(t){return G(this,P).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return G(this,D).findAll({...t,status:"pending"}).length}getQueryData(t){var e;const n=this.defaultQueryOptions({queryKey:t});return null==(e=G(this,P).get(n.queryHash))?void 0:e.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=G(this,P).build(this,e),r=n.state.data;return void 0===r?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(Xr(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return G(this,P).findAll(t).map(({queryKey:t,state:e})=>[t,e.data])}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),i=G(this,P).get(r.queryHash),o=function(t,e){return"function"==typeof t?t(e):t}(e,null==i?void 0:i.state.data);if(void 0!==o)return G(this,P).build(this,r).setData(o,{...n,manual:!0})}setQueriesData(t,e,n){return yi.batch(()=>G(this,P).findAll(t).map(({queryKey:t})=>[t,this.setQueryData(t,e,n)]))}getQueryState(t){var e;const n=this.defaultQueryOptions({queryKey:t});return null==(e=G(this,P).get(n.queryHash))?void 0:e.state}removeQueries(t){const e=G(this,P);yi.batch(()=>{e.findAll(t).forEach(t=>{e.remove(t)})})}resetQueries(t,e){const n=G(this,P);return yi.batch(()=>(n.findAll(t).forEach(t=>{t.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=yi.batch(()=>G(this,P).findAll(t).map(t=>t.cancel(n)));return Promise.all(r).then(Zr).catch(Zr)}invalidateQueries(t,e={}){return yi.batch(()=>(G(this,P).findAll(t).forEach(t=>{t.invalidate()}),"none"===(null==t?void 0:t.refetchType)?Promise.resolve():this.refetchQueries({...t,type:(null==t?void 0:t.refetchType)??(null==t?void 0:t.type)??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=yi.batch(()=>G(this,P).findAll(t).filter(t=>!t.isDisabled()&&!t.isStatic()).map(t=>{let e=t.fetch(void 0,n);return n.throwOnError||(e=e.catch(Zr)),"paused"===t.state.fetchStatus?Promise.resolve():e}));return Promise.all(r).then(Zr)}fetchQuery(t){const e=this.defaultQueryOptions(t);void 0===e.retry&&(e.retry=!1);const n=G(this,P).build(this,e);return n.isStaleByTime(Xr(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(Zr).catch(Zr)}fetchInfiniteQuery(t){return t.behavior=Ii(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(Zr).catch(Zr)}ensureInfiniteQueryData(t){return t.behavior=Ii(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return hi.isOnline()?G(this,D).resumePausedMutations():Promise.resolve()}getQueryCache(){return G(this,P)}getMutationCache(){return G(this,D)}getDefaultOptions(){return G(this,M)}setDefaultOptions(t){K(this,M,t)}setQueryDefaults(t,e){G(this,O).set(Qr(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...G(this,O).values()],n={};return e.forEach(e=>{ti(t,e.queryKey)&&Object.assign(n,e.defaultOptions)}),n}setMutationDefaults(t,e){G(this,B).set(Qr(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...G(this,B).values()],n={};return e.forEach(e=>{ti(t,e.mutationKey)&&Object.assign(n,e.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...G(this,M).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=Jr(e.queryKey,e)),void 0===e.refetchOnReconnect&&(e.refetchOnReconnect="always"!==e.networkMode),void 0===e.throwOnError&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===ui&&(e.enabled=!1),e}defaultMutationOptions(t){return(null==t?void 0:t._defaulted)?t:{...G(this,M).mutations,...(null==t?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){G(this,P).clear(),G(this,D).clear()}},P=new WeakMap,D=new WeakMap,M=new WeakMap,O=new WeakMap,B=new WeakMap,F=new WeakMap,j=new WeakMap,z=new WeakMap,W),Ni=Se.createContext(void 0),Ri=({client:t,children:e})=>(Se.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),$.jsx(Ni.Provider,{value:t,children:e}));const Ai=Un("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-soft hover:shadow-card",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-soft",ghost:"hover:bg-accent/10 hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",hero:"bg-gradient-river text-primary-foreground font-semibold shadow-elevated hover:shadow-card hover:-translate-y-0.5 active:translate-y-0",heroOutline:"border-2 border-primary-foreground/80 text-primary-foreground bg-primary-foreground/10 backdrop-blur-sm hover:bg-primary-foreground/20 font-semibold",accent:"bg-accent text-accent-foreground hover:bg-accent/90 shadow-soft",sky:"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-soft hover:shadow-card"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-12 rounded-xl px-8 text-base",xl:"h-14 rounded-xl px-10 text-lg",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Pi=Se.forwardRef(({className:t,variant:e,size:n,asChild:r=!1,...i},o)=>{const a=r?gt:"button";return $.jsx(a,{className:Vn(Ai({variant:e,size:n,className:t})),ref:o,...i})});Pi.displayName="Button";const Di=At,Mi=Pt;Se.forwardRef(({className:t,inset:e,children:n,...r},i)=>$.jsxs(yt,{ref:i,className:Vn("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",e&&"pl-8",t),...r,children:[n,$.jsx(xt,{className:"ml-auto h-4 w-4"})]})).displayName=yt.displayName;Se.forwardRef(({className:t,...e},n)=>$.jsx(bt,{ref:n,className:Vn("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...e})).displayName=bt.displayName;const Oi=Se.forwardRef(({className:t,sideOffset:e=4,...n},r)=>$.jsx(wt,{children:$.jsx(_t,{ref:r,sideOffset:e,className:Vn("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})}));Oi.displayName=_t.displayName;const Li=Se.forwardRef(({className:t,inset:e,...n},r)=>$.jsx(Et,{ref:r,className:Vn("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e&&"pl-8",t),...n}));Li.displayName=Et.displayName;Se.forwardRef(({className:t,children:e,checked:n,...r},i)=>$.jsxs(Ct,{ref:i,className:Vn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t),checked:n,...r,children:[$.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:$.jsx(It,{children:$.jsx(St,{className:"h-4 w-4"})})}),e]})).displayName=Ct.displayName;Se.forwardRef(({className:t,children:e,...n},r)=>$.jsxs(kt,{ref:r,className:Vn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t),...n,children:[$.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:$.jsx(It,{children:$.jsx(Tt,{className:"h-2 w-2 fill-current"})})}),e]})).displayName=kt.displayName;const Bi=Se.forwardRef(({className:t,inset:e,...n},r)=>$.jsx(Nt,{ref:r,className:Vn("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",t),...n}));Bi.displayName=Nt.displayName;const Fi=Se.forwardRef(({className:t,...e},n)=>$.jsx(Rt,{ref:n,className:Vn("-mx-1 my-1 h-px bg-muted",t),...e}));Fi.displayName=Rt.displayName;var ji={exports:{}},zi={},Wi=Se;var Ui="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},Vi=Wi.useState,Hi=Wi.useEffect,Gi=Wi.useLayoutEffect,qi=Wi.useDebugValue;function Ki(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ui(t,n)}catch(r){return!0}}var Zi="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(t,e){return e()}:function(t,e){var n=e(),r=Vi({inst:{value:n,getSnapshot:e}}),i=r[0].inst,o=r[1];return Gi(function(){i.value=n,i.getSnapshot=e,Ki(i)&&o({inst:i})},[t,n,e]),Hi(function(){return Ki(i)&&o({inst:i}),t(function(){Ki(i)&&o({inst:i})})},[t]),qi(n),n};zi.useSyncExternalStore=void 0!==Wi.useSyncExternalStore?Wi.useSyncExternalStore:Zi,ji.exports=zi;var Xi=ji.exports;function $i(){return()=>{}}var Yi="Avatar",[Ji,Qi]=Q(Yi),[to,eo]=Ji(Yi),no=Se.forwardRef((t,e)=>{const{__scopeAvatar:n,...r}=t,[i,o]=Se.useState("idle");return $.jsx(to,{scope:n,imageLoadingStatus:i,onImageLoadingStatusChange:o,children:$.jsx(Y.span,{...r,ref:e})})});no.displayName=Yi;var ro="AvatarImage",io=Se.forwardRef((t,e)=>{const{__scopeAvatar:n,src:r,onLoadingStatusChange:i=()=>{},...o}=t,a=eo(ro,n),s=function(t,{referrerPolicy:e,crossOrigin:n}){const r=Xi.useSyncExternalStore($i,()=>!0,()=>!1),i=Se.useRef(null),o=r?(i.current||(i.current=new window.Image),i.current):null,[a,s]=Se.useState(()=>so(o,t));return ut(()=>{s(so(o,t))},[o,t]),ut(()=>{const t=t=>()=>{s(t)};if(!o)return;const r=t("loaded"),i=t("error");return o.addEventListener("load",r),o.addEventListener("error",i),e&&(o.referrerPolicy=e),"string"==typeof n&&(o.crossOrigin=n),()=>{o.removeEventListener("load",r),o.removeEventListener("error",i)}},[o,n,e]),a}(r,o),u=it(t=>{i(t),a.onImageLoadingStatusChange(t)});return ut(()=>{"idle"!==s&&u(s)},[s,u]),"loaded"===s?$.jsx(Y.img,{...o,ref:e,src:r}):null});io.displayName=ro;var oo="AvatarFallback",ao=Se.forwardRef((t,e)=>{const{__scopeAvatar:n,delayMs:r,...i}=t,o=eo(oo,n),[a,s]=Se.useState(void 0===r);return Se.useEffect(()=>{if(void 0!==r){const t=window.setTimeout(()=>s(!0),r);return()=>window.clearTimeout(t)}},[r]),a&&"loaded"!==o.imageLoadingStatus?$.jsx(Y.span,{...i,ref:e}):null});function so(t,e){return t?e?(t.src!==e&&(t.src=e),t.complete&&t.naturalWidth>0?"loaded":"loading"):"error":"idle"}ao.displayName=oo;var uo=no,co=io,lo=ao;const ho=Se.forwardRef(({className:t,...e},n)=>$.jsx(uo,{ref:n,className:Vn("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...e}));ho.displayName=uo.displayName;Se.forwardRef(({className:t,...e},n)=>$.jsx(co,{ref:n,className:Vn("aspect-square h-full w-full",t),...e})).displayName=co.displayName;const po=Se.forwardRef(({className:t,...e},n)=>$.jsx(lo,{ref:n,className:Vn("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...e}));po.displayName=lo.displayName;var fo={};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mo=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},vo={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const e=t[i],o=i+1<t.length,a=o?t[i+1]:0,s=i+2<t.length,u=s?t[i+2]:0,c=e>>2,l=(3&e)<<4|a>>4;let h=(15&a)<<2|u>>6,d=63&u;s||(d=64,o||(h=64)),r.push(n[c],n[l],n[h],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(mo(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){const o=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(o>>10)),e[r++]=String.fromCharCode(56320+(1023&o))}else{const o=t[n++],a=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const e=n[t.charAt(i++)],o=i<t.length?n[t.charAt(i)]:0;++i;const a=i<t.length?n[t.charAt(i)]:64;++i;const s=i<t.length?n[t.charAt(i)]:64;if(++i,null==e||null==o||null==a||null==s)throw new go;const u=e<<2|o>>4;if(r.push(u),64!==a){const t=o<<4&240|a>>2;if(r.push(t),64!==s){const t=a<<6&192|s;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class go extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const yo=function(t){return function(t){const e=mo(t);return vo.encodeByteArray(e,!0)}(t).replace(/\./g,"")},xo=function(t){try{return vo.decodeString(t,!0)}catch(e){}return null};
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const bo=()=>
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,wo=()=>{try{return bo()||(()=>{if("undefined"==typeof process)return;const t=fo.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const e=t&&xo(t[1]);return e&&JSON.parse(e)})()}catch(t){return}},_o=()=>{var t;return null===(t=wo())||void 0===t?void 0:t.config},Eo=t=>{var e;return null===(e=wo())||void 0===e?void 0:e[`_${t}`]};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Co{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch(()=>{}),1===t.length?t(e):t(e,n))}}}
/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Io(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch(e){return!1}}const So={};let ko=!1;function To(t,e){if("undefined"==typeof window||"undefined"==typeof document||!Io(window.location.host)||So[t]===e||So[t]||ko)return;function n(t){return`__firebase__banner__${t}`}So[t]=e;const r="__firebase__banner",i=function(){const t={prod:[],emulator:[]};for(const e of Object.keys(So))So[e]?t.emulator.push(e):t.prod.push(e);return t}().prod.length>0;function o(){const t=document.createElement("span");return t.style.cursor="pointer",t.style.marginLeft="16px",t.style.fontSize="24px",t.innerHTML=" &times;",t.onclick=()=>{ko=!0,function(){const t=document.getElementById(r);t&&t.remove()}()},t}function a(){const t=function(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}(r),e=n("text"),a=document.getElementById(e)||document.createElement("span"),s=n("learnmore"),u=document.getElementById(s)||document.createElement("a"),c=n("preprendIcon"),l=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.created){const e=t.element;!function(t){t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center"}(e),function(t,e){t.setAttribute("id",e),t.innerText="Learn more",t.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",t.setAttribute("target","__blank"),t.style.paddingLeft="5px",t.style.textDecoration="underline"}(u,s);const n=o();!function(t,e){t.setAttribute("width","24"),t.setAttribute("id",e),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.marginLeft="-6px"}(l,c),e.append(l,a,u,n),document.body.appendChild(e)}i?(a.innerText="Preview backend disconnected.",l.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(l.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',a.innerText="Preview backend running in this workspace."),a.setAttribute("id",e)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",a):a()}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function No(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}class Ro extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,Ro.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ao.prototype.create)}}class Ao{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],o=i?function(t,e){return t.replace(Po,(t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`})}(i,n):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new Ro(r,a,n)}}const Po=/\{\$([^}]+)}/g;function Do(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],o=e[i];if(Mo(n)&&Mo(o)){if(!Do(n,o))return!1}else if(n!==o)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function Mo(t){return null!==t&&"object"==typeof t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oo(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(t=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Lo(t){const e={};return t.replace(/^\?/,"").split("&").forEach(t=>{if(t){const[n,r]=t.split("=");e[decodeURIComponent(n)]=decodeURIComponent(r)}}),e}function Bo(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}class Fo{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(t=>{this.error(t)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,n){let r;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");r=function(t,e){if("object"!=typeof t||null===t)return!1;for(const n of e)if(n in t&&"function"==typeof t[n])return!0;return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n},void 0===r.next&&(r.next=jo),void 0===r.error&&(r.error=jo),void 0===r.complete&&(r.complete=jo);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(t){}}),this.observers.push(r),i}unsubscribeOne(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[t])try{e(this.observers[t])}catch(n){"undefined"!=typeof console&&console.error}})}close(t){this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function jo(){}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zo(t){return t&&t._delegate?t._delegate:t}class Wo{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uo="[DEFAULT]";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vo{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new Co;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(n){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t))try{this.getOrInitializeService({instanceIdentifier:Uo})}catch(e){}for(const[t,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:r});n.resolve(t)}catch(e){}}}}clearInstance(t=Uo){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...t.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return null!=this.component}isInitialized(t=Uo){return this.instances.has(t)}getOptions(t=Uo){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[i,o]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&o.resolve(r)}return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&t(o,r),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(r){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===Uo?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(i){}var r;return n||null}normalizeInstanceIdentifier(t=Uo){return this.component?this.component.multipleInstances?t:Uo:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Ho{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new Vo(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Go,qo;(qo=Go||(Go={}))[qo.DEBUG=0]="DEBUG",qo[qo.VERBOSE=1]="VERBOSE",qo[qo.INFO=2]="INFO",qo[qo.WARN=3]="WARN",qo[qo.ERROR=4]="ERROR",qo[qo.SILENT=5]="SILENT";const Ko={debug:Go.DEBUG,verbose:Go.VERBOSE,info:Go.INFO,warn:Go.WARN,error:Go.ERROR,silent:Go.SILENT},Zo=Go.INFO,Xo={[Go.DEBUG]:"log",[Go.VERBOSE]:"log",[Go.INFO]:"info",[Go.WARN]:"warn",[Go.ERROR]:"error"},$o=(t,e,...n)=>{if(e<t.logLevel)return;(new Date).toISOString();if(!Xo[e])throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Yo{constructor(t){this.name=t,this._logLevel=Zo,this._logHandler=$o,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Go))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?Ko[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Go.DEBUG,...t),this._logHandler(this,Go.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Go.VERBOSE,...t),this._logHandler(this,Go.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Go.INFO,...t),this._logHandler(this,Go.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Go.WARN,...t),this._logHandler(this,Go.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Go.ERROR,...t),this._logHandler(this,Go.ERROR,...t)}}let Jo,Qo;const ta=new WeakMap,ea=new WeakMap,na=new WeakMap,ra=new WeakMap,ia=new WeakMap;let oa={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return ea.get(t);if("objectStoreNames"===e)return t.objectStoreNames||na.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ua(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function aa(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Qo||(Qo=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(ca(this),e),ua(ta.get(this))}:function(...e){return ua(t.apply(ca(this),e))}:function(e,...n){const r=t.call(ca(this),e,...n);return na.set(r,e.sort?e.sort():[e]),ua(r)}}function sa(t){return"function"==typeof t?aa(t):(t instanceof IDBTransaction&&function(t){if(ea.has(t))return;const e=new Promise((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{e(),r()},o=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});ea.set(t,e)}(t),e=t,(Jo||(Jo=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(t,oa):t);var e}function ua(t){if(t instanceof IDBRequest)return function(t){const e=new Promise((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{e(ua(t.result)),r()},o=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(e=>{e instanceof IDBCursor&&ta.set(e,t)}).catch(()=>{}),ia.set(e,t),e}(t);if(ra.has(t))return ra.get(t);const e=sa(t);return e!==t&&(ra.set(t,e),ia.set(e,t)),e}const ca=t=>ia.get(t);const la=["get","getKey","getAll","getAllKeys","count"],ha=["put","add","delete","clear"],da=new Map;function pa(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(da.get(e))return da.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=ha.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!la.includes(n))return;const o=async function(t,...e){const o=this.transaction(t,i?"readwrite":"readonly");let a=o.store;return r&&(a=a.index(e.shift())),(await Promise.all([a[n](...e),i&&o.done]))[0]};return da.set(e,o),o}oa=(t=>({...t,get:(e,n,r)=>pa(e,n)||t.get(e,n,r),has:(e,n)=>!!pa(e,n)||t.has(e,n)}))(oa);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class fa{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null}).filter(t=>t).join(" ")}}const ma="@firebase/app",va="0.13.2",ga=new Yo("@firebase/app"),ya="@firebase/app-compat",xa="@firebase/analytics-compat",ba="@firebase/analytics",wa="@firebase/app-check-compat",_a="@firebase/app-check",Ea="@firebase/auth",Ca="@firebase/auth-compat",Ia="@firebase/database",Sa="@firebase/data-connect",ka="@firebase/database-compat",Ta="@firebase/functions",Na="@firebase/functions-compat",Ra="@firebase/installations",Aa="@firebase/installations-compat",Pa="@firebase/messaging",Da="@firebase/messaging-compat",Ma="@firebase/performance",Oa="@firebase/performance-compat",La="@firebase/remote-config",Ba="@firebase/remote-config-compat",Fa="@firebase/storage",ja="@firebase/storage-compat",za="@firebase/firestore",Wa="@firebase/ai",Ua="@firebase/firestore-compat",Va="firebase",Ha="[DEFAULT]",Ga={[ma]:"fire-core",[ya]:"fire-core-compat",[ba]:"fire-analytics",[xa]:"fire-analytics-compat",[_a]:"fire-app-check",[wa]:"fire-app-check-compat",[Ea]:"fire-auth",[Ca]:"fire-auth-compat",[Ia]:"fire-rtdb",[Sa]:"fire-data-connect",[ka]:"fire-rtdb-compat",[Ta]:"fire-fn",[Na]:"fire-fn-compat",[Ra]:"fire-iid",[Aa]:"fire-iid-compat",[Pa]:"fire-fcm",[Da]:"fire-fcm-compat",[Ma]:"fire-perf",[Oa]:"fire-perf-compat",[La]:"fire-rc",[Ba]:"fire-rc-compat",[Fa]:"fire-gcs",[ja]:"fire-gcs-compat",[za]:"fire-fst",[Ua]:"fire-fst-compat",[Wa]:"fire-vertex","fire-js":"fire-js",[Va]:"fire-js-all"},qa=new Map,Ka=new Map,Za=new Map;function Xa(t,e){try{t.container.addComponent(e)}catch(n){ga.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function $a(t){const e=t.name;if(Za.has(e))return ga.debug(`There were multiple attempts to register component ${e}.`),!1;Za.set(e,t);for(const n of qa.values())Xa(n,t);for(const n of Ka.values())Xa(n,t);return!0}function Ya(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Ja(t){return null!=t&&void 0!==t.settings}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qa=new Ao("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ts{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Wo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Qa.create("app-deleted",{appName:this._name})}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const es="11.10.0";function ns(t,e={}){let n=t;if("object"!=typeof e){e={name:e}}const r=Object.assign({name:Ha,automaticDataCollectionEnabled:!0},e),i=r.name;if("string"!=typeof i||!i)throw Qa.create("bad-app-name",{appName:String(i)});if(n||(n=_o()),!n)throw Qa.create("no-options");const o=qa.get(i);if(o){if(Do(n,o.options)&&Do(r,o.config))return o;throw Qa.create("duplicate-app",{appName:i})}const a=new Ho(i);for(const u of Za.values())a.addComponent(u);const s=new ts(n,r,a);return qa.set(i,s),s}function rs(t,e,n){var r;let i=null!==(r=Ga[t])&&void 0!==r?r:t;n&&(i+=`-${n}`);const o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){const t=[`Unable to register library "${i}" with version "${e}":`];return o&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&t.push("and"),a&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void ga.warn(t.join(" "))}$a(new Wo(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const is="firebase-heartbeat-store";let os=null;function as(){return os||(os=function(t,e,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const a=indexedDB.open(t,e),s=ua(a);return r&&a.addEventListener("upgradeneeded",t=>{r(ua(a.result),t.oldVersion,t.newVersion,ua(a.transaction),t)}),n&&a.addEventListener("blocked",t=>n(t.oldVersion,t.newVersion,t)),s.then(t=>{o&&t.addEventListener("close",()=>o()),i&&t.addEventListener("versionchange",t=>i(t.oldVersion,t.newVersion,t))}).catch(()=>{}),s}("firebase-heartbeat-database",1,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(is)}catch(n){}}}).catch(t=>{throw Qa.create("idb-open",{originalErrorMessage:t.message})})),os}async function ss(t,e){try{const n=(await as()).transaction(is,"readwrite"),r=n.objectStore(is);await r.put(e,us(t)),await n.done}catch(n){if(n instanceof Ro)ga.warn(n.message);else{const t=Qa.create("idb-set",{originalErrorMessage:null==n?void 0:n.message});ga.warn(t.message)}}}function us(t){return`${t.name}!${t.options.appId}`}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cs{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new hs(e),this._heartbeatsCachePromise=this._storage.read().then(t=>(this._heartbeatsCache=t,t))}async triggerHeartbeat(){var t,e;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=ls();if(null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(t=>t.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const t=function(t){if(0===t.length)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(t,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){ga.warn(n)}}async getHeartbeatsHeader(){var t;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=ls(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const i of t){const t=n.find(t=>t.agent===i.agent);if(t){if(t.dates.push(i.date),ds(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),ds(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=yo(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return ga.warn(e),""}}}function ls(){return(new Date).toISOString().substring(0,10)}class hs{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(t){return!1}}()&&new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(n){e(n)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await as()).transaction(is),n=await e.objectStore(is).get(us(t));return await e.done,n}catch(e){if(e instanceof Ro)ga.warn(e.message);else{const t=Qa.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});ga.warn(t.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return ss(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return ss(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function ds(t){return yo(JSON.stringify({version:2,heartbeats:t})).length}var ps;function fs(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}ps="",$a(new Wo("platform-logger",t=>new fa(t),"PRIVATE")),$a(new Wo("heartbeat",t=>new cs(t),"PRIVATE")),rs(ma,va,ps),rs(ma,va,"esm2017"),rs("fire-js","");const ms=fs,vs=new Ao("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),gs=new Yo("@firebase/auth");function ys(t,...e){gs.logLevel<=Go.ERROR&&gs.error(`Auth (${es}): ${t}`,...e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xs(t,...e){throw Es(t,...e)}function bs(t,...e){return Es(t,...e)}function ws(t,e,n){const r=Object.assign(Object.assign({},ms()),{[e]:n});return new Ao("auth","Firebase",r).create(e,{appName:t.name})}function _s(t){return ws(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Es(t,...e){if("string"!=typeof t){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return vs.create(t,...e)}function Cs(t,e,...n){if(!t)throw Es(e,...n)}function Is(t){const e="INTERNAL ASSERTION FAILED: "+t;throw ys(e),new Error(e)}function Ss(t,e){t||Is(e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ks(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.href)||""}function Ts(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.protocol)||null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ns(){return"undefined"==typeof navigator||!navigator||!("onLine"in navigator)||"boolean"!=typeof navigator.onLine||"http:"!==Ts()&&"https:"!==Ts()&&!function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()&&!("connection"in navigator)||navigator.onLine}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Rs{constructor(t,e){this.shortDelay=t,this.longDelay=e,Ss(e>t,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(No())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return Ns()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function As(t,e){Ss(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ps{static initialize(t,e,n){this.fetchImpl=t,e&&(this.headersImpl=e),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Is("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Is("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Is("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ds={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Ms=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Os=new Rs(3e4,6e4);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ls(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Bs(t,e,n,r,i={}){return Fs(t,i,async()=>{let i={},o={};r&&("GET"===e?o=r:i={body:JSON.stringify(r)});const a=Oo(Object.assign({key:t.config.apiKey},o)).slice(1),s=await t._getAdditionalHeaders();s["Content-Type"]="application/json",t.languageCode&&(s["X-Firebase-Locale"]=t.languageCode);const u=Object.assign({method:e,headers:s},i);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(u.referrerPolicy="no-referrer"),t.emulatorConfig&&Io(t.emulatorConfig.host)&&(u.credentials="include"),Ps.fetch()(await zs(t,t.config.apiHost,n,a),u)})}async function Fs(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},Ds),e);try{const e=new Us(t),i=await Promise.race([n(),e.promise]);e.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Vs(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const e=i.ok?o.errorMessage:o.error.message,[n,a]=e.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Vs(t,"credential-already-in-use",o);if("EMAIL_EXISTS"===n)throw Vs(t,"email-already-in-use",o);if("USER_DISABLED"===n)throw Vs(t,"user-disabled",o);const s=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw ws(t,s,a);xs(t,s)}}catch(i){if(i instanceof Ro)throw i;xs(t,"network-request-failed",{message:String(i)})}}async function js(t,e,n,r,i={}){const o=await Bs(t,e,n,r,i);return"mfaPendingCredential"in o&&xs(t,"multi-factor-auth-required",{_serverResponse:o}),o}async function zs(t,e,n,r){const i=`${e}${n}?${r}`,o=t,a=o.config.emulator?As(t.config,i):`${t.config.apiScheme}://${i}`;if(Ms.includes(n)&&(await o._persistenceManagerAvailable,"COOKIE"===o._getPersistenceType())){return o._getPersistence()._getFinalTarget(a).toString()}return a}function Ws(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Us{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((t,e)=>{this.timer=setTimeout(()=>e(bs(this.auth,"network-request-failed")),Os.get())})}}function Vs(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=bs(t,e,r);return i.customData._tokenResponse=n,i}function Hs(t){return void 0!==t&&void 0!==t.enterprise}class Gs{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===t.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const e of this.recaptchaEnforcementState)if(e.provider&&e.provider===t)return Ws(e.enforcementState);return null}isProviderEnabled(t){return"ENFORCE"===this.getProviderEnforcementState(t)||"AUDIT"===this.getProviderEnforcementState(t)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function qs(t,e){return Bs(t,"POST","/v1/accounts:lookup",e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ks(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch(e){}}function Zs(t){return 1e3*Number(t)}function Xs(t){const[e,n,r]=t.split(".");if(void 0===e||void 0===n||void 0===r)return ys("JWT malformed, contained fewer than 3 sections"),null;try{const t=xo(n);return t?JSON.parse(t):(ys("Failed to decode base64 JWT payload"),null)}catch(i){return ys("Caught error parsing JWT payload as JSON",null==i?void 0:i.toString()),null}}function $s(t){const e=Xs(t);return Cs(e,"internal-error"),Cs(void 0!==e.exp,"internal-error"),Cs(void 0!==e.iat,"internal-error"),Number(e.exp)-Number(e.iat)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ys(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Ro&&function({code:t}){return"auth/user-disabled"===t||"auth/user-token-expired"===t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}class Js{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){const t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}{this.errorBackoff=3e4;const t=(null!==(e=this.user.stsTokenManager.expirationTime)&&void 0!==e?e:0)-Date.now()-3e5;return Math.max(0,t)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===(null==t?void 0:t.code)&&this.schedule(!0))}this.schedule()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ks(this.lastLoginAt),this.creationTime=Ks(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tu(t){var e;const n=t.auth,r=await t.getIdToken(),i=await Ys(t,qs(n,{idToken:r}));Cs(null==i?void 0:i.users.length,n,"internal-error");const o=i.users[0];t._notifyReloadListener(o);const a=(null===(e=o.providerUserInfo)||void 0===e?void 0:e.length)?eu(o.providerUserInfo):[],s=(u=t.providerData,c=a,[...u.filter(t=>!c.some(e=>e.providerId===t.providerId)),...c]);var u,c;const l=t.isAnonymous,h=!(t.email&&o.passwordHash||(null==s?void 0:s.length)),d=!!l&&h,p={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:s,metadata:new Qs(o.createdAt,o.lastLoginAt),isAnonymous:d};Object.assign(t,p)}function eu(t){return t.map(t=>{var{providerId:e}=t,n=Dt(t,["providerId"]);return{providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class nu{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Cs(t.idToken,"internal-error"),Cs(void 0!==t.idToken,"internal-error"),Cs(void 0!==t.refreshToken,"internal-error");const e="expiresIn"in t&&void 0!==t.expiresIn?Number(t.expiresIn):$s(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){Cs(0!==t.length,"internal-error");const e=$s(t);this.updateTokensAndExpiration(t,null,e)}async getToken(t,e=!1){return e||!this.accessToken||this.isExpired?(Cs(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(t,e){const n=await Fs(t,{},async()=>{const n=Oo({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:i}=t.config,o=await zs(t,r,"/v1/token",`key=${i}`),a=await t._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const s={method:"POST",headers:a,body:n};return t.emulatorConfig&&Io(t.emulatorConfig.host)&&(s.credentials="include"),Ps.fetch()(o,s)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(t,e);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(t,e,n){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(t,e){const{refreshToken:n,accessToken:r,expirationTime:i}=e,o=new nu;return n&&(Cs("string"==typeof n,"internal-error",{appName:t}),o.refreshToken=n),r&&(Cs("string"==typeof r,"internal-error",{appName:t}),o.accessToken=r),i&&(Cs("number"==typeof i,"internal-error",{appName:t}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new nu,this.toJSON())}_performRefresh(){return Is("not implemented")}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ru(t,e){Cs("string"==typeof t||void 0===t,"internal-error",{appName:e})}class iu{constructor(t){var{uid:e,auth:n,stsTokenManager:r}=t,i=Dt(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Js(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Qs(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(t){const e=await Ys(this,this.stsTokenManager.getToken(this.auth,t));return Cs(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return async function(t,e=!1){const n=zo(t),r=await n.getIdToken(e),i=Xs(r);Cs(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const o="object"==typeof i.firebase?i.firebase:void 0,a=null==o?void 0:o.sign_in_provider;return{claims:i,token:r,authTime:Ks(Zs(i.auth_time)),issuedAtTime:Ks(Zs(i.iat)),expirationTime:Ks(Zs(i.exp)),signInProvider:a||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null}}(this,t)}reload(){return async function(t){const e=zo(t);await tu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}(this)}_assign(t){this!==t&&(Cs(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(t=>Object.assign({},t)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const e=new iu(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return e.metadata._copy(this.metadata),e}_onReload(t){Cs(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let n=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),n=!0),e&&await tu(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ja(this.auth.app))return Promise.reject(_s(this.auth));const t=await this.getIdToken();return await Ys(this,
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function(t,e){return Bs(t,"POST","/v1/accounts:delete",e)}(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var n,r,i,o,a,s,u,c;const l=null!==(n=e.displayName)&&void 0!==n?n:void 0,h=null!==(r=e.email)&&void 0!==r?r:void 0,d=null!==(i=e.phoneNumber)&&void 0!==i?i:void 0,p=null!==(o=e.photoURL)&&void 0!==o?o:void 0,f=null!==(a=e.tenantId)&&void 0!==a?a:void 0,m=null!==(s=e._redirectEventId)&&void 0!==s?s:void 0,v=null!==(u=e.createdAt)&&void 0!==u?u:void 0,g=null!==(c=e.lastLoginAt)&&void 0!==c?c:void 0,{uid:y,emailVerified:x,isAnonymous:b,providerData:w,stsTokenManager:_}=e;Cs(y&&_,t,"internal-error");const E=nu.fromJSON(this.name,_);Cs("string"==typeof y,t,"internal-error"),ru(l,t.name),ru(h,t.name),Cs("boolean"==typeof x,t,"internal-error"),Cs("boolean"==typeof b,t,"internal-error"),ru(d,t.name),ru(p,t.name),ru(f,t.name),ru(m,t.name),ru(v,t.name),ru(g,t.name);const C=new iu({uid:y,auth:t,email:h,emailVerified:x,displayName:l,isAnonymous:b,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:E,createdAt:v,lastLoginAt:g});return w&&Array.isArray(w)&&(C.providerData=w.map(t=>Object.assign({},t))),m&&(C._redirectEventId=m),C}static async _fromIdTokenResponse(t,e,n=!1){const r=new nu;r.updateFromServerResponse(e);const i=new iu({uid:e.localId,auth:t,stsTokenManager:r,isAnonymous:n});return await tu(i),i}static async _fromGetAccountInfoResponse(t,e,n){const r=e.users[0];Cs(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?eu(r.providerUserInfo):[],o=!(r.email&&r.passwordHash||(null==i?void 0:i.length)),a=new nu;a.updateFromIdToken(n);const s=new iu({uid:r.localId,auth:t,stsTokenManager:a,isAnonymous:o}),u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new Qs(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash||(null==i?void 0:i.length))};return Object.assign(s,u),s}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ou=new Map;function au(t){Ss(t instanceof Function,"Expected a class definition");let e=ou.get(t);return e?(Ss(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,ou.set(t,e),e)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class su{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return void 0===e?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}su.type="NONE";const uu=su;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cu(t,e,n){return`firebase:${t}:${e}:${n}`}class lu{constructor(t,e,n){this.persistence=t,this.auth=e,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=cu(this.userKey,r.apiKey,i),this.fullPersistenceKey=cu("persistence",r.apiKey,i),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);if(!t)return null;if("string"==typeof t){const e=await qs(this.auth,{idToken:t}).catch(()=>{});return e?iu._fromGetAccountInfoResponse(this.auth,e,t):null}return iu._fromJSON(this.auth,t)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=t,e?this.setCurrentUser(e):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,n="authUser"){if(!e.length)return new lu(au(uu),t,n);const r=(await Promise.all(e.map(async t=>{if(await t._isAvailable())return t}))).filter(t=>t);let i=r[0]||au(uu);const o=cu(n,t.config.apiKey,t.name);let a=null;for(const c of e)try{const e=await c._get(o);if(e){let n;if("string"==typeof e){const r=await qs(t,{idToken:e}).catch(()=>{});if(!r)break;n=await iu._fromGetAccountInfoResponse(t,r,e)}else n=iu._fromJSON(t,e);c!==i&&(a=n),i=c;break}}catch(u){}const s=r.filter(t=>t._shouldAllowMigration);return i._shouldAllowMigration&&s.length?(i=s[0],a&&await i._set(o,a.toJSON()),await Promise.all(e.map(async t=>{if(t!==i)try{await t._remove(o)}catch(u){}})),new lu(i,t,n)):new lu(i,t,n)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hu(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(mu(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(du(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(gu(e))return"Blackberry";if(yu(e))return"Webos";if(pu(e))return"Safari";if((e.includes("chrome/")||fu(e))&&!e.includes("edge/"))return"Chrome";if(vu(e))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=t.match(e);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function du(t=No()){return/firefox\//i.test(t)}function pu(t=No()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function fu(t=No()){return/crios\//i.test(t)}function mu(t=No()){return/iemobile/i.test(t)}function vu(t=No()){return/android/i.test(t)}function gu(t=No()){return/blackberry/i.test(t)}function yu(t=No()){return/webos/i.test(t)}function xu(t=No()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function bu(){return function(){const t=No();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}()&&10===document.documentMode}function wu(t=No()){return xu(t)||vu(t)||yu(t)||gu(t)||/windows phone/i.test(t)||mu(t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _u(t,e=[]){let n;switch(t){case"Browser":n=hu(No());break;case"Worker":n=`${hu(No())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${es}/${r}`}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const n=e=>new Promise((n,r)=>{try{n(t(e))}catch(i){r(i)}});n.onAbort=e,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const e=[];try{for(const n of this.queue)await n(t),n.onAbort&&e.push(n.onAbort)}catch(n){e.reverse();for(const t of e)try{t()}catch(r){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==n?void 0:n.message})}}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cu{constructor(t){var e,n,r,i;const o=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(e=o.minPasswordLength)&&void 0!==e?e:6,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),void 0!==o.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),void 0!==o.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),void 0!==o.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),void 0!==o.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=t.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=t.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=t.schemaVersion}validatePassword(t){var e,n,r,i,o,a;const s={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,s),this.validatePasswordCharacterOptions(t,s),s.isValid&&(s.isValid=null===(e=s.meetsMinPasswordLength)||void 0===e||e),s.isValid&&(s.isValid=null===(n=s.meetsMaxPasswordLength)||void 0===n||n),s.isValid&&(s.isValid=null===(r=s.containsLowercaseLetter)||void 0===r||r),s.isValid&&(s.isValid=null===(i=s.containsUppercaseLetter)||void 0===i||i),s.isValid&&(s.isValid=null===(o=s.containsNumericCharacter)||void 0===o||o),s.isValid&&(s.isValid=null===(a=s.containsNonAlphanumericCharacter)||void 0===a||a),s}validatePasswordLengthOptions(t,e){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(e.meetsMinPasswordLength=t.length>=n),r&&(e.meetsMaxPasswordLength=t.length<=r)}validatePasswordCharacterOptions(t,e){let n;this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);for(let r=0;r<t.length;r++)n=t.charAt(r),this.updatePasswordCharacterOptionsStatuses(e,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(t,e,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=i))}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iu{constructor(t,e,n,r){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ku(this),this.idTokenSubscription=new ku(this),this.beforeStateQueue=new Eu(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=vs,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(t=>this._resolvePersistenceManagerAvailable=t)}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=au(e)),this._initializationPromise=this.queue(async()=>{var n,r,i;if(!this._deleted&&(this.persistenceManager=await lu.create(this,t),null===(n=this._resolvePersistenceManagerAvailable)||void 0===n||n.call(this),!this._deleted)){if(null===(r=this._popupRedirectResolver)||void 0===r?void 0:r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(o){}await this.initializeCurrentUser(e),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();return this.currentUser||t?this.currentUser&&t&&this.currentUser.uid===t.uid?(this._currentUser._assign(t),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(t,!0)):void 0}async initializeCurrentUserFromIdToken(t){try{const e=await qs(this,{idToken:t}),n=await iu._fromGetAccountInfoResponse(this,e,t);await this.directlySetCurrentUser(n)}catch(e){await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var e;if(Ja(this.app)){const t=this.app.settings.authIdToken;return t?new Promise(e=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(t).then(e,e))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(e=this.redirectUser)||void 0===e?void 0:e._redirectEventId,o=null==r?void 0:r._redirectEventId,a=await this.tryRedirectSignIn(t);n&&n!==o||!(null==a?void 0:a.user)||(r=a.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Cs(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch(n){await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await tu(t)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Ja(this.app))return Promise.reject(_s(this));const e=t?zo(t):null;return e&&Cs(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&Cs(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Ja(this.app)?Promise.reject(_s(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Ja(this.app)?Promise.reject(_s(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(au(t))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const e=this._getPasswordPolicyInternal();return e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):e.validatePassword(t)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await async function(t,e={}){return Bs(t,"GET","/v2/passwordPolicy",Ls(t,e))}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this),e=new Cu(t);null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(t){this._errorFactory=new Ao("auth","Firebase",t())}onAuthStateChanged(t,e,n){return this.registerStateListener(this.authStateSubscription,t,e,n)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,n){return this.registerStateListener(this.idTokenSubscription,t,e,n)}authStateReady(){return new Promise((t,e)=>{if(this.currentUser)t();else{const n=this.onAuthStateChanged(()=>{n(),t()},e)}})}async revokeAccessToken(t){if(this.currentUser){const e={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(e.tenantId=this.tenantId),await async function(t,e){return Bs(t,"POST","/v2/accounts:revokeToken",Ls(t,e))}(this,e)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(t=this._currentUser)||void 0===t?void 0:t.toJSON()}}async _setRedirectUser(t,e){const n=await this.getOrInitRedirectPersistenceManager(e);return null===t?n.removeCurrentUser():n.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&au(t)||this._popupRedirectResolver;Cs(e,this,"argument-error"),this.redirectPersistenceManager=await lu.create(this,[au(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var e,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(e=this._currentUser)||void 0===e?void 0:e._redirectEventId)===t?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,n,r){if(this._deleted)return()=>{};const i="function"==typeof e?e:e.next.bind(e);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Cs(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),"function"==typeof e){const i=t.addObserver(e,n,r);return()=>{o=!0,i()}}{const n=t.addObserver(e);return()=>{o=!0,n()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Cs(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){t&&!this.frameworks.includes(t)&&(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=_u(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var t;if(Ja(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await(null===(t=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getToken());return(null==e?void 0:e.error)&&function(t,...e){gs.logLevel<=Go.WARN&&gs.warn(`Auth (${es}): ${t}`,...e)}(`Error while retrieving App Check token: ${e.error}`),null==e?void 0:e.token}}function Su(t){return zo(t)}class ku{constructor(t){this.auth=t,this.observer=null,this.addObserver=function(t,e){const n=new Fo(t,e);return n.subscribe.bind(n)}(t=>this.observer=t)}get next(){return Cs(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tu={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Nu(t){return Tu.loadJS(t)}class Ru{constructor(){this.enterprise=new Au}ready(t){t()}execute(t,e){return Promise.resolve("token")}render(t,e){return""}}class Au{ready(t){t()}execute(t,e){return Promise.resolve("token")}render(t,e){return""}}const Pu="NO_RECAPTCHA";class Du{constructor(t){this.type="recaptcha-enterprise",this.auth=Su(t)}async verify(t="verify",e=!1){async function n(t){if(!e){if(null==t.tenantId&&null!=t._agentRecaptchaConfig)return t._agentRecaptchaConfig.siteKey;if(null!=t.tenantId&&void 0!==t._tenantRecaptchaConfigs[t.tenantId])return t._tenantRecaptchaConfigs[t.tenantId].siteKey}return new Promise(async(e,n)=>{(async function(t,e){return Bs(t,"GET","/v2/recaptchaConfig",Ls(t,e))})(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const n=new Gs(r);return null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,e(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(t=>{n(t)})})}function r(e,n,r){const i=window.grecaptcha;Hs(i)?i.enterprise.ready(()=>{i.enterprise.execute(e,{action:t}).then(t=>{n(t)}).catch(()=>{n(Pu)})}):r(Error("No reCAPTCHA enterprise script loaded."))}if(this.auth.settings.appVerificationDisabledForTesting){return(new Ru).execute("siteKey",{action:"verify"})}return new Promise((t,i)=>{n(this.auth).then(n=>{if(!e&&Hs(window.grecaptcha))r(n,t,i);else{if("undefined"==typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));let e=Tu.recaptchaEnterpriseScript;0!==e.length&&(e+=n),Nu(e).then(()=>{r(n,t,i)}).catch(t=>{i(t)})}}).catch(t=>{i(t)})})}}async function Mu(t,e,n,r=!1,i=!1){const o=new Du(t);let a;if(i)a=Pu;else try{a=await o.verify(n)}catch(u){a=await o.verify(n,!0)}const s=Object.assign({},e);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in s){const t=s.phoneEnrollmentInfo.phoneNumber,e=s.phoneEnrollmentInfo.recaptchaToken;Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:t,recaptchaToken:e,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in s){const t=s.phoneSignInInfo.recaptchaToken;Object.assign(s,{phoneSignInInfo:{recaptchaToken:t,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return s}return r?Object.assign(s,{captchaResp:a}):Object.assign(s,{captchaResponse:a}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),s}async function Ou(t,e,n,r,i){var o;if(null===(o=t._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Mu(t,e,n,"getOobCode"===n);return r(t,i)}return r(t,e).catch(async i=>{if("auth/missing-recaptcha-token"===i.code){const i=await Mu(t,e,n,"getOobCode"===n);return r(t,i)}return Promise.reject(i)})}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lu(t,e,n){const r=Su(t);Cs(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=Bu(e),{host:o,port:a}=function(t){const e=Bu(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const t=i[1];return{host:t,port:Fu(r.substr(t.length+1))}}{const[t,e]=r.split(":");return{host:t,port:Fu(e)}}}(e),s=null===a?"":`:${a}`,u={url:`${i}//${o}${s}/`},c=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!r._canInitEmulator)return Cs(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void Cs(Do(u,r.config.emulator)&&Do(c,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=u,r.emulatorConfig=c,r.settings.appVerificationDisabledForTesting=!0,Io(o)?(!async function(t){(await fetch(t,{credentials:"include"})).ok}(`${i}//${o}${s}`),To("Auth",!0)):function(){function t(){const t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}"undefined"!=typeof console&&console.info;"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",t):t())}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */()}function Bu(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Fu(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}class ju{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return Is("not implemented")}_getIdTokenResponse(t){return Is("not implemented")}_linkToIdToken(t,e){return Is("not implemented")}_getReauthenticationResolver(t){return Is("not implemented")}}async function zu(t,e){return Bs(t,"POST","/v1/accounts:signUp",e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wu(t,e){return js(t,"POST","/v1/accounts:signInWithPassword",Ls(t,e))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Uu extends ju{constructor(t,e,n,r=null){super("password",n),this._email=t,this._password=e,this._tenantId=r}static _fromEmailAndPassword(t,e){return new Uu(t,e,"password")}static _fromEmailAndCode(t,e,n=null){return new Uu(t,e,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t;if((null==e?void 0:e.email)&&(null==e?void 0:e.password)){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":return Ou(t,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Wu);case"emailLink":return async function(t,e){return js(t,"POST","/v1/accounts:signInWithEmailLink",Ls(t,e))}(t,{email:this._email,oobCode:this._password});default:xs(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":return Ou(t,{idToken:e,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",zu);case"emailLink":return async function(t,e){return js(t,"POST","/v1/accounts:signInWithEmailLink",Ls(t,e))}(t,{idToken:e,email:this._email,oobCode:this._password});default:xs(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vu(t,e){return js(t,"POST","/v1/accounts:signInWithIdp",Ls(t,e))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hu extends ju{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new Hu(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):xs("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t,{providerId:n,signInMethod:r}=e,i=Dt(e,["providerId","signInMethod"]);if(!n||!r)return null;const o=new Hu(n,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(t){return Vu(t,this.buildRequest())}_linkToIdToken(t,e){const n=this.buildRequest();return n.idToken=e,Vu(t,n)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,Vu(t,e)}buildRequest(){const t={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=Oo(e)}return t}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gu{constructor(t){var e,n,r,i,o,a;const s=Lo(Bo(t)),u=null!==(e=s.apiKey)&&void 0!==e?e:null,c=null!==(n=s.oobCode)&&void 0!==n?n:null,l=function(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=s.mode)&&void 0!==r?r:null);Cs(u&&c&&l,"argument-error"),this.apiKey=u,this.operation=l,this.code=c,this.continueUrl=null!==(i=s.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(o=s.lang)&&void 0!==o?o:null,this.tenantId=null!==(a=s.tenantId)&&void 0!==a?a:null}static parseLink(t){const e=function(t){const e=Lo(Bo(t)).link,n=e?Lo(Bo(e)).deep_link_id:null,r=Lo(Bo(t)).deep_link_id;return(r?Lo(Bo(r)).link:null)||r||n||e||t}(t);try{return new Gu(e)}catch(n){return null}}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu{constructor(){this.providerId=qu.PROVIDER_ID}static credential(t,e){return Uu._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const n=Gu.parseLink(e);return Cs(n,"argument-error"),Uu._fromEmailAndCode(t,n.code,n.tenantId)}}qu.PROVIDER_ID="password",qu.EMAIL_PASSWORD_SIGN_IN_METHOD="password",qu.EMAIL_LINK_SIGN_IN_METHOD="emailLink";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ku{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zu extends Ku{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xu extends Zu{constructor(){super("facebook.com")}static credential(t){return Hu._fromParams({providerId:Xu.PROVIDER_ID,signInMethod:Xu.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Xu.credentialFromTaggedObject(t)}static credentialFromError(t){return Xu.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Xu.credential(t.oauthAccessToken)}catch(e){return null}}}Xu.FACEBOOK_SIGN_IN_METHOD="facebook.com",Xu.PROVIDER_ID="facebook.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class $u extends Zu{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return Hu._fromParams({providerId:$u.PROVIDER_ID,signInMethod:$u.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return $u.credentialFromTaggedObject(t)}static credentialFromError(t){return $u.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:n}=t;if(!e&&!n)return null;try{return $u.credential(e,n)}catch(r){return null}}}$u.GOOGLE_SIGN_IN_METHOD="google.com",$u.PROVIDER_ID="google.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Yu extends Zu{constructor(){super("github.com")}static credential(t){return Hu._fromParams({providerId:Yu.PROVIDER_ID,signInMethod:Yu.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Yu.credentialFromTaggedObject(t)}static credentialFromError(t){return Yu.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Yu.credential(t.oauthAccessToken)}catch(e){return null}}}Yu.GITHUB_SIGN_IN_METHOD="github.com",Yu.PROVIDER_ID="github.com";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ju extends Zu{constructor(){super("twitter.com")}static credential(t,e){return Hu._fromParams({providerId:Ju.PROVIDER_ID,signInMethod:Ju.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return Ju.credentialFromTaggedObject(t)}static credentialFromError(t){return Ju.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:n}=t;if(!e||!n)return null;try{return Ju.credential(e,n)}catch(r){return null}}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function Qu(t,e){return js(t,"POST","/v1/accounts:signUp",Ls(t,e))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ju.TWITTER_SIGN_IN_METHOD="twitter.com",Ju.PROVIDER_ID="twitter.com";class tc{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,n,r=!1){const i=await iu._fromIdTokenResponse(t,n,r),o=ec(n);return new tc({user:i,providerId:o,_tokenResponse:n,operationType:e})}static async _forOperation(t,e,n){await t._updateTokensIfNecessary(n,!0);const r=ec(n);return new tc({user:t,providerId:r,_tokenResponse:n,operationType:e})}}function ec(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nc extends Ro{constructor(t,e,n,r){var i;super(e.code,e.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,nc.prototype),this.customData={appName:t.name,tenantId:null!==(i=t.tenantId)&&void 0!==i?i:void 0,_serverResponse:e.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(t,e,n,r){return new nc(t,e,n,r)}}function rc(t,e,n,r){return("reauthenticate"===e?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw nc._fromErrorAndOperation(t,n,e,r);throw n})}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function ic(t,e,n=!1){if(Ja(t.app))return Promise.reject(_s(t));const r="signIn",i=await rc(t,r,e),o=await tc._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(o.user),o}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function oc(t){const e=Su(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function ac(t,e,n){return Ja(t.app)?Promise.reject(_s(t)):async function(t,e){return ic(Su(t),e)}(zo(t),qu.credential(e,n)).catch(async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&oc(t),e})}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function sc(t,{displayName:e,photoURL:n}){if(void 0===e&&void 0===n)return;const r=zo(t),i={idToken:await r.getIdToken(),displayName:e,photoUrl:n,returnSecureToken:!0},o=await Ys(r,async function(t,e){return Bs(t,"POST","/v1/accounts:update",e)}(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:t})=>"password"===t);a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}const uc="__sak";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cc{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(uc,"1"),this.storage.removeItem(uc),Promise.resolve(!0)):Promise.resolve(!1)}catch(t){return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lc extends cc{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=wu(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const n=this.storage.getItem(e),r=this.localCache[e];n!==r&&t(e,r,n)}}onStorageEvent(t,e=!1){if(!t.key)return void this.forAllChangedKeys((t,e,n)=>{this.notifyListeners(t,n)});const n=t.key;e?this.detachListener():this.stopPolling();const r=()=>{const t=this.storage.getItem(n);(e||this.localCache[n]!==t)&&this.notifyListeners(n,t)},i=this.storage.getItem(n);bu()&&i!==t.newValue&&t.newValue!==t.oldValue?setTimeout(r,10):r()}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const r of Array.from(n))r(e?JSON.parse(e):e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,e,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}lc.type="LOCAL";const hc=lc;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dc extends cc{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,e){}_removeListener(t,e){}}dc.type="SESSION";const pc=dc;
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class fc{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find(e=>e.isListeningto(t));if(e)return e;const n=new fc(t);return this.receivers.push(n),n}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:n,eventType:r,data:i}=e.data,o=this.handlersMap[r];if(!(null==o?void 0:o.size))return;e.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const a=Array.from(o).map(async t=>t(e.origin,i)),s=await function(t){return Promise.all(t.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(e){return{fulfilled:!1,reason:e}}}))}(a);e.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:s})}_subscribe(t,e){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),e&&0!==this.handlersMap[t].size||delete this.handlersMap[t],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function mc(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(10*Math.random());return t+n}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */fc.receivers=[];class vc{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise((a,s)=>{const u=mc("",20);r.port1.start();const c=setTimeout(()=>{s(new Error("unsupported_event"))},n);o={messageChannel:r,onMessage(t){const e=t;if(e.data.eventId===u)switch(e.data.status){case"ack":clearTimeout(c),i=setTimeout(()=>{s(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(e.data.response);break;default:clearTimeout(c),clearTimeout(i),s(new Error("invalid_response"))}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:t,eventId:u,data:e},[r.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gc(){return window}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function yc(){return void 0!==gc().WorkerGlobalScope&&"function"==typeof gc().importScripts}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const xc="firebaseLocalStorageDb",bc="firebaseLocalStorage",wc="fbase_key";class _c{constructor(t){this.request=t}toPromise(){return new Promise((t,e)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{e(this.request.error)})})}}function Ec(t,e){return t.transaction([bc],e?"readwrite":"readonly").objectStore(bc)}function Cc(){const t=indexedDB.open(xc,1);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const e=t.result;try{e.createObjectStore(bc,{keyPath:wc})}catch(r){n(r)}}),t.addEventListener("success",async()=>{const n=t.result;n.objectStoreNames.contains(bc)?e(n):(n.close(),await function(){const t=indexedDB.deleteDatabase(xc);return new _c(t).toPromise()}(),e(await Cc()))})})}async function Ic(t,e,n){const r=Ec(t,!0).put({[wc]:e,value:n});return new _c(r).toPromise()}function Sc(t,e){const n=Ec(t,!0).delete(e);return new _c(n).toPromise()}class kc{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Cc()),this.db}async _withRetries(t){let e=0;for(;;)try{const e=await this._openDb();return await t(e)}catch(n){if(e++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return yc()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=fc._getInstance(yc()?self:null),this.receiver._subscribe("keyChanged",async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)})),this.receiver._subscribe("ping",async(t,e)=>["keyChanged"])}async initializeSender(){var t,e;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new vc(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(t=n[0])||void 0===t?void 0:t.fulfilled)&&(null===(e=n[0])||void 0===e?void 0:e.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){var e;if(this.sender&&this.activeServiceWorker&&((null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await Cc();return await Ic(t,uc,"1"),await Sc(t,uc),!0}catch(t){}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Ic(n,t,e)),this.localCache[t]=e,this.notifyServiceWorker(t)))}async _get(t){const e=await this._withRetries(e=>async function(t,e){const n=Ec(t,!1).get(e),r=await new _c(n).toPromise();return void 0===r?null:r.value}(e,t));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>Sc(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(t=>{const e=Ec(t,!1).getAll();return new _c(e).toPromise()});if(!t)return[];if(0!==this.pendingWrites)return[];const e=[],n=new Set;if(0!==t.length)for(const{fbase_key:r,value:i}of t)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),e.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),e.push(r));return e}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const r of Array.from(n))r(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&this.stopPolling()}}kc.type="LOCAL";const Tc=kc;new Rs(3e4,6e4);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Nc extends ju{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return Vu(t,this._buildIdpRequest())}_linkToIdToken(t,e){return Vu(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return Vu(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function Rc(t){return ic(t.auth,new Nc(t),t.bypassAuthState)}function Ac(t){const{auth:e,user:n}=t;return Cs(n,e,"internal-error"),
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
async function(t,e,n=!1){const{auth:r}=t;if(Ja(r.app))return Promise.reject(_s(r));const i="reauthenticate";try{const o=await Ys(t,rc(r,i,e,t),n);Cs(o.idToken,r,"internal-error");const a=Xs(o.idToken);Cs(a,r,"internal-error");const{sub:s}=a;return Cs(t.uid===s,r,"user-mismatch"),tc._forOperation(t,i,o)}catch(o){throw"auth/user-not-found"===(null==o?void 0:o.code)&&xs(r,"user-mismatch"),o}}(n,new Nc(t),t.bypassAuthState)}async function Pc(t){const{auth:e,user:n}=t;return Cs(n,e,"internal-error"),async function(t,e,n=!1){const r=await Ys(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return tc._forOperation(t,"link",r)}(n,new Nc(t),t.bypassAuthState)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dc{constructor(t,e,n,r,i=!1){this.auth=t,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise(async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(t){const{urlResponse:e,sessionId:n,postBody:r,tenantId:i,error:o,type:a}=t;if(o)return void this.reject(o);const s={auth:this.auth,requestUri:e,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(s))}catch(u){this.reject(u)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return Rc;case"linkViaPopup":case"linkViaRedirect":return Pc;case"reauthViaPopup":case"reauthViaRedirect":return Ac;default:xs(this.auth,"internal-error")}}resolve(t){Ss(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Ss(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mc=new Rs(2e3,1e4);class Oc extends Dc{constructor(t,e,n,r,i){super(t,e,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Oc.currentPopupAction&&Oc.currentPopupAction.cancel(),Oc.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Cs(t,this.auth,"internal-error"),t}async onExecution(){Ss(1===this.filter.length,"Popup operations only handle one event");const t=mc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(bs(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return(null===(t=this.authWindow)||void 0===t?void 0:t.associatedEvent)||null}cancel(){this.reject(bs(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Oc.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e,n;(null===(n=null===(e=this.authWindow)||void 0===e?void 0:e.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(bs(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(t,Mc.get())};t()}}Oc.currentPopupAction=null;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Lc="pendingRedirect",Bc=new Map;class Fc extends Dc{constructor(t,e,n=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,n),this.eventId=null}async execute(){let t=Bc.get(this.auth._key());if(!t){try{const e=await async function(t,e){const n=function(t){return cu(Lc,t.config.apiKey,t.name)}(e),r=function(t){return au(t._redirectPersistence)}(t);if(!(await r._isAvailable()))return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(e)}catch(e){t=()=>Promise.reject(e)}Bc.set(this.auth._key(),t)}return this.bypassAuthState||Bc.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if("signInViaRedirect"===t.type)return super.onAuthEvent(t);if("unknown"!==t.type){if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function jc(t,e){Bc.set(t._key(),e)}async function zc(t,e,n=!1){if(Ja(t.app))return Promise.reject(_s(t));const r=Su(t),i=
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function(t,e){return e?au(e):(Cs(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}(r,e),o=new Fc(r,i,n),a=await o.execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(t,n)&&(e=!0,this.sendToConsumer(t,n),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!function(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Vc(t);default:return!1}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){var n;if(t.error&&!Vc(t)){const r=(null===(n=t.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";e.onError(bs(this.auth,r))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const n=null===e.eventId||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&n}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Uc(t))}saveEventToCache(t){this.cachedEventUids.add(Uc(t)),this.lastProcessedEventTime=Date.now()}}function Uc(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(t=>t).join("-")}function Vc({type:t,error:e}){return"unknown"===t&&"auth/no-auth-event"===(null==e?void 0:e.code)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Hc=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Gc=/^https?/;async function qc(t){if(t.config.emulator)return;const{authorizedDomains:e}=await async function(t,e={}){return Bs(t,"GET","/v1/projects",e)}(t);for(const r of e)try{if(Kc(r))return}catch(n){}xs(t,"unauthorized-domain")}function Kc(t){const e=ks(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const i=new URL(t);return""===i.hostname&&""===r?"chrome-extension:"===n&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Gc.test(n))return!1;if(Hc.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zc=new Rs(3e4,6e4);function Xc(){const t=gc().___jsl;if(null==t?void 0:t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}function $c(t){return new Promise((e,n)=>{var r,i,o;function a(){Xc(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Xc(),n(bs(t,"network-request-failed"))},timeout:Zc.get()})}if(null===(i=null===(r=gc().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)e(gapi.iframes.getContext());else{if(!(null===(o=gc().gapi)||void 0===o?void 0:o.load)){const e=`__${"iframefcb"}${Math.floor(1e6*Math.random())}`;return gc()[e]=()=>{gapi.load?a():n(bs(t,"network-request-failed"))},Nu(`${Tu.gapiScript}?onload=${e}`).catch(t=>n(t))}a()}}).catch(t=>{throw Yc=null,t})}let Yc=null;
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Jc=new Rs(5e3,15e3),Qc={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},tl=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function el(t){const e=t.config;Cs(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?As(e,"emulator/auth/iframe"):`https://${t.config.authDomain}/__/auth/iframe`,r={apiKey:e.apiKey,appName:t.name,v:es},i=tl.get(t.config.apiHost);i&&(r.eid=i);const o=t._getFrameworks();return o.length&&(r.fw=o.join(",")),`${n}?${Oo(r).slice(1)}`}async function nl(t){const e=await function(t){return Yc=Yc||$c(t),Yc}(t),n=gc().gapi;return Cs(n,t,"internal-error"),e.open({where:document.body,url:el(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Qc,dontclear:!0},e=>new Promise(async(n,r)=>{await e.restyle({setHideOnLeave:!1});const i=bs(t,"network-request-failed"),o=gc().setTimeout(()=>{r(i)},Jc.get());function a(){gc().clearTimeout(o),n(e)}e.ping(a).then(a,()=>{r(i)})}))}
/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rl={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class il{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(t){}}}function ol(t,e,n,r=500,i=600){const o=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let s="";const u=Object.assign(Object.assign({},rl),{width:r.toString(),height:i.toString(),top:o,left:a}),c=No().toLowerCase();n&&(s=fu(c)?"_blank":n),du(c)&&(e=e||"http://localhost",u.scrollbars="yes");const l=Object.entries(u).reduce((t,[e,n])=>`${t}${e}=${n},`,"");if(function(t=No()){var e;return xu(t)&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(c)&&"_self"!==s)return function(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e||"",s),new il(null);const h=window.open(e||"",s,l);Cs(h,t,"popup-blocked");try{h.focus()}catch(d){}return new il(h)}const al="__/auth/handler",sl="emulator/auth/handler",ul=encodeURIComponent("fac");async function cl(t,e,n,r,i,o){Cs(t.config.authDomain,t,"auth-domain-config-required"),Cs(t.config.apiKey,t,"invalid-api-key");const a={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:es,eventId:i};if(e instanceof Ku){e.setDefaultLanguage(t.languageCode),a.providerId=e.providerId||"",function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[t,e]of Object.entries({}))a[t]=e}if(e instanceof Zu){const t=e.getScopes().filter(t=>""!==t);t.length>0&&(a.scopes=t.join(","))}t.tenantId&&(a.tid=t.tenantId);const s=a;for(const l of Object.keys(s))void 0===s[l]&&delete s[l];const u=await t._getAppCheckToken(),c=u?`#${ul}=${encodeURIComponent(u)}`:"";return`${function({config:t}){if(!t.emulator)return`https://${t.authDomain}/${al}`;return As(t,sl)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t)}?${Oo(s).slice(1)}${c}`}const ll="webStorageSupport";const hl=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=pc,this._completeRedirectFn=zc,this._overrideRedirectResult=jc}async _openPopup(t,e,n,r){var i;Ss(null===(i=this.eventManagers[t._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return ol(t,await cl(t,e,n,ks(),r),mc())}async _openRedirect(t,e,n,r){await this._originValidation(t);return function(t){gc().location.href=t}(await cl(t,e,n,ks(),r)),new Promise(()=>{})}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:t,promise:n}=this.eventManagers[e];return t?Promise.resolve(t):(Ss(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(t);return this.eventManagers[e]={promise:n},n.catch(()=>{delete this.eventManagers[e]}),n}async initAndGetManager(t){const e=await nl(t),n=new Wc(t);return e.register("authEvent",e=>{Cs(null==e?void 0:e.authEvent,t,"invalid-auth-event");return{status:n.onEvent(e.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(ll,{type:ll},n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[ll];void 0!==i&&e(!!i),xs(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=qc(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return wu()||pu()||xu()}};var dl="@firebase/auth",pl="1.10.8";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class fl{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),(null===(t=this.auth.currentUser)||void 0===t?void 0:t.uid)||null}async getToken(t){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(t)}}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged(e=>{t((null==e?void 0:e.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){Cs(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ml=Eo("authIdTokenMaxAge")||300;let vl=null;var gl;Tu={loadJS:t=>new Promise((e,n)=>{const r=document.createElement("script");var i,o;r.setAttribute("src",t),r.onload=e,r.onerror=t=>{const e=bs("internal-error");e.customData=t,n(e)},r.type="text/javascript",r.charset="UTF-8",(null!==(o=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==o?o:document).appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},gl="Browser",$a(new Wo("auth",(t,{options:e})=>{const n=t.getProvider("app").getImmediate(),r=t.getProvider("heartbeat"),i=t.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=n.options;Cs(o&&!o.includes(":"),"invalid-api-key",{appName:n.name});const s={apiKey:o,authDomain:a,clientPlatform:gl,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_u(gl)},u=new Iu(n,r,i,s);return function(t,e){const n=(null==e?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(au);(null==e?void 0:e.errorMap)&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,null==e?void 0:e.popupRedirectResolver)}(u,e),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,e,n)=>{t.getProvider("auth-internal").initialize()})),$a(new Wo("auth-internal",t=>{const e=Su(t.getProvider("auth").getImmediate());return new fl(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),rs(dl,pl,function(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(gl)),rs(dl,pl,"esm2017");
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
rs("firebase","11.10.0","app");const yl=function(t=function(t=Ha){const e=qa.get(t);if(!e&&t===Ha&&_o())return ns();if(!e)throw Qa.create("no-app",{appName:t});return e}()){const e=Ya(t,"auth");if(e.isInitialized())return e.getImmediate();const n=function(t,e){const n=Ya(t,"auth");if(n.isInitialized()){const t=n.getImmediate();if(Do(n.getOptions(),null!=e?e:{}))return t;xs(t,"already-initialized")}return n.initialize({options:e})}(t,{popupRedirectResolver:hl,persistence:[Tc,hc,pc]}),r=Eo("authTokenSyncURL");if(r&&"boolean"==typeof isSecureContext&&isSecureContext){const t=new URL(r,location.origin);if(location.origin===t.origin){const e=(i=t.toString(),async t=>{const e=t&&await t.getIdTokenResult(),n=e&&((new Date).getTime()-Date.parse(e.issuedAtTime))/1e3;if(n&&n>ml)return;const r=null==e?void 0:e.token;vl!==r&&(vl=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});!function(t,e,n){zo(t).beforeAuthStateChanged(e,n)}(n,e,()=>e(n.currentUser)),function(t,e,n,r){zo(t).onIdTokenChanged(e,n,r)}(n,t=>e(t))}}var i;const o=(a="auth",null===(u=null===(s=wo())||void 0===s?void 0:s.emulatorHosts)||void 0===u?void 0:u[a]);var a,s,u;return o&&Lu(n,`http://${o}`),n}(ns({apiKey:"",authDomain:"",projectId:"",storageBucket:"",messagingSenderId:"",appId:""})),xl=Se.createContext(void 0),bl=t=>{if(t instanceof Ro){const e=t.code;if("auth/invalid-credential"===e||"auth/invalid-email"===e||"auth/user-not-found"===e)return"";if("auth/email-already-in-use"===e)return"";if("auth/weak-password"===e)return" 6 ";if("auth/too-many-requests"===e)return" "}return" "},wl=({children:t})=>{const[e,n]=Se.useState(null),[r,i]=Se.useState(!0),[o,a]=Se.useState(!1),[s,u]=Se.useState(null);Se.useEffect(()=>{var t,e,r;return t=t=>{n(t),i(!1)},zo(yl).onAuthStateChanged(t,e,r)},[]);const c=async(t,e)=>{a(!0),u(null);try{await ac(yl,t,e)}catch(n){throw u(bl(n)),n}finally{a(!1)}},l=async({email:t,password:e,displayName:n})=>{a(!0),u(null);try{const r=await async function(t,e,n){if(Ja(t.app))return Promise.reject(_s(t));const r=Su(t),i=Ou(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Qu),o=await i.catch(e=>{throw"auth/password-does-not-meet-requirements"===e.code&&oc(t),e}),a=await tc._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}(yl,t,e);n&&await sc(r.user,{displayName:n})}catch(r){throw u(bl(r)),r}finally{a(!1)}},h=async()=>{var t;u(null),await(t=yl,zo(t).signOut())},d=()=>u(null),p=Se.useMemo(()=>({user:e,initializing:r,authLoading:o,authError:s,signIn:c,signUp:l,signOutUser:h,resetAuthError:d}),[e,r,o,s]);return $.jsx(xl.Provider,{value:p,children:t})},_l=()=>{const t=Se.useContext(xl);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var El=function(t,e){return(El=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function Cl(t,e){function n(){this.constructor=t}El(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function Il(t,e,n,r){return new(n||(n=Promise))(function(e,i){function o(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){t.done?e(t.value):new n(function(e){e(t.value)}).then(o,a)}s((r=r.apply(t,[])).next())})}function Sl(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var kl=function(){function t(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(t,e){this.platform,this.platformName=t,this.platform=e},t.prototype.registerFlag=function(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){var r=this.urlFlags[t];this.set(t,r)}},t.prototype.get=function(t){return t in this.flags||(this.flags[t]=this.evaluateFlag(t)),this.flags[t]},t.prototype.getNumber=function(t){return this.get(t)},t.prototype.getBool=function(t){return this.get(t)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e){if(null==this.flagRegistry[t])throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)},t.prototype.evaluateFlag=function(t){if(null==this.flagRegistry[t])throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},t.prototype.setFlags=function(t){this.flags=Object.assign({},t)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var t=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var e,n,r=(e=this.global.location.search,n={},e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(n,e[0],e[1]),e.join("=")}),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach(function(e){var n=e.split(":"),r=n[0],i=n[1];t.urlFlags[r]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+t+".")}(r,i)})}},t}();function Tl(){return Nl}var Nl=null,Rl=new Map,Al=new Map;function Pl(t,e){var n=Ll(t,e);return Rl.get(n)}function Dl(t){for(var e=Rl.entries(),n=[];;){var r=e.next(),i=r.done,o=r.value;if(i)break;var a=o[0],s=o[1];a.split("_")[0]===t&&n.push(s)}return n}function Ml(t){var e=t.kernelName,n=t.backendName,r=Ll(e,n);if(Rl.has(r))throw new Error("The kernel '"+e+"' for backend '"+n+"' is already registered");Rl.set(r,t)}function Ol(t){var e=t.kernelName;Al.has(e),Al.set(e,t)}function Ll(t,e){return e+"_"+t}function Bl(t,e,n){return Math.max(t,Math.min(e,n))}function Fl(t){return t%2==0?t:t+1}function jl(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function zl(t,e,n){void 0===n&&(n=""),jl(Hl(t,e),function(){return n+" Shapes "+t+" and "+e+" must match"})}function Wl(t){jl(null!=t,function(){return"The input to the tensor constructor must be a non-null value."})}function Ul(t,e,n){if(void 0===e&&(e=[]),void 0===n&&(n=!1),null==e&&(e=[]),Array.isArray(t)||th(t)&&!n)for(var r=0;r<t.length;++r)Ul(t[r],e,n);else e.push(t);return e}function Vl(t){if(0===t.length)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e}function Hl(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Gl(t){return t%1==0}function ql(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)}function Kl(t){var e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function Zl(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function Xl(t,e,n){return void 0===e&&(e=function(t){return 0}),new Promise(function(r,i){var o=0,a=function(){if(t())r();else{o++;var s=e(o);null!=n&&o>=n?i():setTimeout(a,s)}};a()})}function $l(t,e){var n=e.length;return jl((t=null==t?e.map(function(t,e){return e}):[].concat(t)).every(function(t){return t>=-n&&t<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t}),jl(t.every(function(t){return Gl(t)}),function(){return"All values in axis param must be integers but got axis "+t}),t.map(function(t){return t<0?n+t:t})}function Yl(t,e){for(var n=[],r=[],i=null!=e&&Array.isArray(e)&&0===e.length,o=null==e||i?null:$l(e,t).sort(),a=0,s=0;s<t.length;++s){if(null!=o){if(o[a]===s&&1!==t[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+t[s]+"' is not 1");(null==o[a]||o[a]>s)&&1===t[s]&&(n.push(t[s]),r.push(s)),o[a]<=s&&a++}1!==t[s]&&(n.push(t[s]),r.push(s))}return{newShape:n,keptDims:r}}function Jl(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n}function Ql(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error("Unknown data type "+t);n=new Array(e)}return n}function th(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function eh(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function nh(t){return"string"==typeof t||t instanceof String}function rh(t){return Array.isArray(t)?rh(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":function(t){return"number"==typeof t}(t)?"float32":nh(t)?"string":function(t){return"boolean"==typeof t}(t)?"bool":"float32"}function ih(t){return!!(t&&t.constructor&&t.call&&t.apply)}function oh(t,e){for(var n=e;n<t;++n)if(t%n==0)return n;return t}function ah(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function sh(t,e,n){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Ul(t)),n&&function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}(t,e),i=e,(r=t)instanceof Float32Array&&"float32"===i||r instanceof Int32Array&&"int32"===i||r instanceof Uint8Array&&"bool"===i)return t;var r,i;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){for(var o=new Uint8Array(t.length),a=0;a<o.length;++a)0!==Math.round(t[a])&&(o[a]=1);return o}throw new Error("Unknown data type "+e)}function uh(t,e){if(0===t.length)return e[0];var n=t.reduce(function(t,e){return t*e});if(0===n)return[];if(n!==e.length)throw new Error("["+t+"] does not match the input size.");return function t(e,n,r){var i=new Array;if(1===n.length)for(var o=n[0],a=0;a<o;a++)i[a]=r[e+a];else{o=n[0];var s=n.slice(1),u=s.reduce(function(t,e){return t*e});for(a=0;a<o;a++)i[a]=t(e+a*u,s,r)}return i}(0,t,e)}function ch(t,e){for(var n=lh(t,e),r=0;r<n.length;r++)n[r]=1;return n}function lh(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type "+e)}function hh(){return Tl().platform.now()}function dh(t){t.forEach(function(e){jl(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}function ph(t,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",Tl().platform.decode(t,e)}function fh(t,e,n){if(0===e)return 0;if(1===e)return t[0];for(var r=t[t.length-1],i=0;i<t.length-1;++i)r+=n[i]*t[i];return r}var mh=function(){function t(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new vh)}return t.prototype.profileKernel=function(t,e,n){var r,i=this,o=this.backendTimer.time(function(){r=n()});return r.forEach(function(n){n.data().then(function(r){!function(t,e){if("float32"!==e)return!1;for(var n=0;n<t.length;n++){var r=t[n];if(isNaN(r)||!isFinite(r))return!0}}(r,n.dtype),o.then(function(o){var a="";null!=o.getExtraProfileInfo&&(a=o.getExtraProfileInfo()),i.logger.logKernelProfile(t,n,r,o.kernelMs,e,a)})})}),r},t}(),vh=function(){function t(){}return t.prototype.logKernelProfile=function(t,e,n,r,i,o){"number"==typeof r?Zl(r+"ms",9):r.error,Zl(t,25),e.rank,e.size,Zl(e.shape.toString(),14);for(var a in i){var s=i[a].shape||e.shape,u=s.length;0}},t}();function gh(t,e,n){return Zl(Array.isArray(t)?parseFloat(t[0].toFixed(7))+" + "+parseFloat(t[1].toFixed(7))+"j":nh(t)?"'"+t+"'":"bool"===n?yh(t):parseFloat(t.toFixed(7)).toString(),e)}function yh(t){return 0===t?"false":"true"}function xh(t){for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}var bh=function(){function t(t,e,n){var r=this;if(this.dtype=e,this.shape=t.slice(),this.size=Vl(t),null!=n){var i=n.length;jl(i===this.size,function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+r.size+"'."})}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Ql(e,this.size),this.strides=ah(t)}return t.prototype.set=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),jl(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+e.rank+")"});var i=this.locToIndex(n);this.values[i]=t},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var n=0,r=0,i=t;r<i.length;r++){var o=i[r];if(o<0||o>=this.shape[n]){var a="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(a)}n++}for(var s=t[t.length-1],u=0;u<t.length-1;++u)s+=this.strides[u]*t[u];return this.values[s]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return wh().makeTensor(this.values,this.shape,this.dtype)},t}(),wh=null,_h=null,Eh=null,Ch=function(){function t(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=Vl(t),this.strides=ah(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),jl(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},t.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},t.prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),this.reshape([t,e,n,r])},t.prototype.as5D=function(t,e,n,r,i){return this.throwIfDisposed(),this.reshape([t,e,n,r,i])},t.prototype.asType=function(t){return this.throwIfDisposed(),_h.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return Il(this,0,void 0,function(){var t;return Sl(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,_h.buffer(this.shape,this.dtype,t)]}})})},t.prototype.bufferSync=function(){return _h.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return Il(this,0,void 0,function(){var t;return Sl(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,uh(this.shape,t)]}})})},t.prototype.arraySync=function(){return uh(this.shape,this.dataSync())},t.prototype.data=function(){return Il(this,0,void 0,function(){var t,e;return Sl(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),t=wh().read(this.dataId),"string"!==this.dtype?[3,2]:[4,t];case 1:e=n.sent();try{return[2,e.map(function(t){return ph(t)})]}catch(r){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,t]}})})},t.prototype.dataSync=function(){this.throwIfDisposed();var t=wh().readSync(this.dataId);if("string"===this.dtype)try{return t.map(function(t){return ph(t)})}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},t.prototype.bytes=function(){return Il(this,0,void 0,function(){var t;return Sl(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,wh().read(this.dataId)];case 1:return t=e.sent(),"string"===this.dtype?[2,t]:[2,new Uint8Array(t.buffer)]}})})},t.prototype.dispose=function(){this.isDisposed||(wh().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),_h.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),_h.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),_h.expandDims(this,t)},t.prototype.cumsum=function(t,e,n){return void 0===t&&(t=0),void 0===e&&(e=!1),void 0===n&&(n=!1),_h.cumsum(this,t,e,n)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),_h.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),_h.clone(this)},t.prototype.oneHot=function(t,e,n){return this.throwIfDisposed(),_h.oneHot(this,t,e,n)},t.prototype.toString=function(t){return void 0===t&&(t=!1),function(t,e,n,r){var i=ah(e),o=function(t,e,n,r){var i=Vl(e),o=r[r.length-1],a=new Array(o).fill(0),s=e.length,u="complex64"===n?xh(t):t;if(s>1)for(var c=0;c<i/o;c++)for(var l=c*o,h=0;h<o;h++)a[h]=Math.max(a[h],gh(u[l+h],0,n).length);return a}(t,e,n,i),a=e.length,s=function t(e,n,r,i,o,a){void 0===a&&(a=!0);var s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c)return"complex64"===r?[gh(xh(e)[0],0,r)]:"bool"===r?[yh(e[0])]:[e[0].toString()];if(1===c){if(u>20){var l=3*s,h=Array.from(e.slice(0,l)),d=Array.from(e.slice((u-3)*s,u*s));return"complex64"===r&&(h=xh(h),d=xh(d)),["["+h.map(function(t,e){return gh(t,o[e],r)}).join(", ")+", ..., "+d.map(function(t,e){return gh(t,o[u-3+e],r)}).join(", ")+"]"]}return["["+("complex64"===r?xh(e):Array.from(e)).map(function(t,e){return gh(t,o[e],r)}).join(", ")+"]"]}var p=n.slice(1),f=i.slice(1),m=i[0]*s,v=[];if(u>20){for(var g=0;g<3;g++){var y=(x=g*m)+m;v.push.apply(v,t(e.slice(x,y),p,r,f,o,!1))}for(v.push("..."),g=u-3;g<u;g++)y=(x=g*m)+m,v.push.apply(v,t(e.slice(x,y),p,r,f,o,g===u-1))}else for(g=0;g<u;g++){var x;y=(x=g*m)+m,v.push.apply(v,t(e.slice(x,y),p,r,f,o,g===u-1))}var b=2===c?",":"";for(v[0]="["+v[0]+b,g=1;g<v.length-1;g++)v[g]=" "+v[g]+b;var w=",\n";for(g=2;g<c;g++)w+="\n";return v[v.length-1]=" "+v[v.length-1]+"]"+(a?"":w),v}(t,e,n,i,o),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(t){return"    "+t}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,t)},t.prototype.tile=function(t){return this.throwIfDisposed(),_h.tile(this,t)},t.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),_h.gather(this,t,e)},t.prototype.matMul=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=!1),this.throwIfDisposed(),_h.matMul(this,t,e,n)},t.prototype.dot=function(t){return this.throwIfDisposed(),_h.dot(this,t)},t.prototype.norm=function(t,e,n){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===n&&(n=!1),this.throwIfDisposed(),_h.norm(this,t,e,n)},t.prototype.slice=function(t,e){return this.throwIfDisposed(),_h.slice(this,t,e)},t.prototype.reverse=function(t){return this.throwIfDisposed(),_h.reverse(this,t)},t.prototype.concat=function(e,n){return void 0===n&&(n=0),this.throwIfDisposed(),e instanceof t&&(e=[e]),_h.concat([this].concat(e),n)},t.prototype.split=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),_h.split(this,t,e)},t.prototype.stack=function(t,e){return void 0===e&&(e=0),_h.stack([this,t],e)},t.prototype.unstack=function(t){return void 0===t&&(t=0),_h.unstack(this,t)},t.prototype.pad=function(t,e){return void 0===e&&(e=0),_h.pad(this,t,e)},t.prototype.batchNormalization=function(t,e,n,r,i){return void 0===n&&(n=.001),Eh("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,i,r,n)},t.prototype.batchNorm=function(t,e,n,r,i){return void 0===i&&(i=.001),this.throwIfDisposed(),_h.batchNorm(this,t,e,n,r,i)},t.prototype.all=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),_h.all(this,t,e)},t.prototype.any=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),_h.any(this,t,e)},t.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),_h.logSumExp(this,t,e)},t.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),_h.sum(this,t,e)},t.prototype.prod=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),_h.prod(this,t,e)},t.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),_h.mean(this,t,e)},t.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),_h.min(this,t,e)},t.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),_h.max(this,t,e)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),_h.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),_h.argMax(this,t)},t.prototype.cast=function(t){return this.throwIfDisposed(),_h.cast(this,t)},t.prototype.add=function(t){return this.throwIfDisposed(),_h.add(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),_h.addStrict(this,t)},t.prototype.atan2=function(t){return this.throwIfDisposed(),_h.atan2(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),_h.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),_h.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),_h.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),_h.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),_h.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),_h.mulStrict(this,t)},t.prototype.div=function(t){return this.throwIfDisposed(),_h.div(this,t)},t.prototype.divNoNan=function(t){return this.throwIfDisposed(),_h.divNoNan(this,t)},t.prototype.floorDiv=function(t){return this.throwIfDisposed(),_h.floorDiv(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),_h.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),_h.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),_h.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),_h.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),_h.maximumStrict(this,t)},t.prototype.mod=function(t){return this.throwIfDisposed(),_h.mod(this,t)},t.prototype.modStrict=function(t){return this.throwIfDisposed(),_h.modStrict(this,t)},t.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),_h.squaredDifferenceStrict(this,t)},t.prototype.transpose=function(t){return this.throwIfDisposed(),_h.transpose(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),_h.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),_h.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),_h.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),_h.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),_h.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),_h.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),_h.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),_h.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),_h.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),_h.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),_h.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),_h.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),_h.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),_h.logicalOr(this,t)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),_h.logicalNot(this)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),_h.logicalXor(this,t)},t.prototype.where=function(t,e){return this.throwIfDisposed(),_h.where(t,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),_h.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),_h.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),_h.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),_h.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),_h.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),_h.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),_h.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),_h.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),_h.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),_h.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),_h.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),_h.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),_h.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),_h.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),_h.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),_h.abs(this)},t.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),_h.clipByValue(this,t,e)},t.prototype.relu=function(){return this.throwIfDisposed(),_h.relu(this)},t.prototype.relu6=function(){return this.throwIfDisposed(),_h.relu6(this)},t.prototype.elu=function(){return this.throwIfDisposed(),_h.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),_h.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),_h.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),_h.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),_h.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),_h.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),_h.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),_h.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),_h.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),_h.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),_h.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),_h.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),_h.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),_h.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),_h.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),_h.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),_h.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),_h.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),_h.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),_h.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),_h.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),_h.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),_h.round(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),_h.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),_h.softmax(this,t)},t.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),_h.logSoftmax(this,t)},t.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),_h.image.resizeBilinear(this,t,e)},t.prototype.resizeNearestNeighbor=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),_h.image.resizeNearestNeighbor(this,t,e)},t.prototype.conv1d=function(t,e,n,r,i,o){return void 0===r&&(r="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),_h.conv1d(this,t,e,n,r,i,o)},t.prototype.conv2d=function(t,e,n,r,i,o){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),_h.conv2d(this,t,e,n,r,i,o)},t.prototype.conv2dTranspose=function(t,e,n,r,i){return this.throwIfDisposed(),_h.conv2dTranspose(this,t,e,n,r,i)},t.prototype.depthwiseConv2D=function(t,e,n,r,i,o){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),_h.depthwiseConv2d(this,t,e,n,r,i,o)},t.prototype.separableConv2d=function(t,e,n,r,i,o){return void 0===i&&(i=[1,1]),void 0===o&&(o="NHWC"),this.throwIfDisposed(),_h.separableConv2d(this,t,e,n,r,i,o)},t.prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),_h.avgPool(this,t,e,n,r)},t.prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),_h.maxPool(this,t,e,n,r)},t.prototype.localResponseNormalization=function(t,e,n,r){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=.5),_h.localResponseNormalization(this,t,e,n,r)},t.prototype.pool=function(t,e,n,r,i){return this.throwIfDisposed(),_h.pool(this,t,e,n,r,i)},t.prototype.variable=function(t,e,n){return void 0===t&&(t=!0),this.throwIfDisposed(),wh().makeVariable(this,t,e,n)},t.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),_h.unsortedSegmentSum(this,t,e)},t.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),_h.batchToSpaceND(this,t,e)},t.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),_h.spaceToBatchND(this,t,e)},t.prototype.topk=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!0),this.throwIfDisposed(),_h.topk(this,t,e)},t.prototype.stridedSlice=function(t,e,n,r,i,o,a,s){return void 0===r&&(r=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),this.throwIfDisposed(),_h.stridedSlice(this,t,e,n,r,i,o,a,s)},t.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),_h.depthToSpace(this,t,e)},t.prototype.fft=function(){return this.throwIfDisposed(),_h.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),_h.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),_h.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),_h.spectral.irfft(this)},t}();Object.defineProperty(Ch,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var Ih,Sh,kh,Th,Nh,Rh,Ah=function(t){function e(e,n,r,i){var o=t.call(this,e.shape,e.dtype,e.dataId,i)||this;return o.trainable=n,o.name=r,o}return Cl(e,t),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!Hl(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");wh().disposeTensor(this),this.dataId=t.dataId,wh().incRef(this,null)},e.prototype.dispose=function(){wh().disposeVariable(this),this.isDisposedInternal=!0},e}(Ch);Object.defineProperty(Ah,Symbol.hasInstance,{value:function(t){return t instanceof Ch&&null!=t.assign&&t.assign instanceof Function}}),(Rh=Ih||(Ih={})).R0="R0",Rh.R1="R1",Rh.R2="R2",Rh.R3="R3",Rh.R4="R4",Rh.R5="R5",Rh.R6="R6",function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(Sh||(Sh={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(kh||(kh={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(Th||(Th={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(Nh||(Nh={}));var Ph={float32:Th,int32:Sh,bool:kh,complex64:Nh};function Dh(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error("Can not upcast "+t+" with "+e)}return Ph[t][e]}function Mh(t){return Dh(t,"int32")}function Oh(t,e){if(t.dtype===e.dtype)return[t,e];var n=Dh(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function Lh(t){var e=[];return function t(e,n,r){if(null!=e)if(e instanceof Ch)n.push(e);else if(i=e,Array.isArray(i)||"object"==typeof i){var i,o=e;for(var a in o){var s=o[a];r.has(s)||(r.add(s),t(s,n,r))}}}(t,e,new Set),e}var Bh,Fh=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},t}(),jh=function(){function t(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Fh}return t.prototype.ready=function(){return Il(this,0,void 0,function(){var t,e,n;return Sl(this,function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];t=this.getSortedBackends(),e=0,r.label=1;case 1:return e<t.length?(n=t[e],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(t.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;if(this.initializeBackend(t).asyncInit)return null}return this.registry[t]},t.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},t.prototype.registerBackend=function(t,e,n){return void 0===n&&(n=1),!(t in this.registryFactory)&&(this.registryFactory[t]={factory:e,priority:n},!0)},t.prototype.setBackend=function(t){return Il(this,0,void 0,function(){var e,n,r;return Sl(this,function(i){switch(i.label){case 0:if(null==this.registryFactory[t])throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,null!=this.registry[t]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),n=e.success,e.asyncInit?[4,n]:[3,2]);case 1:return r=i.sent(),[3,3];case 2:r=n,i.label=3;case 3:if(!r)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new mh(this.backendInstance),[2,!0]}})})},t.prototype.setupRegisteredKernels=function(){var t=this;Dl(this.backendName).forEach(function(e){null!=e.setupFunc&&e.setupFunc(t.backendInstance)})},t.prototype.disposeRegisteredKernels=function(t){var e=this;Dl(t).forEach(function(n){null!=n.disposeFunc&&n.disposeFunc(e.registry[t])})},t.prototype.initializeBackend=function(t){var e=this,n=this.registryFactory[t];if(null==n)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var i=++this.pendingBackendInitId,o=r.then(function(n){return!(i<e.pendingBackendInitId||(e.registry[t]=n,e.pendingBackendInit=null,0))}).catch(function(t){return!(i<e.pendingBackendInitId||(e.pendingBackendInit=null,1))});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}return this.registry[t]=r,{success:!0,asyncInit:!1}}catch(a){return{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var t=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,n){return t.registryFactory[n].priority-t.registryFactory[e].priority})},t.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var n=t[e],r=this.initializeBackend(n),i=r.success,o=r.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(t,e){var n=this.state.tensorInfo.get(e),r=n.backend,i=this.readSync(e);r.disposeData(e),n.backend=t,t.move(e,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(t,e){var n,r=this,i=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}return this.scopedRun(function(){return r.startScope(i)},function(){return r.endScope(n)},function(){return n=e()})},t.prototype.scopedRun=function(t,e,n){t();try{var r=n();return e(),r}catch(i){throw e(),i}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(t){var e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],function(t){return{x:function(){return t.toFloat()}}},[]),e},t.prototype.runKernel=function(t,e,n,r,i){return this.runKernelFunc(null,e,null,t,n,r,i)},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(t,e,n){var r=this.backend.numDataIds(),i=0;n.forEach(function(t){i+="complex64"===t.dtype?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-e-i-o;if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+t+"'")},t.prototype.runKernelFunc=function(t,e,n,r,i,o,a){var s,u=this;void 0===o&&(o=[]),void 0===a&&(a=[]);var c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var h,d=function(t){l&&(c=t.map(function(t){return u.keep(u.clone(t))}))},p=this.state.numBytes,f=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,v=Pl(r,this.backendName);return h=null!=v?function(){var t=u.backend.numDataIds();m=v.kernelFunc({inputs:e,attrs:i,backend:u.backend});var n=Array.isArray(m)?m:[m];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n);var s=n.map(function(t){var e=t.dataId,n=t.shape,r=t.dtype;return u.makeTensorFromDataId(e,n,r)}),c=s.filter(function(t,e){return a[e]});return d((o||[]).slice().concat(c)),s}:function(){var e=u.backend.numDataIds();m=u.tidy(function(){return t(u.backend,d)});var n=Array.isArray(m)?m:[m];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n),n},this.scopedRun(function(){return u.state.kernelDepth++},function(){return u.state.kernelDepth--},function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,e,function(){return h()}):h()}),l&&this.addTapeNode(r,e,s,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-f,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(t){return e[t].shape}),outputShapes:s.map(function(t){return t.shape})}),Array.isArray(m)?s:s[0]},t.prototype.makeTensor=function(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var i=t;"string"===n&&nh(t[0])&&(i=t.map(function(t){return function(t,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",Tl().platform.encode(t,e)}(t)}));var o=r.write(i,e,n),a=new Ch(e,n,o,this.nextTensorId());if(this.incRef(a,r),"string"===n){var s=this.state.tensorInfo.get(o),u=function(t){if(null==t)return 0;var e=0;return t.forEach(function(t){return e+=t.length}),e}(i);this.state.numBytes+=u-s.bytes,s.bytes=u}return a},t.prototype.makeTensorFromDataId=function(t,e,n,r){var i=new Ch(e,n=n||"float32",t,this.nextTensorId());return this.incRef(i,r),i},t.prototype.makeVariable=function(t,e,n,r){void 0===e&&(e=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.asType(r));var i=new Ah(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},t.prototype.incRef=function(t,e){var n=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(r=t.size*eh(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof Ah||this.track(t)},t.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,"string"===t.dtype&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?("complex64"!==t.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var e=this.state.registeredVariables[t];this.disposeVariable(e)}},t.prototype.disposeVariable=function(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},t.prototype.profile=function(t){return Il(this,0,void 0,function(){var e,n;return Sl(this,function(r){return this.state.profiling=!0,e=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(t){return t.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},t.prototype.addTapeNode=function(t,e,n,r,i){var o=this,a={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:i},s=function(t){return Al.get(t)}(t);null!=s&&(r=s.gradFunc),null!=r&&(a.gradient=function(t){return t=t.map(function(t,e){if(null==t){var r=n[e],i=lh(r.size,r.dtype);return o.makeTensor(i,r.shape,r.dtype)}return t}),r(t.length>1?t:t[0],i)}),this.state.activeTape.push(a)},t.prototype.keep=function(t){return t.kept=!0,t},t.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},t.prototype.endScope=function(t){for(var e=this,n=Lh(t),r=new Set(n.map(function(t){return t.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];o.kept||r.has(o.id)||o.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(t){t.kept||t.scopeId!==a.id||e.track(t)})},t.prototype.gradients=function(t,e,n,r){var i=this;if(void 0===r&&(r=!1),jl(e.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",t)});jl(o instanceof Ch,function(){return"The result y returned by f() must be a tensor."});var a=function(t,e,n){for(var r={},i={},o=0;o<e.length;o++)r[e[o].id]=!0;for(o=0;o<t.length;o++){var a=(f=t[o]).inputs;for(var s in a){for(var u=a[s],c=!1,l=0;l<e.length;l++)if(r[u.id]){f.outputs.forEach(function(t){return r[t.id]=!0}),c=!0,i[f.id]=!0;break}if(c)break}}var h={};h[n.id]=!0;var d={};for(o=t.length-1;o>=0;o--)for(a=(f=t[o]).inputs,l=0;l<f.outputs.length;l++)if(h[f.outputs[l].id]){for(var s in a)h[a[s].id]=!0,d[f.id]=!0;break}var p=[];for(o=0;o<t.length;o++){var f;if(i[(f=t[o]).id]&&d[f.id]){var m={};for(var s in f.inputs){var v=f.inputs[s];r[v.id]&&(m[s]=v)}var g=Object.assign({},f);g.inputs=m,g.outputs=f.outputs,p.push(g)}}return p}(this.state.activeTape,e,o);if(!r&&0===a.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var t,r,s={};s[o.id]=null==n?(r=ch(Vl(t=o.shape),"float32"),zh.makeTensor(r,t,"float32")):n,function(t,e){for(var n=function(n){var r=e[n],o=[];if(r.outputs.forEach(function(e){var n=t[e.id];null!=n?o.push(n):o.push(null)}),null==r.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+r.kernelName+".");var a=r.gradient(o),s=function(e){if(!(e in a))throw new Error("Cannot backprop through input "+e+". Available gradients found: "+Object.keys(a)+".");var n=function(t){return i.tidy(t)}(function(){return a[e]()});if("float32"!==n.dtype)throw new Error("Error in gradient for op "+r.kernelName+". The gradient of input "+e+" must have 'float32' dtype, but has '"+n.dtype+"'");var o=r.inputs[e];if(!Hl(n.shape,o.shape))throw new Error("Error in gradient for op "+r.kernelName+". The gradient of input '"+e+"' has shape '"+n.shape+"', which does not match the shape of the input '"+o.shape+"'");if(null==t[o.id])t[o.id]=n;else{var s=t[o.id];t[o.id]=s.add(n),s.dispose()}};for(var u in r.inputs)s(u)},r=e.length-1;r>=0;r--)n(r)}(s,a);var u=e.map(function(t){return s[t.id]});return 0===i.state.gradientDepth&&(i.state.activeTape.forEach(function(t){for(var e=0,n=t.saved;e<n.length;e++)n[e].dispose()}),i.state.activeTape=null),{value:o,grads:u}})},t.prototype.customGrad=function(t){var e=this;return jl(ih(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];jl(r.every(function(t){return t instanceof Ch}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var o={};return r.forEach(function(t,e){o[e]=t}),e.runKernelFunc(function(e,i){return jl((n=t.apply(void 0,r.concat([i]))).value instanceof Ch,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),jl(ih(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},o,function(t,e){var i=n.gradFunc(t,e),o=Array.isArray(i)?i:[i];jl(o.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),jl(o.every(function(t){return t instanceof Ch}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var a={};return o.forEach(function(t,e){a[e]=function(){return t}}),a})}},t.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},t.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},t.prototype.time=function(t){return Il(this,0,void 0,function(){var e,n;return Sl(this,function(r){switch(r.label){case 0:return e=hh(),[4,this.backend.time(t)];case 1:return(n=r.sent()).wallMs=hh()-e,[2,n]}})})},t.prototype.track=function(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Fh,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}(),zh=function(){var t,e=function(){if(null==Bh){var t=void 0;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof global)t=global;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}Bh=t}return Bh}();if(null==e._tfengine){var n=new kl(e);e._tfengine=new jh(n)}return t=e._tfengine.ENV,Nl=t,wh=function(){return e._tfengine},e._tfengine}();function Wh(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Uh=Tl();Uh.registerFlag("DEBUG",function(){return!1},function(t){}),Uh.registerFlag("IS_BROWSER",function(){return Wh()}),Uh.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),Uh.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),Uh.registerFlag("PROD",function(){return!1}),Uh.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Uh.getBool("DEBUG")}),Uh.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),Uh.registerFlag("IS_TEST",function(){return!1});var Vh,Hh,Gh,qh={},Kh={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Zh(t){t in qh||(qh[t]=function(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=function(t){if("undefined"!=typeof OffscreenCanvas&&2===t)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return e.addEventListener("webglcontextlost",function(e){e.preventDefault(),delete qh[t]},!1),1===t?e.getContext("webgl",Kh)||e.getContext("experimental-webgl",Kh):e.getContext("webgl2",Kh)}(t));var e=qh[t];return e.isContextLost()?(delete qh[t],Zh(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),qh[t])}function Xh(t,e){return[e,t]}function $h(t){var e=Vl(t);return Kl(Math.ceil(e/4))}function Yh(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function Jh(t,e){var n,r,i,o,a,s,u,c,l,h=t;return 2===Tl().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,i=h.RGBA16F,o=h.RGBA32F,a=h.RED,s=4,u=1,c=h.HALF_FLOAT,l=h.FLOAT):(n=t.RGBA,r=t.RGBA,i=t.RGBA,o=h.RGBA,a=t.RGBA,s=4,u=4,c=null!=e?e.HALF_FLOAT_OES:null,l=t.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function Qh(t,e,n){var r=n();return e&&function(t){var e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+function(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}(t,e))}(t),r}!function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"}(Vh||(Vh={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(Hh||(Hh={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Gh||(Gh={}));function td(t){return!!(Tl().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||5.96e-8<Math.abs(t)&&Math.abs(t)<65504)}function ed(t,e,n){return hd(t,e,function(){return t.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}var nd,rd,id=/ERROR: [0-9]+:([0-9]+):/g;function od(t,e,n){if(Qh(t,e,function(){return t.validateProgram(n)}),!1===t.getProgramParameter(n,t.VALIDATE_STATUS))throw new Error("Shader program validation failed.")}function ad(t,e,n,r,i,o,a,s){var u=t.getAttribLocation(n,r);return-1!==u&&(Qh(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,i)}),Qh(t,e,function(){return t.vertexAttribPointer(u,o,t.FLOAT,!1,a,s)}),Qh(t,e,function(){return t.enableVertexAttribArray(u)}),!0)}function sd(t,e,n,r){(function(t,e){var n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")})(t,r),Qh(t,e,function(){return t.activeTexture(t.TEXTURE0+r)}),Qh(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)})}function ud(t,e,n,r){Qh(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)}),Qh(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)})}function cd(t,e,n){Qh(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)}),Qh(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function ld(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}(t,e))}function hd(t,e,n,r){var i=Qh(t,e,function(){return n()});if(null==i)throw new Error(r);return i}function dd(t,e){return void 0===e&&(e=2),Vl(t.slice(0,t.length-e))}function pd(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function fd(t){var e=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(e=[dd(t)].concat(pd(t))),e}function md(t){return t%2==0}function vd(t,e){if(Hl(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){var n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r)return!0;if(md(n)&&md(r)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&md(t[0])&&md(e[0])}function gd(t,e){return null!=t.getExtension(e)}function yd(t){try{if(null!=Zh(t))return!0}catch(e){return!1}return!1}function xd(t){var e=Jh(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),i}var bd=Tl();function wd(t){Tl().getBool("DEPRECATION_WARNINGS_ENABLED")}function _d(t,e){return zh.tidy(t,e)}function Ed(t){Lh(t).forEach(function(t){return t.dispose()})}function Cd(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Tl().getBool("IS_TEST")}function Id(t,e){var n=t;if(th(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(n)||th(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&Tl().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function t(e,n,r){if(r=r||[],Array.isArray(e)||th(e)){jl(n.length>0,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"}),jl(e.length===n[0],function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+e.length+" elements"});for(var i=n.slice(1),o=0;o<e.length;++o)t(e[o],i,r.concat(o))}else jl(0===n.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"})}(t,r,[]),r}function Sd(t,e,n,r){if(null!=t&&("numeric"!==t&&t!==e||"numeric"===t&&"string"===e))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+t+" tensor, but got "+e+" tensor")}function kd(t,e,n,r){if(void 0===r&&(r="numeric"),t instanceof Ch)return Sd(r,t.dtype,e,n),t;var i=rh(t);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),Sd(r,i,e,n),null==t||!th(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){var o=null==t?"null":t.constructor.name;throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+o+"'")}var a=Id(t,i);th(t)||Array.isArray(t)||(t=[t]);var s="string"!==i?sh(t,i,Tl().getBool("DEBUG")):Ul(t,[],!0);return zh.makeTensor(s,a,i)}function Td(t,e,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return t.map(function(t,r){return kd(t,e+"["+r+"]",n)},r)}function Nd(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function Rd(t,e){for(var n=[],r=t.length,i=0;i<r;i++)-1===e.indexOf(i)&&n.push(t[i]);return[n,e.map(function(e){return t[e]})]}function Ad(t,e){return function(t,e,n){for(var r=t.length+e.length,i=[],o=0,a=0,s=0;s<r;s++)-1===n.indexOf(s)?i.push(t[o++]):i.push(e[a++]);return i}(t,e.map(function(t){return 1}),e)}function Pd(t,e,n){jl(Nd(e,n),function(){return t+" supports only inner-most axes for now. Got axes "+e+" and rank-"+n+" input."})}function Dd(t,e){if(Nd(t,e))return null;for(var n=[],r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach(function(t){return n.push(t)}),n}function Md(t){return t.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function Od(t,e){for(var n=[],r=e-t;r<e;++r)n.push(r);return n}function Ld(t,e){for(var n=t[0].slice(),r=1;r<t.length;r++)n[e]+=t[r][e];return n}function Bd(t){var e=Object.keys(t);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var n=e[0],r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var i=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];zh.startScope(n);try{var i=r.apply(void 0,t);return zh.endScope(i),i}catch(o){throw zh.endScope(null),o}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}bd.registerFlag("HAS_WEBGL",function(){return bd.getNumber("WEBGL_VERSION")>0}),bd.registerFlag("WEBGL_VERSION",function(){return yd(2)?2:yd(1)?1:0}),bd.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===bd.get("WEBGL_VERSION")}),bd.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),bd.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),bd.registerFlag("WEBGL_PACK",function(){return bd.getBool("HAS_WEBGL")}),bd.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return bd.getBool("WEBGL_PACK")}),bd.registerFlag("WEBGL_PACK_CLIP",function(){return bd.getBool("WEBGL_PACK")}),bd.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),bd.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return bd.getBool("WEBGL_PACK")}),bd.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return bd.getBool("WEBGL_PACK")}),bd.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return bd.getBool("WEBGL_PACK")}),bd.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return bd.getBool("WEBGL_PACK")}),bd.registerFlag("WEBGL_PACK_REDUCE",function(){return bd.getBool("WEBGL_PACK")}),bd.registerFlag("WEBGL_LAZILY_UNPACK",function(){return bd.getBool("WEBGL_PACK")}),bd.registerFlag("WEBGL_CONV_IM2COL",function(){return bd.getBool("WEBGL_PACK")}),bd.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return function(t){if(null==nd){var e=Zh(t);nd=e.getParameter(e.MAX_TEXTURE_SIZE)}return nd}(bd.getNumber("WEBGL_VERSION"))}),bd.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return function(t){if(null==rd){var e=Zh(t);rd=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,rd)}(bd.getNumber("WEBGL_VERSION"))}),bd.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var t=bd.getNumber("WEBGL_VERSION");return 0===t?0:function(t){if(0===t)return 0;var e=Zh(t);return gd(e,"EXT_disjoint_timer_query_webgl2")&&2===t?2:gd(e,"EXT_disjoint_timer_query")?1:0}(t)}),bd.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return bd.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(t=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))));var t}),bd.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return function(t){if(0===t)return!1;var e=Zh(t);if(1===t){if(!gd(e,"OES_texture_float"))return!1}else if(!gd(e,"EXT_color_buffer_float"))return!1;return xd(e)}(bd.getNumber("WEBGL_VERSION"))}),bd.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!bd.getBool("WEBGL_FORCE_F16_TEXTURES")&&bd.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),bd.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return function(t){if(0===t)return!1;var e=Zh(t);if(1!==t){if(gd(e,"EXT_color_buffer_float"))return xd(e);if(gd(e,"EXT_color_buffer_half_float")){var n=e.getExtension("EXT_color_buffer_half_float");return function(t,e){var n=Jh(t,e),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(i),o}(e,n)}return!1}return!!gd(e,"OES_texture_float")&&!!gd(e,"WEBGL_color_buffer_float")&&xd(e)}(bd.getNumber("WEBGL_VERSION"))}),bd.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return function(t){return 2===t&&null!=Zh(t).fenceSync}(bd.getNumber("WEBGL_VERSION"))}),bd.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return bd.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Eh=wd;var Fd=Bd({complex_:function(t,e){var n=kd(t,"real","complex"),r=kd(e,"imag","complex");return zl(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),zh.runKernelFunc(function(t){return t.complex(n,r)},{$real:n,$imag:r})}}),jd=Bd({real_:function(t){var e=kd(t,"input","real");return zh.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),zd=Bd({imag_:function(t){var e=kd(t,"input","imag");return zh.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function Wd(t,e,n){return Ud(t,e,Id(t,n),n)}function Ud(t,e,n,r){if(null==r&&(r=rh(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!th(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){dh(e);var i=Vl(e),o=Vl(n);jl(i===o,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o});for(var a=0;a<n.length;++a){var s=n[a],u=a!==n.length-1||s!==Vl(e.slice(a));jl(n[a]===e[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+e+"). "})}}return th(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?sh(t,r,Tl().getBool("DEBUG")):Ul(t,[],!0),zh.makeTensor(t,e,r)}function Vd(t,e){if((th(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&th(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Ud(t,[],[],e)}function Hd(t,e){Wl(t);var n=Id(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Ud(t,null,n,e)}function Gd(t,e,n){if(Wl(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Id(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Ud(t,e,r,n)}function qd(t,e,n){if(Wl(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Id(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Ud(t,e,r,n)}function Kd(t,e,n){if(Wl(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Id(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Ud(t,e,r,n)}function Zd(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=Zd(t,"float32"),r=Xd(t,"float32");return Fd(n,r)}var i=ch(Vl(t),e);return zh.makeTensor(i,t,e)}function Xd(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=Xd(t,"float32"),r=Xd(t,"float32");return Fd(n,r)}var i=lh(Vl(t),e);return zh.makeTensor(i,t,e)}function $d(t,e,n){return zh.runKernelFunc(function(r){return r.fill(t,e,n)},{})}function Yd(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(t===e||t<e&&n<0||e<t&&n>1)return Xd([0],r);var i=lh(Math.abs(Math.ceil((e-t)/n)),r);e<t&&1===n&&(n=-1),i[0]=t;for(var o=1;o<i.length;o++)i[o]=i[o-1]+n;return Hd(i,r)}var Jd=Bd({onesLike_:function(t){var e=kd(t,"x","onesLike");if("complex64"===e.dtype){var n=Jd(jd(e)),r=Qd(zd(e));return Fd(n,r)}return zh.runKernelFunc(function(t){return t.onesLike(e)},{$x:e},function(t,e){return{$x:function(){return Qd(t)}}})}}),Qd=Bd({zerosLike_:function(t){var e=kd(t,"x","zerosLike");return zh.runKernelFunc(function(t){return t.zerosLike(e)},{$x:e},function(t,e){return{$x:function(){return Qd(t)}}})}}),tp=Bd({concat_:function(t,e){void 0===e&&(e=0),jl(t.length>=1,function(){return"Pass at least one tensor to concat"});var n=Td(t,"tensors","concat");"complex64"===n[0].dtype&&n.forEach(function(t){if("complex64"!==t.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+t.dtype+". ")}),e=$l(e,n[0].shape)[0];var r=Ld(n.map(function(t){return t.shape}),e);if(0===Vl(r))return Wd([],r);if(1===(n=n.filter(function(t){return t.size>0})).length)return n[0];var i=n.map(function(t){return t.shape});!function(t,e){var n=t[0].length;t.forEach(function(t,e){jl(t.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+e+"] must be the same as the rank of the rest ("+n+")"})}),jl(e>=0&&e<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=t[0];t.forEach(function(t,i){for(var o=0;o<n;o++)jl(o===e||t[o]===r[o],function(){return"Error in concat"+n+"D: Shape of tensors["+i+"] ("+t+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."})})}(i,e);var o=n,a={axis:e};return zh.runKernelFunc(function(t){return t.concat(n,e)},o,function(t){var n=i.map(function(t){return t[e]});return op(t,n,e).map(function(t){return function(){return t}})},"Concat",a)}}),ep=Bd({concat1d_:function(t){return tp(t,0)}}),np=Bd({concat2d_:function(t,e){return tp(t,e)}}),rp=Bd({concat3d_:function(t,e){return tp(t,e)}}),ip=Bd({concat4d_:function(t,e){return tp(t,e)}}),op=Bd({split_:function(t,e,n){void 0===n&&(n=0);var r,i=kd(t,"x","split");return n=$l(n,i.shape)[0],"number"==typeof e?(jl(i.shape[n]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(i.shape[n]/e)):(jl(i.shape[n]===e.reduce(function(t,e){return t+e}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),zh.runKernelFunc(function(t){return t.split(i,r,n)},{$x:i},function(t){return{$x:function(){return tp(t,n)}}})}});function ap(t,e){return t(e={exports:{}},e.exports),e.exports}var sp=ap(function(t){!function(t,e){function n(t){var e,n=this,r=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}function r(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function i(t,e){var i=new n(t),o=e&&e.state,a=i.next;return a.int32=function(){return 4294967296*i.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,o&&("object"==typeof o&&r(o,i),a.state=function(){return r(i,{})}),a}e&&e.exports?e.exports=i:this.alea=i}(0,t)}),up=ap(function(t){!function(t,e){function n(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function r(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function i(t,e){var i=new n(t),o=e&&e.state,a=function(){return(i.next()>>>0)/4294967296};return a.double=function(){do{var t=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=i.next,a.quick=a,o&&("object"==typeof o&&r(o,i),a.state=function(){return r(i,{})}),a}e&&e.exports?e.exports=i:this.xor128=i}(0,t)}),cp=ap(function(t){!function(t,e){function n(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function r(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function i(t,e){var i=new n(t),o=e&&e.state,a=function(){return(i.next()>>>0)/4294967296};return a.double=function(){do{var t=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=i.next,a.quick=a,o&&("object"==typeof o&&r(o,i),a.state=function(){return r(i,{})}),a}e&&e.exports?e.exports=i:this.xorwow=i}(0,t)}),lp=ap(function(t){!function(t,e){function n(t){var e=this;e.next=function(){var t,n,r=e.x,i=e.i;return t=r[i],n=(t^=t>>>7)^t<<24,n^=(t=r[i+1&7])^t>>>10,n^=(t=r[i+3&7])^t>>>3,n^=(t=r[i+4&7])^t<<7,t=r[i+7&7],n^=(t^=t<<13)^t<<9,r[i]=n,e.i=i+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function r(t,e){return e.x=t.x.slice(),e.i=t.i,e}function i(t,e){null==t&&(t=+new Date);var i=new n(t),o=e&&e.state,a=function(){return(i.next()>>>0)/4294967296};return a.double=function(){do{var t=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=i.next,a.quick=a,o&&(o.x&&r(o,i),a.state=function(){return r(i,{})}),a}e&&e.exports?e.exports=i:this.xorshift7=i}(0,t)}),hp=ap(function(t){!function(t,e){function n(t){var e=this;e.next=function(){var t,n,r=e.w,i=e.X,o=e.i;return e.w=r=r+1640531527|0,n=i[o+34&127],t=i[o=o+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=i[o]=n^t,e.i=o,n+(r^r>>>16)|0},function(t,e){var n,r,i,o,a,s=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),i=0,o=-32;o<u;++o)e&&(r^=e.charCodeAt((o+32)%e.length)),0===o&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(a=a+1640531527|0,i=0==(n=s[127&o]^=r+a)?i+1:0);for(i>=128&&(s[127&(e&&e.length||0)]=-1),i=127,o=512;o>0;--o)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;t.w=a,t.X=s,t.i=i}(e,t)}function r(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function i(t,e){null==t&&(t=+new Date);var i=new n(t),o=e&&e.state,a=function(){return(i.next()>>>0)/4294967296};return a.double=function(){do{var t=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=i.next,a.quick=a,o&&(o.X&&r(o,i),a.state=function(){return r(i,{})}),a}e&&e.exports?e.exports=i:this.xor4096=i}(0,t)}),dp=ap(function(t){!function(t,e){function n(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function r(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function i(t,e){var i=new n(t),o=e&&e.state,a=function(){return(i.next()>>>0)/4294967296};return a.double=function(){do{var t=((i.next()>>>11)+(i.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=i.next,a.quick=a,o&&("object"==typeof o&&r(o,i),a.state=function(){return r(i,{})}),a}e&&e.exports?e.exports=i:this.tychei=i}(0,t)}),pp=ap(function(t){!function(e,n){var r,i=this,o=256,a="random",s=n.pow(o,6),u=n.pow(2,52),c=2*u,l=255;function h(t,l,h){var v=[],g=f(function t(e,n){var r,i=[],o=typeof e;if(n&&"object"==o)for(r in e)try{i.push(t(e[r],n-1))}catch(a){}return i.length?i:"string"==o?e:e+"\0"}((l=1==l?{entropy:!0}:l||{}).entropy?[t,m(e)]:null==t?function(){try{var t;return r&&(t=r.randomBytes)?t=t(o):(t=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(t)),m(t)}catch(s){var n=i.navigator,a=n&&n.plugins;return[+new Date,i,a,i.screen,m(e)]}}():t,3),v),y=new d(v),x=function(){for(var t=y.g(6),e=s,n=0;t<u;)t=(t+n)*o,e*=o,n=y.g(1);for(;t>=c;)t/=2,e/=2,n>>>=1;return(t+n)/e};return x.int32=function(){return 0|y.g(4)},x.quick=function(){return y.g(4)/4294967296},x.double=x,f(m(y.S),e),(l.pass||h||function(t,e,r,i){return i&&(i.S&&p(i,y),t.state=function(){return p(y,{})}),r?(n[a]=t,e):t})(x,g,"global"in l?l.global:this==n,l.state)}function d(t){var e,n=t.length,r=this,i=0,a=r.i=r.j=0,s=r.S=[];for(n||(t=[n++]);i<o;)s[i]=i++;for(i=0;i<o;i++)s[i]=s[a=l&a+t[i%n]+(e=s[i])],s[a]=e;(r.g=function(t){for(var e,n=0,i=r.i,a=r.j,s=r.S;t--;)e=s[i=l&i+1],n=n*o+s[l&(s[i]=s[a=l&a+e])+(s[a]=e)];return r.i=i,r.j=a,n})(o)}function p(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function f(t,e){for(var n,r=t+"",i=0;i<r.length;)e[l&i]=l&(n^=19*e[l&i])+r.charCodeAt(i++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(n["seed"+a]=h,f(n.random(),e),t.exports){t.exports=h;try{r=require("crypto")}catch(v){}}}([],Math)});pp.alea=sp,pp.xor128=up,pp.xorwow=cp,pp.xorshift7=lp,pp.xor4096=hp,pp.tychei=dp;var fp=pp.alea,mp=function(){function t(t,e,n,r,i){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=fp(o.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,r=!1;!r;){var i=void 0,o=void 0,a=void 0;do{a=(i=2*this.random()-1)*i+(o=2*this.random()-1)*o}while(a>=1||0===a);var s=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*i*s,n=this.mean+this.stdDev*o*s,this.truncated&&!this.isValidTruncated(e)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}(),vp=function(){function t(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;var i=r||Math.random();this.randu=fp(i.toString()),this.randn=new mp(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return t.prototype.nextValue=function(){for(var t,e,n,r,i,o;;){do{r=this.randn.nextValue(),o=1+this.c*r}while(o<=0);if(o*=o*o,e=1-.331*(t=r*r)*t,n=.5*t+this.d*(1-o+Math.log(o)),(i=this.randu())<e||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},t.prototype.convertValue=function(t){return"float32"===this.dtype?t:Math.round(t)},t}(),gp=function(){function t(t,e,n,r){var i=this;if(void 0===t&&(t=0),void 0===e&&(e=1),this.canReturnFloat=function(){return null==i.dtype||"float32"===i.dtype},this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=fp(r)}return t.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}();function yp(t,e,n){return void 0===e&&(e="float32"),e=e||"float32",dh(t),new bh(t,e,n)}var xp=Bd({batchToSpaceND_:function(t,e,n){var r=kd(t,"x","batchToSpaceND"),i=e.reduce(function(t,e){return t*e});return jl(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),jl(n.length===e.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+e.length}),jl(r.shape[0]%i==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),zh.runKernelFunc(function(t){return t.batchToSpaceND(r,e,n)},{$x:r},function(t){return{$x:function(){return t.spaceToBatchND(e,n)}}})}}),bp=Bd({broadcastTo_:function(t,e){var n=kd(t,"broadcastTo","x"),r=n.shape;if(e.some(function(t){return!(t>0)||t%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<n.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+n.rank+".");if(e.length>n.rank){for(var i=n.shape.slice();i.length<e.length;)i.unshift(1);n=n.reshape(i)}for(var o=Array.from(e),a=e.length-1;a>=0;a--)if(n.shape[a]===e[a])o[a]=1;else if(1!==n.shape[a])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var s=o.map(function(t,e){return t>1?e:-1}).filter(function(t){return t>=0});return 0===s.length?n.clone():zh.runKernelFunc(function(t){return t.tile(n,o)},{input:n},function(t){return{input:function(){return t.sum(s,!0)}}})}}),wp=Bd({cast_:function(t,e){var n=kd(t,"x","cast");if(!function(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}(e))throw new Error("Failed to cast to unknown dtype "+e);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:e};return zh.runKernelFunc(function(t){return t.cast(n,e)},{x:n},function(t){return{x:function(){return t.clone()}}},"Cast",r)}}),_p=Bd({clone_:function(t){var e=kd(t,"x","clone",null);return zh.runKernelFunc(function(){return zh.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),Ep=Bd({cumsum_:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i=kd(t,"x","cumsum"),o=Dd([e|=0],i.rank),a=i;null!=o&&(a=i.transpose(o));var s=Od(1,i.rank)[0],u=zh.runKernelFunc(function(t){return t.cumsum(a,s,n,r)},{permutedX:a},function(t){return{permutedX:function(){return t.cumsum(e,n,!r)}}});return null!=o&&(u=u.transpose(o)),u}}),Cp=Bd({depthToSpace_:function(t,e,n){void 0===n&&(n="NHWC");var r=kd(t,"x","depthToSpace"),i="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],a="NHWC"===n?r.shape[3]:r.shape[1];return jl(i*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+e+"  for depthToSpace with input shape\n      "+r.shape}),jl(o*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+e+" for depthToSpace with input shape\n          "+r.shape}),jl(a%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+r.shape}),zh.runKernelFunc(function(t){return t.depthToSpace(r,e,n)},{$x:r})}}),Ip=Bd({expandDims_:function(t,e){void 0===e&&(e=0);var n=kd(t,"x","expandDims",null);jl(e<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return e<0&&(jl(-(n.rank+1)<=e,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),e=n.rank+e+1),r.splice(e,0,1),Fp(n,r)}}),Sp=Bd({eye_:function(t,e,n,r){void 0===r&&(r="float32"),null==e&&(e=t);for(var i=yp([t,e],r),o=t<=e?t:e,a=0;a<o;++a)i.set(1,a,a);var s=i.toTensor().as2D(t,e);if(null==n)return s;if(1===n.length)return Up(Ip(s,0),[n[0],1,1]);if(2===n.length)return Up(Ip(Ip(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return Up(Ip(Ip(Ip(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),kp=Bd({multinomial_:function(t,e,n,r){void 0===r&&(r=!1);var i=kd(t,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);n=n||Math.random();var s=1===a?i.as2D(1,-1):i,u=zh.runKernelFunc(function(t){return t.multinomial(s,r,e,n)},{logits2D:s});return 1===a?u.as1D():u}}),Tp=Bd({oneHot_:function(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=kd(t,"indices","oneHot","int32"),o=i.shape.concat([e]);return i=i.flatten(),zh.runKernelFunc(function(t){return t.oneHot(i,e,n,r)},{$indices:i},function(t){return{$indices:function(){return Xd(i.shape,"float32")}}}).reshape(o)}}),Np=Bd({pad_:function(t,e,n){void 0===n&&(n=0);var r=kd(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:n};return zh.runKernelFunc(function(t){return t.pad(r,e,n)},{x:r},function(t){var n=e.map(function(t){return t[0]});return{x:function(){return t.slice(n,r.shape)}}},"PadV2",i)}}),Rp=Bd({pad1d_:function(t,e,n){return void 0===n&&(n=0),jl(2===e.length,function(){return"Invalid number of paddings. Must be length of 2."}),Np(t,[e],n)}}),Ap=Bd({pad2d_:function(t,e,n){return void 0===n&&(n=0),jl(2===e.length&&2===e[0].length&&2===e[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Np(t,e,n)}}),Pp=Bd({pad3d_:function(t,e,n){return void 0===n&&(n=0),jl(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Np(t,e,n)}}),Dp=Bd({pad4d_:function(t,e,n){return void 0===n&&(n=0),jl(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),Np(t,e,n)}}),Mp=Bd({rand_:function(t,e,n){var r=Vl(t),i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return zh.makeTensor(i,t,n)}}),Op=Bd({randomNormal_:function(t,e,n,r,i){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new mp(e,n,r,!1,i),a=yp(t,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),Lp=Bd({randomGamma_:function(t,e,n,r,i){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var o=new vp(e,n,r,i),a=yp(t,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),Bp=Bd({randomUniform_:function(t,e,n,r,i){void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var o=yp(t,r),a=new gp(e,n,null,i),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),Fp=Bd({reshape_:function(t,e){var n=kd(t,"x","reshape",null);e=function(t,e){for(var n=1,r=-1,i=0;i<t.length;++i)if(t[i]>=0)n*=t[i];else if(-1===t[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(t[i]<0)throw Error("Shapes can not be < 0. Found "+t[i]+" at dim "+i);if(-1===r){if(e>0&&e!==n)throw Error("Size("+e+") must match the product of shape "+t);return t}if(0===n)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(e%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+n);var o=t.slice();return o[r]=e/n,o}(e,n.size),jl(n.size===Vl(e),function(){return"new shape and old shape must have the same number of elements."});var r={shape:e};return zh.runKernelFunc(function(t){return t.reshape(n,e)},{x:n},function(t){return{x:function(){return t.reshape(n.shape)}}},"Reshape",r)}}),jp=Bd({spaceToBatchND_:function(t,e,n){var r=kd(t,"x","spaceToBatchND");return jl(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),jl(n.length===e.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+e.length}),jl(r.shape.reduce(function(t,r,i){return i>0&&i<=e.length?t&&(r+n[i-1][0]+n[i-1][1])%e[i-1]==0:t},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+e.toString()}),zh.runKernelFunc(function(t){return t.spaceToBatchND(r,e,n)},{$x:r},function(t){return{$x:function(){return t.batchToSpaceND(e,n)}}})}}),zp=Bd({squeeze_:function(t,e){var n=kd(t,"x","squeeze");return Fp(n,Yl(n.shape,e).newShape)}}),Wp=Bd({stack_:function(t,e){void 0===e&&(e=0);var n=Td(t,"tensors","stack");if(jl(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===n.length)return n[0].expandDims(e);var r=n[0].rank,i=n[0].shape,o=n[0].dtype;jl(e<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(t){zl(i,t.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(t){jl(o===t.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=n.map(function(t){return t.expandDims(e)});return tp(a,e)}}),Up=Bd({tile_:function(t,e){var n=kd(t,"x","tile",null);jl(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+e+"."});var r=[n],i={reps:e};return zh.runKernelFunc(function(t,r){var i=t.tile(n,e);return r([n]),i},{x:n},function(t,n){var r=n[0];return{x:function(){var n=Qd(r);if(1===r.rank)for(var i=0;i<e[0];++i)n=n.add(t.slice([i*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(i=0;i<e[0];++i)for(var o=0;o<e[1];++o)n=n.add(t.slice([i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(i=0;i<e[0];++i)for(o=0;o<e[1];++o)for(var a=0;a<e[2];++a)n=n.add(t.slice([i*r.shape[0],o*r.shape[1],a*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(i=0;i<e[0];++i)for(o=0;o<e[1];++o)for(a=0;a<e[2];++a)for(var s=0;s<e[3];++s)n=n.add(t.slice([i*r.shape[0],o*r.shape[1],a*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}},"Tile",i,r)}}),Vp=Bd({truncatedNormal_:function(t,e,n,r,i){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new mp(e,n,r,!0,i),a=yp(t,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),Hp=Bd({unstack_:function(t,e){void 0===e&&(e=0),e=e||0;var n=kd(t,"x","unstack");jl(e>=-n.shape.length&&e<n.shape.length,function(){return"Axis = "+e+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),e<0&&(e+=n.shape.length);var r={axis:e};return zh.runKernelFunc(function(t){return t.unstack(n,e)},{x:n},function(t){return{x:function(){return Wp(t,e)}}},"Unpack",r)}});function Gp(t,e,n,r){void 0===r&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);for(var o=e.length,a=0;a<o;++a)i=i.concat([t[a+1]/e[a],e[a]]);i=i.concat(t.slice(o+1))}return i}function qp(t,e,n){void 0===n&&(n=!0);var r=[];if(n){r.push(e);for(var i=e+1;i<t;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var o=[],a=[];for(i=1;i<t;++i)i>=2*e+1||i%2==1?a.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,a)}return r}function Kp(t,e,n,r){void 0===r&&(r=!0);var i=[];r?i.push(t[0]/n):i.push(t[0]*n);for(var o=1;o<t.length;++o)o<=e.length?r?i.push(e[o-1]*t[o]):i.push(t[o]/e[o-1]):i.push(t[o]);return i}function Zp(t,e){for(var n=[0],r=0;r<e;++r)n.push(t[r][0]);return n}function Xp(t,e,n){for(var r=t.slice(0,1),i=0;i<n;++i)r.push(t[i+1]-e[i][0]-e[i][1]);return r}function $p(t,e){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+t.rank);if(0===t.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var n=e.shape,r=n[n.length-1],i=1,o=0;o<n.length-1;++o)i*=n[o];var a=t.shape,s=n.slice();s.pop();var u=1;for(o=r;o<t.rank;++o)u*=a[o],s.push(a[o]);var c=ah(t.shape).map(function(t){return t/u}).concat([1]).slice(0,r);return[s,i,u,c]}function Yp(t){return t<=30?t:oh(t,Math.floor(Math.sqrt(t)))}function Jp(t,e,n){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}!function(t,e,n){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+e.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+i+".";if(n.rank<i)throw new Error(o+" update.rank < "+i+". ");if(t.length<r+(n.rank-i))throw new Error(o+" Output shape length < "+(r+(n.rank-i)));if(n.rank!==i+t.length-r)throw new Error(o+" update.rank != "+(i+t.length-r));for(var a=0;a<i;++a)if(n.shape[a]!==e.shape[a])throw new Error(o+" updates.shape["+a+"] ("+n.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<n.rank-i;++a)if(n.shape[a+i]!==t[a+r])throw new Error(o+" updates.shape["+(a+i)+"] ("+n.shape[a+i]+") != shape["+(a+i)+"] ("+t[a+i]+")")}(n,e,t)}function Qp(t,e,n){for(var r=e.shape.length,i=r>1?e.shape[r-1]:1,o=n.length,a=1,s=i;s<o;++s)a*=n[s];var u=i<1?1:i;return{sliceRank:i,numUpdates:Vl(e.shape)/u,sliceSize:a,strides:ah(n.slice(0,i)).concat([1]),outputSize:Vl(n)}}function tf(t){for(var e=[],n=0;t>0;)1&t&&e.push(n),t/=2,n++;return e}function ef(t,e,n){for(var r=[],i=0;i<t.length;i++)r[i]=Math.ceil((e[i]-t[i])/n[i]);return r}function nf(t,e,n,r,i){var o=e[i],a=n[i]||1;(t&1<<i||null==o)&&(o=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[i];return o<0&&(o+=s),Bl(0,o,s-1)}function rf(t,e,n,r,i){var o=e[i],a=n[i]||1;(t&1<<i||null==o)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[i];return o<0&&(o+=s),a>0?Bl(0,o,s):Bl(-1,o,s-1)}function of(t,e,n){for(var r=n.length,i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(i=r+1;i<n.length;i++)if(e[i]>0||n[i]!==t[i])return!1;return!0}function af(t,e){for(var n=t.length>0?t[t.length-1]:1,r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}function sf(t){return zh.customGrad(t)}var uf=Bd({softmax_:function(t,e){void 0===e&&(e=-1);var n=kd(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+e);return zh.runKernelFunc(function(t,r){var i=t.softmax(n,e);return r([i]),i},{logits:n},function(t,n){var r=n[0],i=t.mul(r);return{logits:function(){return i.sub(i.sum([e],!0).mul(r))}}},"Softmax",{dim:e},[],[!0])}}),cf=Bd({logSoftmax_:function(t,e){void 0===e&&(e=-1);var n=kd(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+e);return sf(function(t,n){var r=t.max(e,!0),i=t.sub(r),o=i.toFloat().sub(i.exp().sum(e,!0).log());return n([o]),{value:o,gradFunc:function(t,n){var r=n[0].exp();return t.sub(t.sum(e,!0).mul(r))}}})(n)}}),lf=function(){function t(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return t.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},t.prototype.set=function(t,e){this.dataIdsCount++,this.data.set(t,e)},t.prototype.has=function(t){return this.data.has(t)},t.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},t.prototype.numDataIds=function(){return this.dataIdsCount},t}(),hf=function(){function t(){}return t.prototype.time=function(t){return df("time")},t.prototype.read=function(t){return df("read")},t.prototype.readSync=function(t){return df("readSync")},t.prototype.numDataIds=function(){return df("numDataIds")},t.prototype.disposeData=function(t){return df("disposeData")},t.prototype.write=function(t,e,n){return df("write")},t.prototype.move=function(t,e,n,r){return df("move")},t.prototype.memory=function(){return df("memory")},t.prototype.floatPrecision=function(){return df("floatPrecision")},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.batchMatMul=function(t,e,n,r){return df("batchMatMul")},t.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,df("fusedBatchMatMul")},t.prototype.slice=function(t,e,n){return df("slice")},t.prototype.stridedSlice=function(t,e,n,r){return df("stridedSlice")},t.prototype.unstack=function(t,e){return df("unstack")},t.prototype.reverse=function(t,e){return df("reverse")},t.prototype.concat=function(t,e){return df("concat")},t.prototype.neg=function(t){return df("neg")},t.prototype.add=function(t,e){return df("add")},t.prototype.addN=function(t){return df("addN")},t.prototype.subtract=function(t,e){return df("subtract")},t.prototype.multiply=function(t,e){return df("multiply")},t.prototype.realDivide=function(t,e){return df("realDivide")},t.prototype.floorDiv=function(t,e){return df("floorDiv")},t.prototype.sum=function(t,e){return df("sum")},t.prototype.prod=function(t,e){return df("prod")},t.prototype.unsortedSegmentSum=function(t,e,n){return df("unsortedSegmentSum")},t.prototype.argMin=function(t,e){return df("argMin")},t.prototype.argMax=function(t,e){return df("argMax")},t.prototype.equal=function(t,e){return df("equal")},t.prototype.notEqual=function(t,e){return df("notEqual")},t.prototype.less=function(t,e){return df("less")},t.prototype.lessEqual=function(t,e){return df("lessEqual")},t.prototype.greater=function(t,e){return df("greater")},t.prototype.greaterEqual=function(t,e){return df("greaterEqual")},t.prototype.logicalNot=function(t){return df("logicalNot")},t.prototype.logicalAnd=function(t,e){return df("logicalAnd")},t.prototype.logicalOr=function(t,e){return df("logicalOr")},t.prototype.where=function(t){return df("where")},t.prototype.select=function(t,e,n){return df("select")},t.prototype.topk=function(t,e,n){return df("topk")},t.prototype.min=function(t,e){return df("min")},t.prototype.minimum=function(t,e){return df("minimum")},t.prototype.mod=function(t,e){return df("mod")},t.prototype.max=function(t,e){return df("max")},t.prototype.maximum=function(t,e){return df("maximum")},t.prototype.all=function(t,e){return df("all")},t.prototype.any=function(t,e){return df("any")},t.prototype.squaredDifference=function(t,e){return df("squaredDifference")},t.prototype.ceil=function(t){return df("ceil")},t.prototype.floor=function(t){return df("floor")},t.prototype.round=function(t){return df("round")},t.prototype.sign=function(t){return df("sign")},t.prototype.isNaN=function(t){return df("isNaN")},t.prototype.isInf=function(t){return df("isInf")},t.prototype.isFinite=function(t){return df("isFinite")},t.prototype.pow=function(t,e){return df("pow")},t.prototype.exp=function(t){return df("exp")},t.prototype.expm1=function(t){return df("expm1")},t.prototype.softmax=function(t,e){return df("softmax")},t.prototype.log=function(t){return df("log")},t.prototype.log1p=function(t){return df("log1p")},t.prototype.sqrt=function(t){return df("sqrt")},t.prototype.rsqrt=function(t){return df("rsqrt")},t.prototype.square=function(t){return df("square")},t.prototype.reciprocal=function(t){return df("reciprocal")},t.prototype.relu=function(t){return df("relu")},t.prototype.relu6=function(t){return df("relu6")},t.prototype.prelu=function(t,e){return df("prelu")},t.prototype.elu=function(t){return df("elu")},t.prototype.eluDer=function(t,e){return df("eluDer")},t.prototype.selu=function(t){return df("selu")},t.prototype.int=function(t){return df("int")},t.prototype.clip=function(t,e,n){return df("clip")},t.prototype.abs=function(t){return df("abs")},t.prototype.complexAbs=function(t){return df("complexAbs")},t.prototype.sigmoid=function(t){return df("sigmoid")},t.prototype.softplus=function(t){return df("softplus")},t.prototype.sin=function(t){return df("sin")},t.prototype.cos=function(t){return df("cos")},t.prototype.tan=function(t){return df("tan")},t.prototype.asin=function(t){return df("asin")},t.prototype.acos=function(t){return df("acos")},t.prototype.atan=function(t){return df("atan")},t.prototype.atan2=function(t,e){return df("atan2")},t.prototype.sinh=function(t){return df("sinh")},t.prototype.cosh=function(t){return df("cosh")},t.prototype.tanh=function(t){return df("tanh")},t.prototype.asinh=function(t){return df("asinh")},t.prototype.acosh=function(t){return df("acosh")},t.prototype.atanh=function(t){return df("atanh")},t.prototype.erf=function(t){return df("erf")},t.prototype.step=function(t,e){return df("step")},t.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,df("fusedConv2d")},t.prototype.conv2d=function(t,e,n){return df("conv2d")},t.prototype.conv2dDerInput=function(t,e,n){return df("conv2dDerInput")},t.prototype.conv2dDerFilter=function(t,e,n){return df("conv2dDerFilter")},t.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,df("fusedDepthwiseConv2D")},t.prototype.depthwiseConv2D=function(t,e,n){return df("depthwiseConv2D")},t.prototype.depthwiseConv2DDerInput=function(t,e,n){return df("depthwiseConv2DDerInput")},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){return df("depthwiseConv2DDerFilter")},t.prototype.conv3d=function(t,e,n){return df("conv3d")},t.prototype.conv3dDerInput=function(t,e,n){return df("conv3dDerInput")},t.prototype.conv3dDerFilter=function(t,e,n){return df("conv3dDerFilter")},t.prototype.maxPool=function(t,e){return df("maxPool")},t.prototype.maxPoolBackprop=function(t,e,n,r){return df("maxPoolBackprop")},t.prototype.avgPool=function(t,e){return df("avgPool")},t.prototype.avgPoolBackprop=function(t,e,n){return df("avgPoolBackprop")},t.prototype.avgPool3d=function(t,e){return df("avgPool3d")},t.prototype.avgPool3dBackprop=function(t,e,n){return df("avgPool3dBackprop")},t.prototype.maxPool3d=function(t,e){return df("maxPool3d")},t.prototype.maxPool3dBackprop=function(t,e,n,r){return df("maxPool3dBackprop")},t.prototype.reshape=function(t,e){return df("reshape")},t.prototype.cast=function(t,e){return df("cast")},t.prototype.tile=function(t,e){return df("tile")},t.prototype.pad=function(t,e,n){return df("pad")},t.prototype.transpose=function(t,e){return df("transpose")},t.prototype.gather=function(t,e,n){return df("gather")},t.prototype.gatherND=function(t,e){return df("gatherND")},t.prototype.scatterND=function(t,e,n){return df("scatterND")},t.prototype.batchToSpaceND=function(t,e,n){return df("batchToSpaceND")},t.prototype.spaceToBatchND=function(t,e,n){return df("spaceToBatchND")},t.prototype.resizeBilinear=function(t,e,n,r){return df("resizeBilinear")},t.prototype.resizeBilinearBackprop=function(t,e,n){return df("resizeBilinearBackprop")},t.prototype.resizeNearestNeighbor=function(t,e,n,r){return df("resizeNearestNeighbor")},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){return df("resizeNearestNeighborBackprop")},t.prototype.batchNormalization=function(t,e,n,r,i,o){return df("batchNormalization")},t.prototype.localResponseNormalization4D=function(t,e,n,r,i){return df("localResponseNormalization4D")},t.prototype.LRNGrad=function(t,e,n,r,i,o,a){return df("LRNGrad")},t.prototype.multinomial=function(t,e,n,r){return df("multinomial")},t.prototype.oneHot=function(t,e,n,r){return df("oneHot")},t.prototype.cumsum=function(t,e,n,r){return df("cumsum")},t.prototype.nonMaxSuppression=function(t,e,n,r,i){return df("nonMaxSuppression")},t.prototype.fft=function(t){return df("fft")},t.prototype.ifft=function(t){return df("ifft")},t.prototype.complex=function(t,e){return df("complex")},t.prototype.real=function(t){return df("real")},t.prototype.imag=function(t){return df("imag")},t.prototype.cropAndResize=function(t,e,n,r,i,o){return df("cropAndResize")},t.prototype.depthToSpace=function(t,e,n){return df("depthToSpace")},t.prototype.split=function(t,e,n){return df("split")},t.prototype.sparseToDense=function(t,e,n,r){return df("sparseToDense")},t.prototype.diag=function(t){return df("diag")},t.prototype.fill=function(t,e,n){return df("fill")},t.prototype.onesLike=function(t){return df("onesLike")},t.prototype.zerosLike=function(t){return df("zerosLike")},t.prototype.linspace=function(t,e,n){return df("linspace")},t.prototype.dispose=function(){return df("dispose")},t}();function df(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function pf(t,e){for(var n=t.length,r=[],i=0;i<n;i++){var o=n-1-i,a=t[o]||1;(e[e.length-1-i]||1)>1&&1===a&&r.unshift(o)}return r}function ff(t,e){for(var n=[],r=0;r<e.length;r++){var i=t[t.length-r-1],o=e.length-r-1,a=e[o];(null==i||1===i&&a>1)&&n.unshift(o)}return n}function mf(t,e){for(var n=[],r=Math.max(t.length,e.length),i=0;i<r;i++){var o=t[t.length-i-1];null==o&&(o=1);var a=e[e.length-i-1];if(null==a&&(a=1),1===o)n.unshift(a);else if(1===a)n.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+t+" and "+e+".");n.unshift(o)}}return n}function vf(t,e,n,r,i,o,a){void 0===a&&(a="channelsLast");var s,u=wf(e),c=u[0],l=u[1];if("channelsLast"===a)s=[c,l,t[3],t[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);s=[c,l,t[1],t[1]]}return yf(t,s,n,r,i,o,!1,a)}function gf(t,e,n,r,i,o,a){void 0===a&&(a="NDHWC");var s,u,c=_f(e),l=c[0],h=c[1],d=c[2];if("NDHWC"===a)u="channelsLast",s=[l,h,d,t[4],t[4]];else{if("NCDHW"!==a)throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[l,h,d,t[1],t[1]]}return xf(t,s,n,r,i,!1,u,o)}function yf(t,e,n,r,i,o,a,s){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],h=u[2],d=u[3];if("channelsLast"===s)c=t[0],l=t[1],h=t[2],d=t[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=t[0],d=t[1],l=t[2],h=t[3]}var p,f=e[0],m=e[1],v=e[3],g=wf(n),y=g[0],x=g[1],b=wf(r),w=b[0],_=b[1],E=Ef(f,w),C=Ef(m,_),I=function(t,e,n,r,i,o,a,s){var u,c,l;if("number"==typeof t){u={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};var h=function(t,e,n,r,i){null==r&&(r=bf(t,e,n));var o=t[1],a=Cf((t[0]-e+2*r)/n+1,i);jl(Gl(a),function(){return"The output # of rows ("+a+") must be an integer. Change the stride and/or zero pad parameters"});var s=Cf((o-e+2*r)/n+1,i);return jl(Gl(s),function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"}),[a,s]}([e,n],o,r,t,s);c=h[0],l=h[1]}else if("same"===t){c=Math.ceil(e/r),l=Math.ceil(n/i);var d=Math.max(0,(c-1)*r+o-e),p=Math.max(0,(l-1)*i+a-n),f=Math.floor(d/2),m=d-f,v=Math.floor(p/2);u={top:f,bottom:m,left:v,right:p-v,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-o+1)/r),l=Math.ceil((n-a+1)/i)}return{padInfo:u,outHeight:c,outWidth:l}}(i,l,h,y,x,E,C,o),S=I.padInfo,k=I.outHeight,T=I.outWidth,N=a?v*d:v;return"channelsFirst"===s?p=[c,N,k,T]:"channelsLast"===s&&(p=[c,k,T,N]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:h,inChannels:d,outHeight:k,outWidth:T,outChannels:N,padInfo:S,strideHeight:y,strideWidth:x,filterHeight:f,filterWidth:m,effectiveFilterHeight:E,effectiveFilterWidth:C,dilationHeight:w,dilationWidth:_,inShape:t,outShape:p,filterShape:e}}function xf(t,e,n,r,i,o,a,s){void 0===o&&(o=!1),void 0===a&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],h=u[2],d=u[3],p=u[4];if("channelsLast"===a)c=t[0],l=t[1],h=t[2],d=t[3],p=t[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);c=t[0],p=t[1],l=t[2],h=t[3],d=t[4]}var f,m=e[0],v=e[1],g=e[2],y=e[4],x=_f(n),b=x[0],w=x[1],_=x[2],E=_f(r),C=E[0],I=E[1],S=E[2],k=Ef(m,C),T=Ef(v,I),N=Ef(g,S),R=function(t,e,n,r,i,o,a,s,u,c,l){var h,d,p,f;if("number"==typeof t){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};var m=function(t,e,n,r,i,o){null==i&&(i=bf(t,e,r));var a=t[1],s=t[2],u=Cf((t[0]-e+2*i)/r+1,o);jl(Gl(u),function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"});var c=Cf((a-e+2*i)/r+1,o);jl(Gl(c),function(){return"The output # of rows ("+c+") must be an integer. Change the stride and/or zero pad parameters"});var l=Cf((s-e+2*i)/r+1,o);return jl(Gl(l),function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"}),[u,c,l,1]}([e,n,r,1],s,0,i,t,l);d=m[0],p=m[1],f=m[2]}else if("same"===t){var v=((d=Math.ceil(e/i))-1)*i+s-e,g=((p=Math.ceil(n/o))-1)*o+u-n,y=((f=Math.ceil(r/a))-1)*a+c-r,x=Math.floor(v/2),b=v-x,w=Math.floor(g/2),_=g-w,E=Math.floor(y/2);h={top:w,bottom:_,left:E,right:y-E,front:x,back:b,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((e-s+1)/i),p=Math.ceil((n-u+1)/o),f=Math.ceil((r-c+1)/a)}return{padInfo:h,outDepth:d,outHeight:p,outWidth:f}}(i,l,h,d,b,w,_,k,T,N,s),A=R.padInfo,P=R.outDepth,D=R.outHeight,M=R.outWidth,O=o?y*p:y;return"channelsFirst"===a?f=[c,O,P,D,M]:"channelsLast"===a&&(f=[c,P,D,M,O]),{batchSize:c,dataFormat:a,inDepth:l,inHeight:h,inWidth:d,inChannels:p,outDepth:P,outHeight:D,outWidth:M,outChannels:O,padInfo:A,strideDepth:b,strideHeight:w,strideWidth:_,filterDepth:m,filterHeight:v,filterWidth:g,effectiveFilterDepth:k,effectiveFilterHeight:T,effectiveFilterWidth:N,dilationDepth:C,dilationHeight:I,dilationWidth:S,inShape:t,outShape:f,filterShape:e}}function bf(t,e,n,r){void 0===r&&(r=1);var i=Ef(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)}function wf(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function _f(t){return"number"==typeof t?[t,t,t]:t}function Ef(t,e){return e<=1?t:t+(t-1)*(e-1)}function Cf(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function If(t){var e=wf(t),n=e[0],r=e[1],i=e[2];return 1===n&&1===r&&1===i}function Sf(t,e){return If(t)||If(e)}function kf(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error("Unknown dataFormat "+t)}function Tf(t,e,n){if("complex64"===e){if("complex64"===t.dtype)return t.clone();var r=Xd(t.shape),i=t.toFloat(),o=n.complex(i,r);return r.dispose(),i.dispose(),o}if(!function(t,e){return!("complex64"===e||"float32"===e&&"complex64"!==t||"int32"===e&&"float32"!==t&&"complex64"!==t||"bool"===e&&"bool"===t)}(t.dtype,e))return zh.makeTensorFromDataId(t.dataId,t.shape,e);if("complex64"===t.dtype){var a=n.real(t);return o=a.cast(e),a.dispose(),o}if("int32"===e)return n.int(t);if("bool"===e){var s=Vd(0,t.dtype);return o=n.notEqual(t,s),s.dispose(),o}throw new Error("Error in Cast: failed to cast "+t.dtype+" to "+e)}function Nf(t,e){return zh.makeTensorFromDataId(t.dataId,e,t.dtype)}function Rf(t,e,n){var r=(e-t)/(n-1),i=lh(n,"float32");i[0]=t;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return Hd(i,"float32")}function Af(t,e){if(t.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+e.length+".");for(var n=new Float32Array(2*t.length),r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function Pf(t,e){return{real:t[2*e],imag:t[2*e+1]}}function Df(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function Mf(t,e,n){var r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}function Of(t,e,n){var r=function(t,e,n){for(var r=0,i=t.length,o=0,a=!1;r<i;){var s=n(e,t[o=r+(i-r>>>1)]);s>0?r=o+1:(i=o,a=!s)}return a?r:-r-1}(t,e,n||Lf),i=r<0?-(r+1):r;t.splice(i,0,e)}function Lf(t,e){return t>e?1:t<e?-1:0}function Bf(t,e,n,r,i){return jf(t,e,n,r,i,0).selectedIndices}function Ff(t,e,n,r,i,o){var a=jf(t,e,n,r,i,o);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function jf(t,e,n,r,i,o,a,s){void 0===s&&(s=!1);for(var u=Array.from(e).map(function(t,e){return{score:t,boxIndex:e,suppressBeginIndex:0}}).filter(function(t){return t.score>i}).sort(Uf),c=o>0?-.5/o:0,l=[],h=[];l.length<n&&u.length>0;){var d=u.pop(),p=d.score,f=d.boxIndex,m=d.suppressBeginIndex;if(p<i)break;for(var v=!1,g=l.length-1;g>=m;--g){var y=zf(t,f,l[g]);if(y>=r){v=!0;break}if(d.score=d.score*Wf(r,c,y),d.score<=i)break}d.suppressBeginIndex=l.length,v||(d.score===p?(l.push(f),h.push(d.score)):d.score>i&&Of(u,d,Uf))}var x=l.length;return s&&(l.fill(0,x),h.fill(0,x)),{selectedIndices:Hd(l,"int32"),selectedScores:Hd(h,"float32"),numValidOutputs:Vd(x,"int32")}}function zf(t,e,n){var r=t.subarray(4*e,4*e+4),i=t.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),d=Math.max(i[1],i[3]),p=(s-o)*(u-a),f=(h-c)*(d-l);if(p<=0||f<=0)return 0;var m=Math.max(o,c),v=Math.max(a,l),g=Math.min(s,h),y=Math.min(u,d),x=Math.max(g-m,0)*Math.max(y-v,0);return x/(p+f-x)}function Wf(t,e,n){var r=Math.exp(e*n*n);return n<=t?r:0}function Uf(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}function Vf(t,e,n){var r=new Array(t.rank).fill(0),i=t.shape.slice();return e.map(function(e){i[n]=e;var o=t.slice(r,i);return r[n]+=e,o})}function Hf(t,e){for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];var i=yp(n,t.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),a=new Array(t.rank),s=0;s<a.length;s++)a[s]=o[s]%t.shape[s];var u=t.locToIndex(a);i.values[r]=t.values[u]}return i.toTensor()}function Gf(t,e,n,r,i){for(var o=e[e.length-1],a=[t.length/o,o],s=a[0],u=a[1],c=Jl(n,s*r),l=Jl("int32",s*r),h=0;h<s;h++){for(var d=h*u,p=t.subarray(d,d+u),f=[],m=0;m<p.length;m++)f.push({value:p[m],index:m});f.sort(function(t,e){return e.value-t.value});var v=h*r,g=c.subarray(v,v+r),y=l.subarray(v,v+r);for(m=0;m<r;m++)g[m]=f[m].value,y[m]=f[m].index}var x=e.slice();return x[x.length-1]=r,[Wd(c,x,n),Wd(l,x,"int32")]}function qf(t,e){for(var n=[],r=0;r<e.length;r++)e[r]&&n.push(r);var i=yp(t,"int32"),o=yp([n.length,t.length],"int32");for(r=0;r<n.length;r++){var a=i.indexToLoc(n[r]),s=r*t.length;o.values.set(a,s)}return o.toTensor()}var Kf=function(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(function(t,e){return"T"+e});var n=[];this.variableNames.forEach(function(t){n.push("float v"+t+" = get"+t+"AtOutCoords();")});var r=this.variableNames.map(function(t){return"v"+t}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},Zf=function(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map(function(t,e){return"T"+e});var n=[];this.variableNames.forEach(function(t){n.push("vec4 v"+t+" = get"+t+"AtOutCoords();")});var r=this.variableNames.map(function(t){return"v"+t}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},Xf=function(t,e,n){this.variableNames=["A"];var r=t.windowSize,i=t.batchSize,o=t.inSize,a=Math.ceil(o/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];var s="max"===e?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function $f(t,e){return["x","y","z","w","u","v"].slice(0,e).map(function(e){return t+"."+e})}function Yf(t,e){return 1===e?[t]:$f(t,e)}function Jf(){var t,e,n,r,i,o,a,s,u,c;return 2===Tl().getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",r="in",i="texture",o="outputColor",a="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",r="varying",i="texture2D",o="gl_FragColor",a="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:i,output:o,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function Qf(t,e,n){void 0===n&&(n="index");var r=ah(e);return r.map(function(e,i){return"int "+t[i]+" = "+n+" / "+e+"; "+(i===r.length-1?"int "+t[i+1]+" = "+n+" - "+t[i]+" * "+e:"index -= "+t[i]+" * "+e)+";"}).join("")}function tm(t){var e=ah(t).map(function(t){return t.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+e[0]+" + coords.y * "+e[1]+" + coords.z;\n  }\n"}var em="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function nm(t,e,n,r){var i=[];t.forEach(function(t){var e=Vl(t.shapeInfo.logicalShape);t.shapeInfo.isUniform?i.push("uniform float "+t.name+(e>1?"["+e+"]":"")+";"):(i.push("uniform sampler2D "+t.name+";"),i.push("uniform int offset"+t.name+";"))});var o,a,s=i.join("\n"),u=t.map(function(t){return function(t,e,n){void 0===n&&(n=!1);var r="";r+=n?im(t):rm(t);var i=t.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(r+=n?function(t,e){var n,r=t.name,i=r.charAt(0).toUpperCase()+r.slice(1),o="get"+i+"AtOutCoords",a=t.shapeInfo.logicalShape.length,s=e.logicalShape.length,u=pf(t.shapeInfo.logicalShape,e.logicalShape),c=hm(s),l=s-a,h=["x","y","z","w","u","v"];n=0===a?"":s<2&&u.length>=1?"coords = 0;":u.map(function(t){return"coords."+h[t+l]+" = 0;"}).join("\n");var d;d=s<2&&a>0?"coords":t.shapeInfo.logicalShape.map(function(t,e){return"coords."+h[e+l]}).join(", ");var p="return outputValue;",f=1===Vl(t.shapeInfo.logicalShape),m=1===Vl(e.logicalShape);if(1!==a||f||m){if(f&&!m)p=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var v=a-2,g=a-1;u.indexOf(v)>-1&&u.indexOf(g)>-1?p="return vec4(outputValue.x);":u.indexOf(v)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}}else p="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+o+"() {\n      "+c+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+i+"("+d+");\n      "+p+"\n    }\n  "}(t,e):function(t,e){var n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",o=e.texShape,a=t.shapeInfo.texShape,s=t.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!t.shapeInfo.isUniform&&s===u&&null==t.shapeInfo.flatOffset&&Hl(a,o))return"\n      float "+i+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var c=hm(u),l=pf(t.shapeInfo.logicalShape,e.logicalShape),h=u-s,d=["x","y","z","w","u","v"];return"\n    float "+i+"() {\n      "+c+" coords = getOutputCoords();\n      "+(0===s?"":u<2&&l.length>=1?"coords = 0;":l.map(function(t){return"coords."+d[t+h]+" = 0;"}).join("\n"))+"\n      return get"+r+"("+(u<2&&s>0?"coords":t.shapeInfo.logicalShape.map(function(t,e){return"coords."+d[e+h]}).join(", "))+");\n    }\n  "}(t,e)),r}(t,e,r)}).join("\n"),c=e.texShape,l=Jf(),h="\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+l.texture2D+"(textureSampler, uv).r;\n    }\n  ",d=function(t){return t.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+t.varyingFs+" vec2 resultUV;\n    "+t.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+t.defineSpecialNaN+"\n    "+t.defineSpecialInf+"\n    "+t.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+om+"\n    "+am+"\n    "+sm+"\n  "}(l);return e.isPacked?(o=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return n=e,1===(r=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)])[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+r[1]+".0);\n      }\n    ":1===r[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+r[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n      return 2 * (resTexRC.x * "+r[1]+" + resTexRC.y);\n    }\n  ";case 2:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Hl(t,e))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(t[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return i=t,o=e,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],u=(s=Math.ceil(i[2]/2))*Math.ceil(i[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+a[0]+", "+a[1]+"));\n      int index = resTexRC.x * "+a[1]+" + resTexRC.y;\n\n      int b = index / "+u+";\n      index -= b * "+u+";\n\n      int r = 2 * (index / "+s+");\n      int c = imod(index, "+s+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(t,e){for(var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),i=r*Math.ceil(t[t.length-2]/2),o=i,a="",s="b, r, c",u=2;u<t.length-1;u++)a="\n      int b"+u+" = index / "+(o*=t[t.length-u-1])+";\n      index -= b"+u+" * "+o+";\n    "+a,s="b"+u+", "+s;return"\n    ivec"+t.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+a+"\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+t.length+"("+s+");\n    }\n  "}(t,e)}var n,r,i,o,a,s,u}(e.logicalShape,c),a=function(t){return"\n    void setOutput(vec4 val) {\n      "+t.output+" = val;\n    }\n  "}(l)):(o=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return 1===(n=e)[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return resTexRC.x * "+n[1]+" + resTexRC.y;\n    }\n  ";case 2:return function(t,e){return Hl(t,e)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ":1===t[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===t[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+t[1]+";\n      int c = index - r * "+t[1]+";\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return r=e,i=Qf(["r","c","d"],t),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+r[0]+", "+r[1]+"));\n      int index = resTexRC.x * "+r[1]+" + resTexRC.y;\n      "+i+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(t,e){var n=Qf(["r","c","d","d2"],t);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(t,e);case 5:return function(t,e){var n=Qf(["r","c","d","d2","d3"],t);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+e[0]+",\n                             "+e[1]+"));\n\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(t,e);case 6:return function(t,e){var n=Qf(["r","c","d","d2","d3","d4"],t);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(t,e);default:throw new Error(t.length+"-D output sampling is not yet supported")}var n,r,i}(e.logicalShape,c),a=function(t){return"\n    void setOutput(float val) {\n      "+t.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(d+=um),[d,h,a,s,o,u,n].join("\n")}function rm(t){var e=t.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"float "+n+"() {return "+e+";}";var r=t.shapeInfo.texShape,i=r[0],o=r[1];if(1===i&&1===o)return"\n      float "+n+"() {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var a=t.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+a[0]+", "+a[1]+", "+cm(e)+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(t);case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+lm(t)+"\n      }\n    ";var r=t.shapeInfo.texShape,i=r[0],o=r[1];if(1===o&&1===i)return"\n      float "+n+"(int index) {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var a=cm(e);return 1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+a+") + 0.5) / "+i+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+a+") + 0.5) / "+o+".0, 0.5);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+i+", "+o+", index + "+a+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(t);case 2:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape;if(null!=i&&Hl(e,i)){var o=i[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+i[1]+".0, "+o+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var a=Yl(e),s=a.newShape,u=a.keptDims,c=s;if(c.length<e.length)return"\n      "+rm(dm(t,c))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+pm(["row","col"],u)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+e[1]+", 1)));\n        "+lm(t)+"\n      }\n    ";var l=i[0],h=i[1],d=cm(n);return 1===h?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+e[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+l+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===l?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+e[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+h+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+e[1]+" + col + "+d+";\n    vec2 uv = uvFromFlat("+l+", "+h+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(t);case 3:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[1]*e[2],o=e[2],a=Yl(e),s=a.newShape,u=a.keptDims,c=s;if(c.length<e.length)return"\n        "+rm(dm(t,c))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+pm(["row","col","depth"],u)+");\n        }\n      ";if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+i+", "+o+", 1)));\n        "+lm(t)+"\n      }\n    ";var l=t.shapeInfo.texShape,h=l[0],d=l[1],p=t.shapeInfo.flatOffset;return d===i&&null==p?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+o+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+d+".0, "+h+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":d===o&&null==p?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+e[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+d+".0, "+h+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+i+" + col * "+o+" + depth + "+cm(n)+";\n        vec2 uv = uvFromFlat("+h+", "+d+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(t);case 4:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[3],o=e[2]*i,a=e[1]*o,s=Yl(e),u=s.newShape,c=s.keptDims;if(u.length<e.length)return"\n      "+rm(dm(t,u))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+pm(["row","col","depth","depth2"],c)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+a+", "+o+", "+i+", 1)));\n        "+lm(t)+"\n      }\n    ";var l=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],p=h[1];return p===a&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+o+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":p===i&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+e[1]*e[2]+", "+e[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+a+" + col * "+o+" +\n          depth * "+i+" + depth2;\n      vec2 uv = uvFromFlat("+d+", "+p+", index + "+cm(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(t);case 5:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[4],o=e[3]*i,a=e[2]*o,s=e[1]*a,u=Yl(e),c=u.newShape,l=u.keptDims;if(c.length<e.length)return"\n      "+rm(dm(t,c))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+pm(["row","col","depth","depth2","depth3"],l)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+a+", "+o+", "+i+")) +\n          depth3;\n        "+lm(t)+"\n      }\n    ";var h=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,p=d[0],f=d[1];return f===s&&null==h?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+a+", "+o+", "+i+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+f+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":f===i&&null==h?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+e[1]*e[2]*e[3]+",\n               "+e[2]*e[3]+", "+e[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+f+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+a+" + depth * "+o+" +\n          depth2 * "+i+" + depth3 + "+cm(n)+";\n      vec2 uv = uvFromFlat("+p+", "+f+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(t);case 6:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=Yl(e),o=i.newShape,a=i.keptDims;if(o.length<e.length)return"\n      "+rm(dm(t,o))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+pm(["row","col","depth","depth2","depth3","depth4"],a)+");\n      }\n    ";var s=e[5],u=e[4]*s,c=e[3]*u,l=e[2]*c,h=e[1]*l;if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+h+", "+l+", "+c+", "+u+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+lm(t)+"\n      }\n    ";var d=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,f=p[0],m=p[1];return m===h&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+l+", "+c+", "+u+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":m===s&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+e[1]*e[2]*e[3]*e[4]+",\n               "+e[2]*e[3]*e[4]+",\n               "+e[3]*e[4]+",\n               "+e[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+h+" + col * "+l+" + depth * "+c+" +\n          depth2 * "+u+" + depth3 * "+s+" + depth4 + "+cm(n)+";\n      vec2 uv = uvFromFlat("+f+", "+m+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(t);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function im(t){var e,n,r,i,o,a,s;switch(t.shapeInfo.logicalShape.length){case 0:return"\n    vec4 "+("get"+(e=t.name).charAt(0).toUpperCase()+e.slice(1))+"() {\n      return "+Jf().texture2D+"("+e+", halfCR);\n    }\n  ";case 1:return r=(n=t).name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],s=Jf(),"\n    vec4 "+i+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+a[0]+", "+a[1]+", index);\n      return "+s.texture2D+"("+r+", uv);\n    }\n  ";case 2:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,o=i[0],a=i[1],s=Jf();if(null!=i&&Hl(e,i))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+a+".0, "+o+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(e[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(t);case 3:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===e[0])return"\n        "+im(dm(t,e.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+pm(["b","row","col"],[1,2])+");\n        }\n      ";var a=o[0],s=o[1],u=Math.ceil(e[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+a+", "+s+", "+u*Math.ceil(e[1]/2)+", "+u+", b, row, col);\n      return "+Jf().texture2D+"("+n+", uv);\n    }\n  "}(t);default:return function(t){for(var e=t.shapeInfo.logicalShape,n=e.length,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],s=a[0],u=a[1],c=Math.ceil(e[n-1]/2),l=c*Math.ceil(e[n-2]/2),h="int b, int row, int col",d="b * "+l+" + (row / 2) * "+c+" + (col / 2)",p=2;p<n-1;p++)h="int b"+p+", "+h,d="b"+p+" * "+(l*=e[n-p-1])+" + "+d;return"\n    vec4 "+i+"("+h+") {\n      int index = "+d+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+Jf().texture2D+"("+r+", uv);\n    }\n  "}(t)}}var om="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",am="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",sm="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",um="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function cm(t){return"offset"+t}function lm(t){var e=t.name,n=Vl(t.shapeInfo.logicalShape);return n<2?"return "+e+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+e+"[i];\n      }\n    }\n  "}function hm(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function dm(t,e){var n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function pm(t,e){return e.map(function(e){return t[e]}).join(", ")}var fm=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,jl(t.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var i=t[t.length-1],o=Math.ceil(i/e);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,c=u.length,l=hm(c),h=Yf("coords",c);if(1===o){var d=hm(s=c+1);a="\n        "+d+" sourceLocR = "+d+"("+h.join()+", 0);\n        ++"+h[c-1]+";\n        "+d+" sourceLocG = "+d+"("+h.join()+", 0);\n        ++"+h[c-2]+";\n        "+d+" sourceLocA = "+d+"("+h.join()+", 0);\n        --"+h[c-1]+";\n        "+d+" sourceLocB = "+d+"("+h.join()+", 0);\n        --"+h[c-2]+";"}else s=c,a="\n        "+l+" sourceLocR = coords;\n        ++"+h[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+h[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+h[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+h[c-2]+";";var p=["x","y","z","w","u","v"].slice(0,s),f="."+p[s-1],m=p.map(function(t){return"int "+t}),v=Yf("sourceLocR",s-1).concat("inIdx.r"),g=Yf("sourceLocG",s-1).concat("inIdx.g"),y=Yf("sourceLocB",s-1).concat("inIdx.b"),x=Yf("sourceLocA",s-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+x.join()+")));",_="vec4(\n            getAChannel("+v.join()+"),\n            hasNextCol ? getAChannel("+g.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+x.join()+") : 0.)",E=r?"":"\n      float getBestIndicesAChannel("+m.join()+") {\n        return getChannel(getBestIndicesA("+p.join()+"),\n                                          vec2("+p.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+m.join()+") {\n        return getChannel(getA("+p.join()+"),\n                               vec2("+p.slice(-2).join()+"));\n      }\n      "+E+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+h[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+h[c-2]+" < "+(u[c-2]-1)+";\n        "+a+"\n        ivec4 srcIdx = ivec4(sourceLocR"+f+", sourceLocG"+f+",\n          sourceLocB"+f+", sourceLocA"+f+") * "+e+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+_+";\n\n        for (int i = 0; i < "+e+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+_+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+b+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},mm=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,a=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=s-1-t.padInfo.top,l=u-1-t.padInfo.left,h=1/(e*n);this.userCode="\n      const ivec2 pads = ivec2("+c+", "+l+");\n      const float avgMultiplier = float("+h+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+o+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+a+") {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},vm=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=l-1-t.padInfo.front,f=h-1-t.padInfo.top,m=d-1-t.padInfo.left,v=1/(e*n*r);this.userCode="\n      const ivec3 pads = ivec3("+p+", "+f+", "+m+");\n      const float avgMultiplier = float("+v+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+i+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+h+";\n              wR += "+u+") {\n            float dyR = float(dyRCorner + wR) / "+o+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+d+";\n                wC += "+c+") {\n              float dyC = float(dyCCorner + wC) / "+a+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},gm=function(t,e,n,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],mf(t,e),mf(t,n);var a="0.0";null!=r&&(mf(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";null!=i&&(mf(t,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+o+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},ym=function(t,e,n,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],mf(t,e),mf(t,n);var a="vec4(0.0)";null!=r&&(mf(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=i&&(mf(t,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+o+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},xm=function(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=mf(e,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+t+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},bm="return a + b;",wm="return a - b;",_m="return a * b;",Em="return (a < 0.) ? b * a : a;",Cm=function(t,e,n){this.variableNames=["A","B"],this.outputShape=mf(e,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Im="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Sm=function(t,e,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=mf(e,n);var i=this.outputShape.length,o="";if(r)if(0===i||1===Vl(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          "+hm(i)+" coords = getOutputCoords();\n        ",1===i)o+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var a=Yf("coords",i);o+="\n            bool nextRowOutOfBounds =\n              ("+a[i-2]+" + 1) >= "+this.outputShape[i-2]+";\n            bool nextColOutOfBounds =\n              ("+a[i-1]+" + 1) >= "+this.outputShape[i-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+o+"\n\n        setOutput(result);\n      }\n    "},km=function(){function t(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),Tm=function(){function t(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),Nm=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},Rm=function(t){this.outputShape=[],this.outputShape=Ld(t,1),this.variableNames=t.map(function(t,e){return"T"+e});var e=new Array(t.length-1);e[0]=t[0][1];for(var n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<e.length;n++){var i=e[n-1];r.push("else if (yC < "+e[n]+") setOutput(getT"+n+"(yR, yC-"+i+"));")}var o=e.length,a=e[e.length-1];r.push("else setOutput(getT"+o+"(yR, yC-"+a+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},Am=function(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ld(t,e);var n=this.outputShape,r=n.length,i=hm(r),o=Yf("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(function(t,e){return"T"+e});var s=new Array(t.length-1);s[0]=t[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+t[u][e];var c=a[e],l=a.slice(-2),h=a.join(),d="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+h+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var p=s[u-1];d+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+Pm(a,c,p)+"),\n            vec2("+Pm(l,c,p)+"));\n        }"}var f=s.length,m=s[s.length-1];d+="\n        return getChannel(\n          getT"+f+"("+Pm(a,c,m)+"),\n          vec2("+Pm(l,c,m)+"));",this.userCode="\n      float getValue("+a.map(function(t){return"int "+t})+") {\n        "+d+"\n      }\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+o+"), 0., 0., 0.);\n\n        "+o[r-1]+" = "+o[r-1]+" + 1;\n        if ("+o[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+o+");\n        }\n\n        "+o[r-2]+" = "+o[r-2]+" + 1;\n        if ("+o[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+o+");\n        }\n\n        "+o[r-1]+" = "+o[r-1]+" - 1;\n        if ("+o[r-2]+" < "+n[r-2]+" &&\n            "+o[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+o+");\n        }\n        setOutput(result);\n      }\n    "};function Pm(t,e,n){var r=t.indexOf(e);return t.map(function(t,e){return e===r?t+" - "+n:t}).join()}var Dm=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+r+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              if ("+o+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Mm=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,a=e-1-t.padInfo.top,s=n-1-t.padInfo.left,u=o?1:2,c=o?2:3,l=o?3:1;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+l+"];\n\n        ivec2 dyCorner = ivec2(coords["+u+"], coords["+c+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n\n              if ("+o+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Om=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,a=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yF = 0; yF < "+t.outDepth+"; yF++) {\n            int xF = wF + yF * "+e+" - "+i+";\n\n            if (xF < 0 || xF >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+o+";\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+a+";\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Lm=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,s=e-1-t.padInfo.front,u=n-1-t.padInfo.top,c=r-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+c+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+e+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+i+".0;\n\n          if (dyF < 0.0 || dyF >= "+t.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+e+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+o+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+a+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Bm=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+o+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+r+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Fm=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=e-1-t.padInfo.top,a=n-1-t.padInfo.left,s=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},jm=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.padInfo.top,o=t.padInfo.left,a=t.strideHeight,s=t.strideWidth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterHeight,h=t.filterWidth,d=4*Math.floor(t.inChannels/4),p=t.inChannels%4,f="channelsLast"===t.dataFormat,m=f?1:2,v=f?2:3,g=f?3:1,y="",x="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",x="result = activation(result);");var b=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+a+", "+s+");\n      const ivec2 pads = ivec2("+i+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+g+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+m+"], coords["+v+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+f+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===p)+") {\n\n              if ("+f+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+d+") *\n                    getW(wR, wC, "+d+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+d+", xR, xC) *\n                    getW(wR, wC, "+d+", d2);\n              }\n\n            } else if ("+(2===p)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2)\n              );\n\n              if ("+f+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===p)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2),\n                getW(wR, wC, "+d+" + 2, d2)\n              );\n\n              if ("+f+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1),\n                  getX(batch, xR, xC, "+d+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC),\n                  getX(batch, "+d+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+b+"\n        "+x+"\n        setOutput(result);\n      }\n    "},zm=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterDepth,h=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),f=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+i+", "+o+", "+a+");\n      const ivec3 pads = ivec3("+e+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+p+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===f)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+p+") *\n                  getW(wF, wR, wC, "+p+", d2);\n              } else if ("+(2===f)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+p+"),\n                  getX(batch, xF, xR, xC, "+p+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+p+", d2),\n                  getW(wF, wR, wC, "+p+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===f)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+p+"),\n                  getX(batch, xF, xR, xC, "+p+" + 1),\n                  getX(batch, xF, xR, xC, "+p+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+p+", d2),\n                  getW(wF, wR, wC, "+p+" + 1, d2),\n                  getW(wF, wR, wC, "+p+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Wm=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.inHeight,o=t.inWidth,a=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,h=t.dilationWidth,d=t.filterHeight,p=t.filterWidth,f=t.outChannels/t.inChannels,m="",v="";n&&(m=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",v="result = activation(result);");var g=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+m+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+f+";\n        int q = d2 - d1 * "+f+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+d+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+i+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+p+"; wC++) {\n            int xC = xCCorner + wC * "+h+";\n\n            if (xC < 0 || xC >= "+o+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+g+"\n        "+v+"\n        setOutput(result);\n      }\n    "},Um=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var i=t.inHeight,o=t.inWidth,a=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,h=t.dilationWidth,d=t.filterHeight,p=t.filterWidth,f=p,m="int xR; int xC; int xCOffset;",v=0;v<d;v++)for(var g=0;g<p;g++)m+="\n          vec4 xTexelR"+v+"C"+2*g+" = vec4(0.);\n          vec4 wR"+v+"C"+g+" = vec4(0.);\n          vec4 xR"+v+"C"+g+" = vec4(0.);";for(v=0;v<d;v++)for(var y=0;y<f;y++){if(m+="\n          xR = xRCorner + "+v*l+";\n          xC = xCCorner + "+(g=2*y)*h+";\n        ",1===c){if(g<p&&(m+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+o+") {\n                    xTexelR"+v+"C"+g+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+o+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+o+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+v+"C"+g+" = vec4(previous.zw, xTexelR"+v+"C"+g+".xy);\n                } else {\n                  xR"+v+"C"+g+" = vec4(0, 0, xTexelR"+v+"C"+g+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+i+" && xC >= 0 && xC < "+o+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = xTexelR"+v+"C"+g+";\n              ",g+1<p)){var x=s%2==0?Fl(h):h;h%2==0&&s%2==1||h%2!=0&&s%2!=1?(m+="\n                  xCOffset = xC + "+s%2+" + "+x+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+o+") {\n                    xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",h>1&&(m+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+i+" &&\n                      xCOffset >= 0 && xCOffset < "+o+") {\n                      xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+v+"C"+g+" = vec4(0.);\n                    }\n                  "),m+="\n                  xR"+v+"C"+(g+1)+" = vec4(\n                    xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".xy);\n                "):m+="\n                  xCOffset = xC + "+x+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+o+") {\n                    xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+v+"C"+(g+1)+" = xTexelR"+v+"C"+(g+2)+";\n                "}}else g<p&&(m+="\n              if(xR >= 0 && xR < "+i+") {\n            ",s%2==1?(m+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+o+") {\n                  xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+v+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = vec4(\n                  xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".zw);\n              ",g+1<p&&(m+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+o+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+v+"C"+(g+1)+" = vec4(xTexelR"+v+"C"+(g+2)+".xy, final.xy);\n                ")):(m+="\n                if(xC >= 0 && xC < "+o+") {\n                  xTexelR"+v+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+v+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+v+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+v+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+v+"C"+g+" = vec4(\n                  xTexelR"+v+"C"+g+".xy, xTexelR"+v+"C"+(g+2)+".xy);\n              ",g+1<p&&(m+="\n                  xR"+v+"C"+(g+1)+" = vec4(\n                    xTexelR"+v+"C"+g+".zw, xTexelR"+v+"C"+(g+2)+".zw);\n                ")),m+="}");g<p&&(m+="\n            vec4 wTexelR"+v+"C"+g+" = getW("+v+", "+g+", d1, q);\n            wR"+v+"C"+g+" = vec4(wTexelR"+v+"C"+g+".xz, wTexelR"+v+"C"+g+".xz);\n          ",g+1<p&&(m+="\n              vec4 wTexelR"+v+"C"+(g+1)+" = getW("+v+", "+(g+1)+", d1, q);\n              wR"+v+"C"+(g+1)+" =\n                vec4(wTexelR"+v+"C"+(g+1)+".xz, wTexelR"+v+"C"+(g+1)+".xz);"))}for(v=0;v<d;v++)for(g=0;g<p;g++)m+="dotProd += xR"+v+"C"+g+" * wR"+v+"C"+g+";";var b="",w="";n&&(b=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",w="result = activation(result);");var _=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+b+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+m+"\n\n        vec4 result = dotProd;\n        "+_+"\n        "+w+"\n        setOutput(result);\n      }\n    "},Vm=function(t,e,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=t[0],a=t[1],s=t[2],u=t[3],c=e[0],l=n[0],h=n[1];this.outputShape=[c,l,h,u];var d="bilinear"===r?1:0,p=[a-1+".0",s-1+".0"],f=p[0],m=p[1],v=l>1?[""+(a-1)/(l-1),"(y2-y1) * height_ratio","y1*"+f+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+f],g=v[0],y=v[1],x=v[2],b=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],w=b[0],_=b[1],E=b[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+o+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+_+";\n\n        float in_y = "+x+";\n        if( in_y < 0.0 || in_y > "+f+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n        float in_x = "+E+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+d+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},Hm=function(t,e,n){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=t[t.length-1],o=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+i+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+hm(r)+" coords = getOutputCoords();\n        int end = "+Gm(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+i+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+o+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+Gm(r,"coords")+" = idx;\n          val += getX("+function(t,e){if(1===t)return""+e;if(2===t)return e+".x, "+e+".y";if(3===t)return e+".x, "+e+".y, "+e+".z";if(4===t)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function Gm(t,e){if(1===t)return""+e;if(2===t)return e+".y";if(3===t)return e+".z";if(4===t)return e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var qm=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Vh.DENSE;var e=$h(t),n=Jf();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Qf(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},Km=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Vh.DENSE;var e=$h(t),n=Jf();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Qf(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},Zm=function(){function t(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),Xm=function(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},$m=function(t){this.variableNames=["A"],this.outTexUsage=Hh.DOWNLOAD;var e=Jf();this.outputShape=t,this.userCode="\n      "+em+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+e.output+" = encode_float(x);\n      }\n    "},Ym=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Hh.DOWNLOAD;var e=Jf();this.outputShape=t,this.userCode="\n      "+em+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+e.output+" = encode_float(x);\n      }\n    "},Jm=function(t,e,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=Jf(),i=e[0],o=e[1];this.outputShape=t;var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      "+tm(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+o+";\n        int c = imod(flatIndex, "+o+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+o+".0, "+i+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+a+", 0., 0., 0.);\n      }\n    "},Qm=function(t,e,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Jf(),i=e[0],o=e[1];this.outputShape=t;var a="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;a+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+t[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+t[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+o+";\n              c = imod(flatIndex, "+o+");\n              uv = (vec2(c, r) + halfCR) / vec2("+o+".0, "+i+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+tm(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+a+"\n\n        "+r.output+" = "+s+";\n      }\n    "},tv=function(t,e,n){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+i+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+t+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+o+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},ev=function(){function t(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.valueLoc&&(e.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(e.valueLoc,t)}},t}(),nv=function(t,e,n){this.variableNames=["A","indices"];var r=t.slice();r[n]=e,this.outputShape=r,this.rank=r.length;var i=hm(this.rank),o=function(t,e){var n=t.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],o=0;o<t.length;o++)o===e?i.push("int(getIndices("+r[o]+"))"):i.push(""+r[o]);return i.join()}(t,n);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "},rv=function(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;var r=hm(e.length),i=hm(n.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+i+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+o+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function iv(t,e){var n=Jf();return function(t,e,n){var r=hd(t,e,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Qh(t,e,function(){return t.shaderSource(r,n)}),Qh(t,e,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error("Failed to compile vertex shader.");return r}(t,e,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function ov(t,e){return function(t,e,n){var r=hd(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return Qh(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),Qh(t,e,function(){return t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)}),r}(t,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function av(t,e){return function(t,e,n){var r=hd(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return Qh(t,e,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)}),Qh(t,e,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)}),r}(t,e,new Uint16Array([0,1,2,2,1,3]))}function sv(t,e,n,r,i,o,a){!function(t,e){var n=Tl().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){var r="["+t+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>n||e>n)throw r="["+t+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}(n,r);var s=function(t,e){return hd(t,e,function(){return t.createTexture()},"Unable to create WebGLTexture.")}(t,e),u=t.TEXTURE_2D;return Qh(t,e,function(){return t.bindTexture(u,s)}),Qh(t,e,function(){return t.texParameteri(u,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),Qh(t,e,function(){return t.texParameteri(u,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),Qh(t,e,function(){return t.texParameteri(u,t.TEXTURE_MIN_FILTER,t.NEAREST)}),Qh(t,e,function(){return t.texParameteri(u,t.TEXTURE_MAG_FILTER,t.NEAREST)}),Qh(t,e,function(){return t.texImage2D(u,0,i,n,r,0,o,a,null)}),Qh(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)}),s}var uv=function(){function t(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=Tl().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(t,e){qh[t]=e}(e,t)):this.gl=Zh(e);var n="WEBGL_color_buffer_float";if(1===Tl().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=ed(this.gl,this.debug,"OES_texture_float"),gd(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=ed(this.gl,this.debug,"OES_texture_half_float");else if(Tl().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),gd(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=ed(this.gl,this.debug,"EXT_color_buffer_half_float");else if(Tl().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",gd(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!gd(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=ov(this.gl,this.debug),this.indexBuffer=av(this.gl,this.debug),this.framebuffer=function(t,e){return hd(t,e,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}(this.gl,this.debug),this.textureConfig=Jh(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return Tl().getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var t=this;if(!this.disposed){this.program,this.outputTexture;var e=this.gl;Qh(e,this.debug,function(){return e.finish()}),Qh(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),Qh(e,this.debug,function(){return e.deleteFramebuffer(t.framebuffer)}),Qh(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),Qh(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),Qh(e,this.debug,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),function(t,e,n,r,i){var o=Xh(n,r);return sv(t,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,t.FLOAT)}(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),function(t,e,n,r,i){var o=Xh(n,r);return sv(t,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),function(t,e,n,r){var i=Xh(n,r);return sv(t,e,i[0],i[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),function(t,e,n,r){Qh(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)}),r.data instanceof Uint8Array?Qh(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)}):Qh(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}),Qh(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}(this.gl,this.debug,t,e)},t.prototype.uploadDenseMatrixToTexture=function(t,e,n,r){this.throwIfDisposed(),function(t,e,n,r,i,o,a){var s,u,c;Qh(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)}),o instanceof Uint8Array?(s=new Uint8Array(r*i*4),u=t.UNSIGNED_BYTE,c=t.RGBA):(s=new Float32Array(r*i*4),u=t.FLOAT,c=a.internalFormatPackedFloat),s.set(o),Qh(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,c,r,i,0,t.RGBA,u,s)}),Qh(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}(this.gl,this.debug,t,e,n,r,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),function(t,e,n,r,i){var o=Yh(n,r);return sv(t,e,o[0],o[1],i.internalFormatPackedHalfFloat,t.RGBA,i.textureTypeHalfFloat)}(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),function(t,e,n,r,i){var o=Yh(n,r);return sv(t,e,o[0],o[1],i.internalFormatPackedFloat,t.RGBA,t.FLOAT)}(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(cd(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Qh(this.gl,this.debug,function(){return e.gl.deleteTexture(t)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return function(t,e,n,r,i){var o=Xh(n,r),a=o[0],s=o[1],u=new Uint8Array(n*r*4);return Qh(t,e,function(){return t.readPixels(0,0,a,s,i.downloadTextureFormat,t.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}(r.gl,r.debug,e,n,r.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(t,e,n,r,i,o){return function(t,e,n,r,i,o,a){var s,u=t,c=new Float32Array((s=Yh(o,a))[0]*s[1]*4);return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}(this.gl,t,0,0,0,i,o,this.textureConfig)},t.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return function(t,e,n){var r=t,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}(this.gl,t,e)},t.prototype.createBufferFromTexture=function(t,e,n){this.bindTextureToFrameBuffer(t);var r=function(t,e,n,r){var i=t.createBuffer();Qh(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,i)});var o=16*n*r;return Qh(t,e,function(){return t.bufferData(t.PIXEL_PACK_BUFFER,o,t.STREAM_READ)}),Qh(t,e,function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,0)}),Qh(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}),i}(this.gl,this.debug,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},t.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},t.prototype.createFence=function(t){var e,n,r=this;if(Tl().getBool("WEBGL_FENCE_API_ENABLED")){var i=t,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=function(){var t=i.clientWaitSync(o,0,0);return t===i.ALREADY_SIGNALED||t===i.CONDITION_SATISFIED},e=o}else Tl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(e,Tl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:e,isFencePassed:n}},t.prototype.downloadMatrixFromPackedTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return function(t,e,n,r){var i=new Float32Array(n*r*4);return Qh(t,e,function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,i)}),i}(r.gl,r.debug,e,n)})},t.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,n=function(t,e,n){var r=hd(t,e,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Qh(t,e,function(){return t.shaderSource(r,n)}),Qh(t,e,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw function(t,e){var n=id.exec(e);if(null!=n){for(var r=+n[1],i=t.split("\n"),o=i.length.toString().length+2,a=i.map(function(t,e){return Zl((e+1).toString(),o)+t}),s=0,u=0;u<a.length;u++)s=Math.max(a[u].length,s);a.slice(0,r-1),a.slice(r-1,r),a.slice(r)}}(n,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}(e,this.debug,t),r=iv(e,this.debug),i=function(t,e){return hd(t,e,function(){return t.createProgram()},"Unable to create WebGLProgram.")}(e,this.debug);return Qh(e,this.debug,function(){return e.attachShader(i,r)}),Qh(e,this.debug,function(){return e.attachShader(i,n)}),function(t,e,n){if(Qh(t,e,function(){return t.linkProgram(n)}),!1===t.getProgramParameter(n,t.LINK_STATUS))throw new Error("Failed to link vertex and fragment shaders.")}(e,this.debug,i),this.debug&&od(e,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=function(t,e,n,r){return Qh(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),ad(t,e,n,"clipSpacePos",r,3,20,0)&&ad(t,e,n,"uv",r,2,20,12)}(e,this.debug,this.program,this.vertexBuffer)),i},t.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&Qh(this.gl,this.debug,function(){return e.gl.deleteProgram(t)})},t.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&od(this.gl,this.debug,this.program),Qh(this.gl,this.debug,function(){return e.gl.useProgram(t)})},t.prototype.getUniformLocation=function(t,e,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?function(t,e,n,r){return hd(t,e,function(){return t.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}(this.gl,this.debug,t,e):function(t,e,n){return t.getUniformLocation(e,n)}(this.gl,t,e)},t.prototype.getAttributeLocation=function(t,e){var n=this;return this.throwIfDisposed(),Qh(this.gl,this.debug,function(){return n.gl.getAttribLocation(t,e)})},t.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},t.prototype.setInputMatrixTexture=function(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(t,e,n,r,i,o){Qh(t,e,function(){return sd(t,e,r,o)}),Qh(t,e,function(){return t.uniform1i(i,o)})}(this.gl,this.debug,this.program,t,e,n)},t.prototype.setOutputMatrixTexture=function(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)},t.prototype.setOutputPackedMatrixTexture=function(t,e,n){this.throwIfDisposed();var r=Yh(e,n),i=r[0],o=r[1];this.setOutputMatrixTextureDriver(t,i,o)},t.prototype.setOutputMatrixWriteRegion=function(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&od(this.gl,this.debug,this.program),ld(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),Qh(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),Qh(this.gl,this.debug,function(){return t.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=ed(this.gl,this.debug,2===Tl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===Tl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),i=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),i},t.prototype.endQuery=function(){if(2!==Tl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,n=this.getQueryTimerExtensionWebGL2();e.endQuery(n.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(t){return Il(this,0,void 0,function(){var e=this;return Sl(this,function(n){switch(n.label){case 0:return[4,Xl(function(){return e.disposed||e.isQueryAvailable(t,Tl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(t,Tl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var n=this.gl;return n.getQueryParameter(t,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint},t.prototype.pollFence=function(t){var e=this;return new Promise(function(n){e.addItemToPoll(function(){return t.isFencePassed()},function(){return n()})})},t.prototype.pollItems=function(){for(var t=function(t){for(var e=0;e<t.length&&t[e]();++e);return e-1}(this.itemsToPoll.map(function(t){return t.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},t.prototype.addItemToPoll=function(t,e){var n=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||Xl(function(){return n.pollItems(),0===n.itemsToPoll.length})},t.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),ud(this.gl,this.debug,t,this.framebuffer),this.debug&&ld(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(ud(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&ld(this.gl)):cd(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var n=e();return this.unbindTextureToFrameBuffer(),n},t.prototype.setOutputMatrixTextureDriver=function(t,e,n){this.throwIfDisposed();var r=this.gl;ud(r,this.debug,t,this.framebuffer),this.debug&&ld(r),this.outputTexture=t,Qh(r,this.debug,function(){return r.viewport(0,0,e,n)}),Qh(r,this.debug,function(){return r.scissor(0,0,e,n)})},t.prototype.setOutputMatrixWriteRegionDriver=function(t,e,n,r){var i=this;this.throwIfDisposed(),Qh(this.gl,this.debug,function(){return i.gl.scissor(t,e,n,r)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();function cv(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+e.length+" inputs");t.forEach(function(t,n){var r=t.logicalShape,i=e[n],o=i.shape;if(!Hl(r,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+o+" must match");if(!t.isUniform||!i.isUniform){var a=t.texShape,s=i.isUniform?null:i.texData.texShape;if(!Hl(a,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+s+" must match")}})}var lv=function(t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r=n.filterWidth,i=n.inChannels,o=n.strideWidth,a=n.strideHeight,s=n.padInfo,u=n.outWidth,c=n.dilationWidth,l=n.dilationHeight,h=n.dataFormat,d=s.left,p=s.top,f=i*r,m=Jf(),v="channelsLast"===h,g=v?0:1,y=v?1:2,x="",b=0;b<=1;b++)for(var w=0;w<=1;w++)x+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+b+";\n\n          if(blockIndex < "+t[1]+" && pos < "+t[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+a+" - "+p+";\n            d0 = offsetY + "+l+" * (pos / "+f+");\n\n            if(d0 < "+e[g]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+o+". - "+d+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+f+".) / "+i+".));\n\n              if(d1 < "+e[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+i+".));\n\n                if ("+v+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*b+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*b+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+x+"\n\n        "+m.output+" = result;\n      }\n    "},hv=function(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[];var o,a=e,s=t[3]-1;this.outputShape=t;var u="float("+n+") + float("+r+") * sum";o=.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+a+"; j <= "+a+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+o+";\n        setOutput(val);\n      }\n    "},dv=function(t,e,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},pv=function(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,a=e,s=t[3]-1;this.outputShape=t;var u="float("+n+") + float("+r+") * sum";o=.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+a+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+a+"; j <= "+a+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+o+";\n        setOutput(result);\n      }\n    "},fv=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideHeight,n=t.strideWidth,r=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,a=i-1-t.padInfo.top,s=o-1-t.padInfo.left,u=i*o-1;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+e+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+o+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+o+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},mv=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,a=t.dilationWidth,s=t.effectiveFilterDepth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=s-1-t.padInfo.front,h=u-1-t.padInfo.top,d=c-1-t.padInfo.left,p=s*u*c-1;this.userCode="\n      const ivec3 pads = ivec3("+l+", "+h+", "+d+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+i+") {\n          float dyD = float(dyDCorner + wD) / "+e+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+o+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+a+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+p+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},vv=function(t,e,n,r,i,o,a){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===o&&(o=null),void 0===a&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var s=n?t[1]:t[2],u=Math.ceil(s/2),c=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",h=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],p="",f="";o&&(p=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+o+"\n        }":"vec4 activation(vec4 x) {\n          "+o+"\n        }",f="result = activation(result);");var m=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+p+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+h[0]+" * "+d[0]+");\n          result += ("+h[1]+" * "+d[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+m+"\n\n        "+f+"\n\n        setOutput(result);\n      }\n    "},gv=function(){function t(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.seedLoc&&(e.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(e.seedLoc,t)}},t}(),yv=function(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},xv=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var e,n,r,i,o=t.length;if(0===o)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var a=Yf("rc",o),s=hm(o),u=function(t,e,n){if(1===t)return"rc > "+e[0];for(var r="",i=t-2;i<t;i++)r+=n[i]+" >= "+e[i],i<t-1&&(r+="||");return r}(o,t,a),c=function(t,e,n,r){if(1===t)return"";var i=r.slice(-2);return"\n    int r = "+i[0]+";\n    int c = "+i[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+e+";\n    bool rEdge = rp1 >= "+n+";\n  "}(o,t[t.length-1],t[t.length-2],a),l=(n=a,r=(e=t).length,i=function(t,e){for(var n=[],r=0;r<=1;r++)for(var i=0;i<=1;i++){for(var o=(0===r?"r":"rp1")+", "+(0===i?"c":"cp1"),a=2;a<t;a++)o=e[e.length-1-a]+","+o;n.push(o)}return n}(r,n),1===r?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+i[0]+"),\n          cEdge ? 0. : getA("+i[1]+"),\n          rEdge ? 0. : getA("+i[2]+"),\n          rEdge || cEdge ? 0. : getA("+i[3]+")");this.userCode="\n        void main() {\n          "+s+" rc = getOutputCoords();\n\n          if("+u+") {\n            setOutput(vec4(0));\n          } else {\n            "+c+"\n\n            setOutput(vec4("+l+"));\n          }\n        }\n      "}},bv=function(t,e,n){this.variableNames=["x"],this.outputShape=e.map(function(e,n){return e[0]+t[n]+e[1]});var r=t.length,i=hm(r),o=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,n){return e[0]+t[n]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+i+" start = "+i+"("+o+");\n      "+i+" end = "+i+"("+a+");\n\n      void main() {\n        "+i+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+i+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+o+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},wv=function(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(e,n){return e[0]+t[n]+e[1]});for(var r=t.length,i=hm(r),o=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,n){return e[0]+t[n]}).join(","),s=Yf("rc",r),u=Yf("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",h=[i+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",f=0,m=1===r?2:4;f<m;f++)p+="\n        "+h[f]+"\n        if ("+d+") {\n          result["+f+"] = float("+n+");\n        } else {\n          "+i+" source = rc - start;\n          result["+f+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";p+=1===r?"} ":"}}",this.userCode="\n      const "+i+" start = "+i+"("+o+");\n      const "+i+" end = "+i+"("+a+");\n\n      void main() {\n        "+i+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+p+"\n        setOutput(result);\n      }\n    "},_v=function(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,i=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=t.padInfo.top,h=t.padInfo.left;this.outputShape=t.outShape;var d="avg"===e,p="0.0";if(d||(p="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+i+", "+o+");\n        const ivec2 pads = ivec2("+l+", "+h+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var f=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(f="avgValue / count");var m=4*Math.floor(r/4),v=r%4,g="\n      if ("+d+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+o+");\n      const ivec2 pads = ivec2("+l+", "+h+");\n      const float initializationValue = "+p+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+p+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+m+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+m+";\n          if ("+(1===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+f+");\n      }\n    "}},Ev=function(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,i=t.strideDepth,o=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=t.padInfo.front,f=t.padInfo.top,m=t.padInfo.left;this.outputShape=t.outShape;var v="avg"===e,g="0.0";if(v||(g="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+i+", "+o+", "+a+");\n        const ivec3 pads = ivec3("+p+", "+f+", "+m+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+l+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+h+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+d+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+h+" * "+d+" +\n                      wR * "+d+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(y="avgValue / count");var x=4*Math.floor(r/4),b=r%4,w="\n      if ("+v+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+i+", "+o+", "+a+");\n      const ivec3 pads = ivec3("+p+", "+f+", "+m+");\n      const float initializationValue = "+g+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+g+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+x+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+w+"\n            }\n\n            int xC = xCCorner + "+x+";\n            if ("+(1===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(2===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(3===b)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+w+"\n            }\n          }\n          setOutput("+y+");\n        }\n      }\n    "}},Cv=function(t,e){this.variableNames=["x"];var n=t.windowSize,r=t.batchSize,i=t.inSize,o=Math.ceil(i/n);this.outputShape=[r,o];var a="0.0",s="";"prod"===e?a="1.0":"min"===e?(a="1.0 / 1e-20",s="min"):"max"===e&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");var c=4*Math.floor(n/4),l=n%4,h="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",d="vec4";"all"===e?(a="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===e&&(a="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var p="";i%n>0&&(p="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+p+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+h+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(2===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(3===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+h+"\n        }\n        setOutput("+u+");\n      }\n    "},Iv=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var n="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),n+="\n        "+i+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+Qf(["r","c","d"],e)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+tm(t)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+t[1]+";\n        int cols = "+t[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},Sv=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=t.shape,s=a[1],u=a[2],c=[n&&s>1?i-1:i,n&&u>1?o-1:o],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=c[0]/l[0],d=c[1]/l[1],p=1/h,f=1/d,m=2*Math.ceil(p)+2,v=2*Math.ceil(f)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+p+");\n        const float invWidthScale = float("+f+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(o-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},kv=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var i=t[0],o=t[1],a=t[2],s=t[3];this.outputShape=[i,e,n,s];var u=[r&&e>1?o-1:o,r&&n>1?a-1:a],c=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},Tv=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=t[0],o=t[1],a=t[2],s=t[3];this.outputShape=[i,e,n,s];var u=[r&&e>1?o-1:o,r&&n>1?a-1:a],c=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+o+".0, "+a+".0,\n                                     "+a+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},Nv=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=t.shape,s=a[1],u=a[2],c=[n&&s>1?i-1:i,n&&u>1?o-1:o],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=c[0]/l[0],d=c[1]/l[1],p=1/h,f=1/d,m=2*Math.ceil(p)+2,v=2*Math.ceil(f)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+p+");\n        const float invWidthScale = float("+f+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+v+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Rv=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var i=t[0],o=t[1],a=t[2],s=t[3];this.outputShape=[i,e,n,s];var u=[r&&e>1?o-1:o,r&&n>1?a-1:a],c=[r&&e>1?e-1:e,r&&n>1?n-1:n],l=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+l+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},Av=function(t,e){this.variableNames=["x"];var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=t,1!==n){var r=t.map(function(n,r){return i=r,-1!==e.indexOf(i)&&1!==t[i]?t[i]+" - coords["+i+"] - 1":"coords["+i+"]";var i}).join(","),i=hm(n);this.userCode="\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "},Pv=function(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=t;var r=Yf("rc",n),i=r[n-1]+" + 1 < "+this.outputShape[n-1],o=r[n-2]+" + 1 < "+this.outputShape[n-2],a=hm(n);function s(n){var r=t.map(function(r,i){return o=i,a=n,-1!==e.indexOf(o)&&1!==t[o]?t[o]+" - "+a[o]+" - 1":""+a[o];var o,a});return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+t[0]+" - rc - 1),\n            "+t[0]+" - rc - 1);\n          if("+i+"){\n              result.g = getChannel(getX("+t[0]+" - (rc  + 1) - 1),\n                "+t[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+a+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+(s(r.slice())+";\n          if(")+i+"){\n            result.g = "+function(t){return t[n-1]="("+t[n-1]+" + 1)",s(t)}(r.slice())+";\n          }\n          if("+o+") {\n            result.b = "+function(t){return t[n-2]="("+t[n-2]+" + 1)",s(t)}(r.slice())+";\n            if("+i+") {\n              result.a = "+function(t){return t[n-1]="("+t[n-1]+" + 1)",t[n-2]="("+t[n-2]+" + 1)",s(t)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},Dv=function(t,e,n,r,i,o,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=hm(i.length),u=hm(o.length),c="";1===n?c="i":2===n&&(c="i, j");var l="getIndices("+c+")",h="";1===r?h="i":2===r&&(h="i, coords[1]");var d="getUpdates("+h+")",p=e>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+i+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+t+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round("+l+");\n              flattenedIndex += index * "+p+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+d+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},Mv=function(t,e){this.variableNames=["x","segmentIds"];var n=t.windowSize,r=t.batchSize,i=t.inSize,o=t.numSegments,a=o*Math.ceil(i/n);this.outputShape=[r,a];var s=4*Math.floor(n/4),u=n%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";i%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var h="";i%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+h+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+o+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+o+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},Ov=function(t,e,n){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+o[u]),u<t&&a.push(""+o[u]);r=a.join(),i=s.join()}var c=hm(n);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+i+"));\n        } else {\n          setOutput(getB("+i+"));\n        }\n      }\n    "},Lv=function(){function t(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,n=hm(this.rank),r="uniform int start["+this.rank+"];",i=function(t){if(1===t)return"sourceLoc";if(t<=6)return Bv.slice(0,t).map(function(t){return"sourceLoc."+t}).join(",");throw Error("Slicing for rank "+t+" is not yet supported")}(this.rank);e="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+t.map(function(t,e){return"sourceLoc."+Bv[e]+" = start["+e+"] + coords."+Bv[e]+";"}).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+e+"\n        setOutput(getSource("+i+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),Bv=["x","y","z","w","u","v"],Fv=function(){function t(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var e=hm(this.rank),n=Yf("coords",this.rank),r=Yf("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",o="getChannel(getSource("+r.join()+"), "+i+")",a="\n      result.x = "+o+";\n      if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+o+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+t[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+o+";\n        if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+o+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+e+"("+t.map(function(t,e){return"start["+e+"]"}).join()+");":t.map(function(t,e){return r[e]+" = "+n[e]+" + start["+e+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+e+" coords = getOutputCoords();\n        "+e+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+a+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),jv=function(t,e,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=hm(n.length),o=hm(n.length),a="";if(1===r)a="coords * strides + begin";else{var s=0;a=n.map(function(t,e){return s++,1===n.length?"coords * strides["+e+"] + begin["+e+"]":"coords["+(s-1)+"] * strides["+e+"] + begin["+e+"]"}).join(",")}this.userCode="\n      "+i+" begin = "+i+"("+t+");\n      "+i+" strides = "+i+"("+e+");\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+a+"));\n      }\n    "},zv=function(){function t(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(t,e,n){var r,i=Wv(e,n),o=Uv(t,i,n);if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[o].shift();return this.usedTextures[o].push(a),a}return this.numUsedTextures++,this.log(),i===Gh.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):i===Gh.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):i===Gh.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):i===Gh.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):i===Gh.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[o].push(r),r},t.prototype.releaseTexture=function(t,e,n,r){if(null!=this.freeTextures){var i=Uv(e,Wv(n,r),r);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(t),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures[i],a=o.indexOf(t);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(a,1),this.log()}},t.prototype.log=function(){if(this.logEnabled)this.numFreeTextures,this.numUsedTextures},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var t=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function Wv(t,e){if(t===Hh.UPLOAD)return Gh.PACKED_2X2_FLOAT32;if(t===Hh.RENDER||null==t)return n=e,Tl().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?Gh.PACKED_2X2_FLOAT32:Gh.UNPACKED_FLOAT32:n?Gh.PACKED_2X2_FLOAT16:Gh.UNPACKED_FLOAT16;var n;if(t===Hh.DOWNLOAD||t===Hh.PIXELS)return Gh.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function Uv(t,e,n){return t[0]+"_"+t[1]+"_"+e+"_"+n}var Vv=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;var i=hm(this.rank),o=function(t){var e=t.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+t[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],i=0;i<t.length;i++)r.push("imod("+n[i]+", "+t[i]+")");return r.join()}(t);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "},Hv=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;var i=hm(this.rank),o=function(t){var e=t.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e),i=0;i<t.length;i++)r[t[i]]=n[i];return r.join()}(e);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+o+"));\n    }\n    "},Gv=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=hm(this.rank),o=$f("rc",this.rank),a=new Array(this.rank);for(r=0;r<e.length;r++)a[e[r]]=o[r];var s="vec2("+a.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+n[this.rank-1],c="getChannel(getA("+a.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+i+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+o[this.rank-1]+";\n      if(++"+o[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},qv=1.7580993408473768,Kv=1.0507009873554805,Zv=function(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Xv="if (isnan(x)) return x;",$v="return abs(x);",Yv=Xv+"\n  return (x < 0.0) ? 0.0 : x;\n",Jv=Xv+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Qv="return (x >= 0.0) ? x : (exp(x) - 1.0);",tg="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+qv+";\n  float scale = "+Kv+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",eg="return -x;",ng="return ceil(x);",rg="return floor(x);",ig="return exp(x);",og="return exp(x) - 1.0;",ag=Xv+"\n  return sin(x);\n",sg=Xv+"\n  return cos(x);\n",ug=Xv+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",cg=Xv+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",lg=Xv+"\n  return atan(x);\n",hg=Xv+"return log(x + sqrt(x * x + 1.0));",dg=Xv+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",pg=Xv+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",fg="return x;",mg="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",vg="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",gg="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",yg=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},xg=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var e=t.length,n=Yf("rc",e),r=hm(e),i=function(t,e){if(1===t)return"rc";for(var n="",r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}(e,n),o=n.slice(-2),a=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+i+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "},bg={};function wg(t,e){if(void 0===e&&(e=!1),"linear"===t)return"return x;";if("relu"===t)return e?mg:Yv;if("elu"===t)return e?gg:Qv;if("relu6"===t)return e?vg:Jv;if("prelu"===t)return e?Im:Em;throw new Error("Activation "+t+" has not been implemented for the WebGL backend.")}var _g=function(t){function e(e){var n,r=t.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!Tl().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var i=Zh(Tl().getNumber("WEBGL_VERSION"));r.binaryCache=((n=Tl().getNumber("WEBGL_VERSION"))in bg||(bg[n]={}),bg[n]),r.gpgpu=new uv(i),r.canvas=i.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=e,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=e.gl.canvas;return r.textureManager=new zv(r.gpgpu),r.numMBBeforeWarning=null==Tl().global.screen?1024:Tl().global.screen.height*Tl().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new lf(r,zh),r}return Cl(e,t),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,e,n){if(Tl().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===n&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:e,dtype:n,values:t,usage:Hh.UPLOAD}),r},e.prototype.move=function(t,e,n,r){if(Tl().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:n,dtype:r,values:e,usage:Hh.UPLOAD})},e.prototype.readSync=function(t){var e=this.texData.get(t),n=e.values,r=e.dtype,i=e.complexTensors,o=e.slice,a=e.shape,s=e.isPacked;if(null!=o){var u;u=s?new yg(a,fg):new Zv(a,fg);var c=this.runWebGLProgram(u,[{dataId:t,shape:a,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeData(c.dataId),l}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===r)return n;var h,d,p=null!=this.activeTimers;return p&&(h=hh()),d="complex64"===r?Af(i.real.dataSync(),i.imag.dataSync()):this.getValuesFromTexture(t),p&&(this.downloadWaitMs+=hh()-h),this.convertAndCacheOnCPU(t,d)},e.prototype.read=function(t){return Il(this,0,void 0,function(){var e,n,r,i,o,a,s,u,c,l,h,d,p,f,m,v,g,y,x,b,w,_;return Sl(this,function(E){switch(E.label){case 0:if(this.pendingRead.has(t))return e=this.pendingRead.get(t),[2,new Promise(function(t){return e.push(t)})];if(n=this.texData.get(t),r=n.values,i=n.shape,o=n.slice,a=n.dtype,s=n.complexTensors,u=n.isPacked,null!=o)return void 0,c=u?new yg(i,fg):new Zv(i,fg),l=this.runWebGLProgram(c,[{dataId:t,shape:i,dtype:a}],a),h=this.read(l.dataId),this.disposeData(l.dataId),[2,h];if(null!=r)return[2,this.convertAndCacheOnCPU(t)];if(!Tl().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===Tl().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,"complex64"!==a&&Tl().get("WEBGL_BUFFER_SUPPORTED")&&(p=this.decode(t),f=this.texData.get(p.dataId),d=(_=this.gpgpu).createBufferFromTexture.apply(_,[f.texture].concat($h(i)))),this.pendingRead.set(t,[]),"complex64"===a?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:E.sent(),E.label=2;case 2:return"complex64"!==a?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return v=E.sent(),g=v[0],y=v[1],m=Af(g,y),[3,5];case 4:null==d?m=this.getValuesFromTexture(t):(x=Vl(i),m=this.gpgpu.downloadFloat32MatrixFromBuffer(d,x)),E.label=5;case 5:return null!=p&&this.disposeData(p.dataId),b=this.convertAndCacheOnCPU(t,m),w=this.pendingRead.get(t),this.pendingRead.delete(t),w.forEach(function(t){return t(b)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,b]}})})},e.prototype.checkNumericalProblems=function(t){if(null!=t)for(var e=0;e<t.length;e++){var n=t[e];if(!td(n)){if(Tl().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},e.prototype.getValuesFromTexture=function(t){var e,n=this.texData.get(t),r=n.shape,i=n.dtype,o=n.isPacked,a=Vl(r);if(Tl().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(t),u=this.texData.get(s.dataId),c=(e=this.gpgpu).downloadMatrixFromPackedTexture.apply(e,[u.texture].concat($h(r))).subarray(0,a);return this.disposeData(s.dataId),c}var l=Tl().getBool("WEBGL_PACK")&&!0===o,h=l?fd(r):r,d=l?new Ym(h):new $m(h),p=this.runWebGLProgram(d,[{shape:h,dtype:i,dataId:t}],"float32"),f=this.texData.get(p.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(f.texture,f.texShape[0],f.texShape[1]).subarray(0,a);return this.disposeData(p.dataId),m},e.prototype.time=function(t){return Il(this,0,void 0,function(){var e,n,r,i,o,a,s;return Sl(this,function(u){switch(u.label){case 0:return e=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t(),i=Ul(this.activeTimers.map(function(t){return t.query})).filter(function(t){return null!=t}),o=Ul(this.activeTimers.map(function(t){return t.name})).filter(function(t){return null!=t}),this.activeTimers=e,r&&(this.programTimersStack=null),a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},Tl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(i)]:[3,2];case 1:return s=u.sent(),a.kernelMs=function(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}(s),a.getExtraProfileInfo=function(){return s.map(function(t,e){return{name:o[e],ms:t}}).map(function(t){return t.name+": "+t.ms}).join(", ")},[3,3];case 2:a.kernelMs={error:"WebGL query timers are not supported in this environment."},u.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,a]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return Tl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:hh(),endMs:null}},e.prototype.endTimer=function(t){return Tl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=hh(),t)},e.prototype.getQueryTime=function(t){return Il(this,0,void 0,function(){var e;return Sl(this,function(n){return Tl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(e=t).endMs-e.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var e=this.texData.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var e=this.texData.get(t),n=e.texture,r=e.dtype,i=e.texShape,o=e.usage,a=e.isPacked,s=e.slice,u=s&&s.origDataId||t,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(i,r),this.textureManager.releaseTexture(n,i,o,a)));var l=this.texData.get(t);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return Tl().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=zh.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,e){var n=this;return void 0===e&&(e=128),null!=this.getCPUBackend()&&t.every(function(t){return null==n.texData.get(t.dataId).texture&&t.size<e})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,e){var n=this.makeOutput(t.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:zh.keep(t.clone()),imag:zh.keep(e.clone())},n},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,e,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,e,n);if(0===Vl(n))return Wd([],n,t.dtype);var r=this.texData.get(t.dataId).isPacked,i=of(t.shape,e,n);if(r||!i){var o=Tl().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Fv(n):new Lv(n),a=o.getCustomSetupFunc(e);return this.compileAndRun(o,[t],null,a)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,e,n)},e.prototype.shallowSlice=function(t,e,n){var r=this.texData.get(t.dataId),i=this.makeOutput(n,t.dtype),o=this.texData.get(i.dataId);Object.assign(o,r),o.shape=n,o.dtype=t.dtype;var a=af(e,t.strides);r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};var s=this.dataRefCount.get(o.slice.origDataId)||1;return this.dataRefCount.set(o.slice.origDataId,s+1),i},e.prototype.stridedSlice=function(t,e,n,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,e,n,r);var i=ef(e,n,r);if(i.some(function(t){return 0===t}))return Wd([],i);var o=new jv(e,r,i);return this.compileAndRun(o,[t])},e.prototype.reverse=function(t,e){var n=Tl().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Pv(t.shape,e):new Av(t.shape,e);return this.compileAndRun(n,[t])},e.prototype.concat=function(t,e){if("complex64"===t[0].dtype){var n=t.map(function(t){return jd(t)}),r=t.map(function(t){return zd(t)});return Fd(this.concat(n,e),this.concat(r,e))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,e);if(1===t.length)return t[0];if(t.length>Tl().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(t.length/2),o=this.concat(t.slice(0,i),e),a=this.concat(t.slice(i),e);return this.concat([o,a],e)}if(Tl().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var s=new Am(t.map(function(t){return t.shape}),e);return this.compileAndRun(s,t)}var u=Ld(t.map(function(t){return t.shape}),e),c=t.map(function(t){return t.as2D(-1,Vl(t.shape.slice(e)))}),l=new Rm(c.map(function(t){return t.shape}));return this.compileAndRun(l,c).reshape(u)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(Tl().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,eg,t.dtype);var e=new Zv(t.shape,eg);return this.compileAndRun(e,[t])},e.prototype.batchMatMul=function(t,e,n,r){var i=n?t.shape[2]:t.shape[1],o=r?e.shape[1]:e.shape[2],a=n?t.shape[1]:t.shape[2],s=t.shape[0];if((1===i||1===o)&&a>1e3){n&&(t=t.transpose([0,2,1])),r&&(e=e.transpose([0,2,1]));var u=1===o?t:t.as3D(s,a,1),c=1===o?2:1,l=1===o?e.as3D(s,1,a):e;return this.multiply(u,l).sum(c,!0)}var h=Dh(t.dtype,e.dtype),d=new vv(t.shape,[s,i,o],n,r);return this.compileAndRun(d,[t,e],h)},e.prototype.fusedBatchMatMul=function(t){var e=t.a,n=t.b,r=t.transposeA,i=t.transposeB,o=t.bias,a=t.activation,s=t.preluActivationWeights,u=r?e.shape[2]:e.shape[1],c=i?n.shape[1]:n.shape[2],l=e.shape[0],h=Dh(e.dtype,n.dtype),d=null!=o,p=null!=s,f=a?wg(a,!0):null,m=new vv(e.shape,[l,u,c],r,i,d,f,p),v=[e,n];return o&&v.push(o),s&&v.push(s),this.compileAndRun(m,v,h)},e.prototype.multiply=function(t,e){if("complex64"===t.dtype){var n=this.texData.get(t.dataId),r=this.texData.get(e.dataId),i=new xm("return areal * breal - aimag * bimag;",t.shape,e.shape),o=new xm("return areal * bimag + aimag * breal;",t.shape,e.shape),a=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag),this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)],s=this.compileAndRun(i,a),u=this.compileAndRun(o,a),c=this.complex(s,u);return s.dispose(),u.dispose(),c}if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.multiply(t,e);if(Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,_m,t.dtype);var l=new Cm(_m,t.shape,e.shape);return this.compileAndRun(l,[t,e],t.dtype)},e.prototype.batchNormalization=function(t,e,n,r,i,o){var a=[t,e,n],s=null;null!=o&&(s=o.shape,a.push(o));var u=null;if(null!=i&&(u=i.shape,a.push(i)),Tl().getBool("WEBGL_PACK_NORMALIZATION")){var c=new ym(t.shape,e.shape,n.shape,s,u,r);return this.compileAndRun(c,a)}var l=new gm(t.shape,e.shape,n.shape,s,u,r);return this.compileAndRun(l,a)},e.prototype.localResponseNormalization4D=function(t,e,n,r,i){var o=Tl().getBool("WEBGL_PACK_NORMALIZATION")?new pv(t.shape,e,n,r,i):new hv(t.shape,e,n,r,i);return this.compileAndRun(o,[t])},e.prototype.LRNGrad=function(t,e,n,r,i,o,a){var s=new dv(e.shape,r,i,o,a);return this.compileAndRun(s,[e,n,t])},e.prototype.tile=function(t,e){if("string"===t.dtype){var n=this.readSync(t.dataId).map(function(t){return ph(t)});return Hf(yp(t.shape,t.dtype,n),e)}var r=new Vv(t.shape,e);return this.compileAndRun(r,[t])},e.prototype.pad=function(t,e,n){var r=Tl().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wv(t.shape,e,n):new bv(t.shape,e,n);return this.compileAndRun(r,[t])},e.prototype.transpose=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,e);var n=Tl().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Gv(t.shape,e):new Hv(t.shape,e);return this.compileAndRun(n,[t])},e.prototype.gather=function(t,e,n){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.gather(t,e,n);var r=new nv(t.shape,e.size,n);return this.compileAndRun(r,[t,e])},e.prototype.batchToSpaceND=function(t,e,n){jl(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var r=e.reduce(function(t,e){return t*e}),i=Gp(t.shape,e,r),o=qp(i.length,e.length),a=Kp(t.shape,e,r),s=Zp(n,e.length),u=Xp(a,n,e.length);return t.reshape(i).transpose(o).reshape(a).slice(s,u)},e.prototype.spaceToBatchND=function(t,e,n){jl(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var r=e.reduce(function(t,e){return t*e}),i=[[0,0]];i.push.apply(i,n);for(var o=1+e.length;o<t.shape.length;++o)i.push([0,0]);var a=t.pad(i),s=Gp(a.shape,e,r,!1),u=qp(s.length,e.length,!1),c=Kp(a.shape,e,r,!1);return a.reshape(s).transpose(u).reshape(c)},e.prototype.reduce=function(t,e,n){var r=t.shape[0],i=t.shape[1],o=Yp(i),a=new Cv({windowSize:o,inSize:i,batchSize:r},e),s=this.compileAndRun(a,[t],n);return 1===s.shape[1]?s:this.reduce(s,e,n)},e.prototype.argReduce=function(t,e,n){void 0===n&&(n=null);var r=t.shape[0],i=t.shape[1];null!=n&&(r=n.shape[0],i=n.shape[1]);var o=Yp(i),a=new Xf({windowSize:o,inSize:i,batchSize:r},e,null==n),s=[t];null!=n&&s.push(n);var u=this.compileAndRun(a,s,"int32");return 1===u.shape[1]?u:this.argReduce(t,e,u)},e.prototype.argReducePacked=function(t,e,n){void 0===n&&(n=null);var r=null!=n?n.shape:t.shape,i=Yp(r[r.length-1]),o=new fm(r,i,e,null==n),a=null==n?[t]:[t,n],s=this.compileAndRun(o,a,"int32");return s.rank===t.rank?this.argReducePacked(t,e,s):s},e.prototype.sum=function(t,e){Pd("sum",e,t.rank);var n=Rd(t.shape,e),r=n[0],i=Vl(n[1]),o=t.as2D(-1,i),a=Mh(t.dtype);return this.reduce(o,"sum",a).reshape(r)},e.prototype.prod=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,e);var n=Rd(t.shape,e),r=n[0],i=Vl(n[1]),o=t.as2D(-1,i),a=Mh(t.dtype);return this.reduce(o,"prod",a).reshape(r)},e.prototype.unsortedSegmentSum=function(t,e,n){var r=0,i=Dd([r],t.rank),o=t;null!=i&&(o=t.transpose(i),r=Od(1,t.rank)[0]);var a=function(t,e,n){for(var r=[],i=t.length,o=0;o<i;o++)o!==e?r.push(t[o]):r.push(n);return r}(o.shape,r,n),s=Vl([o.shape[r]]),u=o.as2D(-1,s),c=Mh(t.dtype),l=this.segOpCompute(u,"unsortedSegmentSum",e,c,n).reshape(a);return null!=i&&(l=l.transpose(Md(i))),l},e.prototype.segOpCompute=function(t,e,n,r,i){var o=t.shape[0],a=t.shape[1],s=function(t,e){var n,r=!1;for(t<=30?(n=t,r=!0):n=oh(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=oh(t,n+1);return n}(a,i),u=new Mv({windowSize:s,inSize:a,batchSize:o,numSegments:i}),c=this.compileAndRun(u,[t,n],r);return c.shape[1]===i?c:(n=Yd(0,i).tile([a/s]),this.segOpCompute(c,e,n,r,i))},e.prototype.argMinMaxReduce=function(t,e,n){var r=[e];if(Pd("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,t.rank),!Tl().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var i=Rd(t.shape,r),o=i[0],a=Vl(i[1]),s=t.as2D(-1,a);return this.argReduce(s,n).reshape(o)}return this.argReducePacked(t,n)},e.prototype.argMin=function(t,e){return this.argMinMaxReduce(t,e,"min")},e.prototype.argMax=function(t,e){return this.argMinMaxReduce(t,e,"max")},e.prototype.cumsum=function(t,e,n,r){if(e!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+e);var i=new Hm(t.shape,n,r);return this.compileAndRun(i,[t])},e.prototype.equal=function(t,e){if(Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(equal(a, b));\n","bool");var n=new Cm("return float(a == b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.notEqual=function(t,e){if(Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(notEqual(a, b));\n","bool");var n=new Cm("return float(a != b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.less=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.less(t,e);if(Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThan(a, b));\n","bool");var n=new Cm("return float(a < b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.lessEqual=function(t,e){if(Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new Cm("return float(a <= b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.greater=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.greater(t,e);if(Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new Cm("return float(a > b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.greaterEqual=function(t,e){if(Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new Cm("return float(a >= b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.logicalNot=function(t){var e=new Zv(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(e,[t])},e.prototype.logicalAnd=function(t,e){if(Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new Cm("return float(a >= 1.0 && b >= 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.logicalOr=function(t,e){if(Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new Cm("return float(a >= 1.0 || b >= 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.select=function(t,e,n){var r=new Ov(t.rank,e.shape,e.rank);return this.compileAndRun(r,[t,e,n],Dh(e.dtype,n.dtype))},e.prototype.where=function(t){Cd("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=t.dataSync();return qf(t.shape,e)},e.prototype.topk=function(t,e,n){return Gf(t.dataSync(),t.shape,t.dtype,e)},e.prototype.min=function(t,e){Pd("min",e,t.rank);var n=Rd(t.shape,e),r=n[0],i=Vl(n[1]),o=t.as2D(-1,i);return this.reduce(o,"min",o.dtype).reshape(r)},e.prototype.minimum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.minimum(t,e);var n=Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Sm("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Cm("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.mod=function(t,e){var n=Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Sm("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Cm("if (b == 0.0) return NAN;\n  return mod(a, b);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.max=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,e);Pd("max",e,t.rank);var n=Rd(t.shape,e),r=n[0],i=Vl(n[1]),o=t.as2D(-1,i);return this.reduce(o,"max",o.dtype).reshape(r)},e.prototype.maximum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.maximum(t,e);var n=Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Sm("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Cm("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.all=function(t,e){Pd("all",e,t.rank);var n=Rd(t.shape,e),r=n[0],i=Vl(n[1]),o=t.as2D(-1,i);return this.reduce(o,"all",o.dtype).reshape(r)},e.prototype.any=function(t,e){Pd("any",e,t.rank);var n=Rd(t.shape,e),r=n[0],i=Vl(n[1]),o=t.as2D(-1,i);return this.reduce(o,"any",o.dtype).reshape(r)},e.prototype.realDivide=function(t,e){if(Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new Cm("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",t.shape,e.shape);return this.compileAndRun(n,[t,e],"float32")},e.prototype.floorDiv=function(t,e){if(Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new Cm("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",t.shape,e.shape);return this.compileAndRun(n,[t,e],"int32")},e.prototype.add=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,bm);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.add(t,e);var n=Dh(t.dtype,e.dtype);if(Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,bm,n);var r=new Cm(bm,t.shape,e.shape);return this.compileAndRun(r,[t,e],n)},e.prototype.packedUnaryOp=function(t,e,n){var r=new yg(t.shape,e);return this.compileAndRun(r,[t],n)},e.prototype.packedBinaryOp=function(t,e,n,r,i){void 0===i&&(i=!1);var o=new Sm(n,t.shape,e.shape,i);return this.compileAndRun(o,[t,e],r)},e.prototype.complexSeparableBinaryOp=function(t,e,n){var r=this,i=this.texData.get(t.dataId),o=this.texData.get(e.dataId),a=[[i.complexTensors.real,o.complexTensors.real],[i.complexTensors.imag,o.complexTensors.imag]].map(function(i){var o=i[0],a=i[1],s=r.makeComplexComponentTensorInfo(t,o),u=r.makeComplexComponentTensorInfo(e,a),c=new Cm(n,t.shape,e.shape);return r.compileAndRun(c,[s,u],Dh(o.dtype,a.dtype))}),s=a[0],u=a[1],c=this.complex(s,u);return s.dispose(),u.dispose(),c},e.prototype.makeComplexComponentTensorInfo=function(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}},e.prototype.addN=function(t){if(1===t.length)return t[0];if(t.length>Tl().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var e=Math.floor(t.length/2),n=this.addN(t.slice(0,e)),r=this.addN(t.slice(e));return this.addN([n,r])}var i=t.map(function(t){return t.dtype}).reduce(function(t,e){return Dh(t,e)}),o=t.map(function(t){return t.shape}),a=Tl().getBool("WEBGL_PACK")?new Zf(t[0].shape,o):new Kf(t[0].shape,o);return this.compileAndRun(a,t,i)},e.prototype.subtract=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,wm);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.subtract(t,e);var n=Dh(t.dtype,e.dtype);if(Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,wm,t.dtype);var r=new Cm(wm,t.shape,e.shape);return this.compileAndRun(r,[t,e],n)},e.prototype.pow=function(t,e){var n=Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Sm("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Cm("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",t.shape,e.shape),r=Dh(t.dtype,e.dtype);return this.compileAndRun(n,[t,e],r)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(Tl().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,ng,t.dtype);var e=new Zv(t.shape,ng);return this.compileAndRun(e,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(Tl().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,rg,t.dtype);var e=new Zv(t.shape,rg);return this.compileAndRun(e,[t])},e.prototype.sign=function(t){var e=new Zv(t.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(e,[t])},e.prototype.isNaN=function(t){var e=new Zv(t.shape,"return float(isnan(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.isInf=function(t){var e=new Zv(t.shape,"return float(isinf(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.isFinite=function(t){var e=new Zv(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.round=function(t){var e=new Zv(t.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(e,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(Tl().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,ig,t.dtype);var e=new Zv(t.shape,ig);return this.compileAndRun(e,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(Tl().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,og,t.dtype);var e=new Zv(t.shape,og);return this.compileAndRun(e,[t])},e.prototype.softmax=function(t,e){var n=$l([e],t.shape),r=this.max(t,n),i=Ad(r.shape,n),o=this.subtract(t,r.reshape(i)),a=this.exp(o),s=this.sum(a,n).reshape(i);return this.realDivide(a,s)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(Tl().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",t.dtype);var e=new Zv(t.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(e,[t])},e.prototype.log1p=function(t){var e=new Zv(t.shape,"return log(1.0 + x);");return this.compileAndRun(e,[t])},e.prototype.sqrt=function(t){var e=new Zv(t.shape,"return sqrt(x);");return this.compileAndRun(e,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var e=new Zv(t.shape,"return inversesqrt(x);");return this.compileAndRun(e,[t])},e.prototype.reciprocal=function(t){var e=new Zv(t.shape,"return 1.0 / x;");return this.compileAndRun(e,[t])},e.prototype.relu=function(t){var e;return e=Tl().getBool("WEBGL_PACK")?new yg(t.shape,mg):new Zv(t.shape,Yv),this.compileAndRun(e,[t])},e.prototype.relu6=function(t){var e;return e=Tl().getBool("WEBGL_PACK")?new yg(t.shape,vg):new Zv(t.shape,Jv),this.compileAndRun(e,[t])},e.prototype.prelu=function(t,e){var n=Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Sm(Im,t.shape,e.shape):new Cm(Em,t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.elu=function(t){if(Tl().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,gg,t.dtype);var e=new Zv(t.shape,Qv);return this.compileAndRun(e,[t])},e.prototype.eluDer=function(t,e){var n=Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Sm("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",t.shape,e.shape):new Cm("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.selu=function(t){var e=new Zv(t.shape,tg);return this.compileAndRun(e,[t])},e.prototype.int=function(t){var e=new Zv(t.shape,"return float(int(x));");return this.compileAndRun(e,[t],"int32")},e.prototype.clip=function(t,e,n){var r,i=(r=Tl().getBool("WEBGL_PACK_CLIP")?new Tm(t.shape):new km(t.shape)).getCustomSetupFunc(e,n);return this.compileAndRun(r,[t],null,i)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(Tl().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,$v,t.dtype);var e=new Zv(t.shape,$v);return this.compileAndRun(e,[t])},e.prototype.complexAbs=function(t){var e=this.texData.get(t.dataId),n=new Nm(t.shape),r=[this.makeComplexComponentTensorInfo(t,e.complexTensors.real),this.makeComplexComponentTensorInfo(t,e.complexTensors.imag)];return this.compileAndRun(n,r)},e.prototype.sigmoid=function(t){var e=new Zv(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(e,[t])},e.prototype.softplus=function(t){var e=new Zv(t.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(e,[t])},e.prototype.sin=function(t){var e=new Zv(t.shape,ag);return this.compileAndRun(e,[t])},e.prototype.cos=function(t){var e=new Zv(t.shape,sg);return this.compileAndRun(e,[t])},e.prototype.tan=function(t){var e=new Zv(t.shape,"return tan(x);");return this.compileAndRun(e,[t])},e.prototype.asin=function(t){var e=new Zv(t.shape,ug);return this.compileAndRun(e,[t])},e.prototype.acos=function(t){var e=new Zv(t.shape,cg);return this.compileAndRun(e,[t])},e.prototype.atan=function(t){var e=new Zv(t.shape,lg);return this.compileAndRun(e,[t])},e.prototype.atan2=function(t,e){var n=Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Sm("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Cm("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.sinh=function(t){var e=new Zv(t.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},e.prototype.cosh=function(t){var e=new Zv(t.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},e.prototype.tanh=function(t){var e=new Zv(t.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(e,[t])},e.prototype.asinh=function(t){var e=new Zv(t.shape,hg);return this.compileAndRun(e,[t])},e.prototype.acosh=function(t){var e=new Zv(t.shape,dg);return this.compileAndRun(e,[t])},e.prototype.atanh=function(t){var e=new Zv(t.shape,pg);return this.compileAndRun(e,[t])},e.prototype.erf=function(t){var e=new Zv(t.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(e,[t])},e.prototype.step=function(t,e){var n,r=new Zv(t.shape,(void 0===(n=e)&&(n=0),Xv+"\n    return x > 0.0 ? 1.0 : float("+n+");\n  "));return this.compileAndRun(r,[t])},e.prototype.conv2dByMatMul=function(t,e,n,r,i,o){var a=t.shape,s=this.texData.get(t.dataId),u=n.inChannels,c=a[0]*a[1]*a[2],l=n.outChannels,h="channelsLast"===n.dataFormat,d=(1===c||1===l)&&u>1e3,p=a[2]%2!=0&&!!s.isPacked;if(d||!Tl().getBool("WEBGL_LAZILY_UNPACK")||!Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!p){var f=h?a[0]*a[1]*a[2]:a[0]*a[2]*a[3],m=this.reshape(t,[1,f,n.inChannels]),v=this.reshape(e,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b:v,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:o}),n.outShape)}var g=h?a[0]*a[1]*(a[2]+1):a[0]*a[2]*(a[3]+1),y={dataId:t.dataId,shape:[1,g,n.inChannels],dtype:t.dtype},x=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,jl(vd(s.shape,y.shape),function(){return"packed reshape "+s.shape+" to "+y.shape+" isn't free"});var b=this.reshape(e,[1,n.inChannels,n.outChannels]),w=this.fusedBatchMatMul({a:y,b:b,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:o}),_=this.texData.get(w.dataId);return jl(_.isPacked,function(){return"batchMatMul result is expected to be packed"}),s.shape=x,_.shape=n.outShape,zh.makeTensorFromDataId(w.dataId,n.outShape,w.dtype)},e.prototype.conv2dWithIm2Row=function(t,e,n,r,i,o){var a=n.filterWidth,s=n.filterHeight,u=n.inChannels,c=n.outWidth,l=n.outHeight,h="channelsLast"===n.dataFormat,d=a*s*u,p=l*c,f=[d,p],m=t.squeeze([0]),v=e.reshape([1,d,-1]),g=new lv(f,m.shape,n),y=this.compileAndRun(g,[m]).reshape([1,f[0],f[1]]),x=null!=r,b=null!=o,w=i?wg(i,!0):null,_=new vv(y.shape,[1,p,n.outChannels],!0,!1,x,w,b),E=[y,v];r&&E.push(r),b&&E.push(o);var C=this.compileAndRun(_,E);return h?C.reshape([1,l,c,n.outChannels]):C.reshape([1,n.outChannels,l,c])},e.prototype.fusedConv2d=function(t){var e=t.input,n=t.filter,r=t.convInfo,i=t.bias,o=t.activation,a=t.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(e,n,r,i,o,a);if(Tl().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,n,r,i,o,a);var s=null!=i,u=null!=a,c=o?wg(o,!1):null,l=new jm(r,s,c,u),h=[e,n];return i&&h.push(i),a&&h.push(a),this.compileAndRun(l,h)},e.prototype.conv2d=function(t,e,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(t,e,n);if(Tl().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,e,n);var r=new jm(n);return this.compileAndRun(r,[t,e])},e.prototype.conv2dDerInput=function(t,e,n){var r=new Mm(n);return this.compileAndRun(r,[t,e])},e.prototype.conv2dDerFilter=function(t,e,n){var r=new Dm(n);return this.compileAndRun(r,[t,e])},e.prototype.fusedDepthwiseConv2D=function(t){var e,n=t.input,r=t.filter,i=t.convInfo,o=t.bias,a=t.activation,s=t.preluActivationWeights,u=Tl().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1,c=a?wg(a,u):null,l=[n,r],h=null!=o,d=null!=s;return h&&l.push(o),d&&l.push(s),u?(e=new Um(i,h,c,d),this.compileAndRun(e,l)):(e=new Wm(i,h,c,d),this.compileAndRun(e,l))},e.prototype.depthwiseConv2D=function(t,e,n){var r;return Tl().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new Um(n),this.compileAndRun(r,[t,e])):(r=new Wm(n),this.compileAndRun(r,[t,e]))},e.prototype.depthwiseConv2DDerInput=function(t,e,n){var r=new Fm(n);return this.compileAndRun(r,[t,e])},e.prototype.depthwiseConv2DDerFilter=function(t,e,n){var r=new Bm(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3d=function(t,e,n){var r=new zm(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3dDerInput=function(t,e,n){var r=new Lm(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3dDerFilter=function(t,e,n){var r=new Om(n);return this.compileAndRun(r,[t,e])},e.prototype.maxPool=function(t,e){var n=new _v(e,"max",!1);return this.compileAndRun(n,[t])},e.prototype.avgPool=function(t,e){var n=new _v(e,"avg",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.maxPoolBackprop=function(t,e,n,r){var i=new _v(r,"max",!0),o=this.compileAndRun(i,[e]),a=new fv(r),s=this.compileAndRun(a,[t,o],e.dtype);return o.dispose(),s},e.prototype.avgPoolBackprop=function(t,e,n){var r=new mm(n);return this.compileAndRun(r,[t],e.dtype)},e.prototype.cast=function(t,e){return Tf(t,e,this)},e.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),i=0,o=0;o<t.rank;o++)o!==e&&(r[i++]=t.shape[o]);var a=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(n);for(o=0;o<u.length;o++)a[e]=o,u[o]=this.slice(t,a,s).reshape(r);return u},e.prototype.avgPool3d=function(t,e){var n=new Ev(e,"avg",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,e,n){var r=new vm(n);return this.compileAndRun(r,[t],e.dtype)},e.prototype.maxPool3d=function(t,e){var n=new Ev(e,"max",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,e,n,r){var i=new Ev(r,"max",!0),o=this.compileAndRun(i,[e]),a=new mv(r),s=this.compileAndRun(a,[t,o],e.dtype);return o.dispose(),s},e.prototype.reshape=function(t,e){var n=this.texData.get(t.dataId);if(n.isPacked&&!vd(t.shape,e)&&(null===n.texture||!vd(n.shape,e))){var r=this.packedReshape(t,e);return zh.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return Nf(t,e)},e.prototype.resizeBilinear=function(t,e,n,r){var i=Tl().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Tv(t.shape,e,n,r):new kv(t.shape,e,n,r);return this.compileAndRun(i,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,e,n){var r=new Sv(t,e,n);return this.compileAndRun(r,[t])},e.prototype.resizeNearestNeighbor=function(t,e,n,r){var i=new Rv(t.shape,e,n,r);return this.compileAndRun(i,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,e,n){var r=new Nv(t,e,n);return this.compileAndRun(r,[t])},e.prototype.multinomial=function(t,e,n,r){var i=e?t:uf(t),o=i.shape[0],a=i.shape[1],s=new gv(o,a,n),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[i],"int32",u)},e.prototype.oneHot=function(t,e,n,r){var i=new yv(t.size,e,n,r);return this.compileAndRun(i,[t])},e.prototype.diag=function(t){var e=new Xm(t.size);return this.compileAndRun(e,[t])},e.prototype.nonMaxSuppression=function(t,e,n,r,i){return Cd("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Bf(t.dataSync(),e.dataSync(),n,r,i)},e.prototype.cropAndResize=function(t,e,n,r,i,o){var a=new Vm(t.shape,e.shape,r,i,o);return this.compileAndRun(a,[t,e,n],"float32")},e.prototype.depthToSpace=function(t,e,n){jl(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});var r=t.shape[0],i="NHWC"===n?t.shape[1]:t.shape[2],o="NHWC"===n?t.shape[2]:t.shape[3],a="NHWC"===n?t.shape[3]:t.shape[1],s=i*e,u=o*e,c=a/(e*e),l=new Zm("NHWC"===n?[r,s,u,c]:[r,c,s,u],e,n);return this.compileAndRun(l,[t])},e.prototype.split=function(t,e,n){return Vf(t,e,n)},e.prototype.scatterND=function(t,e,n){var r=Qp(0,t,n),i=r.sliceRank,o=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,c=[u/a,a],l=t.reshape([o,i]),h=e.reshape([o,a]);if(0===u)return Nf(Wd([]),n);var d=Vd(0),p=new Dv(o,i,l.rank,h.rank,s,c);return this.compileAndRun(p,[h,l,d]).reshape(n)},e.prototype.sparseToDense=function(t,e,n,r){var i=Qp(0,t,n),o=i.sliceRank,a=i.numUpdates,s=i.strides,u=i.outputSize,c=new Dv(a,o,t.rank,e.rank,s,[u,1]);return this.compileAndRun(c,[e,t,r]).reshape(n)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,e){var n=this.texData.get(t.dataId),r=new tv("return real * expR - imag * expI;",t.shape,e),i=new tv("return real * expI + imag * expR;",t.shape,e),o=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag)],a=this.compileAndRun(r,o),s=this.compileAndRun(i,o),u=this.complex(a,s).as2D(t.shape[0],t.shape[1]);return a.dispose(),s.dispose(),u},e.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],i=$p(t,e),o=i[0],a=i[1],s=i[2],u=i[3],c=e.reshape([a,r]),l=t.reshape([t.size/s,s]),h=new rv(r,u,[a,s]);return this.compileAndRun(h,[l,c]).reshape(o)},e.prototype.fill=function(t,e,n){if("string"===(n=n||rh(e))){var r=Ql(n,Vl(t));return r.fill(e),zh.makeTensor(r,t,n,this)}var i=new ev(t,e),o=i.getCustomSetupFunc(e);return this.compileAndRun(i,[],n,o)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,"string"===t.dtype?"":0,t.dtype)},e.prototype.linspace=function(t,e,n){return Rf(t,e,n)},e.prototype.makeTensorInfo=function(t,e){var n=this.write(null,t,e);return this.texData.get(n).usage=null,{dataId:n,shape:t,dtype:e}},e.prototype.makeOutput=function(t,e){var n=this.makeTensorInfo(t,e).dataId;return zh.makeTensorFromDataId(n,t,e,this)},e.prototype.unpackTensor=function(t){var e=new xg(t.shape);return this.runWebGLProgram(e,[t],t.dtype)},e.prototype.packTensor=function(t){var e=new xv(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,e){var n=[dd(t.shape)].concat(pd(t.shape)),r={dtype:t.dtype,shape:n,dataId:t.dataId},i=[dd(e)].concat(pd(e)),o=new Iv(i,n),a=this.runWebGLProgram(o,[r],t.dtype,null,!0);return{dataId:a.dataId,shape:e,dtype:a.dtype}},e.prototype.decode=function(t){var e,n=this.texData.get(t),r=n.isPacked,i=n.shape,o=n.dtype,a=fd(i);return e=r?new Km(a):new qm(a),{dtype:o,shape:i,dataId:this.runWebGLProgram(e,[{shape:a,dtype:o,dataId:t}],o,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,e,n,r,i){var o=this;void 0===i&&(i=!1);var a=this.makeTensorInfo(t.outputShape,n),s=this.texData.get(a.dataId);if(t.packedOutput&&(s.isPacked=!0),t.outPackingScheme===Vh.DENSE){var u=$h(t.outputShape);s.texShape=u.map(function(t){return 2*t})}if(null!=t.outTexUsage&&(s.usage=t.outTexUsage),0===Vl(a.shape))return s.values=Jl(a.dtype,0),a;var c=[],l=e.map(function(e){if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=o.texData.get(e.dataId);if(null==n.texture){if(!t.packedInputs&&Vl(e.shape)<=Tl().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.packedInputs&&(n.isPacked=!0,n.shape=e.shape)}else if(!!n.isPacked!=!!t.packedInputs)e=n.isPacked?o.unpackTensor(e):o.packTensor(e),c.push(e),n=o.texData.get(e.dataId);else if(n.isPacked&&!vd(n.shape,e.shape)){var r=e,i=e.shape;e.shape=n.shape,e=o.packedReshape(e,i),c.push(e),n=o.texData.get(e.dataId),r.shape=i}return o.uploadToGPU(e.dataId),{shape:e.shape,texData:n,isUniform:!1}});this.uploadToGPU(a.dataId);var h,d={shape:a.shape,texData:s,isUniform:!1},p=function(t,e,n){var r="";e.concat(n).forEach(function(t){var e=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0,n=t.isUniform?"uniform":t.texData.texShape;r+=t.shape+"_"+n+"_"+e});var i=t.userCode;return t.constructor.name+"_"+r+"_"+i}(t,l,d),f=this.getAndSaveBinary(p,function(){return function(t,e,n,r){var i=e.userCode,o=n.map(function(t,n){var r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(r.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:r}}),a=o.map(function(t){return t.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=nm(o,s,i,e.packedInputs),c=t.createProgram(u),l=null,h=t.getUniformLocation(c,"NAN",!1);1===Tl().getNumber("WEBGL_VERSION")&&(l=t.getUniformLocation(c,"INFINITY",!1));for(var d={},p=0;p<e.variableNames.length;p++){var f=e.variableNames[p];d[f]=t.getUniformLocation(c,f,!1),d["offset"+f]=t.getUniformLocation(c,"offset"+f,!1)}return{program:e,source:u,webGLProgram:c,uniformLocations:d,inShapeInfos:a,outShapeInfo:s,infLoc:l,nanLoc:h}}(o.gpgpu,t,l,d)}),m=null!=this.activeTimers;if(m&&(h=this.startTimer()),function(t,e,n,r,i){cv(e.inShapeInfos,n),cv([e.outShapeInfo],[r]);var o=r.texData.texture,a=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(o,a[0],a[1]):t.setOutputMatrixTexture(o,a[0],a[1]),t.setProgram(e.webGLProgram),1===Tl().getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach(function(n,r){var i=e.program.variableNames[r],o=e.uniformLocations[i],a=e.uniformLocations["offset"+i];if(null!=o)if(n.isUniform)if(Vl(n.shape)<2)t.gl.uniform1f(o,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),t.gl.uniform1fv(o,s)}else null!=n.texData.slice&&null!=a&&t.gl.uniform1i(a,n.texData.slice.flatOffset),t.setInputMatrixTexture(n.texData.texture,o,r)}),null!=i&&i(t,e.webGLProgram),t.executeProgram()}(this.gpgpu,f,l,d,r),c.forEach(function(t){return o.disposeData(t.dataId)}),m&&(h=this.endTimer(h),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(h)})),!Tl().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===i){var v=this.unpackTensor(a);return this.disposeData(a.dataId),v}return a},e.prototype.compileAndRun=function(t,e,n,r,i){void 0===i&&(i=!1),n=n||e[0].dtype;var o=this.runWebGLProgram(t,e,n,r,i);return zh.makeTensorFromDataId(o.dataId,o.shape,o.dtype)},e.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(Tl().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(e){t.gpgpu.deleteProgram(t.binaryCache[e].webGLProgram),delete t.binaryCache[e]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=_d(function(){if(!Tl().get("WEBGL_RENDER_FLOAT32_ENABLED")){var e=Tl().getBool("DEBUG");Tl().set("DEBUG",!1);var n=t.abs(Vd(1e-8)).dataSync()[0];if(Tl().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var e,n=this.texData.get(t),r=n.shape,i=n.dtype,o=n.values,a=n.texture,s=n.usage,u=n.isPacked;if(null==a){var c,l=null!=this.activeTimers;l&&(c=hh());var h=n.texShape;if(null==h&&(h=function(t,e){var n;void 0===e&&(e=!1);var r=Tl().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,1===(t=t.map(function(e,n){return n>=t.length-2?Fl(t[n]):t[n]})).length&&(t=[2,t[0]])),2!==t.length){var i=Yl(t);t=i.newShape}var o=Vl(t);if(t.length<=1&&o<=r)return[1,o];if(2===t.length&&t[0]<=r&&t[1]<=r)return t;if(3===t.length&&t[0]*t[1]<=r&&t[2]<=r)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=r&&t[1]*t[2]<=r)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=r&&t[3]<=r)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=r&&t[1]*t[2]*t[3]<=r)return[t[0],t[1]*t[2]*t[3]];if(e){var a=dd(t),s=2,u=2;return t.length&&(s=(n=pd(t))[0],u=n[1]),Kl(o=a*(s/2)*(u/2)).map(function(t){return 2*t})}return Kl(o)}(r,u),n.texShape=h),null!=o){var d=fd(r),p=void 0,f=h[1],m=h[0],v=o instanceof Uint8Array;u?(f=(e=Yh(h[0],h[1]))[0],m=e[1],p=new Qm(d,[m,f],v)):p=new Jm(d,[m,f],v);var g=this.makeTensorInfo([m,f],i);this.texData.get(g.dataId).usage=v?Hh.PIXELS:Hh.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(g.dataId),f,m,o);var y=this.runWebGLProgram(p,[g],i,null,!0),x=this.texData.get(y.dataId);n.texture=x.texture,n.texShape=x.texShape,n.isPacked=x.isPacked,n.usage=x.usage,this.disposeData(g.dataId),this.texData.delete(y.dataId),n.values=null,l&&(this.uploadWaitMs+=hh()-c)}else{var b=this.acquireTexture(h,s,i,u);n.texture=b}}},e.prototype.convertAndCacheOnCPU=function(t,e){var n=this.texData.get(t),r=n.dtype;return this.releaseGPUData(t),null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){for(var n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length),r=0;r<n.length;++r)n[r]=Math.round(t[r]);return n}throw new Error("Unknown dtype "+e)}(e,r)),n.values},e.prototype.acquireTexture=function(t,e,n,r){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0}return this.textureManager.acquireTexture(t,e,r)},e.prototype.computeBytes=function(t,e){return t[0]*t[1]*eh(e)},e}(hf);Wh()&&zh.registerBackend("webgl",function(){return new _g},2);var Eg=Bd({square_:function(t){var e=kd(t,"x","square"),n=[e];return zh.runKernelFunc(function(t,n){return n([e]),t.square(e)},{x:e},null,"Square",{},n,[])}}),Cg="SquaredDifference",Ig=Bd({squaredDifference_:function(t,e){var n,r=kd(t,"a","squaredDifference"),i=kd(e,"b","squaredDifference");n=Oh(r,i),r=n[0],i=n[1],mf(r.shape,i.shape);var o={a:r,b:i},a=[r,i];return zh.runKernelFunc(function(t,e){var n=t.squaredDifference(r,i);return e([r,i]),n},o,function(t,e){var n=e[0],r=e[1],i=Vd(2);return{a:function(){return t.mul(n.sub(r).mul(i))},b:function(){return t.mul(r.sub(n).mul(i))}}},Cg,{},a,[])}}),Sg=Bd({abs_:function(t){var e=kd(t,"x","abs");return"complex64"===e.dtype?zh.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):zh.runKernelFunc(function(t,n){var r=t.abs(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return t.mul(n.toFloat().step(-1))}}},"Abs")}}),kg=Bd({acos_:function(t){var e=kd(t,"x","acos");return zh.runKernelFunc(function(t,n){var r=t.acos(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(Vd(1).sub(n.toFloat().square()).sqrt()).neg()}}})}}),Tg=Bd({acosh_:function(t){var e=kd(t,"x","acosh");return zh.runKernelFunc(function(t,n){var r=t.acosh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(n.toFloat().square().sub(1).sqrt())}}})}}),Ng=Bd({asin_:function(t){var e=kd(t,"x","asin");return zh.runKernelFunc(function(t,n){var r=t.asin(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(Vd(1).sub(n.toFloat().square()).sqrt())}}})}}),Rg=Bd({asinh_:function(t){var e=kd(t,"x","asinh");return zh.runKernelFunc(function(t,n){var r=t.asinh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(Vd(1).add(n.toFloat().square()).sqrt())}}})}}),Ag=Bd({atan_:function(t){var e=kd(t,"x","atan");return zh.runKernelFunc(function(t,n){var r=t.atan(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat().square().add(1))}}})}}),Pg=Bd({atanh_:function(t){var e=kd(t,"x","atanh");return zh.runKernelFunc(function(t,n){var r=t.atanh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(Vd(1).sub(n.toFloat().square()))}}})}}),Dg=Bd({ceil_:function(t){var e=kd(t,"x","ceil");return zh.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return Qd(t)}}})}}),Mg=Bd({clipByValue_:function(t,e,n){var r=kd(t,"x","clipByValue");jl(e<=n,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+n+")."});var i=[r],o={min:e,max:n};return zh.runKernelFunc(function(t,i){var o=t.clip(r,e,n);return i([r]),o},{x:r},function(t,r){var i=r[0];return{x:function(){return t.where(i.greaterEqual(e).logicalAnd(i.lessEqual(n)),Qd(t))}}},"ClipByValue",o,i)}}),Og=Bd({cos_:function(t){var e=kd(t,"x","cos"),n=[e];return zh.runKernelFunc(function(t,n){var r=t.cos(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return n.toFloat().sin().neg().mul(t)}}},"Cos",{},n)}}),Lg=Bd({cosh_:function(t){var e=kd(t,"x","cosh");return zh.runKernelFunc(function(t,n){var r=t.cosh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return n.toFloat().sinh().mulStrict(t)}}})}}),Bg=Bd({erf_:function(t){var e=kd(t,"x","erf");return jl("int32"===e.dtype||"float32"===e.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===e.dtype&&(e=e.toFloat()),zh.runKernelFunc(function(t,n){var r=t.erf(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Fg=Bd({exp_:function(t){var e=kd(t,"x","exp");return zh.runKernelFunc(function(t,n){var r=t.exp(e);return n([r]),r},{x:e},function(t,e){return{x:function(){return t.mulStrict(e[0])}}},"Exp",{},[],[!0])}}),jg=Bd({expm1_:function(t){var e=kd(t,"x","expm1");return zh.runKernelFunc(function(t,n){var r=t.expm1(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.exp())}}})}}),zg=Bd({floor_:function(t){var e=kd(t,"x","floor");return zh.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return Qd(t)}}})}}),Wg=Bd({log_:function(t){var e=kd(t,"x","log"),n=[e];return zh.runKernelFunc(function(t,n){var r=t.log(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return t.div(n.toFloat())}}},"Log",{},n)}}),Ug=Bd({log1p_:function(t){var e=kd(t,"x","log1p");return zh.runKernelFunc(function(t,n){var r=t.log1p(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.add(1))}}})}}),Vg=Bd({logSigmoid_:function(t){var e=kd(t,"x","logSigmoid");return zh.runKernelFunc(function(t,n){var r=t.softplus(e.neg()).neg();return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.neg().sigmoid())}}})}}),Hg=Bd({neg_:function(t){var e=kd(t,"x","neg"),n=[e];return zh.runKernelFunc(function(t){return t.neg(e)},{x:e},function(t){return{x:function(){return t.neg()}}},"Neg",{},n)}}),Gg=Bd({reciprocal_:function(t){var e=kd(t,"x","reciprocal");return zh.runKernelFunc(function(t,n){var r=t.reciprocal(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.square().neg())}}})}}),qg=Bd({round_:function(t){var e=kd(t,"x","round");return zh.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return Qd(t)}}})}}),Kg=Bd({rsqrt_:function(t){var e=kd(t,"x","rsqrt"),n=[e];return zh.runKernelFunc(function(t,n){var r=t.rsqrt(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return t.div(n.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),Zg=Bd({sigmoid_:function(t){var e=kd(t,"x","sigmoid");return zh.runKernelFunc(function(t,n){var r=t.sigmoid(e);return n([r]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return t.mul(n.mul(Vd(1).sub(n)))}}},"Sigmoid")}}),Xg=Bd({sign_:function(t){var e=kd(t,"x","sign");return zh.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return Qd(t)}}})}}),$g=Bd({isNaN_:function(t){var e=kd(t,"x","isNaN");return zh.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return Qd(t)}}})}}),Yg=Bd({isInf_:function(t){var e=kd(t,"x","isInf");return zh.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return Qd(t)}}})}}),Jg=Bd({isFinite_:function(t){var e=kd(t,"x","isFinite");return zh.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return Qd(t)}}})}}),Qg=Bd({sin_:function(t){var e=kd(t,"x","sin"),n=[e];return zh.runKernelFunc(function(t,n){var r=t.sin(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return n.toFloat().cos().mul(t)}}},"Sin",{},n)}}),ty=Bd({sinh_:function(t){var e=kd(t,"x","sinh");return zh.runKernelFunc(function(t,n){var r=t.sinh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return n.toFloat().cosh().mulStrict(t)}}})}}),ey=Bd({softplus_:function(t){var e=kd(t,"x","softplus");return zh.runKernelFunc(function(t,n){var r=t.softplus(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.sigmoid())}}})}}),ny=Bd({sqrt_:function(t){var e=kd(t,"x","sqrt");return zh.runKernelFunc(function(t,n){var r=t.sqrt(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat().sqrt().mul(2))}}})}}),ry=Bd({step_:function(t,e){void 0===e&&(e=0);var n=kd(t,"x","step");return zh.runKernelFunc(function(t){return t.step(n,e)},{$x:n},function(t){return{$x:function(){return Qd(t)}}})}}),iy=Bd({tan_:function(t){var e=kd(t,"x","tan");return zh.runKernelFunc(function(t,n){var r=t.tan(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.cos().square())}}})}}),oy=Bd({tanh_:function(t){var e=kd(t,"x","tanh");return zh.runKernelFunc(function(t,n){var r=t.tanh(e);return n([r]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return Vd(1).sub(n.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}});function ay(t,e,n,r,i,o){var a,s,u=kd(t,"x","batchNorm"),c=kd(e,"mean","batchNorm"),l=kd(n,"variance","batchNorm");return null!=i&&(a=kd(i,"scale","batchNorm")),null!=r&&(s=kd(r,"offset","batchNorm")),jl(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),jl(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),jl(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),null!=a&&jl(2===a.rank||1===a.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),null!=s&&jl(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),cy(u,c,l,s,a,o)}function sy(t,e,n,r,i,o){var a,s,u=kd(t,"x","batchNorm"),c=kd(e,"mean","batchNorm"),l=kd(n,"variance","batchNorm");return null!=i&&(a=kd(i,"scale","batchNorm")),null!=r&&(s=kd(r,"offset","batchNorm")),jl(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),jl(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),jl(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),null!=a&&jl(3===a.rank||1===a.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),null!=s&&jl(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),cy(u,c,l,s,a,o)}function uy(t,e,n,r,i,o){var a,s,u=kd(t,"x","batchNorm"),c=kd(e,"mean","batchNorm"),l=kd(n,"variance","batchNorm");return null!=i&&(a=kd(i,"scale","batchNorm")),null!=r&&(s=kd(r,"offset","batchNorm")),jl(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),jl(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),jl(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),null!=a&&jl(4===a.rank||1===a.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),null!=s&&jl(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),cy(u,c,l,s,a,o)}function cy(t,e,n,r,i,o){null==o&&(o=.001);var a,s,u,c=kd(t,"x","batchNorm"),l=kd(e,"mean","batchNorm"),h=kd(n,"variance","batchNorm");null!=i&&(a=kd(i,"scale","batchNorm")),null!=r&&(s=kd(r,"offset","batchNorm")),jl(l.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),jl(null==s||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),jl(null==a||l.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var d=[c,l,h,a];return zh.runKernelFunc(function(t,e){var n=t.batchNormalization(u,ly(l),ly(h),o,ly(a),ly(s));return e([c,l,h,a]),n},{x:c,mean:l,variance:h,scale:a,offset:s},function(t,e){var n=e,r=n[0],i=n[1],a=n[2],s=n[3],c=null==s?Vd(1):s,l=ff(i.shape,u.shape),h=[];if(1===i.rank){for(var d=0;d<u.shape.length-1;++d)h.push(u.shape[d]);h.push(1)}var p=r.sub(i),f=t.mul(c),m=Kg(a.add(Vd(o))),v=m.mul(m).mul(m).mul(Vd(-.5));return{x:function(){return 1===i.rank?t.mul(Up(m.as4D(1,1,1,i.shape[0]),h)).mul(c).reshape(r.shape):t.mul(m).mul(c).reshape(r.shape)},mean:function(){var t=m.mul(Vd(-1)).mul(f);return 1===i.rank&&(t=t.sum(l)),t.reshape(i.shape)},variance:function(){var t=v.mul(p).mul(f);return 1===i.rank&&(t=t.sum(l)),t.reshape(i.shape)},scale:function(){var e=p.mul(m),n=t.mul(e);return 1===i.rank&&(n=n.sum(l)),n.reshape(i.shape)},offset:function(){var e=t;return 1===i.rank&&(e=e.sum(l)),e.reshape(i.shape)}}},"BatchNormalization",{varianceEpsilon:o},d).reshape(c.shape)}function ly(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function hy(){wd()}var dy=Bd({batchNormalization2d_:function(t,e,n,r,i,o){return void 0===r&&(r=.001),hy(),ay(t,e,n,o,i,r)}}),py=Bd({batchNormalization3d_:function(t,e,n,r,i,o){return void 0===r&&(r=.001),hy(),sy(t,e,n,o,i,r)}}),fy=Bd({batchNormalization4d_:function(t,e,n,r,i,o){return void 0===r&&(r=.001),hy(),uy(t,e,n,o,i,r)}}),my=Bd({batchNormalization_:function(t,e,n,r,i,o){return void 0===r&&(r=.001),hy(),cy(t,e,n,o,i,r)}}),vy=Bd({batchNorm_:cy}),gy=Bd({batchNorm2d_:ay}),yy=Bd({batchNorm3d_:sy}),xy=Bd({batchNorm4d_:uy}),by=Bd({logicalAnd_:function(t,e){var n=kd(t,"a","logicalAnd","bool"),r=kd(e,"b","logicalAnd","bool");return mf(n.shape,r.shape),zh.runKernelFunc(function(t){return t.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),wy=Bd({logicalNot_:function(t){var e=kd(t,"x","logicalNot","bool");return zh.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),_y=Bd({logicalOr_:function(t,e){var n=kd(t,"a","logicalOr","bool"),r=kd(e,"b","logicalOr","bool");return mf(n.shape,r.shape),zh.runKernelFunc(function(t){return t.logicalOr(n,r)},{$a:n,$b:r})}}),Ey=Bd({logicalXor_:function(t,e){var n=kd(t,"a","logicalXor","bool"),r=kd(e,"b","logicalXor","bool");return mf(n.shape,r.shape),_y(t,e).logicalAnd(by(t,e).logicalNot())}}),Cy=Bd({where_:function(t,e,n){var r=kd(e,"a","where"),i=kd(n,"b","where"),o=kd(t,"condition","where","bool");return zl(r.shape,i.shape,"Error in where: "),1===o.rank?jl(o.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):zl(o.shape,i.shape,"Error in where: "),zh.runKernelFunc(function(t,e){var n=t.select(o,r,i);return e([o]),n},{$condition:o,$a:r,$b:i},function(t,e){var n=e[0];return{$condition:function(){return Qd(n).toFloat()},$a:function(){return t.mul(n.cast(t.dtype))},$b:function(){return t.mul(n.logicalNot().cast(t.dtype))}}})}}),Iy=function(t){return Il(this,0,void 0,function(){var e,n,r;return Sl(this,function(i){switch(i.label){case 0:return[4,(e=kd(t,"condition","whereAsync","bool")).data()];case 1:return n=i.sent(),r=qf(e.shape,n),t!==e&&e.dispose(),[2,r]}})})},Sy=Bd({add_:function(t,e){var n,r=kd(t,"a","add"),i=kd(e,"b","add");n=Oh(r,i),r=n[0],i=n[1];var o=mf(r.shape,i.shape);return zh.runKernelFunc(function(t){return t.add(r,i)},{a:r,b:i},function(t){return{a:function(){var e=t,n=ff(r.shape,o);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},b:function(){var e=t,n=ff(i.shape,o);return n.length>0&&(e=e.sum(n)),e.reshape(i.shape)}}},"Add")}}),ky=Bd({addN_:function(t){jl(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),jl(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var e=t.map(function(t,e){return kd(t,"tensors"+e,"addN")}),n=e[0];e.forEach(function(t){if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(t){if(!Hl(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return zh.runKernelFunc(function(t){return t.addN(e)},r,function(t){var n={};return e.forEach(function(e,r){n[r]=function(){return t.clone()}}),n},"AddN")}}),Ty=Bd({addStrict_:function(t,e){var n=kd(t,"a","addStrict"),r=kd(e,"b","addStrict");return zl(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),Ny=Bd({atan2_:function(t,e){var n,r=kd(t,"a","atan2"),i=kd(e,"b","atan2");n=Oh(r,i),r=n[0],i=n[1];var o=mf(r.shape,i.shape);return zh.runKernelFunc(function(t,e){var n=t.atan2(r,i);return e([r,i]),n},{$a:r,$b:i},function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=Sy(n.square(),r.square()),i=t.mul(r.div(e)),a=ff(n.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(n.shape)},$b:function(){var e=Sy(n.square(),r.square()),i=Hg(t.mul(n.div(e))),a=ff(r.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(r.shape)}}})}}),Ry=Bd({div_:function(t,e){var n,r=kd(t,"a","div"),i=kd(e,"b","div");if(n=Oh(r,i),r=n[0],i=n[1],"int32"===r.dtype&&"int32"===i.dtype)return Dy(r,i);var o=mf(r.shape,i.shape);return zh.runKernelFunc(function(t,e){var n=t.realDivide(r,i);return e([r,i]),n},{a:r,b:i},function(t,e){var n=e[0],r=e[1];return{a:function(){var e=t.div(r.toFloat()),i=ff(n.shape,o);return i.length>0?e.sum(i).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),i=ff(r.shape,o);i.length>0&&(e=e.sum(i).reshape(r.shape));var a=r.square();return e.div(a.toFloat()).neg()}}},"Div")}}),Ay=Bd({divNoNan_:function(t,e){var n,r=kd(t,"a","div"),i=kd(e,"b","div");r=(n=Oh(r,i))[0],i=n[1];var o=Ry(r,i),a=Qd(o),s=i.equal(a);return Cy(s,a,o)}}),Py=Bd({divStrict_:function(t,e){var n=kd(t,"a","div"),r=kd(e,"b","div");return zl(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),Dy=Bd({floorDiv_:function(t,e){var n,r=kd(t,"a","floorDiv"),i=kd(e,"b","floorDiv");n=Oh(r,i),r=n[0],i=n[1];var o=mf(r.shape,i.shape);return zh.runKernelFunc(function(t,e){var n=t.floorDiv(r,i);return e([r,i]),n},{a:r,b:i},function(t,e){var n=e[0],r=e[1];return{a:function(){var e=t.div(r.toFloat()),i=ff(n.shape,o);return i.length>0?e.sum(i).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),i=ff(r.shape,o);i.length>0&&(e=e.sum(i).reshape(r.shape));var a=r.square();return e.div(a.toFloat()).neg()}}},"FloorDiv")}}),My=Bd({maximum_:function(t,e){var n,r=kd(t,"a","maximum"),i=kd(e,"b","maximum");return n=Oh(r,i),r=n[0],i=n[1],"bool"===r.dtype&&(r=r.toInt(),i=i.toInt()),mf(r.shape,i.shape),zh.runKernelFunc(function(t,e){var n=t.maximum(r,i);return e([r,i]),n},{a:r,b:i},function(t,e){var n=e[0],r=e[1];return{a:function(){return t.mul(n.greaterEqual(r).toFloat())},b:function(){return t.mul(n.less(r).toFloat())}}},"Maximum")}}),Oy=Bd({maximumStrict_:function(t,e){var n=kd(t,"a","maximumStrict"),r=kd(e,"b","maximumStrict");return zl(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),Ly=Bd({minimum_:function(t,e){var n,r=kd(t,"a","minimum"),i=kd(e,"b","minimum");return n=Oh(r,i),r=n[0],i=n[1],"bool"===r.dtype&&(r=r.toInt(),i=i.toInt()),mf(r.shape,i.shape),zh.runKernelFunc(function(t,e){var n=t.minimum(r,i);return e([r,i]),n},{a:r,b:i},function(t,e){var n=e[0],r=e[1];return{a:function(){return t.mul(n.lessEqual(r).toFloat())},b:function(){return t.mul(n.greater(r).toFloat())}}},"Minimum")}}),By=Bd({minimumStrict_:function(t,e){var n=kd(t,"a","minimumStrict"),r=kd(e,"b","minimumStrict");return zl(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Fy=Bd({mod_:function(t,e){var n,r=kd(t,"a","mod"),i=kd(e,"b","mod");n=Oh(r,i),r=n[0],i=n[1];var o=mf(r.shape,i.shape);return zh.runKernelFunc(function(t,e){var n=t.mod(r,i);return e([r,i]),n},{$a:r,$b:i},function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=ff(n.shape,o);return e.length>0?t.sum(e).reshape(n.shape):t},$b:function(){var e=t.mul(n.div(r).floor().neg()),i=ff(r.shape,o);return i.length>0?e.sum(i).reshape(r.shape):e}}})}}),jy=Bd({modStrict_:function(t,e){var n=kd(t,"a","modStrict"),r=kd(e,"b","modStrict");return zl(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),zy=Bd({mul_:function(t,e){var n,r=kd(t,"a","mul"),i=kd(e,"b","mul");n=Oh(r,i),r=n[0],i=n[1];var o=mf(r.shape,i.shape);return zh.runKernelFunc(function(t,e){var n=t.multiply(r,i);return e([r,i]),n},{a:r,b:i},function(t,e){var n=e[0],r=e[1];return{a:function(){var e=t.mul(r.toFloat()),i=ff(n.shape,o);return i.length>0?e.sum(i).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),i=ff(r.shape,o);return i.length>0?e.sum(i).reshape(r.shape):e}}},"Mul")}}),Wy=Bd({mulStrict_:function(t,e){var n=kd(t,"a","mul"),r=kd(e,"b","mul");return zl(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Uy=Bd({pow_:function(t,e){var n,r=kd(t,"base","pow"),i=kd(e,"exp","pow");n=Oh(r,i),r=n[0],i=n[1];var o=mf(r.shape,i.shape),a=[r,i];return zh.runKernelFunc(function(t,e){var n=t.pow(r,i);return e([r,i,n]),n},{a:r,b:i},function(t,e){var n=e[0],r=e[1],i=e[2];return{a:function(){var e=r.toFloat(),i=t.mul(e.mul(n.pow(e.sub(Vd(1))))),a=ff(n.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(n.shape)},b:function(){var e=n.greater(0),a=n.log().where(e,Qd(n)),s=t.mul(i.mul(a)),u=ff(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}},"Pow",{},a,[!0])}}),Vy=Bd({powStrict_:function(t,e){return zl(t.shape,e.shape,"Error in powStrict: "),t.pow(e)}}),Hy=Bd({squaredDifferenceStrict_:function(t,e){var n=kd(t,"a","squaredDifferenceStrict"),r=kd(e,"b","squaredDifferenceStrict");return zl(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),Gy=Bd({sub_:function(t,e){var n,r=kd(t,"a","sub"),i=kd(e,"b","sub");n=Oh(r,i),r=n[0],i=n[1];var o=mf(r.shape,i.shape);return zh.runKernelFunc(function(t){return t.subtract(r,i)},{a:r,b:i},function(t){return{a:function(){var e=t,n=ff(r.shape,o);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},b:function(){var e=t,n=ff(i.shape,o);return n.length>0&&(e=e.sum(n)),e.neg().reshape(i.shape)}}},"Sub")}}),qy=Bd({subStrict_:function(t,e){var n=kd(t,"a","subStrict"),r=kd(e,"b","subStrict");return zl(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),Ky=Bd({equal_:function(t,e){var n,r=kd(t,"a","equal"),i=kd(e,"b","equal");return n=Oh(r,i),r=n[0],i=n[1],mf(r.shape,i.shape),zh.runKernelFunc(function(t){return t.equal(r,i)},{$a:r,$b:i})}}),Zy=Bd({equalStrict_:function(t,e){var n=kd(t,"a","equalStrict"),r=kd(e,"b","equalStrict");return zl(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),Xy=Bd({greater_:function(t,e){var n,r=kd(t,"a","greater"),i=kd(e,"b","greater");return n=Oh(r,i),r=n[0],i=n[1],mf(r.shape,i.shape),zh.runKernelFunc(function(t){return t.greater(r,i)},{a:r,b:i},null,"Greater")}}),$y=Bd({greaterEqual_:function(t,e){var n,r=kd(t,"a","greaterEqual"),i=kd(e,"b","greaterEqual");return n=Oh(r,i),r=n[0],i=n[1],mf(r.shape,i.shape),zh.runKernelFunc(function(t,e){var n=t.greaterEqual(r,i);return e([r,i]),n},{a:r,b:i},function(t,e){var n=e[0],r=e[1];return{a:function(){return Qd(n)},b:function(){return Qd(r)}}},"GreaterEqual")}}),Yy=Bd({greaterEqualStrict_:function(t,e){var n=kd(t,"a","greaterEqualStrict"),r=kd(e,"b","greaterEqualStrict");return zl(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),Jy=Bd({greaterStrict_:function(t,e){var n=kd(t,"a","greaterStrict"),r=kd(e,"b","greaterStrict");return zl(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),Qy=Bd({less_:function(t,e){var n,r=kd(t,"a","less"),i=kd(e,"b","less");return n=Oh(r,i),r=n[0],i=n[1],mf(r.shape,i.shape),zh.runKernelFunc(function(t){return t.less(r,i)},{a:r,b:i},null,"Less")}}),tx=Bd({lessEqual_:function(t,e){var n,r=kd(t,"a","lessEqual"),i=kd(e,"b","lessEqual");return n=Oh(r,i),r=n[0],i=n[1],mf(r.shape,i.shape),zh.runKernelFunc(function(t,e){var n=t.lessEqual(r,i);return e([r,i]),n},{a:r,b:i},null,"LessEqual")}}),ex=Bd({lessEqualStrict_:function(t,e){var n=kd(t,"a","lessEqualStrict"),r=kd(e,"b","lessEqualStrict");return zl(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),nx=Bd({lessStrict_:function(t,e){var n=kd(t,"a","lessStrict"),r=kd(e,"b","lessStrict");return zl(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),rx=Bd({notEqual_:function(t,e){var n,r=kd(t,"a","notEqual"),i=kd(e,"b","notEqual");return n=Oh(r,i),r=n[0],i=n[1],mf(r.shape,i.shape),zh.runKernelFunc(function(t){return t.notEqual(r,i)},{a:r,b:i},null,"NotEqual")}}),ix=Bd({notEqualStrict_:function(t,e){var n=kd(t,"a","notEqualStrict"),r=kd(e,"b","notEqualStrict");return zl(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function ox(t,e){for(var n=[],r=t;r<e;++r)n.push(r);return n}function ax(t){for(var e=[],n=0;n<t.length;++n)for(var r=0;r<t[n].length;++r)e.push(t[n][r]);return e}var sx=Bd({gather_:function(t,e,n){void 0===n&&(n=0);var r=kd(t,"x","gather"),i=kd(e,"indices","gather","int32");n=$l(n,r.shape)[0];var o=function(t,e,n){for(var r=t.shape[n],i=[],o=1,a=1,s=0;s<n;s++)i.push(t.shape[s]),o*=t.shape[s];for(s=0;s<e.rank;s++)i.push(e.shape[s]);for(s=n+1;s<t.rank;s++)i.push(t.shape[s]),a*=t.shape[s];return{batchSize:o,sliceSize:a,dimSize:r,outputShape:i}}(r,i,n);return zh.runKernelFunc(function(t,e){var o=t.gather(r,i.flatten(),n);return e([i]),o},{x:r,indices:i},function(t,e){var i=e[0];return{x:function(){var e=r.shape,o=i.size,a=e.slice(0,n),s=a.length,u=e.slice(n,e.length).slice(1),c=u.length,l=ox(0,s),h=ox(s+1,s+1+c),d=ax([a,[o],u]),p=t.reshape(d),f=i.reshape([o]),m=ax([[s],l,h]),v=p.transpose(m),g=ux(v,f,r.shape[n]),y=Md(m);return g.transpose(y)},indices:function(){return i}}},"Gather",{axis:n}).reshape(o.outputShape)}}),ux=Bd({unsortedSegmentSum_:function(t,e,n){var r=kd(t,"x","unsortedSegmentSum"),i=kd(e,"segmentIds","unsortedSegmentSum","int32");return jl(Gl(n),function(){return"numSegments must be of dtype int"}),zh.runKernelFunc(function(t,e){var o=t.unsortedSegmentSum(r,i,n);return e([i]),o},{$x:r},function(t,e){var n=e[0];return{$x:function(){return function(t,e){for(var n=My(e,Qd(e)),r=sx(t,n),i=$y(e,Vd(0,"int32")),o=r.rank-i.rank,a=0;a<o;++a)i=Ip(i,a+1);i=by(i,Zd(r.shape,"bool"));var s=Qd(r);return Cy(i,r,s)}(t,n)}}})}});function cx(t,e,n,r,i,o,a){void 0===o&&(o="NHWC"),jl(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var s=t,u=e,c=!1;3===e.rank&&(c=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=[1,t[0],t[1],t[2]]),jl(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),jl(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),jl(4===n.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var l="NHWC"===o?s[3]:s[1],h="NHWC"===o?u.shape[3]:u.shape[1];jl(l===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."}),jl(h===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[3]+"."}),null!=a&&jl(Gl(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var d=kf(o),p=yf(s,n.shape,r,1,i,a,!1,d),f=zh.runKernelFunc(function(t,e){var r=t.conv2dDerInput(u,n,p);return e([n,u]),r},{dy4D:u,filter:n},function(t,e){var n=e[0],s=e[1];return{dy4D:function(){return px(t,n,r,i,o,1,a)},filter:function(){return mx(t,s,n.shape,r,i,o,a)}}});return c?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function lx(t){var e,n="number"==typeof(e=t)?[e,e,e]:2===e.length?[e[0],e[1],1]:e,r=n[0],i=n[1],o=n[2];return 1===r&&1===i&&1===o}function hx(t,e,n,r,i){jl(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var o=t,a=e,s=!1;4===e.rank&&(s=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,t[0],t[1],t[2],t[3]]);var u=o[4],c=a.shape[4];jl(5===o.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),jl(5===a.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),jl(5===n.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),jl(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),jl(c===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[4]+"."});var l=xf(o,n.shape,r,1,i),h=zh.runKernelFunc(function(t){return t.conv3dDerInput(a,n,l)},{dy5D:a});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var dx=Bd({conv1d_:function(t,e,n,r,i,o,a){void 0===i&&(i="NWC"),void 0===o&&(o=1);var s=kd(t,"x","conv1d"),u=kd(e,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),jl(3===c.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),jl(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=a&&jl(Gl(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),jl(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),jl(Sf(n,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+o+"'"}),jl("NWC"===i,function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),p=px(d,h,[1,n],r,"NHWC",[1,o],a);return l?p.as2D(p.shape[2],p.shape[3]):p.as3D(p.shape[0],p.shape[2],p.shape[3])}}),px=Bd({conv2d_:function(t,e,n,r,i,o,a){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var s=kd(t,"x","conv2d"),u=kd(e,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),jl(4===c.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),jl(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=a&&jl(Gl(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var h="NHWC"===i?c.shape[3]:c.shape[1];jl(h===u.shape[2],function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."}),jl(Sf(n,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"});var d=kf(i),p=yf(c.shape,u.shape,n,o,r,a,!1,d),f=[u,c],m=zh.runKernelFunc(function(t,e){var n=t.conv2d(c,u,p);return e([u,c]),n},{x:c,filter:u},function(t,e){var a=e,s=a[0],u=a[1];return jl(If(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return vx(u.shape,t,s,n,r,i)},filter:function(){return mx(u,t,s.shape,n,r,i)}}},"Conv2D",p,f);return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),fx=Bd({conv3d_:function(t,e,n,r,i,o){void 0===i&&(i="NDHWC"),void 0===o&&(o=[1,1,1]);var a,s=kd(t,"x","conv3d"),u=kd(e,"filter","conv3d"),c=s,l=!1;4===s.rank&&(l=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),jl(5===c.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+c.rank+"."}),jl(5===u.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+u.rank+"."}),jl(c.shape[4]===u.shape[3],function(){return"Error in conv3d: depth of input ("+c.shape[4]+") must match input depth for filter "+u.shape[3]+"."}),jl((a=o,lx(n)||lx(a)),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),jl("NDHWC"===i,function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var h=xf(c.shape,u.shape,n,o,r),d=zh.runKernelFunc(function(t,e){var n=t.conv3d(c,u,h);return e([c,u]),n},{x:c,$filter:u},function(t,e){jl(lx(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var i=e[0],a=e[1];return{x:function(){return hx(i.shape,t,a,n,r)},$filter:function(){return function(t,e,n,r,i){var o=t;4===t.rank&&(o=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]));var a=e;4===a.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3])),jl(5===o.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+o.shape+"."}),jl(5===a.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+a.shape+"."}),jl(5===n.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."}),jl(o.shape[4]===n[3],function(){return"Error in conv3dDerFilter: depth of input "+o.shape[4]+") must match input depth in filter ("+n[3]+"."}),jl(a.shape[4]===n[4],function(){return"Error in conv3dDerFilter: depth of dy ("+a.shape[4]+") must match output depth for filter ("+n[4]+")."});var s=xf(o.shape,n,r,1,i);return zh.runKernelFunc(function(t){return t.conv3dDerFilter(o,a,s)},{x5D:o,dy5D:a})}(i,t,a.shape,n,r)}}});return l?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}}),mx=Bd({conv2dDerFilter_:function(t,e,n,r,i,o,a){void 0===o&&(o="NHWC");var s=t;3===t.rank&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var u=e;3===u.rank&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),jl(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),jl(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),jl(4===n.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var c="NHWC"===o?s.shape[3]:s.shape[1],l="NHWC"===o?u.shape[3]:u.shape[1];jl(c===n[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+n[2]+"."}),jl(l===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+n[3]+")."}),null!=a&&jl(Gl(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var h=kf(o),d=yf(s.shape,n,r,1,i,a,!1,h);return zh.runKernelFunc(function(t){return t.conv2dDerFilter(s,u,d)},{x4D:s,dy4D:u})}}),vx=Bd({conv2dDerInput_:cx}),gx=Bd({depthwiseConv2d_:function(t,e,n,r,i,o,a){void 0===o&&(o=[1,1]);var s=kd(t,"x","depthwiseConv2d"),u=kd(e,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),jl(4===c.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),jl(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),jl(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==o&&(o=[1,1]),jl(Sf(n,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}),null!=a&&jl(Gl(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var h=yf(c.shape,u.shape,n,o,r,a,!0),d=[c,u],p=zh.runKernelFunc(function(t,e){var n=t.depthwiseConv2D(c,u,h);return e([c,u]),n},{x:c,filter:u},function(t,e){jl(If(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var n=e[0],r=e[1];return{x:function(){return yx(n.shape,t,r,h)},filter:function(){return xx(n,t,r.shape,h)}}},"DepthwiseConv2dNative",h,d);return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),yx=Bd({depthwiseConv2dDerInput_:function(t,e,n,r){var i=e,o=!1;3===e.rank&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=zh.runKernelFunc(function(t){return t.depthwiseConv2DDerInput(i,n,r)},{dy4D:i});return o?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),xx=Bd({depthwiseConv2dDerFilter_:function(t,e,n,r){var i=t;3===t.rank&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=e;return 3===o.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),zh.runKernelFunc(function(t){return t.depthwiseConv2DDerFilter(i,o,r)},{x4D:i,dy4D:o})}}),bx=Bd({separableConv2d_:function(t,e,n,r,i,o,a){void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC");var s=kd(t,"x","separableConv2d"),u=kd(e,"depthwiseFilter","separableConv2d"),c=kd(n,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(3===s.rank&&(h=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");jl(4===l.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),jl(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),jl(4===c.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),jl(1===c.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),jl(1===c.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var d=u.shape[2],p=u.shape[3];jl(c.shape[2]===d*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*p+", but got "+c.shape[2]+"."});var f=gx(l,u,r,i,a,o),m=px(f,c,1,"valid",a);return h?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),wx=Bd({conv2dTranspose_:function(t,e,n,r,i,o){return cx(n,kd(t,"x","conv2dTranspose"),kd(e,"filter","conv2dTranspose"),r,i,"NHWC",o)}}),_x=Bd({conv3dTranspose_:function(t,e,n,r,i){return hx(n,kd(t,"x","conv3dTranspose"),kd(e,"filter","conv3dTranspose"),r,i)}}),Ex=Bd({matMul_:function(t,e,n,r){var i;void 0===n&&(n=!1),void 0===r&&(r=!1);var o=kd(t,"a","matMul"),a=kd(e,"b","matMul");i=Oh(o,a),o=i[0],a=i[1];var s=n?o.shape[o.rank-2]:o.shape[o.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],c=n?o.shape[o.rank-1]:o.shape[o.rank-2],l=r?a.shape[a.rank-2]:a.shape[a.rank-1],h=o.shape.slice(0,-2),d=a.shape.slice(0,-2),p=Vl(h),f=Vl(d);jl(o.rank>=2&&a.rank>=2&&o.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+a.rank+"."}),jl(Hl(h,d),function(){return"Error in matMul: outer dimensions ("+h+") and ("+d+") of Tensors with shapes "+o.shape+" and "+a.shape+" must match."}),jl(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+o.shape+" and "+a.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var m=o.shape.slice(0,-2).concat([c,l]),v=n?o.as3D(p,s,c):o.as3D(p,c,s),g=r?a.as3D(f,l,u):a.as3D(f,u,l),y={transposeA:n,transposeB:r};return zh.runKernelFunc(function(t,e){var i=t.batchMatMul(v,g,n,r);return e([v,g]),i},{a:v,b:g},function(t,e){var i=e,o=i[0],a=i[1];return n||r?!n&&r?{a:function(){return t.matMul(a,!1,!1)},b:function(){return t.matMul(o,!0,!1)}}:n&&!r?{a:function(){return a.matMul(t,!1,!0)},b:function(){return o.matMul(t,!1,!1)}}:{a:function(){return a.matMul(t,!0,!0)},b:function(){return t.matMul(o,!0,!0)}}:{a:function(){return t.matMul(a,!1,!0)},b:function(){return o.matMul(t,!0,!1)}}},"BatchMatMul",y).reshape(m)}}),Cx=Bd({dot_:function(t,e){var n=kd(t,"t1","dot"),r=kd(e,"t2","dot");jl(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var i=1===n.rank?n.size:n.shape[1],o=1===r.rank?r.size:r.shape[0];return jl(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),Ix=Bd({outerProduct_:function(t,e){var n=kd(t,"v1","outerProduct"),r=kd(e,"v2","outerProduct");return jl(1===n.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),Sx=Bd({reverse_:function(t,e){var n=kd(t,"x","reverse");if(0===n.rank)return n.clone();var r=$l(e,n.shape);return zh.runKernelFunc(function(t){return t.reverse(n,r)},{$x:n},function(t){return{$x:function(){return t.reverse(r)}}}).reshapeAs(n)}}),kx=Bd({reverse1d_:function(t){var e=kd(t,"x","reverse");return jl(1===e.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Sx(e,0)}}),Tx=Bd({reverse2d_:function(t,e){var n=kd(t,"x","reverse");return jl(2===n.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),Sx(n,e)}}),Nx=Bd({reverse3d_:function(t,e){var n=kd(t,"x","reverse");return jl(3===n.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),Sx(n,e)}}),Rx=Bd({reverse4d_:function(t,e){var n=kd(t,"x","reverse");return jl(4===n.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),Sx(n,e)}});function Ax(t,e,n,r,i,o){var a=kd(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),jl(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),jl(Sf(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),null!=o&&jl(Gl(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var c=vf(s.shape,e,n,r,i,o);if(1===c.filterWidth&&1===c.filterHeight&&Hl(c.inShape,c.outShape))return a.clone();var l=[s],h=zh.runKernelFunc(function(t,e){var n=t.maxPool(s,c);return e([s,n]),n},{x:s},function(t,o){var a=o[0],s=o[1];return{x:function(){return function(t,e,n,r,i,o,a){var s=kd(t,"dy","maxPoolBackprop"),u=kd(e,"input","maxPoolBackprop"),c=kd(n,"output","maxPoolBackprop");jl(u.rank===s.rank,function(){return"Rank of input ("+u.rank+") does not match rank of dy ("+s.rank+")"}),jl(Sf(i,o),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"}),jl(4===s.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+s.rank+"."}),jl(4===u.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var l=vf(u.shape,r,i,o,a,void 0);return zh.runKernelFunc(function(t){return t.maxPoolBackprop(s,u,c,l)},{$dy:s,$input:u})}(t,a,s,e,n,r,i)}}},"MaxPool",c,l);return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function Px(t,e,n,r,i,o){var a=kd(t,"x","avgPool","float32");jl(Sf(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),jl(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=o&&jl(Gl(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var c=vf(s.shape,e,n,r,i,o);if(1===c.filterWidth&&1===c.filterHeight&&Hl(c.inShape,c.outShape))return a.clone();var l=zh.runKernelFunc(function(t){return t.avgPool(s,c)},{x:s},function(t){return{x:function(){return function(t,e,n,r,i,o){var a=kd(t,"dy","avgPoolBackprop"),s=kd(e,"input","avgPoolBackprop");jl(s.rank===a.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+a.rank+")"}),jl(Sf(r,i),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"});var u=s,c=a,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),jl(4===c.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."}),jl(4===u.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var h=vf(u.shape,n,r,i,o),d=zh.runKernelFunc(function(t){return t.avgPoolBackprop(c,u,h)},{dy4D:c,input4D:u});return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}(t,s,e,n,r,i)}}},"AvgPool",c);return l=l.cast(a.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var Dx=Bd({maxPool_:function(t,e,n,r,i){return Ax(t,e,n,1,r,i)}}),Mx=Bd({avgPool_:function(t,e,n,r,i){return Px(t,e,n,1,r,i)}}),Ox=Bd({pool_:function(t,e,n,r,i,o){null==i&&(i=[1,1]),null==o&&(o=1),0===r&&(r="valid");var a=kd(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),jl(Sf(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var c,l,h,d,p,f,m=vf(s.shape,e,o,i,r),v=[m.dilationHeight,m.dilationWidth];c="same"===r?(l=[m.filterHeight,m.filterWidth],h=v,d=l.map(function(t,e){return t+(t-1)*(h[e]-1)}).map(function(t){return t-1}),p=d.map(function(t){return Math.floor(t/2)}),f=d.map(function(t,e){return t-p[e]}),d.map(function(t,e){return[p[e],f[e]]})):[[0,0],[0,0]];var g=1===v[0]&&1===v[1],y=function(t,e,n){var r=n.map(function(t){return t[0]}),i=n.map(function(t){return t[1]}),o=t.concat(r,i),a=e.map(function(t,e){return(t-o[e]%t)%t}),s=i.map(function(t,e){return t+a[e]});return[e.map(function(t,e){return[r[e],s[e]]}),e.map(function(t,e){return[0,a[e]]})]}([m.inHeight,m.inWidth],v,c),x=y[0],b=y[1],w=g?r:"valid",_=g?s:jp(s,v,x),E=("avg"===n?function(){return Px(_,e,o,1,w)}:function(){return Ax(_,e,o,1,w)})(),C=g?E:xp(E,v,b);return u?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),Lx=Bd({maxPool3d_:function(t,e,n,r,i,o,a){void 0===o&&(o="NDHWC");var s=kd(t,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),jl(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),jl("NDHWC"===o,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),jl(Sf(n,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),null!=i&&jl(Gl(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var l=gf(u.shape,e,n,a,r,i,o),h=zh.runKernelFunc(function(t,e){var n=t.maxPool3d(u,l);return e([u,n]),n},{x:u},function(t,o){var s=o[0],u=o[1];return{x:function(){return function(t,e,n,r,i,o,a,s){var u=kd(t,"dy","maxPool3dBackprop"),c=kd(e,"input","maxPool3dBackprop"),l=kd(n,"output","maxPool3dBackprop"),h=u,d=c,p=l,f=!1;4===c.rank&&(f=!0,h=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),d=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),p=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),jl(5===h.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+h.rank+"."}),jl(5===d.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+d.rank+"."}),jl(5===p.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+p.rank+"."}),null==o&&(o=[1,1,1]),jl(Sf(i,o),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"}),null!=s&&jl(Gl(a),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+a+"."});var m=gf(d.shape,r,i,o,a,s),v=zh.runKernelFunc(function(t){return t.maxPool3dBackprop(h,d,p,m)},{dy5D:h,input5D:d});return f?v.as4D(v.shape[1],v.shape[2],v.shape[3],v.shape[4]):v}(t,s,u,e,n,a,r,i)}}});return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Bx=Bd({avgPool3d_:function(t,e,n,r,i,o,a){void 0===o&&(o="NDHWC");var s=kd(t,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),jl(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),jl("NDHWC"===o,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),jl(Sf(n,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),null!=i&&jl(Gl(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var l=gf(u.shape,e,n,a,r,i,o),h=zh.runKernelFunc(function(t){return t.avgPool3d(u,l)},{x:u},function(t){return{x:function(){return function(t,e,n,r,i,o,a){var s=kd(t,"dy","avgPool3dBackprop"),u=kd(e,"input","avgPool3dBackprop"),c=s,l=u,h=!1;4===u.rank&&(h=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),jl(5===c.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."}),jl(5===l.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+l.rank+"."}),null==i&&(i=[1,1,1]),jl(Sf(r,i),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"}),null!=a&&jl(Gl(o),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var d=gf(l.shape,n,r,i,o,a),p=zh.runKernelFunc(function(t){return t.avgPool3dBackprop(c,l,d)},{dy5D:c,input5D:l});return h?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}(t,u,e,n,a,r,i)}}});return h=h.cast(u.dtype),c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Fx=Bd({slice_:function(t,e,n){var r,i,o=kd(t,"x","slice");if(0===o.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof e?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice()).forEach(function(t){jl(-1!==t,function(){return"slice() does not support negative begin indexing."})}),i=(i=null==n?new Array(o.rank).fill(-1):"number"==typeof n?[n].concat(new Array(o.rank-1).fill(-1)):n.length<o.rank?n.concat(new Array(o.rank-n.length).fill(-1)):n).map(function(t,e){return t>=0?t:(jl(-1===t,function(){return"Negative size values should be exactly -1 but got "+t+" for the slice() size at index "+e+"."}),o.shape[e]-r[e])}),function(t,e,n){jl(t.rank===e.length,function(){return"Error in slice"+t.rank+"D: Length of begin "+e+" must match the rank of the array ("+t.rank+")."}),jl(t.rank===n.length,function(){return"Error in slice"+t.rank+"D: Length of size "+n+" must match the rank of the array ("+t.rank+")."});for(var r=function(r){jl(e[r]+n[r]<=t.shape[r],function(){return"Error in slice"+t.rank+"D: begin["+r+"] + size["+r+"] ("+(e[r]+n[r])+") would overflow input.shape["+r+"] ("+t.shape[r]+")"})},i=0;i<t.rank;++i)r(i)}(o,r,i);var a=o.shape,s={begin:r,size:i};return zh.runKernelFunc(function(t){return t.slice(o,r,i)},{x:o},function(t){for(var e=[],n=0;n<t.rank;n++)e.push([r[n],a[n]-r[n]-i[n]]);return{x:function(){return t.pad(e)}}},"Slice",s)}}),jx=Bd({slice1d_:function(t,e,n){var r=kd(t,"x","slice1d");return jl(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Fx(r,[e],[n])}}),zx=Bd({slice2d_:function(t,e,n){var r=kd(t,"x","slice2d");return jl(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Fx(r,e,n)}}),Wx=Bd({slice3d_:function(t,e,n){var r=kd(t,"x","slice3d");return jl(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Fx(r,e,n)}}),Ux=Bd({slice4d_:function(t,e,n){var r=kd(t,"x","slice4d");return jl(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Fx(r,e,n)}});function Vx(t,e,n,r,i){return e.rank<n.rank&&(e=e.reshape(Ad(e.shape,r))),t.rank<n.rank&&(t=t.reshape(Ad(t.shape,r))),{x:function(){var r=t.mul(n.equal(e).cast(t.dtype));return null==i?r:r.transpose(i)}}}var Hx=Bd({all_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=kd(t,"x","all","bool"),i=$l(e,r.shape),o=i,a=Dd(o,r.rank);null!=a&&(r=r.transpose(a),o=Od(o.length,r.rank));var s=zh.runKernelFunc(function(t){return t.all(r,o)},{$x:r});if(n){var u=Ad(s.shape,i);return s.reshape(u)}return s}}),Gx=Bd({any_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=kd(t,"x","any","bool"),i=$l(e,r.shape),o=i,a=Dd(o,r.rank);null!=a&&(r=r.transpose(a),o=Od(o.length,r.rank));var s=zh.runKernelFunc(function(t){return t.any(r,o)},{$x:r});if(n){var u=Ad(s.shape,i);return s.reshape(u)}return s}}),qx=Bd({argMax_:function(t,e){void 0===e&&(e=0);var n=kd(t,"x","argMax");null==e&&(e=0);var r=$l(e,n.shape),i=Dd(r,n.rank);null!=i&&(n=n.transpose(i),r=Od(r.length,n.rank));var o={axis:r[0]},a=[n];return zh.runKernelFunc(function(t,e){var i=t.argMax(n,r[0]);return e([n]),i},{x:n},function(t,e){var n=e[0];return{x:function(){return Qd(n)}}},"ArgMax",o,a)}}),Kx=Bd({argMin_:function(t,e){void 0===e&&(e=0);var n=kd(t,"x","argMin");null==e&&(e=0);var r=$l(e,n.shape),i=Dd(r,n.rank);return null!=i&&(n=n.transpose(i),r=Od(r.length,n.rank)),zh.runKernelFunc(function(t,e){var i=t.argMin(n,r[0]);return e([n]),i},{$x:n},function(t,e){var n=e[0];return{$x:function(){return Qd(n)}}})}}),Zx=Bd({logSumExp_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=kd(t,"x","logSumExp"),i=$l(e,r.shape),o=r.max(i,!0),a=r.sub(o).exp().sum(i).log(),s=o.reshape(a.shape).add(a);if(n){var u=Ad(s.shape,i);return s.reshape(u)}return s}}),Xx=Bd({max_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=kd(t,"x","max"),i=r,o=$l(e,r.shape),a=o,s=Dd(a,r.rank);null!=s&&(r=r.transpose(s),a=Od(a.length,r.rank));var u=[r],c=zh.runKernelFunc(function(t,e){var n=t.max(r,a);return e([i,n]),n},{x:r},function(t,e){return Vx(t,e[1],e[0],o,s)},"Max",{axes:a},u,[!0]);if(n){var l=Ad(c.shape,o);c=c.reshape(l)}return c}}),$x=Bd({mean_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=kd(t,"x","mean"),i=$l(e,r.shape),o=Vl(Rd(r.shape,i)[1]);return sf(function(t){var r=Vd(o);return{value:(r.dtype===t.dtype?t:t.cast(r.dtype)).div(r).sum(e,n),gradFunc:function(e){var n=t.shape.slice();return i.forEach(function(t){n[t]=1}),e.reshape(n).mul(Zd(t.shape,"float32")).div(o)}}})(r)}}),Yx=Bd({min_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=kd(t,"x","min"),i=r,o=$l(e,r.shape),a=o,s=Dd(a,r.rank);null!=s&&(r=r.transpose(s),a=Od(a.length,r.rank));var u=[r],c=zh.runKernelFunc(function(t,e){var n=t.min(r,a);return e([i,n]),n},{x:r},function(t,e){return Vx(t,e[1],e[0],o,s)},"Min",{axes:a},u,[!0]);if(n){var l=Ad(c.shape,o);c=c.reshape(l)}return c}}),Jx=Bd({moments_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=$l(e,(t=kd(t,"x","moments")).shape),i=t.mean(r,n),o=i.shape;n||(o=Ad(i.shape,r));var a=t.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:a.mean(r,n)}}}),Qx=Bd({sum_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=kd(t,"x","sum");"bool"===r.dtype&&(r=r.toInt());var i=$l(e,r.shape);return sf(function(t){var e=Dd(i,t.rank),r=i,o=t;null!=e&&(o=t.transpose(e),r=Od(r.length,t.rank));var a=function(e){var n=t.shape.slice();return i.forEach(function(t){n[t]=1}),e.reshape(n).mul(Zd(t.shape,"float32"))},s={axes:r},u=zh.runKernelFunc(function(t){return t.sum(o,r)},{x:o},function(t){return{x:function(){return a(t)}}},"Sum",s);if(n){var c=Ad(u.shape,i);u=u.reshape(c)}return{value:u,gradFunc:a}})(r)}}),tb=Bd({prod_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=kd(t,"x","prod");"bool"===r.dtype&&(r=r.toInt());var i=$l(e,r.shape),o=Dd(i,r.rank),a=i,s=r;null!=o&&(s=r.transpose(o),a=Od(a.length,r.rank));var u=zh.runKernelFunc(function(t){return t.prod(s,a)},{permutedX:s});if(n){var c=Ad(u.shape,i);u=u.reshape(c)}return u}}),eb=Bd({elu_:function(t){var e=kd(t,"x","elu");return zh.runKernelFunc(function(t,n){var r=t.elu(e);return n([r]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return zh.runKernelFunc(function(e){return e.eluDer(t,n)},{dy:t,y:n})}}})}}),nb=Bd({leakyRelu_:function(t,e){void 0===e&&(e=.2);var n=kd(t,"x","leakyRelu");return My(Vd(e).mul(n),n)}}),rb=Bd({prelu_:function(t,e){var n=kd(t,"x","prelu"),r=kd(e,"alpha","prelu");return zh.runKernelFunc(function(t,e){var i=t.prelu(n,r);return e([n,r]),i},{x:n,alpha:r},function(t,e){var n=e[0],r=e[1],i=n.greater(0);return{x:function(){return Cy(i,t,t.mul(r))},alpha:function(){var e=Cy(i,Qd(t),t.mul(n)),o=ff(r.shape,t.shape);return o.length>0&&(e=e.sum(o)),e.reshape(r.shape)}}},"Prelu")}}),ib=Bd({relu_:function(t){var e=kd(t,"x","relu");return"bool"===e.dtype?e.toInt():zh.runKernelFunc(function(t,n){var r=t.relu(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return t.mulStrict(n.step().toFloat())}}},"Relu")}}),ob=Bd({relu6_:function(t){var e=kd(t,"x","relu6");return"bool"===e.dtype?e.toInt():zh.runKernelFunc(function(t,n){var r=t.relu6(e);return n([e]),r},{x:e},function(t,e){var n=e[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return t.mulStrict(r.toFloat())}}},"Relu6")}}),ab=Bd({selu_:function(t){var e=kd(t,"x","selu");return zh.runKernelFunc(function(t,n){var r=t.selu(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){var e=n.greater(Vd(0)),r=Vd(qv),i=Vd(Kv),o=t.mul(i),a=t.mul(r).mul(n.toFloat().exp());return Cy(e,o,a)}}})}}),sb=Bd({transpose_:function(t,e){var n=kd(t,"x","transpose");if(null==e&&(e=n.shape.map(function(t,e){return e}).reverse()),jl(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+e+"."}),e.forEach(function(t){jl(t>=0&&t<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+e})}),n.rank<=1)return n.clone();var r={perm:e};return zh.runKernelFunc(function(t){return t.transpose(n,e)},{x:n},function(t){var n=Md(e);return{x:function(){return t.transpose(n)}}},"Transpose",r)}}),ub=Bd({localResponseNormalization_:function(t,e,n,r,i){void 0===e&&(e=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=.5);var o=kd(t,"x","localResponseNormalization");jl(4===o.rank||3===o.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+o.rank+"."}),jl(Gl(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var a=o,s=!1;3===o.rank&&(s=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=zh.runKernelFunc(function(t,o){var s=t.localResponseNormalization4D(a,e,n,r,i);return o([a,s]),s},{x4D:a},function(t,o){var a=o[0],s=o[1];return{x4D:function(){return zh.runKernelFunc(function(o){return o.LRNGrad(t,a,s,e,n,r,i)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),cb=Bd({norm_:function(t,e,n,r){void 0===e&&(e="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var i=function t(e,n,r){if(void 0===r&&(r=null),0===e.rank)return e.abs();if(1!==e.rank&&null===r)return t(e.reshape([-1]),n,r);if(1===e.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return e.abs().sum(r);if(n===1/0)return e.abs().max(r);if(n===-1/0)return e.abs().min(r);if("euclidean"===n||2===n)return e.abs().pow(Vd(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return e.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return e.abs().sum(r[1]).max(r[0]);if(n===-1/0)return e.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return e.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(t=kd(t,"x","norm"),e,n),o=i.shape;if(r){var a=$l(n,t.shape);o=Ad(i.shape,a)}return i.reshape(o)}}),lb=Bd({basicLSTMCell_:function(t,e,n,r,i,o){var a=kd(t,"forgetBias","basicLSTMCell"),s=kd(e,"lstmKernel","basicLSTMCell"),u=kd(n,"lstmBias","basicLSTMCell"),c=kd(r,"data","basicLSTMCell"),l=kd(i,"c","basicLSTMCell"),h=kd(o,"h","basicLSTMCell"),d=c.concat(h,1).matMul(s).add(u),p=d.shape[0],f=d.shape[1]/4,m=[p,f],v=d.slice([0,0],m),g=d.slice([0,f],m),y=d.slice([0,2*f],m),x=d.slice([0,3*f],m),b=v.sigmoid().mulStrict(g.tanh()).addStrict(l.mulStrict(a.add(y).sigmoid())),w=b.tanh().mulStrict(x.sigmoid());return[b,w]}}),hb=Bd({multiRNNCell_:function(t,e,n,r){for(var i=kd(e,"data","multiRNNCell"),o=Td(n,"c","multiRNNCell"),a=Td(r,"h","multiRNNCell"),s=i,u=[],c=0;c<t.length;c++){var l=t[c](s,o[c],a[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var h=[],d=[];for(c=0;c<u.length;c+=2)h.push(u[c]),d.push(u[c+1]);return[h,d]}}),db=Bd({movingAverage_:function(t,e,n,r,i){void 0===i&&(i=!0);var o=kd(t,"v","movingAverage"),a=kd(e,"x","movingAverage"),s=kd(n,"decay","movingAverage");(function(t,e){jl(t.dtype===e.dtype,function(){return"The dtypes of the first("+t.dtype+") and second("+e.dtype+") input must match"})})(o,a),jl(Hl(o.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=Vd(1),c=u.sub(s),l=a.sub(o).mul(c);if(i){jl(null!=r,function(){return"When using zeroDebias: true, step is required."});var h=kd(r,"step","movingAverage");l=l.div(u.sub(Uy(s,h)))}return o.add(l)}}),pb=Bd({stridedSlice_:function(t,e,n,r,i,o,a,s,u){if(void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(e.length)),0!==a)throw new Error("ellipsis mask is not yet supported");var c=kd(t,"x","stridedSlice"),l=tf(s),h=c.shape.slice();l.forEach(function(t){e[t]=0,n[t]=1,h.splice(t,0,1)}),c=c.reshape(h);for(var d=0;d<c.rank;d++)e[d]=nf(i,e,r,c.shape,d),n[d]=rf(o,n,r,c.shape,d),r[d]=r[d]||1;var p=tf(u);p.forEach(function(t){n[t]=e[t]+1,r[t]=1});var f=ef(e,n,r),m=f.filter(function(t,e){return-1===p.indexOf(e)});return r.every(function(t){return 1===t})?Fx(c,e,f).reshape(m):zh.runKernelFunc(function(t){return t.stridedSlice(c,e,n,r)},{$x:c}).reshape(m)}}),fb=Bd({topk_:function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!0);var r=kd(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=zh.runKernelFunc(function(t){return t.topk(r,e,n)},{$x:r});return{values:o[0],indices:o[1]}}}),mb=Bd({scatterND_:function(t,e,n){var r=kd(t,"indices","scatterND","int32"),i=kd(e,"updates","scatterND");return Jp(i,r,n),zh.runKernelFunc(function(t){return t.scatterND(r,i,n)},{indices:r,updates:i},null,"ScatterNd",{shape:n})}}),vb=Bd({fft_:function(t){jl("complex64"===t.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e);return zh.runKernelFunc(function(t){return t.fft(r)},{input:t}).reshape(t.shape)}}),gb=Bd({ifft_:function(t){jl("complex64"===t.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e);return zh.runKernelFunc(function(t){return t.ifft(r)},{input:t}).reshape(t.shape)}}),yb=Bd({rfft_:function(t,e){jl("float32"===t.dtype,function(){return"The dtype for rfft() must be real value but got "+t.dtype});var n,r=t.shape[t.shape.length-1],i=t.size/r;if(null!=e&&e<r){var o=t.shape.map(function(t){return 0}),a=t.shape.map(function(t){return t});a[t.shape.length-1]=e,n=t.slice(o,a),r=e}else if(null!=e&&e>r){var s=t.shape.map(function(t){return t});s[t.shape.length-1]=e-r,n=t.concat(Xd(s),t.shape.length-1),r=e}else n=t;var u=n.zerosLike(),c=Fd(n,u).as2D(i,r),l=vb(c),h=Math.floor(r/2)+1,d=jd(l),p=zd(l),f=d.split([h,r-h],d.shape.length-1),m=p.split([h,r-h],p.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=h,Fd(f[0],m[0]).reshape(v)}}),xb=Bd({irfft_:function(t){var e=t.shape[t.shape.length-1],n=t.size/e;if(e<=2){var r=t.as2D(n,e),i=gb(r);return jd(i)}var o=[n,2*(e-1)],a=jd(t).as2D(n,e),s=zd(t).as2D(n,e),u=a.slice([0,1],[n,e-2]).reverse(1),c=s.slice([0,1],[n,e-2]).reverse(1).mul(Vd(-1)),l=a.concat(u,1),h=s.concat(c,1);return r=Fd(l,h).as2D(o[0],o[1]),i=gb(r),jd(i)}}),bb=Object.freeze({fft:vb,ifft:gb,rfft:yb,irfft:xb}),wb=Bd({sparseToDense_:function(t,e,n,r){void 0===r&&(r=0);var i=kd(t,"sparseIndices","sparseToDense","int32"),o=kd(e,"sparseValues","sparseToDense"),a=kd(r,"defaultValue","sparseToDense",o.dtype);return function(t,e,n,r){if("int32"!==t.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+t.shape+".");var i=t.rank>0?t.shape[0]:1,o=t.rank>1?t.shape[1]:1;if(n.length!==o)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+o+".");var a=e.size;if(0!==e.rank&&(1!==e.rank||a!==i))throw new Error("sparseValues has incorrect shape "+e.shape+", should be [] or ["+i+"]");if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,n,a),zh.runKernelFunc(function(t){return t.sparseToDense(i,o,n,a)},{$sparseIndices:i,$sparseValues:o,$defaultValue:a})}}),_b=Bd({gatherND_:function(t,e){var n=kd(e,"indices","gatherND","int32"),r=kd(t,"x","gatherND");return zh.runKernelFunc(function(t){return t.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),Eb=Bd({diag_:function(t){var e=kd(t,"x","diag").flatten(),n=t.shape.concat(t.shape);return zh.runKernelFunc(function(t){return t.diag(e)},{$x:e}).reshape(n)}}),Cb=Bd({dropout_:function(t,e,n,r){var i=kd(t,"x","dropout");if(jl("float32"===i.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."}),jl(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),0===e)return t instanceof Ch?i.clone():i;var o=function(t,e){if(null==e)return t.shape.slice();if(Hl(t.shape,e))return e;if(t.shape.length===e.length){for(var n=[],r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(i,n),a=1-e,s=Bp(o,0,1,"float32",r).add(a).floor().div(a);return i.mul(s)}});function Ib(t,e,n){for(var r=1-t%2,i=new Float32Array(t),o=0;o<t;++o){var a=2*Math.PI*o/(t+r-1);i[o]=e-n*Math.cos(a)}return Hd(i,"float32")}var Sb,kb=Bd({hannWindow_:function(t){return Ib(t,.5,.5)}}),Tb=Bd({hammingWindow_:function(t){return Ib(t,.54,.46)}}),Nb=Bd({frame_:function(t,e,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=0);for(var o=0,a=[];o+e<=t.size;)a.push(Fx(t,o,e)),o+=n;if(r)for(;o<t.size;){var s=o+e-t.size,u=tp([Fx(t,o,e-s),$d([s],i)]);a.push(u),o+=n}return 0===a.length?Gd([],[0,e]):tp(a).as2D(a.length,e)}}),Rb=Bd({stft_:function(t,e,n,r,i){var o;void 0===i&&(i=kb),null==r&&(o=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));for(var a=Nb(t,e,n),s=zy(a,i(e)),u=[],c=0;c<a.shape[0];c++)u.push(yb(s.slice([c,0],[1,e]),r));return tp(u)}}),Ab=Object.freeze({hannWindow:kb,hammingWindow:Tb,frame:Nb,stft:Rb});!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Sb||(Sb={}));var Pb=Bd({absoluteDifference_:function(t,e,n,r){void 0===r&&(r=Sb.SUM_BY_NONZERO_WEIGHTS);var i=kd(t,"labels","absoluteDifference"),o=kd(e,"predictions","absoluteDifference"),a=null;null!=n&&(a=kd(n,"weights","absoluteDifference")),zl(i.shape,o.shape,"Error in absoluteDifference: ");var s=i.sub(o).abs();return Db(s,a,r)}}),Db=Bd({computeWeightedLoss_:function(t,e,n){void 0===n&&(n=Sb.SUM_BY_NONZERO_WEIGHTS);var r=kd(t,"losses","computeWeightedLoss"),i=null;null!=e&&(i=kd(e,"weights","computeWeightedLoss"));var o=null==i?r:r.mul(i);if(n===Sb.NONE)return o;if(n===Sb.SUM)return o.sum();if(n===Sb.MEAN){if(null==i)return o.mean();var a=r.size/i.size,s=o.sum().div(i.sum());return a>1?s.div(Vd(a)):s}if(n===Sb.SUM_BY_NONZERO_WEIGHTS){if(null==i)return o.sum().div(Vd(r.size));var u=i.mul(Zd(r.shape)).notEqual(Vd(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+n)}}),Mb=Bd({cosineDistance_:function(t,e,n,r,i){void 0===i&&(i=Sb.SUM_BY_NONZERO_WEIGHTS);var o=kd(t,"labels","cosineDistance"),a=kd(e,"predictions","cosineDistance"),s=null;null!=r&&(s=kd(r,"weights","cosineDistance")),zl(o.shape,a.shape,"Error in cosineDistance: ");var u=Vd(1).sub(o.mul(a).sum(n,!0));return Db(u,s,i)}}),Ob=Bd({hingeLoss_:function(t,e,n,r){void 0===r&&(r=Sb.SUM_BY_NONZERO_WEIGHTS);var i=kd(t,"labels","hingeLoss"),o=kd(e,"predictions","hingeLoss"),a=null;null!=n&&(a=kd(n,"weights","hingeLoss")),zl(i.shape,o.shape,"Error in hingeLoss: ");var s=Vd(1);i=Vd(2).mul(i).sub(s);var u=s.sub(i.mul(o)).relu();return Db(u,a,r)}}),Lb=Bd({huberLoss_:function(t,e,n,r,i){void 0===r&&(r=1),void 0===i&&(i=Sb.SUM_BY_NONZERO_WEIGHTS);var o=kd(t,"labels","huberLoss"),a=kd(e,"predictions","huberLoss"),s=null;null!=n&&(s=kd(n,"weights","huberLoss")),zl(o.shape,a.shape,"Error in huberLoss: ");var u=Vd(r),c=a.sub(o).abs(),l=Ly(c,u),h=c.sub(l),d=Vd(.5).mul(l.square()).add(u.mul(h));return Db(d,s,i)}}),Bb=Bd({logLoss_:function(t,e,n,r,i){void 0===r&&(r=1e-7),void 0===i&&(i=Sb.SUM_BY_NONZERO_WEIGHTS);var o=kd(t,"labels","logLoss"),a=kd(e,"predictions","logLoss"),s=null;null!=n&&(s=kd(n,"weights","logLoss")),zl(o.shape,a.shape,"Error in logLoss: ");var u=Vd(1),c=Vd(r),l=o.mul(a.add(c).log()).neg().sub(u.sub(o).mul(u.sub(a).add(c).log()));return Db(l,s,i)}}),Fb=Bd({meanSquaredError_:function(t,e,n,r){void 0===r&&(r=Sb.SUM_BY_NONZERO_WEIGHTS);var i=kd(t,"labels","meanSquaredError"),o=kd(e,"predictions","meanSquaredError"),a=null;null!=n&&(a=kd(n,"weights","meanSquaredError")),zl(i.shape,o.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(o);return Db(s,a,r)}}),jb=Bd({sigmoidCrossEntropy_:function(t,e,n,r,i){void 0===r&&(r=0),void 0===i&&(i=Sb.SUM_BY_NONZERO_WEIGHTS);var o=kd(t,"multiClassLabels","sigmoidCrossEntropy"),a=kd(e,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=kd(n,"weights","sigmoidCrossEntropy")),zl(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Vd(r),c=Vd(1),l=Vd(.5);o=o.mul(c.sub(u)).add(l.mul(u))}var h=function(t,e){var n=kd(t,"labels","sigmoidCrossEntropyWithLogits"),r=kd(e,"logits","sigmoidCrossEntropyWithLogits");zl(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=r.relu(),o=r.mul(n),a=r.abs().neg().exp().log1p();return i.sub(o).add(a)}(o,a);return Db(h,s,i)}}),zb=Bd({softmaxCrossEntropy_:function(t,e,n,r,i){void 0===r&&(r=0),void 0===i&&(i=Sb.SUM_BY_NONZERO_WEIGHTS);var o=kd(t,"onehotLabels","softmaxCrossEntropy"),a=kd(e,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=kd(n,"weights","softmaxCrossEntropy")),zl(o.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Vd(r),c=Vd(1),l=Vd(o.shape[1]);o=o.mul(c.sub(u)).add(u.div(l))}var h=function(t,e,n){if(void 0===n&&(n=-1),-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+e.rank+" and dim was "+n);return sf(function(t,e,r){var i=e.logSumExp([n],!0),o=e.toFloat().sub(i);return r([t,o]),{value:o.mul(t).neg().sum([n]),gradFunc:function(t,e){var r=e[0],i=e[1],o=Ad(t.shape,[n]);return[t.reshape(o).mul(r.toFloat().sub(i.exp())),t.reshape(o).mul(i.exp().sub(r.toFloat()))]}}})(t,e)}(o,a);return Db(h,s,i)}}),Wb=Object.freeze({get Reduction(){return Sb},absoluteDifference:Pb,computeWeightedLoss:Db,cosineDistance:Mb,hingeLoss:Ob,huberLoss:Lb,logLoss:Bb,meanSquaredError:Fb,sigmoidCrossEntropy:jb,softmaxCrossEntropy:zb});function Ub(t,e){return void 0===e&&(e=!1),zh.tidy(function(){if(2!==t.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var n=t.shape[0],r=t.shape[1],i=Sp(n),o=t.clone(),a=Gd([[1]],[1,1]),s=a.clone(),u=n>=r?r:n,c=function(t){var e,u=o,c=s,l=i;e=zh.tidy(function(){var e=o.slice([t,t],[n-t,1]),u=e.norm(),c=o.slice([t,t],[1,1]),l=Gd([[-1]]).where(c.greater(0),Gd([[1]])),h=c.sub(l.mul(u)),d=e.div(h);s=1===d.shape[0]?a.clone():a.concat(d.slice([1,0],[d.shape[0]-1,d.shape[1]]),0);var p=l.matMul(h).div(u).neg(),f=o.slice([t,0],[n-t,r]),m=p.mul(s);if(0===t)o=f.sub(m.matMul(s.transpose().matMul(f)));else{var v=f.sub(m.matMul(s.transpose().matMul(f)));o=o.slice([0,0],[t,r]).concat(v,0)}var g=i.slice([0,t],[n,i.shape[1]-t]);if(0===t)i=g.sub(g.matMul(s).matMul(m.transpose()));else{var y=g.sub(g.matMul(s).matMul(m.transpose()));i=i.slice([0,0],[n,t]).concat(y,1)}return[s,o,i]}),s=e[0],o=e[1],i=e[2],Ed([u,c,l])},l=0;l<u;++l)c(l);return!e&&n>r&&(i=i.slice([0,0],[n,r]),o=o.slice([0,0],[r,r])),[i,o]})}var Vb=Bd({bandPart_:function(t,e,n){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=kd(t,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,o=r.shape.slice(-2),a=o[0],s=o[1];if(!(e<=a))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+a+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");e<0&&(e=a),n<0&&(n=s);var u=Yd(0,a,1,"int32").reshape([-1,1]),c=Yd(0,s,1,"int32"),l=Gy(u,c),h=by(l.lessEqual(Vd(+e,"int32")),l.greaterEqual(Vd(-n,"int32"))),d=Xd([a,s],r.dtype);return Wp(Hp(r.reshape([-1,a,s])).map(function(t){return Cy(h,t,d)})).reshape(i)}}),Hb=Bd({gramSchmidt_:function(t){var e;if(Array.isArray(t)){e=!1,jl(null!=t&&t.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=t[0].shape[0],r=function(e){jl(t[e].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[e].shape[0]+" vs. "+n+")"})},i=1;i<t.length;++i)r(i)}else e=!0,t=op(t,t.shape[0],0).map(function(t){return zp(t,[0])});jl(t.length<=t[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."});var o=[],a=t,s=function(t){o.push(zh.tidy(function(){var e=a[t];if(t>0)for(var n=0;n<t;++n){var r=Qx(o[n].mulStrict(e)).mul(o[n]);e=e.sub(r)}return e.div(cb(e,"euclidean"))}))};for(i=0;i<t.length;++i)s(i);return e?Wp(o,0):o}}),Gb=Bd({qr_:function(t,e){if(void 0===e&&(e=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(2===t.rank)return Ub(t,e);var n=t.shape.slice(0,t.shape.length-2).reduce(function(t,e){return t*e}),r=Hp(t.reshape([n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],o=[];return r.forEach(function(t){var n=Ub(t,e),r=n[0],a=n[1];i.push(r),o.push(a)}),[Wp(i,0).reshape(t.shape),Wp(o,0).reshape(t.shape)]}}),qb=Object.freeze({bandPart:Vb,gramSchmidt:Hb,qr:Gb});function Kb(t,e,n,r,i,o){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==o&&(o=0);var a=t.shape[0];return n=Math.min(n,a),jl(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),jl(2===t.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"}),jl(4===t.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]}),jl(1===e.rank,function(){return"scores must be a 1D tensor"}),jl(e.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+e.shape[0]}),jl(0<=o&&o<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}var Zb=Bd({resizeBilinear_:function(t,e,n){void 0===n&&(n=!1);var r=kd(t,"images","resizeBilinear");jl(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),jl(2===e.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=zh.runKernelFunc(function(t,e){return e([i]),t.resizeBilinear(i,a,s,n)},{x:i},function(t,e){return{x:function(){return zh.runKernelFunc(function(r){return r.resizeBilinearBackprop(t,e[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:a,newWidth:s});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Xb=Bd({resizeNearestNeighbor_:function(t,e,n){void 0===n&&(n=!1);var r=kd(t,"images","resizeNearestNeighbor");jl(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),jl(2===e.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),jl("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=zh.runKernelFunc(function(t,e){return e([i]),t.resizeNearestNeighbor(i,a,s,n)},{batchImages:i},function(t,e){return{batchImages:function(){return zh.runKernelFunc(function(r){return r.resizeNearestNeighborBackprop(t,e[0],n)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),$b=Bd({nonMaxSuppression_:function(t,e,n,r,i){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var o=kd(t,"boxes","nonMaxSuppression"),a=kd(e,"scores","nonMaxSuppression"),s=Kb(o,a,n,r,i);n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:i};return zh.runKernelFunc(function(t){return t.nonMaxSuppression(o,a,n,r,i)},{boxes:o,scores:a},null,"NonMaxSuppressionV3",u)}}),Yb=Bd({nonMaxSuppressionWithScore_:function(t,e,n,r,i,o){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===o&&(o=0);var a=kd(t,"boxes","nonMaxSuppression"),s=kd(e,"scores","nonMaxSuppression"),u=Kb(a,s,n,r,i,o),c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},l=zh.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),Jb=Bd({cropAndResize_:function(t,e,n,r,i,o){var a=kd(t,"image","cropAndResize"),s=kd(e,"boxes","cropAndResize","float32"),u=kd(n,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var c=s.shape[0];return jl(4===a.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),jl(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."}),jl(1===u.rank&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."}),jl(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),jl(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),jl("bilinear"===i||"nearest"===i,function(){return"method must be bilinear or nearest, but was "+i}),zh.runKernelFunc(function(t,e){return t.cropAndResize(a,s,u,r,i,o)},{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:r})}}),Qb=Object.freeze({resizeBilinear:Zb,resizeNearestNeighbor:Xb,nonMaxSuppression:$b,nonMaxSuppressionAsync:function(t,e,n,r,i){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),Il(this,0,void 0,function(){var o,a,s,u,c,l,h;return Sl(this,function(d){switch(d.label){case 0:return o=kd(t,"boxes","nonMaxSuppressionAsync"),a=kd(e,"scores","nonMaxSuppressionAsync"),s=Kb(o,a,n,r,i),n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,[4,Promise.all([o.data(),a.data()])];case 1:return u=d.sent(),c=u[0],l=u[1],h=Bf(c,l,n,r,i),o!==t&&o.dispose(),a!==e&&a.dispose(),[2,h]}})})},nonMaxSuppressionWithScore:Yb,nonMaxSuppressionWithScoreAsync:function(t,e,n,r,i,o){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===o&&(o=0),Il(this,0,void 0,function(){var a,s,u,c,l,h,d;return Sl(this,function(p){switch(p.label){case 0:return a=kd(t,"boxes","nonMaxSuppressionAsync"),s=kd(e,"scores","nonMaxSuppressionAsync"),u=Kb(a,s,n,r,i,o),n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,o=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return c=p.sent(),l=c[0],h=c[1],d=Ff(l,h,n,r,i,o),a!==t&&a.dispose(),s!==e&&s.dispose(),[2,d]}})})},cropAndResize:Jb}),tw=function(t,e){return!(t>0)||"linear"===e},ew=function(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return t.mul(e.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},nw=function(t,e){var n=e,r=ff(t.shape,e.shape);return r.length>0&&(n=n.sum(r)),n.reshape(t.shape)},rw=function(t,e,n){if("linear"===e)return t;if("relu"===e)return ib(t);if("elu"===e)return eb(t);if("relu6"===e)return ob(t);if("prelu"===e)return rb(t,n);throw new Error("Unknown fused activation "+e+".")},iw=Bd({fusedMatMul_:function(t){var e,n=t.a,r=t.b,i=t.transposeA,o=void 0!==i&&i,a=t.transposeB,s=void 0!==a&&a,u=t.bias,c=t.activation,l=void 0===c?"linear":c,h=t.preluActivationWeights;if(!1===tw(zh.state.gradientDepth,l)){var d=Ex(n,r,o,s);return null!=u&&(d=Sy(d,u)),rw(d,l,h)}var p=kd(n,"a","fused matMul"),f=kd(r,"b","fused matMul");e=Oh(p,f),p=e[0],f=e[1];var m=o?p.shape[p.rank-2]:p.shape[p.rank-1],v=s?f.shape[f.rank-1]:f.shape[f.rank-2],g=o?p.shape[p.rank-1]:p.shape[p.rank-2],y=s?f.shape[f.rank-2]:f.shape[f.rank-1],x=p.shape.slice(0,-2),b=f.shape.slice(0,-2),w=Vl(x),_=Vl(b);jl(p.rank>=2&&f.rank>=2&&p.rank===f.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+p.rank+" and "+f.rank+"."}),jl(Hl(x,b),function(){return"Error in fused matMul: outer dimensions ("+x+") and ("+b+") of Tensors with shapes "+p.shape+" and "+f.shape+" must match."}),jl(m===v,function(){return"Error in fused matMul: inner shapes ("+m+") and ("+v+") of Tensors with shapes "+p.shape+" and "+f.shape+" and transposeA="+o+" and transposeB="+s+" must match."});var E,C,I=p.shape.slice(0,-2).concat([g,y]),S=o?p.as3D(w,m,g):p.as3D(w,g,m),k=s?f.as3D(_,y,v):f.as3D(_,v,y);null!=u&&mf(I,(E=Oh(E=kd(u,"bias","fused matMul"),p)[0]).shape),null!=h&&(C=kd(h,"prelu weights","fused matMul"));var T={a:S,b:k};null!=u&&(T.bias=E),null!=h&&(T.preluActivationWeights=C);var N=[S,k];return zh.runKernelFunc(function(t,e){var n=t.fusedBatchMatMul({a:S,b:k,transposeA:o,transposeB:s,bias:E,activation:l,preluActivationWeights:C});return e([S,k,n]),n},T,function(t,e){var n=e[0],r=e[1],i=e[2],a=ew(t,i,l),c={};return null!=u&&(c={bias:function(){return nw(E,a)}}),o||s?!o&&s?Object.assign({a:function(){return a.matMul(r,!1,!1)},b:function(){return a.matMul(n,!0,!1)}},c):o&&!s?Object.assign({a:function(){return r.matMul(a,!1,!0)},b:function(){return n.matMul(a,!1,!1)}},c):Object.assign({a:function(){return r.matMul(a,!0,!0)},b:function(){return a.matMul(n,!0,!0)}},c):Object.assign({a:function(){return a.matMul(r,!1,!0)},b:function(){return n.matMul(a,!0,!1)}},c)},"_FusedMatMul",{transposeA:o,transposeB:s,activation:l},N,[!0]).reshape(I)}}),ow=Bd({fusedConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,i=t.pad,o=t.dataFormat,a=void 0===o?"NHWC":o,s=t.dilations,u=void 0===s?[1,1]:s,c=t.dimRoundingMode,l=t.bias,h=t.activation,d=void 0===h?"linear":h,p=t.preluActivationWeights;if(d=d||"linear",!1===tw(zh.state.gradientDepth,d)){var f=px(e,n,r,i,a,u,c);return null!=l&&(f=Sy(f,l)),rw(f,d,p)}var m=kd(e,"x","conv2d"),v=kd(n,"filter","conv2d"),g=m,y=!1;3===m.rank&&(y=!0,g=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),jl(4===g.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."}),jl(4===v.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+v.rank+"."}),null!=c&&jl(Gl(i),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+i+"."}),jl(g.shape[3]===v.shape[2],function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+v.shape[2]+"."}),jl(Sf(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),jl("NHWC"===a,function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var x,b,w=yf(g.shape,v.shape,r,u,i,c);null!=l&&(x=Oh(x=kd(l,"bias","fused conv2d"),m)[0],mf(w.outShape,x.shape)),null!=p&&(b=kd(p,"prelu weights","fused conv2d"));var _={x:g,filter:v};null!=l&&(_.bias=x),null!=p&&(_.preluActivationWeights=b);var E=[v,g],C=zh.runKernelFunc(function(t,e){var n=t.fusedConv2d({input:g,filter:v,convInfo:w,bias:x,activation:d,preluActivationWeights:b});return e([v,g,n]),n},_,function(t,e){var n=e,o=n[0],a=n[1],s=n[2],c=ew(t,s,d);jl(If(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var h={};return null!=l&&(h={bias:function(){return nw(x,c)}}),Object.assign({x:function(){return vx(a.shape,c,o,r,i)},filter:function(){return mx(a,c,o.shape,r,i)}},h)},"FusedConv2D",{convInfo:w,activation:d},E,[!0]);return y?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),aw=Bd({fusedDepthwiseConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,i=t.pad,o=t.dataFormat,a=void 0===o?"NHWC":o,s=t.dilations,u=void 0===s?[1,1]:s,c=t.dimRoundingMode,l=t.bias,h=t.activation,d=void 0===h?"linear":h,p=t.preluActivationWeights;if(!1===tw(zh.state.gradientDepth,d)){var f=gx(e,n,r,i,a,u,c);return null!=l&&(f=Sy(f,l)),rw(f,d,p)}var m=kd(e,"x","depthwiseConv2d"),v=kd(n,"filter","depthwiseConv2d"),g=m,y=!1;3===m.rank&&(y=!0,g=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),jl(4===g.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."}),jl(4===v.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+v.rank+"."}),jl(g.shape[3]===v.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+v.shape[2]+"."}),null==u&&(u=[1,1]),jl(Sf(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),null!=c&&jl(Gl(i),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+i+"."});var x,b,w=yf(g.shape,v.shape,r,u,i,c,!0);null!=l&&(x=Oh(x=kd(l,"bias","fused conv2d"),m)[0],mf(w.outShape,x.shape)),null!=p&&(b=kd(p,"prelu weights","fused depthwiseConv2d"));var _={x:g,filter:v};null!=l&&(_.bias=x),null!=p&&(_.preluActivationWeights=b);var E=[v,g],C=zh.runKernelFunc(function(t,e){var n=t.fusedDepthwiseConv2D({input:g,filter:v,convInfo:w,bias:x,activation:d,preluActivationWeights:b});return e([v,g,n]),n},_,function(t,e){jl(If(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var n=e[0],r=e[1],i=e[2],o=ew(t,i,d),a={};return null!=l&&(a={bias:function(){return nw(x,o)}}),Object.assign({x:function(){return yx(r.shape,o,n,w)},filter:function(){return xx(r,o,n.shape,w)}},a)},"FusedDepthwiseConv2D",{convInfo:w,activation:d},E,[!0]);return y?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),sw=Object.freeze({matMul:iw,conv2d:ow,depthwiseConv2d:aw}),uw=Object.freeze({image:Qb,linalg:qb,losses:Wb,spectral:bb,fused:sw,signal:Ab,square:Eg,squaredDifference:Ig,conv1d:dx,conv2d:px,conv3d:fx,depthwiseConv2d:gx,separableConv2d:bx,conv2dTranspose:wx,conv3dTranspose:_x,op:Bd,batchNormalization2d:dy,batchNormalization3d:py,batchNormalization4d:fy,batchNormalization:my,batchNorm:vy,batchNorm2d:gy,batchNorm3d:yy,batchNorm4d:xy,booleanMaskAsync:function(t,e,n){return Il(this,0,void 0,function(){var r,i,o,a,s,u,c,l,h,d,p,f,m;return Sl(this,function(v){switch(v.label){case 0:for(r=kd(t,"tensor","boolMask"),i=kd(e,"mask","boolMask","bool"),o=null==n?0:n,a=i.rank,s=r.shape,jl(a>0,function(){return"mask cannot be scalar"}),zl(s.slice(o,o+a),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=o;c<o+a;c++)u*=s[c];return l=s.slice(0,o).concat([u],s.slice(o+a)),h=r.reshape(l),d=i.reshape([-1]),[4,Iy(d)];case 1:return p=v.sent(),f=p.squeeze([1]),m=sx(h,f,o),t!==r&&r.dispose(),e!==i&&i.dispose(),f.dispose(),h.dispose(),d.dispose(),p.dispose(),[2,m]}})})},complex:Fd,real:jd,imag:zd,concat:tp,concat1d:ep,concat2d:np,concat3d:rp,concat4d:ip,split:op,matMul:Ex,dot:Cx,outerProduct:Ix,reverse:Sx,reverse1d:kx,reverse2d:Tx,reverse3d:Nx,reverse4d:Rx,maxPool:Dx,avgPool:Mx,pool:Ox,maxPool3d:Lx,avgPool3d:Bx,slice:Fx,slice1d:jx,slice2d:zx,slice3d:Wx,slice4d:Ux,abs:Sg,acos:kg,acosh:Tg,asin:Ng,asinh:Rg,atan:Ag,atanh:Pg,ceil:Dg,clipByValue:Mg,cos:Og,cosh:Lg,erf:Bg,exp:Fg,expm1:jg,floor:zg,log:Wg,log1p:Ug,logSigmoid:Vg,neg:Hg,reciprocal:Gg,round:qg,rsqrt:Kg,sigmoid:Zg,sign:Xg,isNaN:$g,isInf:Yg,isFinite:Jg,sin:Qg,sinh:ty,softplus:ey,sqrt:ny,step:ry,tan:iy,tanh:oy,all:Hx,any:Gx,argMax:qx,argMin:Kx,logSumExp:Zx,max:Xx,mean:$x,min:Yx,moments:Jx,sum:Qx,prod:tb,equal:Ky,equalStrict:Zy,greater:Xy,greaterEqual:$y,greaterEqualStrict:Yy,greaterStrict:Jy,less:Qy,lessEqual:tx,lessEqualStrict:ex,lessStrict:nx,notEqual:rx,notEqualStrict:ix,add:Sy,addN:ky,addStrict:Ty,atan2:Ny,div:Ry,divNoNan:Ay,divStrict:Py,floorDiv:Dy,maximum:My,maximumStrict:Oy,minimum:Ly,minimumStrict:By,mod:Fy,modStrict:jy,mul:zy,mulStrict:Wy,pow:Uy,powStrict:Vy,squaredDifferenceStrict:Hy,sub:Gy,subStrict:qy,elu:eb,leakyRelu:nb,prelu:rb,relu:ib,relu6:ob,selu:ab,logicalAnd:by,logicalNot:wy,logicalOr:_y,logicalXor:Ey,where:Cy,whereAsync:Iy,buffer:yp,print:function(t,e){void 0===e&&(e=!1)},batchToSpaceND:xp,broadcastTo:bp,cast:wp,clone:_p,cumsum:Ep,depthToSpace:Cp,expandDims:Ip,eye:Sp,multinomial:kp,oneHot:Tp,pad:Np,pad1d:Rp,pad2d:Ap,pad3d:Pp,pad4d:Dp,rand:Mp,randomNormal:Op,randomGamma:Lp,randomUniform:Bp,reshape:Fp,spaceToBatchND:jp,squeeze:zp,stack:Wp,tile:Up,truncatedNormal:Vp,unstack:Hp,setdiff1dAsync:function(t,e){return Il(this,0,void 0,function(){var n,r,i,o,a,s,u,c,l,h;return Sl(this,function(d){switch(d.label){case 0:return n=kd(t,"x","setdiff1d"),r=kd(e,"y","setdiff1d"),jl(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),jl(1===n.rank,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),jl(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return i=d.sent(),[4,r.data()];case 2:for(o=d.sent(),a=new Set(o),s=0,l=0;l<i.length;l++)a.has(i[l])||s++;for(u=new bh([s],n.dtype),c=new bh([s],"int32"),l=0,h=0;l<i.length;l++)a.has(i[l])||(u.values[h]=i[l],c.values[h]=l,h++);return[2,[u.toTensor(),c.toTensor()]]}})})},fill:$d,linspace:function(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");return zh.runKernelFunc(function(r){return r.linspace(t,e,n)},{})},ones:Zd,range:Yd,scalar:Vd,tensor:Wd,tensor1d:Hd,tensor2d:Gd,tensor3d:qd,tensor4d:Kd,tensor5d:function(t,e,n){if(Wl(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Id(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Ud(t,e,r,n)},tensor6d:function(t,e,n){if(Wl(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Id(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Ud(t,e=e||r,r,n)},variable:function(t,e,n,r){return void 0===e&&(e=!0),zh.makeVariable(t,e,n,r)},zeros:Xd,onesLike:Jd,zerosLike:Qd,transpose:sb,softmax:uf,logSoftmax:cf,localResponseNormalization:ub,norm:cb,gather:sx,unsortedSegmentSum:ux,basicLSTMCell:lb,multiRNNCell:hb,movingAverage:db,stridedSlice:pb,topk:fb,scatterND:mb,fft:vb,ifft:gb,rfft:yb,irfft:xb,sparseToDense:wb,gatherND:_b,diag:Eb,dropout:Cb,hannWindow:kb,hammingWindow:Tb,frame:Nb,stft:Rb,inTopKAsync:function(t,e,n){return void 0===n&&(n=1),Il(this,0,void 0,function(){var r,i,o,a,s,u,c,l,h,d,p,f,m,v;return Sl(this,function(g){switch(g.label){case 0:return r=kd(t,"predictions","inTopK"),i=kd(e,"targets","inTopK"),jl(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),jl(r.rank-1===i.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank}),zl(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],jl(n>0&&n<=o,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+n}),[4,r.data()];case 1:return a=g.sent(),[4,i.data()];case 2:for(s=g.sent(),u=[a.length/o,o],l=u[1],h=Jl("bool",c=u[0]),d=0;d<c;d++){for(p=d*l,f=a.subarray(p,p+l),m=[],v=0;v<f.length;v++)m.push({value:f[v],index:v});for(m.sort(function(t,e){return e.value-t.value}),h[d]=0,v=0;v<n;v++)if(m[v].index===s[d]){h[d]=1;break}}return t!==r&&r.dispose(),e!==i&&i.dispose(),[2,Wd(h,i.shape,"bool")]}})})}});function cw(t,e){Array.isArray(t)||(t=[t]),t.forEach(function(t){null!=t&&jl("complex64"!==t.dtype,function(){return e+" does not support complex64 tensors."})})}function lw(t,e,n,r){if("linear"===n)return t.linear(e);if("relu"===n)return t.relu(e);if("elu"===n)return t.elu(e);if("relu6"===n)return t.relu6(e);if("prelu"===n)return t.prelu(e,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var hw=function(t){function e(){var e=t.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new lf(e,zh),e}return Cl(e,t),e.prototype.write=function(t,e,n){this.firstUse&&(this.firstUse=!1,Tl().get("IS_NODE")&&Cd("\n============================\nHi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:t,dtype:n}),r},e.prototype.move=function(t,e,n,r){this.data.set(t,{values:e,dtype:r})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return Il(this,0,void 0,function(){return Sl(this,function(e){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var e=this.data.get(t),n=e.dtype,r=e.complexTensors;return"complex64"===n?Af(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var e=this.readSync(t.dataId),n=e;if("string"===t.dtype)try{n=e.map(function(t){return ph(t)})}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return yp(t.shape,t.dtype,n)},e.prototype.makeOutput=function(t,e,n){var r=this.write(t,e,n);return zh.makeTensorFromDataId(r,e,n,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var e=this.data.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return Il(this,0,void 0,function(){var e;return Sl(this,function(n){return e=hh(),t(),[2,{kernelMs:hh()-e}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,e){var n=this.makeOutput(null,t.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:zh.keep(t.clone()),imag:zh.keep(e.clone())},n},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,e,n){if(cw(t,"slice"),of(t.shape,e,n)){var r=af(e,t.strides),i=Vl(n);return Wd(this.readSync(t.dataId).subarray(r,r+i),n,t.dtype)}for(var o=yp(n,t.dtype),a=this.bufferSync(t),s=0;s<o.size;++s){var u=o.indexToLoc(s).map(function(t,n){return t+e[n]});o.values[s]=a.get.apply(a,u)}return o.toTensor()},e.prototype.stridedSlice=function(t,e,n,r){cw(t,"stridedSlice");var i=ef(e,n,r);if(i.some(function(t){return 0===t}))return Wd([],i);for(var o=yp(i,t.dtype),a=this.bufferSync(t),s=0;s<o.size;s++){for(var u=o.indexToLoc(s),c=new Array(u.length),l=0;l<c.length;l++)c[l]=u[l]*r[l]+e[l];o.set.apply(o,[a.get.apply(a,c)].concat(u))}return o.toTensor()},e.prototype.diag=function(t){for(var e=this.readSync(t.dataId),n=yp([t.size,t.size],t.dtype),r=n.values,i=0;i<e.length;i++)r[i*t.size+i]=e[i];return n.toTensor()},e.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),i=0,o=0;o<t.rank;o++)o!==e&&(r[i++]=t.shape[o]);var a=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(n);for(o=0;o<u.length;o++)a[e]=o,u[o]=this.slice(t,a,s).reshape(r);return u},e.prototype.reverse=function(t,e){cw(t,"reverse");for(var n=yp(t.shape,t.dtype),r=this.bufferSync(t),i=function(i){var o=n.indexToLoc(i),a=o.slice();e.forEach(function(e){return a[e]=t.shape[e]-1-a[e]}),n.set.apply(n,[r.get.apply(r,a)].concat(o))},o=0;o<n.size;o++)i(o);return n.toTensor()},e.prototype.concat=function(t,e){var n=this;if("complex64"===t[0].dtype){var r=t.map(function(t){return jd(t)}),i=t.map(function(t){return zd(t)});return Fd(this.concat(r,e),this.concat(i,e))}var o=t.map(function(t){var n=Vl(t.shape.slice(e));return t.as2D(-1,n)}),a=Ld(o.map(function(t){return t.shape}),1),s=yp(a,t[0].dtype).values;if(1===o[0].shape[0]){var u=0;o.forEach(function(t){s.set(n.readSync(t.dataId),u),u+=t.size})}else{var c=0;o.forEach(function(t){for(var e=n.readSync(t.dataId),r=0,i=0;i<t.shape[0];++i)for(var o=i*a[1]+c,u=0;u<t.shape[1];++u)s[o+u]=e[r++];c+=t.shape[1]})}var l=Ld(t.map(function(t){return t.shape}),e);return Wd(s,l,t[0].dtype)},e.prototype.neg=function(t){return cw(t,"neg"),this.multiply(Vd(-1),t)},e.prototype.add=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t+n,imag:e+r}}):this.broadcastedBinaryOp(t,e,Dh(t.dtype,e.dtype),function(t,e){return t+e})},e.prototype.addN=function(t){var e=this;cw(t,"addN");for(var n=t.map(function(t){return e.readSync(t.dataId)}),r=yp(t[0].shape,t[0].dtype),i=r.values,o=0;o<t.length;o++)for(var a=n[o],s=0;s<i.length;s++)i[s]+=a[s];return r.toTensor()},e.prototype.softmax=function(t,e){var n=$l([e],t.shape),r=this.max(t,n),i=Ad(r.shape,n),o=this.subtract(t,r.reshape(i)),a=this.exp(o),s=this.sum(a,n).reshape(i);return this.realDivide(a,s)},e.prototype.subtract=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t-n,imag:e-r}}):this.broadcastedBinaryOp(t,e,Dh(t.dtype,e.dtype),function(t,e){return t-e})},e.prototype.pow=function(t,e){return cw([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.pow(t,e)})},e.prototype.batchMatMul=function(t,e,n,r){cw([t,e],"matMul");for(var i=n?t.shape[1]:t.shape[2],o=n?t.shape[2]:t.shape[1],a=r?e.shape[1]:e.shape[2],s=t.shape[0],u=this.readSync(t.dataId),c=this.readSync(e.dataId),l=n?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],h=l[0],d=l[1],p=l[2],f=r?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],m=f[0],v=f[1],g=f[2],y=o*a,x=yp([s,o,a],t.dtype),b=x.values,w=this.blockSize,_=0;_<s;_++)for(var E=0;E<o;E+=w)for(var C=0;C<a;C+=w)for(var I=0;I<i;I+=w)for(var S=Math.min(E+w,o),k=Math.min(C+w,a),T=Math.min(I+w,i),N=E;N<S;N++)for(var R=C;R<k;R++){for(var A=0,P=I;P<T;P++)A+=u[_*h+N*d+P*p]*c[P*m+R*v+_*g];b[_*y+(N*a+R)]+=A}return x.toTensor()},e.prototype.fusedBatchMatMul=function(t){var e=t.a,n=t.b,r=t.transposeA,i=t.transposeB,o=t.bias,a=t.activation,s=t.preluActivationWeights,u=this.batchMatMul(e,n,r,i);return o&&(u=this.add(u,o)),a&&(u=lw(this,u,a,s)),u},e.prototype.multiply=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t*n-e*r,imag:t*r+e*n}}):this.broadcastedBinaryOp(t,e,Dh(t.dtype,e.dtype),function(t,e){return t*e})},e.prototype.realDivide=function(t,e){return cw([t,e],"realDivide"),this.broadcastedBinaryOp(t,e,"float32",function(t,e){return t/e})},e.prototype.floorDiv=function(t,e){return cw([t,e],"floorDiv"),this.broadcastedBinaryOp(t,e,"int32",function(t,e){return Math.floor(t/e)})},e.prototype.sum=function(t,e){cw(t,"sum"),Pd("sum",e,t.rank);for(var n=Rd(t.shape,e),r=n[0],i=n[1],o=Xd(r,Dh(t.dtype,"int32")),a=Vl(i),s=this.readSync(o.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*a,h=0,d=0;d<a;++d)h+=u[l+d];s[c]=h}return o},e.prototype.prod=function(t,e){cw(t,"sum");for(var n=Rd(t.shape,e),r=n[0],i=n[1],o=Xd(r,Dh(t.dtype,"int32")),a=Vl(i),s=this.readSync(o.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*a,h=1,d=0;d<a;++d)h*=u[l+d];s[c]=h}return o},e.prototype.unsortedSegmentSum=function(t,e,n){cw(t,"unsortedSegmentSum");for(var r=[],i=t.rank-e.rank,o=0;o<i;++o)e=e.expandDims(o+1);for(o=0;o<n;++o){var a=Vd(o,"int32"),s=Ky(a,e).asType("float32").mul(t).sum(0);r.push(s)}return Wp(r)},e.prototype.argMin=function(t,e){cw(t,"argMin");var n=[e];Pd("argMin",n,t.rank);for(var r=Rd(t.shape,n),i=r[0],o=r[1],a=Xd(i,"int32"),s=Vl(o),u=this.readSync(a.dataId),c=this.readSync(t.dataId),l=0;l<u.length;++l){for(var h=l*s,d=c[h],p=0,f=0;f<s;++f){var m=c[h+f];m<d&&(d=m,p=f)}u[l]=p}return a},e.prototype.argMax=function(t,e){cw(t,"argMax");var n=[e];Pd("argMax",n,t.rank);for(var r=Rd(t.shape,n),i=r[0],o=r[1],a=Xd(i,"int32"),s=Vl(o),u=this.readSync(a.dataId),c=this.readSync(t.dataId),l=0;l<u.length;++l){for(var h=l*s,d=c[h],p=0,f=0;f<s;++f){var m=c[h+f];m>d&&(d=m,p=f)}u[l]=p}return a},e.prototype.cumsum=function(t,e,n,r){if(cw(t,"cumsum"),e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var i=Dh(t.dtype,"int32"),o=Xd(t.shape,i),a=this.readSync(o.dataId),s=this.readSync(t.dataId),u=t.shape[t.rank-1],c=r?function(t,e){return t+u-e-1}:function(t,e){return t+e},l=0;l<s.length;l+=u)for(var h=0;h<u;h++){var d=c(l,h);if(0===h)a[d]=n?0:s[d];else{var p=c(l,h-1);a[d]=n?s[p]+a[p]:s[d]+a[p]}}return o},e.prototype.equal=function(t,e){return cw([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t===e?1:0})},e.prototype.notEqual=function(t,e){return cw([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t!==e?1:0})},e.prototype.less=function(t,e){return cw([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<e?1:0})},e.prototype.lessEqual=function(t,e){return cw([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<=e?1:0})},e.prototype.greater=function(t,e){return cw([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>e?1:0})},e.prototype.greaterEqual=function(t,e){return cw([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>=e?1:0})},e.prototype.logicalNot=function(t){cw(t,"logicalNot");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)n[r]=e[r]?0:1;return this.makeOutput(n,t.shape,"bool")},e.prototype.logicalAnd=function(t,e){return cw([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t&&e})},e.prototype.logicalOr=function(t,e){return cw([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t||e})},e.prototype.select=function(t,e,n){cw([t,e,n],"select");for(var r=this.readSync(t.dataId),i=this.readSync(e.dataId),o=this.readSync(n.dataId),a=Xd(e.shape,Dh(e.dtype,n.dtype)),s=this.readSync(a.dataId),u=0,c=0===t.rank||t.rank>1||1===e.rank?1:Vl(e.shape.slice(1)),l=0;l<r.length;l++)for(var h=0;h<c;h++)1===r[l]?s[u++]=i[l]:s[u++]=o[l];return a},e.prototype.where=function(t){cw([t],"where");var e=this.readSync(t.dataId);return qf(t.shape,e)},e.prototype.topk=function(t,e,n){return cw(t,"topk"),Gf(this.readSync(t.dataId),t.shape,t.dtype,e)},e.prototype.min=function(t,e){cw(t,"min"),Pd("min",e,t.rank);for(var n=Rd(t.shape,e),r=n[0],i=n[1],o=Xd(r,t.dtype),a=Vl(i),s=this.readSync(o.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*a,h=u[l],d=0;d<a;++d){var p=u[l+d];p<h&&(h=p)}s[c]=h}return o},e.prototype.minimum=function(t,e){return cw([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.min(t,e)})},e.prototype.mod=function(t,e){return cw([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e})},e.prototype.max=function(t,e){cw(t,"max"),Pd("max",e,t.rank);for(var n=Rd(t.shape,e),r=n[0],i=n[1],o=Xd(r,t.dtype),a=Vl(i),s=this.readSync(o.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*a,h=u[l],d=0;d<a;++d){var p=u[l+d];p>h&&(h=p)}s[c]=h}return o},e.prototype.maximum=function(t,e){return cw([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.max(t,e)})},e.prototype.all=function(t,e){cw(t,"all"),Pd("all",e,t.rank);for(var n=Rd(t.shape,e),r=n[0],i=n[1],o=Xd(r,t.dtype),a=Vl(i),s=this.readSync(o.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*a,h=u[l],d=0;d<a;++d){var p=u[l+d];h=h&&p}s[c]=h}return o},e.prototype.any=function(t,e){cw(t,"any"),Pd("any",e,t.rank);for(var n=Rd(t.shape,e),r=n[0],i=n[1],o=Xd(r,t.dtype),a=Vl(i),s=this.readSync(o.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*a,h=u[l],d=0;d<a;++d){var p=u[l+d];h=h||p}s[c]=h}return o},e.prototype.squaredDifference=function(t,e){return cw([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t-e;return n*n})},e.prototype.ceil=function(t){cw(t,"ceil");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.ceil(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.floor=function(t){cw(t,"floor");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.floor(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.sign=function(t){cw(t,"x");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)e[r]<0?n[r]=-1:e[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,t.shape,"float32")},e.prototype.isNaN=function(t){cw(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Number.isNaN(e[r])&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.isInf=function(t){cw(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Math.abs(e[r])===1/0&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.isFinite=function(t){cw(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Number.isFinite(e[r])&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.round=function(t){cw(t,"round");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=Math.floor(e[r]);e[r]-i<.5?n[r]=Math.floor(e[r]):e[r]-i>.5?n[r]=Math.ceil(e[r]):n[r]=i%2==0?i:i+1}return this.makeOutput(n,t.shape,"float32")},e.prototype.exp=function(t){cw(t,"exp");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.exp(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.expm1=function(t){cw(t,"expm1");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.expm1(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.log=function(t){cw(t,"log");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=Math.log(i)}return this.makeOutput(n,t.shape,"float32")},e.prototype.log1p=function(t){cw(t,"log1p");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=Math.log1p(i)}return this.makeOutput(n,t.shape,"float32")},e.prototype.sqrt=function(t){cw(t,"sqrt");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=Math.sqrt(i)}return this.makeOutput(n,t.shape,"float32")},e.prototype.rsqrt=function(t){cw(t,"rsqrt");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=1/Math.sqrt(i)}return this.makeOutput(n,t.shape,"float32")},e.prototype.reciprocal=function(t){cw(t,"reciprocal");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=1/e[r];return this.makeOutput(n,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){cw(t,"relu");for(var e=Xd(t.shape,t.dtype),n=this.readSync(e.dataId),r=this.readSync(t.dataId),i=0;i<r.length;++i)n[i]=Math.max(0,r[i]);return e},e.prototype.relu6=function(t){cw(t,"relu");for(var e=Xd(t.shape,t.dtype),n=this.readSync(e.dataId),r=this.readSync(t.dataId),i=0;i<r.length;++i)n[i]=Math.min(Math.max(0,r[i]),6);return e},e.prototype.prelu=function(t,e){return cw([t,e],"prelu"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return t<0?e*t:t})},e.prototype.elu=function(t){cw(t,"elu");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var i=n[r];e[r]=i>=0?i:Math.exp(i)-1}return this.makeOutput(e,t.shape,"float32")},e.prototype.eluDer=function(t,e){cw([t,e],"eluDer");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),i=this.readSync(t.dataId),o=0;o<r.length;++o){var a=r[o];n[o]=a>=1?i[o]:i[o]*(a+1)}return this.makeOutput(n,e.shape,"float32")},e.prototype.selu=function(t){cw(t,"selu");for(var e=qv,n=Kv,r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var a=i[o];r[o]=a>=0?n*a:e*(Math.exp(a)-1)}return this.makeOutput(r,t.shape,"float32")},e.prototype.clip=function(t,e,n){cw(t,"clip");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var a=i[o];r[o]=a>n?n:a<e?e:a}return this.makeOutput(r,t.shape,"float32")},e.prototype.abs=function(t){for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.abs(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<t.size;++r){var i=n[2*r],o=n[2*r+1];e[r]=Math.hypot(i,o)}return this.makeOutput(e,t.shape,"float32")},e.prototype.int=function(t){cw(t,"int");for(var e=new Int32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=n[r];return this.makeOutput(e,t.shape,"int32")},e.prototype.sigmoid=function(t){cw(t,"sigmoid");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(e,t.shape,"float32")},e.prototype.softplus=function(t){cw(t,"softplus");for(var e=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(t.size),r=this.readSync(t.dataId),i=0;i<r.length;++i){var o,a=r[i]>-e,s=r[i]<e,u=Math.exp(r[i]);o=s?u:a?r[i]:Math.log(1+u),n[i]=o}return this.makeOutput(n,t.shape,"float32")},e.prototype.sin=function(t){cw(t,"sin");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.sin(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.cos=function(t){cw(t,"cos");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.cos(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.tan=function(t){cw(t,"tan");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.tan(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.asin=function(t){cw(t,"asin");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.asin(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.acos=function(t){cw(t,"acos");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.acos(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atan=function(t){cw(t,"atan");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.atan(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atan2=function(t,e){return cw([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.atan2(t,e)})},e.prototype.sinh=function(t){cw(t,"sinh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.sinh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.cosh=function(t){cw(t,"cosh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.cosh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.tanh=function(t){cw(t,"tanh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=ql(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.asinh=function(t){cw(t,"asinh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.asinh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.acosh=function(t){cw(t,"acosh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.acosh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atanh=function(t){cw(t,"atanh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.atanh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.erf=function(t){cw(t,"erf");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var i=Math.sign(n[r]),o=Math.abs(n[r]),a=1/(1+.3275911*o);e[r]=i*(1-((((1.061405429*a-1.453152027)*a+1.421413741)*a-.284496736)*a+.254829592)*a*Math.exp(-o*o))}return this.makeOutput(e,t.shape,"float32")},e.prototype.step=function(t,e){void 0===e&&(e=0),cw(t,"step");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),i=0;i<r.length;++i){var o=r[i];isNaN(o)?n[i]=NaN:n[i]=o>0?1:e}return this.makeOutput(n,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var e=t.input,n=t.filter,r=t.convInfo,i=t.bias,o=t.activation,a=t.preluActivationWeights,s=this.conv2d(e,n,r);return i&&(s=this.add(s,i)),o&&(s=lw(this,s,o,a)),s},e.prototype.conv2d=function(t,e,n){cw([t,e],"conv2d");for(var r=n.filterHeight,i=n.filterWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c="channelsLast"===n.dataFormat,l=yp(n.outShape,t.dtype),h=t.strides[0],d=c?t.strides[1]:t.strides[2],p=c?t.strides[2]:1,f=c?1:t.strides[1],m=l.strides[0],v=c?l.strides[1]:l.strides[2],g=c?l.strides[2]:1,y=c?1:l.strides[1],x=this.readSync(t.dataId),b=this.readSync(e.dataId),w=l.values,_=0;_<n.batchSize;++_)for(var E=_*h,C=_*m,I=0;I<n.outHeight;++I)for(var S=C+I*v,k=I*n.strideHeight-u,T=0;T<r;T++){var N=k+T*o;if(!(N<0||N>=n.inHeight))for(var R=T*e.strides[0],A=E+N*d,P=0;P<n.outWidth;++P)for(var D=S+P*g,M=P*n.strideWidth-s,O=0;O<i;O++){var L=M+O*a;if(!(L<0||L>=n.inWidth))for(var B=A+L*p,F=R+O*e.strides[1],j=0;j<n.inChannels;++j){for(var z=x[B+j*f],W=0;W<n.outChannels;++W)w[D+W*y]+=z*b[F+W];F+=n.outChannels}}}return l.toTensor()},e.prototype.conv3d=function(t,e,n){for(var r=n.filterDepth,i=n.filterHeight,o=n.filterWidth,a=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,c=n.padInfo.front,l=n.padInfo.left,h=n.padInfo.top,d=yp(n.outShape,t.dtype),p=this.readSync(t.dataId),f=this.readSync(e.dataId),m=d.values,v=0;v<n.batchSize;++v)for(var g=v*t.strides[0],y=v*d.strides[0],x=0;x<n.outDepth;++x)for(var b=y+x*d.strides[1],w=x*n.strideDepth-c,_=0;_<r;_++){var E=w+_*a;if(!(E<0||E>=n.inDepth))for(var C=_*e.strides[0],I=g+E*t.strides[1],S=0;S<n.outHeight;++S)for(var k=b+S*d.strides[2],T=S*n.strideHeight-h,N=0;N<i;N++){var R=T+N*s;if(!(R<0||R>=n.inHeight))for(var A=C+N*e.strides[1],P=I+R*t.strides[2],D=0;D<n.outWidth;++D)for(var M=k+D*n.outChannels,O=D*n.strideWidth-l,L=0;L<o;L++){var B=O+L*u;if(!(B<0||B>=n.inWidth))for(var F=A+L*e.strides[2],j=P+B*n.inChannels,z=F,W=0;W<n.inChannels;++W){for(var U=p[j+W],V=0;V<n.outChannels;++V)m[M+V]+=U*f[z+V];z+=n.outChannels}}}}return d.toTensor()},e.prototype.conv2dDerInput=function(t,e,n){cw([t,e],"conv2dDerInput");for(var r=yp(n.inShape,"float32"),i=r.values,o=this.readSync(t.dataId),a=this.readSync(e.dataId),s=e.strides,u=s[0],c=s[1],l=s[2],h=n.batchSize,d=n.filterHeight,p=n.filterWidth,f=n.inChannels,m=n.inHeight,v=n.inWidth,g=n.outChannels,y=n.outHeight,x=n.outWidth,b=n.strideHeight,w=n.strideWidth,_=n.dataFormat,E=d-1-n.padInfo.top,C=p-1-n.padInfo.left,I="channelsLast"===_,S=r.strides[0],k=I?r.strides[1]:r.strides[2],T=I?r.strides[2]:1,N=I?1:r.strides[1],R=t.strides[0],A=I?t.strides[1]:t.strides[2],P=I?t.strides[2]:1,D=I?1:t.strides[1],M=0;M<h;++M)for(var O=0;O<f;++O)for(var L=0;L<m;++L)for(var B=L-E,F=Math.max(0,Math.ceil(B/b)),j=Math.min(y,(d+B)/b),z=0;z<v;++z){for(var W=z-C,U=Math.max(0,Math.ceil(W/w)),V=Math.min(x,(p+W)/w),H=0,G=F;G<j;++G)for(var q=G*b-B,K=U;K<V;++K)for(var Z=R*M+A*G+P*K,X=u*(d-1-q)+c*(p-1-(K*w-W))+l*O,$=0;$<g;++$)H+=o[Z+D*$]*a[X+$];i[S*M+k*L+T*z+N*O]=H}return r.toTensor()},e.prototype.conv3dDerInput=function(t,e,n){for(var r=yp(n.inShape,"float32"),i=r.values,o=r.strides,a=o[0],s=o[1],u=o[2],c=o[3],l=this.readSync(t.dataId),h=t.strides,d=h[0],p=h[1],f=h[2],m=h[3],v=this.readSync(e.dataId),g=e.strides,y=g[0],x=g[1],b=g[2],w=g[3],_=n.batchSize,E=n.filterDepth,C=n.filterHeight,I=n.filterWidth,S=n.inChannels,k=n.inDepth,T=n.inHeight,N=n.inWidth,R=n.outChannels,A=n.outDepth,P=n.outHeight,D=n.outWidth,M=n.strideDepth,O=n.strideHeight,L=n.strideWidth,B=E-1-n.padInfo.front,F=C-1-n.padInfo.top,j=I-1-n.padInfo.left,z=0;z<_;++z)for(var W=0;W<S;++W)for(var U=0;U<k;++U)for(var V=U-B,H=Math.max(0,Math.ceil(V/M)),G=Math.min(A,(E+V)/M),q=0;q<T;++q)for(var K=q-F,Z=Math.max(0,Math.ceil(K/O)),X=Math.min(P,(C+K)/O),$=0;$<N;++$){for(var Y=$-j,J=Math.max(0,Math.ceil(Y/L)),Q=Math.min(D,(I+Y)/L),tt=0,et=H;et<G;++et)for(var nt=et*M-V,rt=Z;rt<X;++rt)for(var it=rt*O-K,ot=J;ot<Q;++ot)for(var at=d*z+p*et+f*rt+m*ot,st=y*(E-1-nt)+x*(C-1-it)+b*(I-1-(ot*L-Y))+w*W,ut=0;ut<R;++ut)tt+=l[at+ut]*v[st+ut];i[a*z+s*U+u*q+c*$+W]=tt}return r.toTensor()},e.prototype.conv2dDerFilter=function(t,e,n){cw([t,e],"conv2dDerFilter");for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s="channelsLast"===n.dataFormat,u=yp(n.filterShape,"float32"),c=n.padInfo.left,l=n.padInfo.top,h=this.bufferSync(t),d=this.bufferSync(e),p=0;p<o;++p)for(var f=Math.max(0,Math.ceil((l-p)/r)),m=Math.min(n.outHeight,(n.inHeight+l-p)/r),v=0;v<a;++v)for(var g=Math.max(0,Math.ceil((c-v)/i)),y=Math.min(n.outWidth,(n.inWidth+c-v)/i),x=0;x<n.inChannels;++x)for(var b=0;b<n.outChannels;++b){for(var w=0,_=0;_<n.batchSize;++_)for(var E=f;E<m;++E)for(var C=p+E*r-l,I=g;I<y;++I){var S=v+I*i-c;w+=s?h.get(_,C,S,x)*d.get(_,E,I,b):h.get(_,x,C,S)*d.get(_,b,E,I)}u.set(w,p,v,x,b)}return u.toTensor()},e.prototype.conv3dDerFilter=function(t,e,n){for(var r=n.strideDepth,i=n.strideHeight,o=n.strideWidth,a=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=yp(n.filterShape,"float32"),l=c.values,h=c.strides,d=h[0],p=h[1],f=h[2],m=h[3],v=this.readSync(e.dataId),g=e.strides,y=g[0],x=g[1],b=g[2],w=g[3],_=this.readSync(t.dataId),E=t.strides,C=E[0],I=E[1],S=E[2],k=E[3],T=n.padInfo.front,N=n.padInfo.left,R=n.padInfo.top,A=0;A<a;++A)for(var P=Math.max(0,Math.ceil((T-A)/r)),D=Math.min(n.outDepth,(n.inDepth+T-A)/r),M=A*d,O=0;O<s;++O)for(var L=Math.max(0,Math.ceil((R-O)/i)),B=Math.min(n.outHeight,(n.inHeight+R-O)/i),F=O*p+M,j=0;j<u;++j)for(var z=Math.max(0,Math.ceil((N-j)/o)),W=Math.min(n.outWidth,(n.inWidth+N-j)/o),U=j*f+F,V=0;V<n.inChannels;++V)for(var H=V*m+U,G=0;G<n.outChannels;++G){for(var q=0,K=0;K<n.batchSize;++K)for(var Z=K*C,X=K*y,$=P;$<D;++$)for(var Y=(A+$*r-T)*I+Z,J=$*x+X,Q=L;Q<B;++Q)for(var tt=(O+Q*i-R)*S+Y,et=Q*b+J,nt=z;nt<W;++nt){var rt=nt*w+et;q+=_[(j+nt*o-N)*k+tt+V]*v[rt+G]}l[H+G]=q}return c.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var e=t.input,n=t.filter,r=t.convInfo,i=t.bias,o=t.activation,a=t.preluActivationWeights,s=this.depthwiseConv2D(e,n,r);return i&&(s=this.add(s,i)),o&&(s=lw(this,s,o,a)),s},e.prototype.depthwiseConv2D=function(t,e,n){cw([t,e],"depthwiseConv2D");for(var r=n.filterHeight,i=n.filterWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c=n.outChannels/n.inChannels,l=yp(n.outShape,t.dtype),h=this.readSync(t.dataId),d=this.readSync(e.dataId),p=l.values,f=0;f<n.batchSize;++f)for(var m=f*t.strides[0],v=f*l.strides[0],g=0;g<n.outHeight;++g)for(var y=v+g*l.strides[1],x=g*n.strideHeight-s,b=0;b<r;++b){var w=x+b*o;if(!(w<0||w>=n.inHeight))for(var _=b*e.strides[0],E=m+w*t.strides[1],C=0;C<n.outWidth;++C)for(var I=y+C*l.strides[2],S=C*n.strideWidth-u,k=0;k<i;++k){var T=S+k*a;if(!(T<0||T>=n.inWidth))for(var N=_+k*e.strides[1],R=E+T*n.inChannels,A=I,P=N,D=0;D<n.inChannels;++D){for(var M=h[R+D],O=0;O<c;++O)p[A+O]+=M*d[P+O];A+=c,P+=c}}}return l.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,e,n){cw([t,e],"depthwiseConv2DDerInput");for(var r=yp(n.inShape,"float32"),i=r.values,o=r.strides,a=o[0],s=o[1],u=o[2],c=this.readSync(t.dataId),l=t.strides,h=l[0],d=l[1],p=l[2],f=this.readSync(e.dataId),m=e.strides,v=m[0],g=m[1],y=m[2],x=n.batchSize,b=n.filterHeight,w=n.filterWidth,_=n.inChannels,E=n.inHeight,C=n.inWidth,I=n.outChannels,S=n.outHeight,k=n.outWidth,T=n.strideHeight,N=n.strideWidth,R=b-1-n.padInfo.top,A=w-1-n.padInfo.left,P=I/_,D=0;D<x;++D)for(var M=0;M<_;++M)for(var O=0;O<E;++O)for(var L=O-R,B=Math.max(0,Math.ceil(L/T)),F=Math.min(S,(b+L)/T),j=0;j<C;++j){for(var z=j-A,W=Math.max(0,Math.ceil(z/N)),U=Math.min(k,(w+z)/N),V=0,H=B;H<F;++H)for(var G=H*T-L,q=W;q<U;++q)for(var K=h*D+d*H+p*q,Z=v*(b-1-G)+g*(w-1-(q*N-z))+y*M,X=0;X<P;++X)V+=c[K+(M*P+X)]*f[Z+X];i[a*D+s*O+u*j+M]=V}return r.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,e,n){cw([t,e],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s=yp(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,l=n.outChannels/n.inChannels,h=this.bufferSync(t),d=this.bufferSync(e),p=0;p<o;++p)for(var f=Math.max(0,Math.ceil((c-p)/r)),m=Math.min(n.outHeight,(n.inHeight+c-p)/r),v=0;v<a;++v)for(var g=Math.max(0,Math.ceil((u-v)/i)),y=Math.min(n.outWidth,(n.inWidth+u-v)/i),x=0;x<n.outChannels;++x){for(var b=Math.trunc(x/l),w=x%l,_=0,E=0;E<n.batchSize;++E)for(var C=f;C<m;++C)for(var I=p+C*r-c,S=g;S<y;++S){var k=v+S*i-u;_+=h.get(E,I,k,b)*d.get(E,C,S,x)}s.set(_,p,v,b,w)}return s.toTensor()},e.prototype.tile=function(t,e){return cw(t,"tile"),Hf(this.bufferSync(t),e)},e.prototype.pad=function(t,e,n){cw(t,"pad");var r=e.map(function(e,n){return e[0]+t.shape[n]+e[1]}),i=e.map(function(t){return t[0]}),o=this.bufferSync(t),a=yp(r,t.dtype);0!==n&&a.values.fill(n);for(var s=0;s<t.size;s++){var u=o.indexToLoc(s),c=u.map(function(t,e){return t+i[e]});a.set.apply(a,[o.get.apply(o,u)].concat(c))}return a.toTensor()},e.prototype.transpose=function(t,e){cw(t,"transpose");for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[e[r]];var i=this.readSync(t.dataId),o=yp(n,t.dtype),a=this.bufferSync(t);for(r=0;r<t.size;++r){for(var s=a.indexToLoc(r),u=new Array(s.length),c=0;c<u.length;c++)u[c]=s[e[c]];var l=o.locToIndex(u);o.values[l]=i[r]}return o.toTensor()},e.prototype.gather=function(t,e,n){cw([t,e],"gather");var r=t.shape.slice(),i=this.readSync(e.dataId);r[n]=i.length;for(var o=yp(r,t.dtype),a=this.bufferSync(t),s=0;s<o.size;++s){var u=o.indexToLoc(s),c=u.slice();c[n]=i[u[n]];var l=a.locToIndex(c);o.values[s]=a.values[l]}return o.toTensor()},e.prototype.batchToSpaceND=function(t,e,n){cw([t],"batchToSpaceND");var r=e.reduce(function(t,e){return t*e}),i=Gp(t.shape,e,r),o=qp(i.length,e.length),a=Kp(t.shape,e,r),s=Zp(n,e.length),u=Xp(a,n,e.length);return t.reshape(i).transpose(o).reshape(a).slice(s,u)},e.prototype.spaceToBatchND=function(t,e,n){cw([t],"spaceToBatchND");var r=e.reduce(function(t,e){return t*e}),i=[[0,0]];i.push.apply(i,n);for(var o=1+e.length;o<t.shape.length;++o)i.push([0,0]);var a=t.pad(i),s=Gp(a.shape,e,r,!1),u=qp(s.length,e.length,!1),c=Kp(a.shape,e,r,!1);return a.reshape(s).transpose(u).reshape(c)},e.prototype.pool=function(t,e,n){cw(t,"pool");for(var r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=e.padInfo.top,l=e.padInfo.left,h="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,d=this.readSync(t.dataId),p=yp(e.outShape,t.dtype),f=p.values,m=e.outShape[1]*e.outShape[2]*e.outShape[3],v=e.outShape[2]*e.outShape[3],g=e.outShape[3],y=0;y<e.batchSize;++y)for(var x=y*m,b=y*t.strides[0],w=0;w<e.inChannels;++w)for(var _=0;_<e.outHeight;++_)for(var E=_*r-c,C=Math.max(0,E),I=Math.min(e.inHeight,s+E),S=x+_*v,k=0;k<e.outWidth;++k){for(var T=k*i-l,N=Math.max(0,T),R=Math.min(e.inWidth,u+T),A=h,P=0,D=0,M=C;M<I;M+=o){for(var O=b+M*t.strides[1],L=N;L<R;L+=a){var B=d[O+L*t.strides[2]+w];"max"===n&&B>A?A=B:"avg"===n&&(P+=B,D++)}if(isNaN(A))break}f[S+k*g+w]="avg"===n?P/D:A}return p.toTensor()},e.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},e.prototype.maxPoolPositions=function(t,e){for(var n=yp(e.outShape,"int32"),r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=e.padInfo.top,l=e.padInfo.left,h=this.bufferSync(t),d=0;d<e.batchSize;++d)for(var p=0;p<e.inChannels;++p)for(var f=0;f<e.outHeight;++f){for(var m=f*r-c,v=m;v<0;)v+=o;for(var g=Math.min(e.inHeight,s+m),y=0;y<e.outWidth;++y){for(var x=y*i-l,b=x;b<0;)b+=a;for(var w=Math.min(e.inWidth,u+x),_=Number.NEGATIVE_INFINITY,E=-1,C=v;C<g;C+=o)for(var I=C-m,S=b;S<w;S+=a){var k=S-x,T=h.get(d,C,S,p);T>_&&(_=T,E=I*u+k)}n.set(E,d,f,y,p)}}return n.toTensor()},e.prototype.maxPoolBackprop=function(t,e,n,r){cw([e,n],"maxPoolBackprop");for(var i=this.maxPoolPositions(e,r),o=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,h=l-1-r.padInfo.left,d=c-1-r.padInfo.top,p=yp(e.shape,"float32"),f=this.bufferSync(i),m=this.bufferSync(t),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var x=0;x<r.inWidth;++x){for(var b=y-d,w=x-h,_=0,E=0;E<c;E+=s){var C=(b+E)/o;if(!(C<0||C>=r.outHeight||Math.floor(C)!==C))for(var I=0;I<l;I+=u){var S=(w+I)/a;if(!(S<0||S>=r.outWidth||Math.floor(S)!==S)){var k=c*l-1-f.get(v,C,S,g)===E*l+I?1:0;0!==k&&(_+=m.get(v,C,S,g)*k)}}}p.set(_,v,y,x,g)}return p.toTensor()},e.prototype.avgPoolBackprop=function(t,e,n){cw([t,e],"avgPoolBackprop");for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,h=l-1-n.padInfo.left,d=c-1-n.padInfo.top,p=yp(e.shape,"float32"),f=1/(o*a),m=this.bufferSync(t),v=0;v<n.batchSize;++v)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var x=0;x<n.inWidth;++x){for(var b=y-d,w=x-h,_=0,E=0;E<c;E+=s){var C=(b+E)/r;if(!(C<0||C>=n.outHeight||Math.floor(C)!==C))for(var I=0;I<l;I+=u){var S=(w+I)/i;S<0||S>=n.outWidth||Math.floor(S)!==S||(_+=m.get(v,C,S,g))}}p.set(_*f,v,y,x,g)}return p.toTensor()},e.prototype.pool3d=function(t,e,n){cw(t,"pool3d");for(var r=e.strideDepth,i=e.strideHeight,o=e.strideWidth,a=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,p=e.padInfo.top,f=e.padInfo.left,m="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=this.readSync(t.dataId),g=yp(e.outShape,t.dtype),y=g.values,x=e.outShape[1]*e.outShape[2]*e.outShape[3]*e.outShape[4],b=e.outShape[2]*e.outShape[3]*e.outShape[4],w=e.outShape[3]*e.outShape[4],_=e.outShape[4],E=0;E<e.batchSize;++E)for(var C=E*x,I=E*t.strides[0],S=0;S<e.inChannels;++S)for(var k=0;k<e.outDepth;++k){for(var T=k*r-d,N=T;N<0;)N+=a;for(var R=Math.min(e.inDepth,c+T),A=C+k*b,P=0;P<e.outHeight;++P){for(var D=P*i-p,M=D;M<0;)M+=s;for(var O=Math.min(e.inHeight,l+D),L=A+P*w,B=0;B<e.outWidth;++B){for(var F=B*o-f,j=F;j<0;)j+=u;for(var z=Math.min(e.inWidth,h+F),W=L+B*_,U=m,V=0,H=0,G=N;G<R;G+=a){for(var q=I+G*t.strides[1],K=M;K<O;K+=s){for(var Z=q+K*t.strides[2],X=j;X<z;X+=u){var $=v[Z+X*t.strides[3]+S];if("max"===n&&$>U?U=$:"avg"===n&&(V+=$,H++),isNaN(U))break}if(isNaN(U))break}if(isNaN(U))break}y[W+S]="avg"===n?V/H:U}}}return g.toTensor()},e.prototype.avgPool3d=function(t,e){return cw(t,"avgPool3d"),this.pool3d(t,e,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,e,n){cw([t,e],"avgPool3dBackprop");for(var r=n.strideDepth,i=n.strideHeight,o=n.strideWidth,a=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=n.dilationDepth,l=n.dilationHeight,h=n.dilationWidth,d=n.effectiveFilterDepth,p=n.effectiveFilterHeight,f=n.effectiveFilterWidth,m=d-1-n.padInfo.front,v=f-1-n.padInfo.left,g=p-1-n.padInfo.top,y=yp(e.shape,"float32"),x=1/(a*s*u),b=this.bufferSync(t),w=0;w<n.batchSize;++w)for(var _=0;_<n.inChannels;++_)for(var E=0;E<n.inDepth;++E)for(var C=0;C<n.inHeight;++C)for(var I=0;I<n.inWidth;++I){for(var S=E-m,k=C-g,T=I-v,N=0,R=0;R<d;R+=c){var A=(S+R)/r;if(!(A<0||A>=n.outDepth||Math.floor(A)!==A))for(var P=0;P<p;P+=l){var D=(k+P)/i;if(!(D<0||D>=n.outHeight||Math.floor(D)!==D))for(var M=0;M<f;M+=h){var O=(T+M)/o;O<0||O>=n.outWidth||Math.floor(O)!==O||(N+=b.get(w,A,D,O,_))}}}y.set(N*x,w,E,C,I,_)}return y.toTensor()},e.prototype.maxPool3d=function(t,e){return cw(t,"maxPool3d"),this.pool3d(t,e,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,e){for(var n=yp(e.outShape,"int32"),r=e.strideDepth,i=e.strideHeight,o=e.strideWidth,a=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,p=e.padInfo.top,f=e.padInfo.left,m=this.bufferSync(t),v=0;v<e.batchSize;++v)for(var g=0;g<e.inChannels;++g)for(var y=0;y<e.outDepth;++y){for(var x=y*r-d,b=x;b<0;)b+=a;for(var w=Math.min(e.inDepth,c+x),_=0;_<e.outHeight;++_){for(var E=_*i-p,C=E;C<0;)C+=s;for(var I=Math.min(e.inHeight,l+E),S=0;S<e.outWidth;++S){for(var k=S*o-f,T=k;T<0;)T+=u;for(var N=Math.min(e.inWidth,h+k),R=Number.NEGATIVE_INFINITY,A=-1,P=b;P<w;P+=a)for(var D=P-x,M=C;M<I;M+=s)for(var O=M-E,L=T;L<N;L+=u){var B=L-k,F=m.get(v,P,M,L,g);F>=R&&(R=F,A=D*l*h+O*l+B)}n.set(A,v,y,_,S,g)}}}return n.toTensor()},e.prototype.maxPool3dBackprop=function(t,e,n,r){cw([e,n],"maxPool3dBackprop");for(var i=this.maxPool3dPositions(e,r),o=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,h=r.effectiveFilterDepth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,f=h-1-r.padInfo.front,m=p-1-r.padInfo.left,v=d-1-r.padInfo.top,g=yp(e.shape,"float32"),y=this.bufferSync(i),x=this.bufferSync(t),b=0;b<r.batchSize;++b)for(var w=0;w<r.inChannels;++w)for(var _=0;_<r.inDepth;++_)for(var E=0;E<r.inHeight;++E)for(var C=0;C<r.inWidth;++C){for(var I=_-f,S=E-v,k=C-m,T=0,N=0;N<h;N+=u){var R=(I+N)/o;if(!(R<0||R>=r.outDepth||Math.floor(R)!==R))for(var A=0;A<d;A+=c){var P=(S+A)/a;if(!(P<0||P>=r.outHeight||Math.floor(P)!==P))for(var D=0;D<p;D+=l){var M=(k+D)/s;if(!(M<0||M>=r.outWidth||Math.floor(M)!==M)){var O=h*d*p-1-y.get(b,R,P,M,w)===N*d*p+A*p+D?1:0;0!==O&&(T+=x.get(b,R,P,M,w)*O)}}}}g.set(T,b,_,E,C,w)}return g.toTensor()},e.prototype.cast=function(t,e){return Tf(t,e,this)},e.prototype.reshape=function(t,e){return Nf(t,e)},e.prototype.avgPool=function(t,e){return cw(t,"avgPool"),this.pool(t,e,"avg").toFloat()},e.prototype.resizeBilinear=function(t,e,n,r){cw(t,"resizeBilinear");for(var i=t.shape,o=i[0],a=i[1],s=i[2],u=i[3],c=this.readSync(t.dataId),l=new Float32Array(Vl([o,e,n,u])),h=[r&&e>1?a-1:a,r&&n>1?s-1:s],d=[r&&e>1?e-1:e,r&&n>1?n-1:n],p=0,f=h[0]/d[0],m=h[1]/d[1],v=0;v<o;v++)for(var g=0;g<e;g++)for(var y=f*g,x=Math.floor(y),b=y-x,w=Math.min(a-1,Math.ceil(y)),_=v*t.strides[0]+x*t.strides[1],E=v*t.strides[0]+w*t.strides[1],C=0;C<n;C++)for(var I=m*C,S=Math.floor(I),k=I-S,T=Math.min(s-1,Math.ceil(I)),N=_+S*t.strides[2],R=E+S*t.strides[2],A=_+T*t.strides[2],P=E+T*t.strides[2],D=0;D<u;D++){var M=c[N+D],O=c[R+D],L=M+(c[A+D]-M)*k,B=L+(O+(c[P+D]-O)*k-L)*b;l[p++]=B}return Wd(l,[o,e,n,u])},e.prototype.resizeBilinearBackprop=function(t,e,n){cw([t,e],"resizeBilinearBackprop");for(var r=e.shape,i=r[0],o=r[1],a=r[2],s=r[3],u=t.shape,c=u[1],l=u[2],h=new Float32Array(i*o*a*s),d=[n&&c>1?o-1:o,n&&l>1?a-1:a],p=[n&&c>1?c-1:c,n&&l>1?l-1:l],f=d[0]/p[0],m=d[1]/p[1],v=this.readSync(t.dataId),g=0,y=0;y<i;y++)for(var x=y*e.strides[0],b=0;b<c;b++)for(var w=b*f,_=Math.floor(w),E=Math.min(Math.ceil(w),o-1),C=x+_*e.strides[1],I=x+E*e.strides[1],S=w-_,k=1-S,T=0;T<l;T++)for(var N=T*m,R=Math.floor(N),A=Math.min(Math.ceil(N),a-1),P=N-R,D=1-P,M=C+R*e.strides[2],O=C+A*e.strides[2],L=I+R*e.strides[2],B=I+A*e.strides[2],F=k*D,j=k*P,z=S*D,W=S*P,U=0;U<s;U++){var V=v[g++];h[M+U]+=V*F,h[O+U]+=V*j,h[L+U]+=V*z,h[B+U]+=V*W}return Kd(h,[i,a,o,s],e.dtype)},e.prototype.resizeNearestNeighbor=function(t,e,n,r){cw(t,"resizeNearestNeighbor");for(var i=t.shape,o=i[0],a=i[1],s=i[2],u=i[3],c=this.readSync(t.dataId),l=new Float32Array(o*e*n*u),h=[r&&e>1?a-1:a,r&&n>1?s-1:s],d=[r&&e>1?e-1:e,r&&n>1?n-1:n],p=h[0]/d[0],f=h[1]/d[1],m=0,v=0;v<o;v++)for(var g=v*t.strides[0],y=0;y<e;y++)for(var x=p*y,b=g+Math.min(a-1,r?Math.round(x):Math.floor(x))*t.strides[1],w=0;w<n;w++)for(var _=f*w,E=b+Math.min(s-1,r?Math.round(_):Math.floor(_))*t.strides[2],C=0;C<u;C++){var I=c[E+C];l[m++]=I}return Wd(l,[o,e,n,u],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,e,n){cw([t,e],"resizeNearestNeighborBackprop");for(var r=e.shape,i=r[0],o=r[1],a=r[2],s=r[3],u=t.shape,c=u[1],l=u[2],h=new Float32Array(i*o*a*s),d=this.readSync(t.dataId),p=[n&&c>1?o-1:o,n&&l>1?a-1:a],f=[n&&c>1?c-1:c,n&&l>1?l-1:l],m=p[0]/f[0],v=p[1]/f[1],g=1/m,y=1/v,x=2*Math.ceil(g)+2,b=2*Math.ceil(y)+2,w=0;w<i;w++)for(var _=w*e.strides[0],E=0;E<o;E++)for(var C=_+E*e.strides[1],I=Math.floor(E*g),S=Math.floor(I-x/2),k=0;k<a;k++)for(var T=C+k*e.strides[2],N=Math.floor(k*y),R=Math.floor(N-b/2),A=0;A<s;A++){for(var P=0,D=0;D<x;D++){var M=D+S;if(!(M<0||M>=c)){var O=_+M*t.strides[1],L=M*m;if(E===Math.min(o-1,n?Math.round(L):Math.floor(L)))for(var B=0;B<b;B++){var F=B+R;if(!(F<0||F>=l)){var j=O+F*t.strides[2],z=F*v;k===Math.min(a-1,n?Math.round(z):Math.floor(z))&&(P+=d[j+A])}}}}h[T+A]=P}return Kd(h,e.shape,e.dtype)},e.prototype.batchNormalization=function(t,e,n,r,i,o){cw([t,e,n,i,o],"batchNorm");for(var a=this.readSync(t.dataId),s=this.readSync(e.dataId),u=this.readSync(n.dataId),c=i?this.readSync(i.dataId):new Float32Array([1]),l=o?this.readSync(o.dataId):new Float32Array([0]),h=new Float32Array(a.length),d=l.length,p=c.length,f=u.length,m=s.length,v=0,g=0,y=0,x=0,b=0;b<a.length;++b)h[b]=l[v++]+(a[b]-s[g++])*c[y++]/Math.sqrt(u[x++]+r),v>=d&&(v=0),g>=m&&(g=0),y>=p&&(y=0),x>=f&&(x=0);return Kd(h,t.shape)},e.prototype.localResponseNormalization4D=function(t,e,n,r,i){cw(t,"localResponseNormalization4D");var o=t.shape[3],a=o-1,s=this.readSync(t.dataId),u=t.size,c=new Float32Array(u);function l(t){for(var n=t%o,r=t-n+Math.max(0,n-e),i=t-n+Math.min(n+e,a),u=0;r<=i;r++){var c=s[r];u+=c*c}return u}for(var h=0;h<u;h++){var d=l(h),p=s[h]*Math.pow(n+r*d,-i);c[h]=p}return Kd(c,t.shape)},e.prototype.LRNGrad=function(t,e,n,r,i,o,a){cw(t,"LRNGrad");for(var s=t.shape[3],u=this.readSync(t.dataId),c=this.readSync(e.dataId),l=this.readSync(n.dataId),h=new Float32Array(t.size),d=t.size,p=0;p<d;p++){for(var f=p%s,m=p-f+Math.max(0,f-r),v=p-f+Math.min(s,f+r+1),g=0,y=m;y<v;y++)g+=Math.pow(c[y],2);for(g=o*g+i,y=m;y<v;y++){var x=-2*o*a*c[y]*l[p]/g;p===y&&(x+=Math.pow(g,-a)),x*=u[p],h[y]+=x}}return Kd(h,t.shape)},e.prototype.multinomial=function(t,e,n,r){cw(t,"multinomial");for(var i=e?t:uf(t),o=i.shape[0],a=i.shape[1],s=Xd([o,n],"int32"),u=this.readSync(s.dataId),c=this.readSync(i.dataId),l=0;l<o;++l){var h=l*a,d=new Float32Array(a-1);d[0]=c[h];for(var p=1;p<d.length;++p)d[p]=d[p-1]+c[h+p];for(var f=fp(r.toString()),m=l*n,v=0;v<n;++v){var g=f();u[m+v]=d.length;for(var y=0;y<d.length;y++)if(g<d[y]){u[m+v]=y;break}}}return s},e.prototype.oneHot=function(t,e,n,r){cw(t,"oneHot");var i=new Float32Array(t.size*e);i.fill(r);for(var o=this.readSync(t.dataId),a=0;a<t.size;++a)o[a]>=0&&o[a]<e&&(i[a*e+o[a]]=n);return Gd(i,[t.size,e],"int32")},e.prototype.nonMaxSuppression=function(t,e,n,r,i){return cw(t,"nonMaxSuppression"),Bf(this.readSync(t.dataId),this.readSync(e.dataId),n,r,i)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,e){for(var n=t.shape[0],r=t.shape[1],i=yp(t.shape,"float32"),o=yp(t.shape,"float32"),a=jd(t).as2D(n,r),s=zd(t).as2D(n,r),u=0;u<n;u++)for(var c=a.slice([u,0],[1,r]),l=s.slice([u,0],[1,r]),h=Fd(c,l),d=this.readSync(this.fftImpl(h,e).dataId),p=0;p<r;p++){var f=Pf(d,p);i.values[u*r+p]=f.real,o.values[u*r+p]=f.imag}return Fd(i.toTensor(),o.toTensor()).as2D(n,r)},e.prototype.fftImpl=function(t,e){var n=t.as1D(),r=n.size;if(this.isExponentOf2(r)){var i=this.fftRadix2(n,r,e).as2D(t.shape[0],t.shape[1]);return e&&(i=Fd(jd(i).div(Vd(r)),zd(i).div(Vd(r)))),i}var o=this.readSync(t.dataId),a=function(t){for(var e=new Float32Array(t.length/2),n=new Float32Array(t.length/2),r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}(this.fourierTransformByMatmul(o,r,e));return Fd(a.real,a.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return!(t&t-1)},e.prototype.fftRadix2=function(t,e,n){if(1===e)return t;var r=this.readSync(t.dataId),i=e/2,o=function(t){for(var e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e),i=0;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],r[Math.floor(i/4)]=t[i+1];return{real:n,imag:r}}(r),a=Fd(o.real,o.imag).as1D(),s=function(t){for(var e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e),i=2;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],r[Math.floor(i/4)]=t[i+1];return{real:n,imag:r}}(r),u=Fd(s.real,s.imag).as1D();a=this.fftRadix2(a,i,n),u=this.fftRadix2(u,i,n);var c=function(t,e){for(var n=new Float32Array(t/2),r=new Float32Array(t/2),i=0;i<Math.ceil(t/2);i++){var o=(e?2:-2)*Math.PI*(i/t);n[i]=Math.cos(o),r[i]=Math.sin(o)}return{real:n,imag:r}}(e,n),l=Fd(c.real,c.imag).mul(u),h=a.add(l),d=a.sub(l),p=jd(h).concat(jd(d)),f=zd(h).concat(zd(d));return Fd(p,f).as1D()},e.prototype.fourierTransformByMatmul=function(t,e,n){for(var r=new Float32Array(2*e),i=0;i<e;i++){for(var o=0,a=0,s=0;s<e;s++){var u=Mf(i*s,e,n),c=Pf(t,s);o+=c.real*u.real-c.imag*u.imag,a+=c.real*u.imag+c.imag*u.real}n&&(o/=e,a/=e),Df(r,o,a,i)}return r},e.prototype.depthToSpace=function(t,e,n){jl("NHWC"===n,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),jl(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});for(var r=t.shape[0],i=t.shape[1],o=t.shape[2],a=t.shape[3],s=i*e,u=o*e,c=a/(e*e),l=this.readSync(t.dataId),h=new Float32Array(r*s*u*c),d=0,p=0;p<r;++p)for(var f=0;f<s;++f)for(var m=Math.floor(f/e),v=f%e,g=0;g<u;++g)for(var y=Math.floor(g/e),x=(v*e+g%e)*c,b=0;b<c;++b){var w=b+x+a*(y+o*(m+i*p));h[d++]=l[w]}return Kd(h,[r,s,u,c])},e.prototype.broadcastedBinaryOp=function(t,e,n,r){var i=mf(t.shape,e.shape),o=yp(i,n),a=this.readSync(t.dataId),s=this.readSync(e.dataId),u=pf(t.shape,i),c=pf(e.shape,i),l=o.values;if(u.length+c.length===0)for(var h=0;h<l.length;++h)l[h]=r(a[h%a.length],s[h%s.length]);else{var d=this.bufferSync(t),p=this.bufferSync(e),f=function(n){var i=o.indexToLoc(n),h=i.slice(-t.rank);u.forEach(function(t){return h[t]=0});var f=d.locToIndex(h),m=i.slice(-e.rank);c.forEach(function(t){return m[t]=0});var v=p.locToIndex(m);l[n]=r(a[f],s[v])};for(h=0;h<l.length;++h)f(h)}return o.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,e,n){var r=mf(t.shape,e.shape),i=yp(r,"float32"),o=yp(r,"float32"),a=this.readSync(t.dataId),s=this.readSync(e.dataId),u=pf(t.shape,r),c=pf(e.shape,r),l=i.values,h=o.values;if(u.length+c.length===0)for(var d=0;d<l.length;d++){var p=d%a.length,f=d%s.length,m=n(a[2*p],a[2*p+1],s[2*f],s[2*f+1]);l[d]=m.real,h[d]=m.imag}else{var v=this.bufferSync(this.data.get(t.dataId).complexTensors.real),g=this.bufferSync(this.data.get(e.dataId).complexTensors.real),y=function(r){var o=i.indexToLoc(r),d=o.slice(-t.rank);u.forEach(function(t){return d[t]=0});var p=v.locToIndex(d),f=o.slice(-e.rank);c.forEach(function(t){return f[t]=0});var m=g.locToIndex(f),y=n(a[2*p],a[2*p+1],s[2*m],s[2*m+1]);l[r]=y.real,h[r]=y.imag};for(d=0;d<l.length;d++)y(d)}return this.complex(i.toTensor(),o.toTensor())},e.prototype.split=function(t,e,n){return Vf(t,e,n)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,e,n,r,i,o){for(var a=t.shape,s=a[0],u=a[1],c=a[2],l=a[3],h=e.shape[0],d=r[0],p=r[1],f=yp([h,d,p,l],"float32"),m=this.readSync(e.dataId),v=this.readSync(n.dataId),g=this.readSync(t.dataId),y=t.strides,x=f.strides,b=0;b<h;b++){var w=4*b,_=m[w],E=m[w+1],C=m[w+2],I=m[w+3],S=v[b];if(!(S>=s))for(var k=d>1?(C-_)*(u-1)/(d-1):0,T=p>1?(I-E)*(c-1)/(p-1):0,N=0;N<d;N++){var R=d>1?_*(u-1)+N*k:.5*(_+C)*(u-1);if(R<0||R>u-1)for(var A=0;A<p;A++)for(var P=0;P<l;P++){var D=P+A*x[2]+N*x[1]+b*x[0];f.values[D]=o}else if("bilinear"===i){var M=Math.floor(R),O=Math.ceil(R),L=R-M;for(A=0;A<p;A++)if((G=p>1?E*(c-1)+A*T:.5*(E+I)*(c-1))<0||G>c-1)for(P=0;P<l;P++)D=P+A*x[2]+N*x[1]+b*x[0],f.values[D]=o;else{var B=Math.floor(G),F=Math.ceil(G),j=G-B;for(P=0;P<l;P++){var z=g[D=P+B*y[2]+M*y[1]+S*y[0]],W=g[D=P+F*y[2]+M*y[1]+S*y[0]],U=g[D=P+B*y[2]+O*y[1]+S*y[0]],V=z+(W-z)*j,H=U+(g[D=P+F*y[2]+O*y[1]+S*y[0]]-U)*j;D=P+A*x[2]+N*x[1]+b*x[0],f.values[D]=V+(H-V)*L}}}else for(A=0;A<p;++A){var G;if((G=p>1?E*(c-1)+A*T:.5*(E+I)*(c-1))<0||G>c-1)for(P=0;P<l;P++)D=P+A*x[2]+N*x[1]+b*x[0],f.values[D]=o;else{var q=Math.round(G),K=Math.round(R);for(P=0;P<l;P++){var Z=P+q*y[2]+K*y[1]+S*y[0],X=P+A*x[2]+N*x[1]+b*x[0];f.values[X]=g[Z]}}}}}return f.toTensor()},e.prototype.sparseToDense=function(t,e,n,r){var i=Qp(0,t,n),o=i.sliceRank,a=i.numUpdates,s=i.sliceSize,u=i.strides,c=i.outputSize;return this.scatter(t,e,n,c,s,a,o,u,r,!1)},e.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],i=$p(t,e),o=i[0],a=i[1],s=i[2],u=i[3];if(0===a)return Wd([],o,t.dtype);for(var c=new bh([a,s],t.dtype),l=this.readSync(e.dataId),h=this.readSync(t.dataId),d=0;d<a;d++){for(var p=[],f=0,m=0;m<r;m++){var v=l[d*r+m];f+=v*u[m],p.push(v)}if(f<0||f>=t.size/s)throw new Error("Invalid indices: "+p+" does not index into "+t.shape);for(var g=0;g<s;g++)c.values[d*s+g]=h[f*s+g]}return c.toTensor().reshape(o)},e.prototype.scatterND=function(t,e,n){var r=Qp(0,t,n),i=r.sliceRank,o=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,c=Vd(0);return this.scatter(t,e,n,u,a,o,i,s,c,!0)},e.prototype.fill=function(t,e,n){var r=Ql(n=n||rh(e),Vl(t));return r.fill(e),zh.makeTensor(r,t,n,this)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var e=Ql(t.dtype,Vl(t.shape));return this.makeOutput(e,t.shape,t.dtype)},e.prototype.linspace=function(t,e,n){return Rf(t,e,n)},e.prototype.scatter=function(t,e,n,r,i,o,a,s,u,c){var l=[r/i,i],h=this.readSync(t.dataId),d=this.readSync(e.dataId);if(0===r)return Wd([],n,e.dtype);var p=new bh(l,e.dtype);p.values.fill(this.readSync(u.dataId)[0]);for(var f=0;f<o;f++){for(var m=[],v=0,g=0;g<a;g++){var y=h[f*a+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/i)throw new Error("Invalid indices: "+m+" does not index into "+n);for(var x=0;x<i;x++)c?p.values[v*i+x]+=d[f*i+x]:p.values[v*i+x]=0===e.rank?d[0]:d[f*i+x]}return p.toTensor().reshape(n)},e}(hf);zh.registerBackend("cpu",function(){return new hw},1);for(var dw=0,pw=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs,i=e,o=i.boxes,a=i.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,h=s.softNmsSigma,d=n;cw(o,"NonMaxSuppressionWithScore");var p=Ff(d.data.get(o.dataId).values,d.data.get(a.dataId).values,u,c,l,h);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e.x,i=n;cw(r,"square");for(var o=i.data.get(r.dataId).values,a=new Float32Array(o.length),s=0;s<o.length;++s){var u=o[s];a[s]=u*u}return{dataId:i.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Cg,backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e,i=r.a,o=r.b,a=n;cw([i,o],Cg);var s=a.data.get(i.dataId).values,u=a.data.get(o.dataId).values,c=function(t,e,n,r,i,o){var a=mf(t,e),s=a.length,u=ah(a),c=Jl(i,Vl(a)),l=t.length,h=e.length,d=ah(t),p=ah(e),f=pf(t,a),m=pf(e,a);if(f.length+m.length===0)for(var v=0;v<c.length;++v)c[v]=o(n[v%n.length],r[v%r.length]);else{var g=function(t){var e=function(t,e,n){if(0===e)return[];if(1===e)return[t];for(var r=new Array(e),i=0;i<r.length-1;++i)r[i]=Math.floor(t/n[i]),t-=r[i]*n[i];return r[r.length-1]=t,r}(t,s,u),i=e.slice(-l);f.forEach(function(t){return i[t]=0});var a=fh(i,l,d),v=e.slice(-h);m.forEach(function(t){return v[t]=0});var g=fh(v,h,p);c[t]=o(n[a],r[g])};for(v=0;v<c.length;++v)g(v)}return[c,a]}(i.shape,o.shape,s,u,i.dtype,function(t,e){var n=t-e;return n*n}),l=c[0],h=c[1];return{dataId:a.write(l,h,i.dtype),shape:h,dtype:i.dtype}}}];dw<pw.length;dw++)Ml(pw[dw]);for(var fw,mw=function(t){this.variableNames=["A"];var e=Jf(),n=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+e.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},vw=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=Jf(),n=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+e.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+e.output+" = result;\n      }\n    "},gw=0,yw=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs,i=e.pixels,o=r.numChannels,a="undefined"!=typeof HTMLVideoElement&&i instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&i instanceof HTMLImageElement,u=a?[i.videoWidth,i.videoHeight]:[i.width,i.height],c=u[0],l=u[1],h=[l,c],d=[l,c,o];(s||a)&&(null==fw&&(fw=document.createElement("canvas").getContext("2d")),fw.canvas.width=c,fw.canvas.height=l,fw.drawImage(i,0,0,c,l),i=fw.canvas);var p=n.makeTensorInfo(h,"int32");n.texData.get(p.dataId).usage=Hh.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),i);var f=Tl().getBool("WEBGL_PACK")?new vw(d):new mw(d),m=n.runWebGLProgram(f,[p],"int32");return n.disposeData(p.dataId),m}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs;Cd("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=e,o=i.boxes,a=i.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,h=s.softNmsSigma,d=n,p=Ff(d.readSync(o.dataId),d.readSync(a.dataId),u,c,l,h);return[p.selectedIndices,p.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e.x,i=n,o=new Zv(r.shape,"return x * x;");return i.runWebGLProgram(o,[r],r.dtype)}},{kernelName:Cg,backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e,i=r.a,o=r.b,a=n,s=Tl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Sm("return (a - b) * (a - b);",i.shape,o.shape):new Cm("return (a - b) * (a - b);",i.shape,o.shape);return a.compileAndRun(s,[i,o])}}];gw<yw.length;gw++)Ml(yw[gw]);for(var xw=0,bw=[{kernelName:"Square",gradFunc:function(t,e){var n=e[0];return{x:function(){return t.mul(n.toFloat().mul(2))}}}},{kernelName:Cg,gradFunc:function(t,e){var n=e[0],r=e[1],i=Vd(2);return{a:function(){return zy(t,zy(i,Gy(n,r)))},b:function(){return zy(t,zy(i,Gy(r,n)))}}}}];xw<bw.length;xw++)Ol(bw[xw]);var ww=function(){function t(){}return t.prototype.fetch=function(t,e){return fetch(t,e)},t.prototype.now=function(){return performance.now()},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Browser's encoder only supports utf-8, but got "+e);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return new TextDecoder(e).decode(t)},t}();Tl().get("IS_BROWSER")&&Tl().setPlatform("browser",new ww);var _w,Ew=function(){function t(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return t.prototype.fetch=function(t,e){return null!=Tl().global.fetch?Tl().global.fetch(t,e):(null==_w&&(_w=require("node-fetch")),_w(t,e))},t.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)},t}();Tl().get("IS_NODE")&&Tl().setPlatform("node",new Ew);var Cw={float32:4,int32:4,uint16:2,uint8:1,bool:1};function Iw(t,e){for(var n={},r=0,i=function(e){var i=e.name,o=e.dtype,a=e.shape,s=Vl(a),u=void 0;if("quantization"in e){var c=e.quantization;if("uint8"!==c.dtype&&"uint16"!==c.dtype)throw new Error("Weight "+e.name+" has unknown quantization dtype "+c.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=Cw[c.dtype],h=t.slice(r,r+s*l),d="uint8"===c.dtype?new Uint8Array(h):new Uint16Array(h);if("float32"===o)u=Float32Array.from(d,function(t){return t*c.scale+c.min});else{if("int32"!==o)throw new Error("Unsupported dtype in weight '"+i+"': "+o);u=Int32Array.from(d,function(t){return Math.round(t*c.scale+c.min)})}r+=s*l}else if("string"===o){var p=Vl(e.shape);u=[];for(var f=0;f<p;f++){var m=new Uint32Array(t.slice(r,r+4))[0];r+=4;var v=new Uint8Array(t.slice(r,r+m));u.push(v),r+=m}}else{var g=Cw[o];if(h=t.slice(r,r+s*g),"float32"===o)u=new Float32Array(h);else if("int32"===o)u=new Int32Array(h);else{if("bool"!==o)throw new Error("Unsupported dtype in weight '"+i+"': "+o);u=new Uint8Array(h)}r+=s*g}n[i]=Wd(u,a,o)},o=0,a=e;o<a.length;o++)i(a[o]);return n}function Sw(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));var e=0,n=[];t.forEach(function(t){if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+t.constructor.name)});var r=new Uint8Array(e),i=0;return n.forEach(function(t){r.set(new Uint8Array(t.buffer),i),i+=t.byteLength}),r.buffer}var kw="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function Tw(t){return kw?Buffer.byteLength(t):new Blob([t]).size}function Nw(t){var e=0;t.forEach(function(t){e+=t.byteLength});var n=new Uint8Array(e),r=0;return t.forEach(function(t){n.set(new Uint8Array(t),r),r+=t.byteLength}),n.buffer}function Rw(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var e=t.split("/");return e[e.length-1]}function Aw(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:Tw(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:Tw(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var Pw=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e,n){return t.getHandlers(e,"load",n)},t.getHandlers=function(e,n,r){var i=[];return("load"===n?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(function(t){var n=t(e,r);null!==n&&i.push(n)}),i},t}(),Dw="://",Mw=function(){function t(){this.managers={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerManager=function(e,n){jl(null!=e,function(){return"scheme must not be undefined or null."}),e.endsWith(Dw)&&(e=e.slice(0,e.indexOf(Dw))),jl(e.length>0,function(){return"scheme must not be an empty string."});var r=t.getInstance();jl(null==r.managers[e],function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=n},t.getManager=function(t){var e=this.getInstance().managers[t];if(null==e)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function Ow(t){if(-1===t.indexOf(Dw))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Mw.getSchemes().join(","));return{scheme:t.split(Dw)[0],path:t.split(Dw)[1]}}function Lw(t,e,n){return void 0===n&&(n=!1),Il(this,0,void 0,function(){var r,i,o,a,s,u,c,l,h;return Sl(this,function(d){switch(d.label){case 0:return jl(t!==e,function(){return"Old path and new path are the same: '"+t+"'"}),jl((r=Pw.getLoadHandlers(t)).length>0,function(){return"Copying failed because no load handler is found for source URL "+t+"."}),jl(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."}),i=r[0],jl((o=Pw.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),jl(o.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),a=o[0],s=Ow(t).scheme,u=Ow(t).path,c=s===Ow(t).scheme,[4,i.load()];case 1:return l=d.sent(),n&&c?[4,Mw.getManager(s).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,a.save(l)];case 4:return h=d.sent(),!n||c?[3,6]:[4,Mw.getManager(s).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var Bw="models_store",Fw="model_info_store";function jw(){if(!Tl().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window||self,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function zw(t){var e=t.result;e.createObjectStore(Bw,{keyPath:"modelPath"}),e.createObjectStore(Fw,{keyPath:"modelPath"})}var Ww=function(){function t(t){if(this.indexedDB=jw(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return t.prototype.save=function(t){return Il(this,0,void 0,function(){return Sl(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},t.prototype.load=function(){return Il(this,0,void 0,function(){return Sl(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(t,e){var n=this;return new Promise(function(t,r){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return zw(i)},i.onsuccess=function(){var o=i.result;if(null==e){var a=o.transaction(Bw,"readonly"),s=a.objectStore(Bw).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return o.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));t(s.result.modelArtifacts)},s.onerror=function(t){return o.close(),r(s.error)},a.oncomplete=function(){return o.close()}}else{var u,c=Aw(e),l=o.transaction(Fw,"readwrite"),h=l.objectStore(Fw),d=h.put({modelPath:n.modelPath,modelArtifactsInfo:c});d.onsuccess=function(){var i=(u=o.transaction(Bw,"readwrite")).objectStore(Bw).put({modelPath:n.modelPath,modelArtifacts:e,modelArtifactsInfo:c});i.onsuccess=function(){return t({modelArtifactsInfo:c})},i.onerror=function(t){var e=(h=l.objectStore(Fw)).delete(n.modelPath);e.onsuccess=function(){return o.close(),r(i.error)},e.onerror=function(t){return o.close(),r(i.error)}}},d.onerror=function(t){return o.close(),r(d.error)},l.oncomplete=function(){null==u?o.close():u.oncomplete=function(){return o.close()}}}},i.onerror=function(t){return r(i.error)}})},t.URL_SCHEME="indexeddb://",t}(),Uw=function(t){return Tl().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Ww.URL_SCHEME)?(e=t.slice(Ww.URL_SCHEME.length),new Ww(e)):null;var e};Pw.registerSaveRouter(Uw),Pw.registerLoadRouter(Uw);var Vw=function(){function t(){this.indexedDB=jw()}return t.prototype.listModels=function(){return Il(this,0,void 0,function(){var t=this;return Sl(this,function(e){return[2,new Promise(function(e,n){var r=t.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return zw(r)},r.onsuccess=function(){var t=r.result,i=t.transaction(Fw,"readonly"),o=i.objectStore(Fw).getAll();o.onsuccess=function(){for(var t={},n=0,r=o.result;n<r.length;n++){var i=r[n];t[i.modelPath]=i.modelArtifactsInfo}e(t)},o.onerror=function(e){return t.close(),n(o.error)},i.oncomplete=function(){return t.close()}},r.onerror=function(t){return n(r.error)}})]})})},t.prototype.removeModel=function(t){return Il(this,0,void 0,function(){var e=this;return Sl(this,function(n){var r;return t=(r=t).startsWith(Ww.URL_SCHEME)?r.slice(Ww.URL_SCHEME.length):r,[2,new Promise(function(n,r){var i=e.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return zw(i)},i.onsuccess=function(){var e,o=i.result,a=o.transaction(Fw,"readwrite"),s=a.objectStore(Fw),u=s.get(t);u.onsuccess=function(){if(null==u.result)return o.close(),r(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var i=s.delete(t),a=function(){var i=(e=o.transaction(Bw,"readwrite")).objectStore(Bw).delete(t);i.onsuccess=function(){return n(u.result.modelArtifactsInfo)},i.onerror=function(t){return r(u.error)}};i.onsuccess=a,i.onerror=function(t){return a(),o.close(),r(u.error)}},u.onerror=function(t){return o.close(),r(u.error)},a.oncomplete=function(){null==e?o.close():e.oncomplete=function(){return o.close()}}},i.onerror=function(t){return r(i.error)}})]})})},t}();if(Tl().getBool("IS_BROWSER"))try{Mw.registerManager(Ww.URL_SCHEME,new Vw)}catch(Rh){}var Hw="/",Gw="tensorflowjs_models",qw="info",Kw="model_topology",Zw="weight_specs",Xw="weight_data",$w="model_metadata";function Yw(t){return{info:[Gw,t,qw].join(Hw),topology:[Gw,t,Kw].join(Hw),weightSpecs:[Gw,t,Zw].join(Hw),weightData:[Gw,t,Xw].join(Hw),modelMetadata:[Gw,t,$w].join(Hw)}}function Jw(t){var e=t.split(Hw);if(e.length<3)throw new Error("Invalid key format: "+t);return e.slice(1,e.length-1).join(Hw)}var Qw=function(){function t(t){if(!Tl().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=Yw(this.modelPath)}return t.prototype.save=function(t){return Il(this,0,void 0,function(){var e,n,r;return Sl(this,function(i){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=Aw(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(kw)return Buffer.from(t).toString("base64");for(var e=new Uint8Array(t),n="",r=0,i=e.length;r<i;r++)n+=String.fromCharCode(e[r]);return btoa(n)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(o){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]})})},t.prototype.load=function(){return Il(this,0,void 0,function(){var t,e,n,r,i,o,a;return Sl(this,function(s){if(null==(t=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=r,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),e.format=o.format,e.generatedBy=o.generatedBy,e.convertedBy=o.convertedBy,e.userDefinedMetadata=o.userDefinedMetadata),null==(a=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(t){if(kw){var e=Buffer.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var n=atob(t),r=new Uint8Array(n.length),i=0;i<n.length;++i)r.set([n.charCodeAt(i)],i);return r.buffer}(a),[2,e]})})},t.URL_SCHEME="localstorage://",t}(),t_=function(t){return Tl().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Qw.URL_SCHEME)?(e=t.slice(Qw.URL_SCHEME.length),new Qw(e)):null;var e};Pw.registerSaveRouter(t_),Pw.registerLoadRouter(t_);var e_=function(){function t(){jl(Tl().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),jl("undefined"==typeof window||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return t.prototype.listModels=function(){return Il(this,0,void 0,function(){var t,e,n,r,i,o;return Sl(this,function(a){for(t={},e=Gw+Hw,n=Hw+qw,r=0;r<this.LS.length;++r)(i=this.LS.key(r)).startsWith(e)&&i.endsWith(n)&&(o=Jw(i),t[o]=JSON.parse(this.LS.getItem(i)));return[2,t]})})},t.prototype.removeModel=function(t){return Il(this,0,void 0,function(){var e,n;return Sl(this,function(r){var i;if(t=(i=t).startsWith(Qw.URL_SCHEME)?i.slice(Qw.URL_SCHEME.length):i,e=Yw(t),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+t+"'");return n=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,n]})})},t}();if(Tl().getBool("IS_BROWSER"))try{Mw.registerManager(Qw.URL_SCHEME,new e_)}catch(Rh){}function n_(t){return new Promise(function(t){return setTimeout(t)}).then(t)}var r_=function(){function t(e){if(!Tl().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelTopologyFileName=e+".json",this.weightDataFileName=e+".weights.bin"}return t.prototype.save=function(t){return Il(this,0,void 0,function(){var e,n,r,i,o,a;return Sl(this,function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:n},i=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(o=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=i,[4,n_(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return s.sent(),null==t.weightData?[3,4]:((a=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=e,[4,n_(function(){return a.dispatchEvent(new MouseEvent("click"))})]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:Aw(t)}]}})})},t.URL_SCHEME="downloads://",t}(),i_=function(){function t(t){if(null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return t.prototype.load=function(){return Il(this,0,void 0,function(){var t,e,n=this;return Sl(this,function(r){return t=this.files[0],e=this.files.slice(1),[2,new Promise(function(r,i){var o=new FileReader;o.onload=function(o){var a=JSON.parse(o.target.result),s=a.modelTopology;if(null!=s){0===e.length&&r({modelTopology:s});var u=a.weightsManifest;if(null!=u){var c;try{c=n.checkManifestAndWeightFiles(u,e)}catch(p){return void i(p)}var l=[],h=[],d=[];u.forEach(function(t){t.paths.forEach(function(t){h.push(t),d.push(null)}),l.push.apply(l,t.weights)}),u.forEach(function(t){t.paths.forEach(function(t){var e=new FileReader;e.onload=function(e){var n=e.target.result,i=h.indexOf(t);d[i]=n,-1===d.indexOf(null)&&r({modelTopology:s,weightSpecs:l,weightData:Nw(d),format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy,userDefinedMetadata:a.userDefinedMetadata})},e.onerror=function(e){return i("Failed to weights data from file of path '"+t+"'.")},e.readAsArrayBuffer(c[t])})})}else i(new Error("weightManifest field is missing from file "+t.name))}else i(new Error("modelTopology field is missing from file "+t.name))},o.onerror=function(e){return i("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},o.readAsText(t)})]})})},t.prototype.checkManifestAndWeightFiles=function(t,e){for(var n=[],r=e.map(function(t){return Rw(t.name)}),i={},o=0,a=t;o<a.length;o++)a[o].paths.forEach(function(t){var o=Rw(t);if(-1!==n.indexOf(o))throw new Error("Duplicate file basename found in weights manifest: '"+o+"'");if(n.push(o),-1===r.indexOf(o))throw new Error("Weight file with basename '"+o+"' is not provided.");i[t]=e[r.indexOf(o)]});if(n.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+e.length+").");return i},t}();function o_(t,e,n,r){var i;jl(null!=(i=t)&&Array.isArray(i)&&i.length>0,function(){return"promises must be a none empty array"}),function(t,e){jl(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+t}),jl(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+e}),jl(e>=t,function(){return"startFraction must be no more than endFraction, but got startFraction "+t+" and endFraction "+e})}(n=null==n?0:n,r=null==r?1:r);var o=0;return Promise.all(t.map(function(i){return i.then(function(i){var a=n+ ++o/t.length*(r-n);return e(a),i}),i}))}function a_(t,e){return Il(this,0,void 0,function(){var n,r,i,o,a,s,u,c,l;return Sl(this,function(h){switch(h.label){case 0:return null==e&&(e={}),n=null==e.fetchFunc?Tl().platform.fetch:e.fetchFunc,r=t.map(function(t){return n(t,e.requestInit,{isBinary:!0})}),i=0,o=.5,null!=e.onProgress?[3,2]:[4,Promise.all(r)];case 1:return a=h.sent(),[3,4];case 2:return[4,o_(r,e.onProgress,i,o)];case 3:a=h.sent(),h.label=4;case 4:return s=a.map(function(t){return t.arrayBuffer()}),u=.5,c=1,null!=e.onProgress?[3,6]:[4,Promise.all(s)];case 5:return l=h.sent(),[3,8];case 6:return[4,o_(s,e.onProgress,u,c)];case 7:l=h.sent(),h.label=8;case 8:return[2,l]}})})}function s_(t){var e=this;return function(n,r,i){return void 0===r&&(r=""),Il(e,0,void 0,function(){var e,o,a,s,u,c,l,h,d,p;return Sl(this,function(f){switch(f.label){case 0:if(e=n.map(function(){return!1}),o={},a=null!=i?i.map(function(){return!1}):[],s=[],n.forEach(function(t,n){var r=0;t.weights.forEach(function(t){var u="quantization"in t?t.quantization.dtype:t.dtype,c=Cw[u]*Vl(t.shape),l=function(){e[n]=!0,null==o[n]&&(o[n]=[]),o[n].push({manifestEntry:t,groupOffset:r,sizeBytes:c})};null!=i?i.forEach(function(e,n){e===t.name&&(l(),a[n]=!0)}):l(),s.push(t.name),r+=c})}),!a.every(function(t){return t}))throw u=i.filter(function(t,e){return!a[e]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return c=e.reduce(function(t,e,n){return e&&t.push(n),t},[]),l=[],c.forEach(function(t){n[t].paths.forEach(function(t){var e=r+(r.endsWith("/")?"":"/")+t;l.push(e)})}),[4,t(l)];case 1:return h=f.sent(),d={},p=0,c.forEach(function(t){for(var e=n[t].paths.length,r=0,i=0;i<e;i++)r+=h[p+i].byteLength;for(var a=new ArrayBuffer(r),s=new Uint8Array(a),u=0,c=0;c<e;c++){var l=new Uint8Array(h[p+c]);s.set(l,u),u+=l.byteLength}o[t].forEach(function(t){var e=Iw(a.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(var n in e)d[n]=e[n]}),p+=e}),[2,d]}})})}}Pw.registerSaveRouter(function(t){return Tl().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(r_.URL_SCHEME)?(void 0===(e=t.slice(r_.URL_SCHEME.length))&&(e="model"),new r_(e)):null;var e});var u_=function(){function t(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null!=e.fetchFunc?(jl("function"==typeof e.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=Tl().platform.fetch,jl(null!=t&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&jl(2===t.length,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return t.prototype.save=function(t){return Il(this,0,void 0,function(){var e,n,r,i;return Sl(this,function(o){switch(o.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:n},e.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((i=o.sent()).ok)return[2,{modelArtifactsInfo:Aw(t),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}})})},t.prototype.load=function(){return Il(this,0,void 0,function(){var t,e,n,r,i,o,a,s,u,c,l,h;return Sl(this,function(d){switch(d.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=d.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");d.label=2;case 2:return d.trys.push([2,4,,5]),[4,t.json()];case 3:return e=d.sent(),[3,5];case 4:throw d.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=e.modelTopology,i=e.weightsManifest,o=e.generatedBy,a=e.convertedBy,s=e.format,u=e.userDefinedMetadata,null==r&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:h=d.sent(),c=h[0],l=h[1],d.label=7;case 7:return[2,{modelTopology:r,weightSpecs:c,weightData:l,userDefinedMetadata:u,generatedBy:o,convertedBy:a,format:s}]}})})},t.prototype.loadWeights=function(t){return Il(this,0,void 0,function(){var e,n,r,i,o,a,s,u,c,l,h;return Sl(this,function(d){switch(d.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,f=void 0,m=void 0,f=(p=e).lastIndexOf("/"),m=p.lastIndexOf("?"),n=[p.substring(0,f)+"/",m>f?p.substring(m):""],r=n[0],i=n[1],o=this.weightPathPrefix||r,a=[],s=0,u=t;s<u.length;s++)c=u[s],a.push.apply(a,c.weights);return l=[],t.forEach(function(t){t.paths.forEach(function(t){l.push(o+t+i)})}),[4,a_(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return h=d.sent(),[2,[a,Nw(h)]]}var p,f,m})})},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function c_(t){return null!=t.match(u_.URL_SCHEME_REGEX)}var l_=function(t,e){return"undefined"==typeof fetch?null:(Array.isArray(t)?t.every(function(t){return c_(t)}):c_(t))?h_(t,{onProgress:e}):null};function h_(t,e){return new u_(t,e)}Pw.registerSaveRouter(l_),Pw.registerLoadRouter(l_);var d_,p_=function(){function t(t){this.modelArtifacts=t}return t.prototype.load=function(){return Il(this,0,void 0,function(){return Sl(this,function(t){return[2,this.modelArtifacts]})})},t}(),f_=function(){function t(t){this.saveHandler=t}return t.prototype.save=function(t){return Il(this,0,void 0,function(){return Sl(this,function(e){return[2,this.saveHandler(t)]})})},t}(),m_=Object.freeze({browserFiles:function(t){return new i_(t)},browserHTTPRequest:function(t,e){return h_(t,e)},concatenateArrayBuffers:Nw,decodeWeights:Iw,encodeWeights:function(t,e){return Il(this,0,void 0,function(){var n,r,i,o,a,s=this;return Sl(this,function(u){switch(u.label){case 0:for(n=[],r=[],i=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t),o=function(o){var a=i[o],u=Array.isArray(t)?t[o].tensor:t[a];if("float32"!==u.dtype&&"int32"!==u.dtype&&"bool"!==u.dtype&&"string"!==u.dtype)throw new Error("Unsupported dtype in weight '"+a+"': "+u.dtype);var c={name:a,shape:u.shape,dtype:u.dtype};if("string"===u.dtype){var l=new Promise(function(t){return Il(s,0,void 0,function(){var e,n,r,i,o,a,s;return Sl(this,function(c){switch(c.label){case 0:return[4,u.bytes()];case 1:for(e=c.sent(),n=e.reduce(function(t,e){return t+e.length},0)+4*e.length,r=new Uint8Array(n),i=0,o=0;o<e.length;o++)a=e[o],s=new Uint8Array(new Uint32Array([a.length]).buffer),r.set(s,i),i+=4,r.set(a,i),i+=a.length;return t(r),[2]}})})});r.push(l)}else r.push(u.data());null!=e&&(c.group=e),n.push(c)},a=0;a<i.length;++a)o(a);return[4,Promise.all(r)];case 1:return[2,{data:Sw(u.sent()),specs:n}]}})})},fromMemory:function(t,e,n,r){return 1===arguments.length?null!=t.modelTopology||null!=t.weightSpecs?new p_(t):new p_({modelTopology:t}):new p_({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r})},getLoadHandlers:function(t,e){return Pw.getLoadHandlers(t,e)},getModelArtifactsInfoForJSON:Aw,getSaveHandlers:function(t){return Pw.getSaveHandlers(t)},http:h_,isHTTPScheme:c_,loadWeights:function(t,e,n,r){return void 0===e&&(e=""),Il(this,0,void 0,function(){return Sl(this,function(i){return[2,s_(function(t){return a_(t,{requestInit:r})})(t,e,n)]})})},registerLoadRouter:function(t){return Pw.registerLoadRouter(t)},registerSaveRouter:function(t){return Pw.registerSaveRouter(t)},weightsLoaderFactory:s_,withSaveHandler:function(t){return new f_(t)},copyModel:function(t,e){return Il(this,0,void 0,function(){return Sl(this,function(n){return[2,Lw(t,e,!1)]})})},listModels:function(){return Il(this,0,void 0,function(){var t,e,n,r,i,o,a;return Sl(this,function(s){switch(s.label){case 0:t=Mw.getSchemes(),e={},n=0,r=t,s.label=1;case 1:return n<r.length?(i=r[n],[4,Mw.getManager(i).listModels()]):[3,4];case 2:for(a in o=s.sent())e[i+Dw+a]=o[a];s.label=3;case 3:return n++,[3,1];case 4:return[2,e]}})})},moveModel:function(t,e){return Il(this,0,void 0,function(){return Sl(this,function(n){return[2,Lw(t,e,!0)]})})},removeModel:function(t){return Il(this,0,void 0,function(){var e;return Sl(this,function(n){return e=Ow(t),[2,Mw.getManager(e.scheme).removeModel(e.path)]})})}});Bd({confusionMatrix_:function(t,e,n){var r=kd(t,"labels","confusionMatrix"),i=kd(e,"predictions","confusionMatrix");jl(null==n||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),jl(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),jl(1===i.rank,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),jl(r.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),jl(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var o=Tp(r.asType("int32"),n),a=Tp(i.asType("int32"),n);return o.transpose().matMul(a).asType("int32")}});var v_=Bd({fromPixels_:function(t,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,i=!1,o=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)o=!0;else{if(null==t.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);a=!0}if(i&&i&&t.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=Pl("FromPixels",zh.backendName))return zh.runKernel("FromPixels",{pixels:t},{numChannels:e});var s,u,c=i?[t.videoWidth,t.videoHeight]:[t.width,t.height],l=c[0],h=c[1];if(a?s=t.getContext("2d").getImageData(0,0,l,h).data:r||n?s=t.data:(o||i)&&(null==d_&&(d_=document.createElement("canvas").getContext("2d")),d_.canvas.width=l,d_.canvas.height=h,d_.drawImage(t,0,0,l,h),s=d_.getImageData(0,0,l,h).data),4===e)u=new Int32Array(s);else{var d=l*h;u=new Int32Array(d*e);for(var p=0;p<d;p++)for(var f=0;f<e;++f)u[p*e+f]=s[4*p+f]}return qd(u,[h,l,e],"int32")}}),g_=Object.freeze({toPixels:function(t,e){return Il(this,0,void 0,function(){var n,r,i,o,a,s,u,c,l,h,d,p,f,m,v,g,y,x,b,w,_,E,C;return Sl(this,function(I){switch(I.label){case 0:if(n=kd(t,"img","toPixels"),t instanceof Ch||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),i=r[0],o=r[1],(a=2===n.rank?1:n.shape[2])>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,n.data()];case 1:return s=I.sent(),u=n.min(),c=n.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=I.sent(),h=l[0],d=l[1],p=h[0],f=d[0],u.dispose(),c.dispose(),"float32"===n.dtype){if(p<0||f>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+f+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(p<0||f>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+f+"].")}for(m="float32"===n.dtype?255:1,v=new Uint8ClampedArray(o*i*4),g=0;g<i*o;++g)y=void 0,x=void 0,b=void 0,w=void 0,1===a?(y=s[g]*m,x=s[g]*m,b=s[g]*m,w=255):3===a?(y=s[3*g]*m,x=s[3*g+1]*m,b=s[3*g+2]*m,w=255):4===a&&(y=s[4*g]*m,x=s[4*g+1]*m,b=s[4*g+2]*m,w=s[4*g+3]*m),v[0+(_=4*g)]=Math.round(y),v[_+1]=Math.round(x),v[_+2]=Math.round(b),v[_+3]=Math.round(w);return null!=e&&(e.width=o,e.height=i,E=e.getContext("2d"),C=new ImageData(v,o,i),E.putImageData(C,0,0)),n!==t&&n.dispose(),[2,v]}})})},fromPixels:v_}),y_=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(t,e){return new t(e)},t}(),x_=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(e){t.getMap().classNameMap[e.className]=[e,e.fromConfig]},t}();function b_(t){jl(null!=t.className,function(){return"Class being registered does not have the static className property defined."}),jl("string"==typeof t.className,function(){return"className is required to be a string, but got type "+typeof t.className}),jl(t.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),x_.register(t)}var w_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Cl(e,t),e.prototype.minimize=function(t,e,n){void 0===e&&(e=!1);var r=this.computeGradients(t,n),i=r.value,o=r.grads;if(null!=n){var a=n.map(function(t){return{name:t.name,tensor:o[t.name]}});this.applyGradients(a)}else this.applyGradients(o);return Ed(o),e?i:(i.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,e){return function(t,e){jl(ih(t),function(){return"The f passed in variableGrads(f) must be a function"}),jl(null==e||Array.isArray(e)&&e.every(function(t){return t instanceof Ah}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=null!=e;if(!n)for(var r in e=[],zh.registeredVariables)e.push(zh.registeredVariables[r]);var i=n?e.filter(function(t){return!t.trainable}):null,o=e.length;jl((e=e.filter(function(t){return t.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var a=zh.gradients(t,e,null,!0),s=a.value,u=a.grads;jl(u.some(function(t){return null!=t}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),jl(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var c={};return e.forEach(function(t,e){null!=u[e]&&(c[t.name]=u[e])}),null!=i&&i.forEach(function(t){return c[t.name]=null}),{value:s,grads:c}}(t,e)},e.prototype.dispose=function(){null!=this.iterations_&&Ed(this.iterations_)},e.prototype.saveIterations=function(){return Il(this,0,void 0,function(){return Sl(this,function(t){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:Vd(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Il(this,0,void 0,function(){return Sl(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Il(this,0,void 0,function(){return Sl(this,function(t){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return Il(this,0,void 0,function(){var e;return Sl(this,function(n){switch(n.label){case 0:return e=this,[4,t[0].tensor.data()];case 1:return e.iterations_=n.sent()[0],[2,t.slice(1)]}})})},e}(y_);Object.defineProperty(w_,Symbol.hasInstance,{value:function(t){return null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients}});var __=function(t){function e(e,n,r){void 0===r&&(r=null);var i=t.call(this)||this;return i.learningRate=e,i.rho=n,i.epsilon=r,i.accumulatedGrads=[],i.accumulatedUpdates=[],null==r&&(i.epsilon=zh.backend.epsilon()),i}return Cl(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var i=zh.registeredVariables[n];null==e.accumulatedGrads[r]&&(e.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:_d(function(){return Qd(i).variable(!1)})}),null==e.accumulatedUpdates[r]&&(e.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:_d(function(){return Qd(i).variable(!1)})});var o=Array.isArray(t)?t[r].tensor:t[n];if(null!=o){var a=e.accumulatedGrads[r].variable,s=e.accumulatedUpdates[r].variable;_d(function(){var t=a.mul(e.rho).add(o.square().mul(1-e.rho)),n=s.add(e.epsilon).sqrt().div(a.add(e.epsilon).sqrt()).mul(o),r=s.mul(e.rho).add(n.square().mul(1-e.rho));a.assign(t),s.assign(r);var u=n.mul(-e.learningRate).add(i);i.assign(u)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Ed(this.accumulatedGrads.map(function(t){return t.variable})),Ed(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Il(this,0,void 0,function(){var t;return Sl(this,function(e){switch(e.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return Il(this,0,void 0,function(){var e;return Sl(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),e=t.length/2,this.accumulatedGrads=t.slice(0,e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.rho,e.epsilon)},e.className="Adadelta",e}(w_);b_(__);var E_=function(t){function e(e,n){void 0===n&&(n=.1);var r=t.call(this)||this;return r.learningRate=e,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return Cl(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var i=zh.registeredVariables[n];null==e.accumulatedGrads[r]&&(e.accumulatedGrads[r]={originalName:n+"/accumulator",variable:_d(function(){return $d(i.shape,e.initialAccumulatorValue).variable(!1)})});var o=Array.isArray(t)?t[r].tensor:t[n];if(null!=o){var a=e.accumulatedGrads[r].variable;_d(function(){var t=a.add(o.square());a.assign(t);var n=o.div(t.add(zh.backend.epsilon()).sqrt()).mul(-e.learningRate).add(i);i.assign(n)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedGrads&&Ed(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Il(this,0,void 0,function(){return Sl(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return Il(this,0,void 0,function(){return Sl(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulatedGrads=t.map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,e){return new t(e.learningRate,e.initialAccumulatorValue)},e.className="Adagrad",e}(w_);b_(E_);var C_=function(t){function e(e,n,r,i){void 0===i&&(i=null);var o=t.call(this)||this;return o.learningRate=e,o.beta1=n,o.beta2=r,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],_d(function(){o.accBeta1=Vd(n).variable(),o.accBeta2=Vd(r).variable()}),null==i&&(o.epsilon=zh.backend.epsilon()),o}return Cl(e,t),e.prototype.applyGradients=function(t){var e=this,n=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t);_d(function(){var r=Gy(1,e.accBeta1),i=Gy(1,e.accBeta2);n.forEach(function(n,o){var a=zh.registeredVariables[n];null==e.accumulatedFirstMoment[o]&&(e.accumulatedFirstMoment[o]={originalName:n+"/m",variable:_d(function(){return Qd(a).variable(!1)})}),null==e.accumulatedSecondMoment[o]&&(e.accumulatedSecondMoment[o]={originalName:n+"/v",variable:_d(function(){return Qd(a).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[n];if(null!=s){var u=e.accumulatedFirstMoment[o].variable,c=e.accumulatedSecondMoment[o].variable,l=u.mul(e.beta1).add(s.mul(1-e.beta1)),h=c.mul(e.beta2).add(s.square().mul(1-e.beta2)),d=l.div(r),p=h.div(i);u.assign(l),c.assign(h);var f=d.div(p.sqrt().add(e.epsilon)).mul(-e.learningRate).add(a);a.assign(f)}}),e.accBeta1.assign(e.accBeta1.mul(e.beta1)),e.accBeta2.assign(e.accBeta2.mul(e.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Ed(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedSecondMoment&&Ed(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Il(this,0,void 0,function(){var t;return Sl(this,function(e){switch(e.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return Il(this,0,void 0,function(){var e,n=this;return Sl(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),_d(function(){n.accBeta1.assign(Uy(n.beta1,n.iterations_+1)),n.accBeta2.assign(Uy(n.beta2,n.iterations_+1))}),e=t.length/2,this.accumulatedFirstMoment=t.slice(0,e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)},e.className="Adam",e}(w_);b_(C_);var I_=function(t){function e(e,n,r,i,o){void 0===i&&(i=null),void 0===o&&(o=0);var a=t.call(this)||this;return a.learningRate=e,a.beta1=n,a.beta2=r,a.epsilon=i,a.decay=o,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],_d(function(){a.iteration=Vd(0).variable(),a.accBeta1=Vd(n).variable()}),null==i&&(a.epsilon=zh.backend.epsilon()),a}return Cl(e,t),e.prototype.applyGradients=function(t){var e=this,n=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t);_d(function(){var r=Gy(1,e.accBeta1),i=Ry(-e.learningRate,e.iteration.mul(e.decay).add(1));n.forEach(function(n,o){var a=zh.registeredVariables[n];null==e.accumulatedFirstMoment[o]&&(e.accumulatedFirstMoment[o]={originalName:n+"/m",variable:Qd(a).variable(!1)}),null==e.accumulatedWeightedInfNorm[o]&&(e.accumulatedWeightedInfNorm[o]={originalName:n+"/v",variable:Qd(a).variable(!1)});var s=Array.isArray(t)?t[o].tensor:t[n];if(null!=s){var u=e.accumulatedFirstMoment[o].variable,c=e.accumulatedWeightedInfNorm[o].variable,l=u.mul(e.beta1).add(s.mul(1-e.beta1)),h=c.mul(e.beta2),d=s.abs(),p=h.maximum(d);u.assign(l),c.assign(p);var f=i.div(r).mul(l.div(p.add(e.epsilon))).add(a);a.assign(f)}}),e.iteration.assign(e.iteration.add(1)),e.accBeta1.assign(e.accBeta1.mul(e.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Ed(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedWeightedInfNorm&&Ed(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Il(this,0,void 0,function(){return Sl(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Il(this,0,void 0,function(){return Sl(this,function(t){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)},e.className="Adamax",e}(w_);b_(I_);var S_=function(t){function e(e){var n=t.call(this)||this;return n.learningRate=e,n.setLearningRate(e),n}return Cl(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var i=Array.isArray(t)?t[r].tensor:t[n];if(null!=i){var o=zh.registeredVariables[n];_d(function(){var t=e.c.mul(i).add(o);o.assign(t)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=function(t){return zh.keep(t)}(Vd(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Il(this,0,void 0,function(){return Sl(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Il(this,0,void 0,function(){return Sl(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:if(0!==(t=e.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,e){return new t(e.learningRate)},e.className="SGD",e}(w_);b_(S_);var k_=function(t){function e(e,n,r){void 0===r&&(r=!1);var i=t.call(this,e)||this;return i.learningRate=e,i.momentum=n,i.useNesterov=r,i.accumulations=[],i.m=Vd(i.momentum),i}return Cl(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var i=zh.registeredVariables[n];null==e.accumulations[r]&&(e.accumulations[r]={originalName:n+"/momentum",variable:_d(function(){return Qd(i).variable(!1)})});var o=e.accumulations[r].variable,a=Array.isArray(t)?t[r].tensor:t[n];null!=a&&_d(function(){var t,n=e.m.mul(o).add(a);t=e.useNesterov?e.c.mul(a.add(n.mul(e.m))).add(i):e.c.mul(n).add(i),o.assign(n),i.assign(t)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Ed(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Il(this,0,void 0,function(){return Sl(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return Il(this,0,void 0,function(){return Sl(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulations=t.map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)},e.className="Momentum",e}(S_);b_(k_);var T_=function(t){function e(e,n,r,i,o){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===i&&(i=null),void 0===o&&(o=!1);var a=t.call(this)||this;if(a.learningRate=e,a.decay=n,a.momentum=r,a.epsilon=i,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=o,null==i&&(a.epsilon=zh.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return Cl(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var i=zh.registeredVariables[n];null==e.accumulatedMeanSquares[r]&&(e.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:_d(function(){return Qd(i).variable(!1)})}),null==e.accumulatedMoments[r]&&(e.accumulatedMoments[r]={originalName:n+"/momentum",variable:_d(function(){return Qd(i).variable(!1)})}),null==e.accumulatedMeanGrads[r]&&e.centered&&(e.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:_d(function(){return Qd(i).variable(!1)})});var o=Array.isArray(t)?t[r].tensor:t[n];if(null!=o){var a=e.accumulatedMeanSquares[r].variable,s=e.accumulatedMoments[r].variable;_d(function(){var t=a.mul(e.decay).add(o.square().mul(1-e.decay));if(e.centered){var n=e.accumulatedMeanGrads[r].variable,u=n.mul(e.decay).add(o.mul(1-e.decay)),c=s.mul(e.momentum).add(o.mul(e.learningRate).div(t.sub(u.square().add(e.epsilon)).sqrt()));a.assign(t),n.assign(u),s.assign(c);var l=i.sub(c);i.assign(l)}else{var h=a.mul(e.decay).add(o.square().mul(1-e.decay));c=s.mul(e.momentum).add(o.mul(e.learningRate).div(h.add(e.epsilon).sqrt())),a.assign(h),s.assign(c),l=i.sub(c),i.assign(l)}})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Ed(this.accumulatedMeanSquares.map(function(t){return t.variable})),null!=this.accumulatedMeanGrads&&this.centered&&Ed(this.accumulatedMeanGrads.map(function(t){return t.variable})),null!=this.accumulatedMoments&&Ed(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Il(this,0,void 0,function(){var t;return Sl(this,function(e){switch(e.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return Il(this,0,void 0,function(){var e;return Sl(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),e=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)},e.className="RMSProp",e}(w_);b_(T_),"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate,Ch.prototype.squaredDifference=function(t){return Ig(this,t)},_h=uw;
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var N_=function(t,e){return N_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},N_(t,e)};function R_(t,e){function n(){this.constructor=t}N_(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var A_=function(){return A_=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},A_.apply(this,arguments)};function P_(t,e,n,r){return new(n||(n=Promise))(function(e,i){function o(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n(function(t){t(r)})).then(o,a)}s((r=r.apply(t,[])).next())})}function D_(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function M_(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}var O_=function(){function t(t,e){if(!V_(t)||!V_(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}();function L_(t,e){return t instanceof Ch&&t.shape.length===e}function B_(t){return L_(t,3)}function F_(t){return L_(t,4)}function j_(t){return t%2==0}function z_(t){return t&&t.width&&t.height}function W_(t){return t.reduce(function(t,e){return t.add(e)},new G_(0,0)).div(new G_(t.length,t.length))}function U_(t,e,n){return Array(t).fill(0).map(function(t,r){return e+r*n})}function V_(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||0===t}function H_(t){return V_(t)&&0<=t&&t<=1}var G_=function(){function t(t,e){this._x=t,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.mul=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.div=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}(),q_=function(){function t(e,n){void 0===n&&(n=!0);var r=e||{},i=[r.left,r.top,r.right,r.bottom].every(V_),o=[r.x,r.y,r.width,r.height].every(V_);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],c=a[2],l=a[3];t.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",n),this._x=s,this._y=u,this._width=c,this._height=l}return t.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(V_)},t.assertIsValidBox=function(e,n,r){if(void 0===r&&(r=!1),!t.isRect(e))throw new Error(n+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(n+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new G_(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return new G_(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return new G_(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new G_(this.right,this.bottom)},enumerable:!0,configurable:!0}),t.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(t){return Math.round(t)});return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(t){return Math.floor(t)});return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.toSquare=function(){var e=this,n=e.x,r=e.y,i=e.width,o=e.height,a=Math.abs(i-o);return i<o&&(n-=a/2,i+=a),o<i&&(r-=a/2,o+=a),new t({x:n,y:r,width:i,height:o})},t.prototype.rescale=function(e){var n=z_(e)?e.width:e,r=z_(e)?e.height:e;return new t({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},t.prototype.pad=function(e,n){var r=[this.x-e/2,this.y-n/2,this.width+e,this.height+n];return new t({x:r[0],y:r[1],width:r[2],height:r[3]})},t.prototype.clipAtImageBorders=function(e,n){var r=this,i=r.x,o=r.y,a=r.right,s=r.bottom,u=Math.max(i,0),c=Math.max(o,0),l=a-u,h=s-c;return new t({x:u,y:c,width:Math.min(l,e-u),height:Math.min(h,n-c)}).floor()},t.prototype.shift=function(e,n){var r=this.width,i=this.height;return new t({x:this.x+e,y:this.y+n,width:r,height:i})},t.prototype.padAtBorders=function(t,e){var n=this.width+1,r=this.height+1,i=n,o=r,a=this.left,s=this.top,u=this.right,c=this.bottom;return u>e&&(i=-u+e+n,u=e),c>t&&(o=-c+t+r,c=t),a<1&&(o=2-a,a=1),s<1&&(o=2-s,s=1),{dy:1,edy:o,dx:1,edx:i,y:s,ey:c,x:a,ex:u,w:n,h:r}},t.prototype.calibrate=function(e){return new t({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},t}(),K_=function(t){function e(e,n,r,i,o){return void 0===o&&(o=!1),t.call(this,{left:e,top:n,right:r,bottom:i},o)||this}return R_(e,t),e}(q_),Z_=function(){function t(t,e,n,r,i){this._imageDims=new O_(i.width,i.height),this._score=t,this._classScore=e,this._className=n,this._box=new q_(r).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new q_(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(e,n){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:n})},t}(),X_=function(t){function e(e,n,r){return t.call(this,e,e,"",n,r)||this}return R_(e,t),e.prototype.forSize=function(n,r){var i=t.prototype.forSize.call(this,n,r);return new e(i.score,i.relativeBox,i.imageDims)},e}(Z_);function $_(t,e,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(t.right,e.right)-Math.max(t.left,e.left))*Math.max(0,Math.min(t.bottom,e.bottom)-Math.max(t.top,e.top));return n?r/(t.area+e.area-r):r/Math.min(t.area,e.area)}function Y_(t,e,n,r){void 0===r&&(r=!0);for(var i=e.map(function(t,e){return{score:t,boxIndex:e}}).sort(function(t,e){return t.score-e.score}).map(function(t){return t.boxIndex}),o=[],a=function(){var e=i.pop();o.push(e);for(var a=i,s=[],u=0;u<a.length;u++){var c=a[u],l=t[e],h=t[c];s.push($_(l,h,r))}i=i.filter(function(t,e){return s[e]<=n})};i.length>0;)a();return o}function J_(t,e){return _d(function(){var n=e[0],r=e[1],i=e[2],o=$d(M_(t.shape.slice(0,3),[1]),n),a=$d(M_(t.shape.slice(0,3),[1]),r),s=$d(M_(t.shape.slice(0,3),[1]),i),u=tp([o,a,s],3);return Gy(t,u)})}function Q_(t){return 1/(1+Math.exp(-t))}var tE,eE=function(t){function e(e,n,r,i,o){return void 0===o&&(o=!1),t.call(this,{x:e,y:n,width:r,height:i},o)||this}return R_(e,t),e}(q_),nE=function(){function t(t,e,n){void 0===n&&(n=new G_(0,0));var r=e.width,i=e.height;this._imgDims=new O_(r,i),this._shift=n,this._positions=t.map(function(t){return t.mul(new G_(r,i)).add(n)})}return Object.defineProperty(t.prototype,"shift",{get:function(){return new G_(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(e){return e.sub(t._shift).div(new G_(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),t.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},t.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new G_(t,e))},t.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},t.prototype.align=function(t,e){if(void 0===e&&(e={}),t){var n=t instanceof X_?t.box.floor():new q_(t);return this.shiftBy(n.x,n.y).align(null,e)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),i=r.useDlibAlignment,o=r.minBoxPadding;return i?this.alignDlib():this.alignMinBbox(o)},t.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),e=t[0],n=t[1],r=t[2],i=function(t){return r.sub(t).magnitude()},o=(i(e)+i(n))/2,a=Math.floor(o/.45),s=W_(t),u=Math.floor(Math.max(0,s.x-.5*a)),c=Math.floor(Math.max(0,s.y-.43*a));return new eE(u,c,Math.min(a,this.imageWidth+u),Math.min(a,this.imageHeight+c))},t.prototype.alignMinBbox=function(t){var e,n,r,i,o,a,s,u=(e=this.positions,n=e.map(function(t){return t.x}),r=e.map(function(t){return t.y}),i=n.reduce(function(t,e){return e<t?e:t},1/0),o=r.reduce(function(t,e){return e<t?e:t},1/0),a=n.reduce(function(t,e){return t<e?e:t},0),s=r.reduce(function(t,e){return t<e?e:t},0),new K_(i,o,a,s));return u.pad(u.width*t,u.height*t)},t.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},t}(),rE=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R_(e,t),e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],W_([t[3],t[4]])]},e}(nE),iE=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R_(e,t),e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(W_)},e}(nE),oE=function(){function t(t,e){this._label=t,this._distance=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){return void 0===t&&(t=!0),this.label+(t?" ("+function(t,e){void 0===e&&(e=2);var n=Math.pow(10,e);return Math.floor(t*n)/n}(this.distance)+")":"")},t}(),aE=function(t){function e(e,n){var r=t.call(this,e)||this;return r._label=n,r}return R_(e,t),e.assertIsValidLabeledBox=function(t,e){if(q_.assertIsValidBox(t,e),!V_(t.label))throw new Error(e+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(q_),sE=function(){function t(t,e){if("string"!=typeof t)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(t){return!(t instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},t.fromJSON=function(e){var n=e.descriptors.map(function(t){return new Float32Array(t)});return new t(e.label,n)},t}();function uE(t,e){var n={detection:e};return Object.assign({},t,n)}function cE(){var t=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:t,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function lE(t){var e="";if(!t)try{t=require("fs")}catch(n){e=n.toString()}return{readFile:t?function(e){return new Promise(function(n,r){t.readFile(e,function(t,e){return t?r(t):n(e)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)}}}function hE(){var t=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,n=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},r=lE();return A_({Canvas:t||function(){return function(){}}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){return function(){}}(),Image:e||function(){return function(){}}(),ImageData:global.ImageData||function(){return function(){}}(),Video:global.HTMLVideoElement||function(){return function(){}}(),createCanvasElement:function(){if(t)return new t;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:n},r)}function dE(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}function pE(){return"object"==typeof global&&"function"==typeof require&&"undefined"!=typeof module&&"undefined"!=typeof process&&!!process.version}function fE(t){tE=t}function mE(){dE()&&fE(cE()),pE()&&fE(hE())}!function(t){function e(e,n,r,i){var o=t.call(this,e,n)||this;return o._score=r,o._classScore=i,o}R_(e,t),e.assertIsValidPredictedBox=function(t,e){if(aE.assertIsValidLabeledBox(t,e),!H_(t.score)||!H_(t.classScore))throw new Error(e+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(aE);var vE,gE,yE={getEnv:function(){if(!tE)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return tE},setEnv:fE,initialize:mE,createBrowserEnv:cE,createFileSystem:lE,createNodejsEnv:hE,monkeyPatch:function(t){if(tE||mE(),!tE)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=t.Canvas,n=void 0===e?tE.Canvas:e,r=t.Image,i=void 0===r?tE.Image:r;tE.Canvas=n,tE.Image=i,tE.createCanvasElement=t.createCanvasElement||function(){return new n},tE.createImageElement=t.createImageElement||function(){return new i},tE.ImageData=t.ImageData||tE.ImageData,tE.Video=t.Video||tE.Video,tE.fetch=t.fetch||tE.fetch,tE.readFile=t.readFile||tE.readFile},isBrowser:dE,isNodejs:pE};function xE(t){return yE.isNodejs()||"string"!=typeof t?t:document.getElementById(t)}function bE(t){var e=yE.getEnv(),n=e.Canvas;if(t instanceof e.CanvasRenderingContext2D)return t;var r=xE(t);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=r.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}function wE(t){var e=yE.getEnv(),n=e.Image,r=e.Video;return t instanceof n&&t.complete||t instanceof r&&t.readyState>=3}function _E(t){var e=yE.getEnv(),n=e.Image,r=e.Video;return t instanceof n?new O_(t.naturalWidth,t.naturalHeight):t instanceof r?new O_(t.videoWidth,t.videoHeight):new O_(t.width,t.height)}function EE(t){var e=t.width,n=t.height,r=(0,yE.getEnv().createCanvasElement)();return r.width=e,r.height=n,r}function CE(t,e){var n=yE.getEnv().ImageData;if(!(t instanceof n||wE(t)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=_E(t),i=r.width,o=r.height,a=EE({width:i,height:o});return t instanceof n?bE(a).putImageData(t,0,0):bE(a).drawImage(t,0,0,i,o),a}function IE(t,e){return P_(this,0,void 0,function(){var e,n,r,i,o,a;return D_(this,function(s){switch(s.label){case 0:return e=yE.getEnv().createCanvasElement(),n=t.shape.slice(F_(t)?1:0),r=n[0],i=n[1],o=n[2],a=_d(function(){return t.as3D(r,i,o).toInt()}),[4,g_.toPixels(a,e)];case 1:return s.sent(),a.dispose(),[2,e]}})})}function SE(t){var e=yE.getEnv(),n=e.Image,r=e.Canvas,i=e.Video;return t instanceof n||t instanceof r||t instanceof i}mE(),(gE=vE||(vE={})).TOP_LEFT="TOP_LEFT",gE.TOP_RIGHT="TOP_RIGHT",gE.BOTTOM_LEFT="BOTTOM_LEFT",gE.BOTTOM_RIGHT="BOTTOM_RIGHT";var kE=function(){function t(t,e){var n=this;if(void 0===e&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach(function(t,e){if(B_(t))return n._imageTensors[e]=t,void(n._inputDimensions[e]=t.shape);if(F_(t)){var r=t.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[e]=t,void(n._inputDimensions[e]=t.shape.slice(1))}var i=t instanceof yE.getEnv().Canvas?t:CE(t);n._canvases[e]=i,n._inputDimensions[e]=[i.height,i.width,3]})}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var t=this;return U_(this.batchSize,0,1).map(function(e,n){return t.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),t.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},t.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},t.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},t.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},t.prototype.getReshapedInputDimensions=function(t){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(t,e){var n=t.width,r=t.height,i=e/Math.max(r,n);return new O_(Math.round(n*i),Math.round(r*i))}({width:this.getInputWidth(t),height:this.getInputHeight(t)},this.inputSize)},t.prototype.toBatchTensor=function(t,e){var n=this;return void 0===e&&(e=!0),this._inputSize=t,_d(function(){var r=U_(n.batchSize,0,1).map(function(r){var i=n.getInput(r);if(i instanceof Ch){var o=F_(i)?i:i.expandDims();return o=function(t,e){return void 0===e&&(e=!1),_d(function(){var n=t.shape.slice(1),r=n[0],i=n[1];if(r===i)return t;var o=Math.abs(r-i),a=Math.round(o*(e?.5:1)),s=r>i?2:1,u=function(e){var n=t.shape.slice();return n[s]=e,$d(n,0)},c=u(a),l=o-c.shape[s],h=[e&&l?u(l):null,t,c].filter(function(t){return!!t}).map(function(t){return t.toFloat()});return tp(h,s)})}(o,e),o.shape[1]===t&&o.shape[2]===t||(o=Qb.resizeBilinear(o,[t,t])),o.as3D(t,t,3)}if(i instanceof yE.getEnv().Canvas)return g_.fromPixels(function(t,e,n){void 0===n&&(n=!1);var r=yE.getEnv(),i=r.Image,o=r.Canvas;if(!(t instanceof i||t instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=_E(t),s=e/Math.max(a.height,a.width),u=s*a.width,c=s*a.height,l=EE({width:e,height:e}),h=t instanceof o?t:CE(t),d=Math.abs(u-c)/2,p=n&&u<c?d:0,f=n&&c<u?d:0;return bE(l).drawImage(h,p,f,u,c),l}(i,t,e));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+i)}),i=Wp(r.map(function(t){return t.toFloat()})).as4D(n.batchSize,t,t,3);return i})},t}();function TE(t){return P_(this,0,void 0,function(){var e,n,r;return D_(this,function(i){switch(i.label){case 0:if(t instanceof kE)return[2,t];if(!(e=Array.isArray(t)?t:[t]).length)throw new Error("toNetInput - empty array passed as input");return n=function(e){return Array.isArray(t)?" at input index "+e+":":""},(r=e.map(xE)).forEach(function(t,r){if(!SE(t)&&!B_(t)&&!F_(t)){if("string"==typeof e[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+e[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(F_(t)){var i=t.shape[0];if(1!==i)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+i+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(t){return SE(t)&&(e=t,new Promise(function(t,n){if(e instanceof yE.getEnv().Canvas||wE(e))return t();function r(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",i),t(e))}function i(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",i),n(t))}e.addEventListener("load",r),e.addEventListener("error",i)}));var e}))];case 1:return i.sent(),[2,new kE(r,Array.isArray(t))]}})})}function NE(t,e){return P_(this,0,void 0,function(){var n,r,i,o,a,s;return D_(this,function(u){switch(u.label){case 0:return n=yE.getEnv().Canvas,r=t,t instanceof n?[3,5]:[4,TE(t)];case 1:if((i=u.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(o=i.getInput(0))instanceof n?(a=o,[3,4]):[3,2];case 2:return[4,IE(o)];case 3:a=u.sent(),u.label=4;case 4:r=a,u.label=5;case 5:return s=bE(r),[2,e.map(function(t){return t instanceof X_?t.forSize(r.width,r.height).box.floor():t}).map(function(t){return t.clipAtImageBorders(r.width,r.height)}).map(function(t){var e=t.x,n=t.y,r=t.width,i=t.height,o=EE({width:r,height:i});return bE(o).putImageData(s.getImageData(e,n,r,i),0,0),o})]}})})}function RE(t,e){return P_(this,0,void 0,function(){return D_(this,function(n){if(!B_(t)&&!F_(t))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(F_(t)&&t.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,_d(function(){var n=t.shape.slice(F_(t)?1:0),r=n[0],i=n[1],o=n[2];return e.map(function(t){return t instanceof X_?t.forSize(i,r).box:t}).map(function(t){return t.clipAtImageBorders(i,r)}).map(function(e){var n=e.x,a=e.y,s=e.width,u=e.height;return Wx(t.as3D(r,i,o),[a,n,0],[u,s,o])})})]})})}function AE(t,e){return P_(this,0,void 0,function(){var n;return D_(this,function(r){switch(r.label){case 0:return[4,(0,yE.getEnv().fetch)(t,e)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function PE(t){return P_(this,0,void 0,function(){return D_(this,function(e){switch(e.label){case 0:return[4,AE(t)];case 1:return[2,e.sent().json()]}})})}function DE(t,e){var n=e+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:n};if("/"===t)return{modelBaseUri:"/",manifestUri:"/"+n};var r=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"",i=(t=t.replace(r,"")).split("/").filter(function(t){return t}),o=t.endsWith(".json")?i[i.length-1]:n,a=r+(t.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return{modelBaseUri:a=t.startsWith("/")?"/"+a:a,manifestUri:"/"===a?"/"+o:a+"/"+o}}function ME(t,e){return P_(this,0,void 0,function(){var n,r,i,o;return D_(this,function(a){switch(a.label){case 0:return n=DE(t,e),r=n.manifestUri,i=n.modelBaseUri,[4,PE(r)];case 1:return o=a.sent(),[2,m_.loadWeights(o,i)]}})})}var OE=function(){function t(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t);return e.obj[e.objProp]},t.prototype.reassignParamFromPath=function(t,e){var n=this.traversePropertyPath(t),r=n.obj,i=n.objProp;r[i].dispose(),r[i]=e},t.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(e){var n=e.paramPath;return{path:n,tensor:t.getParamFromPath(n)}})},t.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof Ah})},t.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof Ah)})},t.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(e){var n=e.path,r=e.tensor;t.reassignParamFromPath(n,r.variable())})},t.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(e){var n=e.path,r=e.tensor,i=Wd(r.dataSync());r.dispose(),t.reassignParamFromPath(n,i)})},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.getParamList().forEach(function(e){if(t&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){var e=t.tensor;return Array.from(e.dataSync())}).reduce(function(t,e){return t.concat(e)}))},t.prototype.load=function(t){return P_(this,0,void 0,function(){return D_(this,function(e){switch(e.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}})})},t.prototype.loadFromUri=function(t){return P_(this,0,void 0,function(){var e;return D_(this,function(n){switch(n.label){case 0:if(t&&"string"!=typeof t)throw new Error(this._name+".loadFromUri - expected model uri");return[4,ME(t,this.getDefaultModelName())];case 1:return e=n.sent(),this.loadFromWeightMap(e),[2]}})})},t.prototype.loadFromDisk=function(t){return P_(this,0,void 0,function(){var e,n,r,i,o,a,s,u,c,l;return D_(this,function(h){switch(h.label){case 0:if(t&&"string"!=typeof t)throw new Error(this._name+".loadFromDisk - expected model file path");return e=yE.getEnv().readFile,n=DE(t,this.getDefaultModelName()),r=n.manifestUri,i=n.modelBaseUri,o=function(t){return Promise.all(t.map(function(t){return e(t).then(function(t){return t.buffer})}))},a=m_.weightsLoaderFactory(o),c=(u=JSON).parse,[4,e(r)];case 1:return s=c.apply(u,[h.sent().toString()]),[4,a(s,i)];case 2:return l=h.sent(),this.loadFromWeightMap(l),[2]}})})},t.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),n=e.paramMappings,r=e.params;this._paramMappings=n,this._params=r},t.prototype.extractWeights=function(t){var e=this.extractParams(t),n=e.paramMappings,r=e.params;this._paramMappings=n,this._params=r},t.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce(function(e,n){if(!e.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+t);return{obj:e.nextObj,objProp:n,nextObj:e.nextObj[n]}},{nextObj:this.params}),n=e.obj,r=e.objProp;if(!(n&&r&&n[r]instanceof Ch))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:n,objProp:r}},t}();function LE(t,e,n){return _d(function(){var r=bx(t,e.depthwise_filter,e.pointwise_filter,n,"same");return r=Sy(r,e.bias)})}function BE(t,e,n){return void 0===n&&(n=!1),_d(function(){var r=ib(n?Sy(px(t,e.conv0.filters,[2,2],"same"),e.conv0.bias):LE(t,e.conv0,[2,2])),i=LE(r,e.conv1,[1,1]),o=LE(ib(Sy(r,i)),e.conv2,[1,1]);return ib(Sy(r,Sy(i,o)))})}function FE(t,e,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),_d(function(){var i=ib(n?Sy(px(t,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):LE(t,e.conv0,r?[2,2]:[1,1])),o=LE(i,e.conv1,[1,1]),a=LE(ib(Sy(i,o)),e.conv2,[1,1]),s=LE(ib(Sy(i,Sy(o,a))),e.conv3,[1,1]);return ib(Sy(i,Sy(o,Sy(a,s))))})}function jE(t,e,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),_d(function(){var i=Sy(px(t,e.filters,[1,1],n),e.bias);return r?ib(i):i})}function zE(t,e){Object.keys(t).forEach(function(n){e.some(function(t){return t.originalPath===n})||t[n].dispose()})}function WE(t,e){return function(n,r,i,o){var a=Kd(t(n*r*i*i),[i,i,n,r]),s=Hd(t(r));return e.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:a,bias:s}}}function UE(t,e){return function(n,r,i){var o=Gd(t(n*r),[n,r]),a=Hd(t(r));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:o,bias:a}}}var VE=function(){return function(t,e,n){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=n}}();function HE(t,e){return function(n,r,i){var o=Kd(t(9*n),[3,3,n,1]),a=Kd(t(n*r),[1,1,n,r]),s=Hd(t(r));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new VE(o,a,s)}}function GE(t){return function(e){var n=t(e+"/depthwise_filter",4),r=t(e+"/pointwise_filter",4),i=t(e+"/bias",1);return new VE(n,r,i)}}function qE(t,e){return function(n,r,i){var o=t[n];if(!L_(o,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+o);return e.push({originalPath:n,paramPath:i||n}),o}}function KE(t){var e=t;return{extractWeights:function(t){var n=e.slice(0,t);return e=e.slice(t),n},getRemainingWeights:function(){return e}}}function ZE(t,e){var n=WE(t,e),r=HE(t,e);function i(t,e,i,o){return void 0===o&&(o=!1),{conv0:o?n(t,e,3,i+"/conv0"):r(t,e,i+"/conv0"),conv1:r(e,e,i+"/conv1"),conv2:r(e,e,i+"/conv2")}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:function(t,e,n,o){void 0===o&&(o=!1);var a=i(t,e,n,o);return{conv0:a.conv0,conv1:a.conv1,conv2:a.conv2,conv3:r(e,e,n+"/conv3")}}}}function XE(t){return function(e){return{filters:t(e+"/filters",4),bias:t(e+"/bias",1)}}}function $E(t,e){var n=qE(t,e),r=XE(n),i=GE(n);return{extractDenseBlock3Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?r(t+"/conv0"):i(t+"/conv0"),conv1:i(t+"/conv1"),conv2:i(t+"/conv2")}},extractDenseBlock4Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?r(t+"/conv0"):i(t+"/conv0"),conv1:i(t+"/conv1"),conv2:i(t+"/conv2"),conv3:i(t+"/conv3")}}}}var YE=function(t){function e(){return t.call(this,"FaceFeatureExtractor")||this}return R_(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("FaceFeatureExtractor - load model before inference");return _d(function(){var n=FE(J_(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Vd(255)),e.dense0,!0);return n=FE(n,e.dense1),n=FE(n,e.dense2),n=FE(n,e.dense3),n=Mx(n,[7,7],[2,2],"valid")})},e.prototype.forward=function(t){return P_(this,0,void 0,function(){var e;return D_(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,TE(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=$E(t,e).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return zE(t,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=KE(t),r=n.extractWeights,i=n.getRemainingWeights,o=ZE(r,e).extractDenseBlock4Params,a=o(3,32,"dense0",!0),s=o(32,64,"dense1"),u=o(64,128,"dense2"),c=o(128,256,"dense3");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u,dense3:c}}}(t)},e}(OE);function JE(t,e){return _d(function(){return Sy(Ex(t,e.weights),e.bias)})}function QE(t){var e={},n={};return Object.keys(t).forEach(function(r){(r.startsWith("fc")?n:e)[r]=t[r]}),{featureExtractorMap:e,classifierMap:n}}var tC=function(t){function e(e,n){var r=t.call(this,e)||this;return r._faceFeatureExtractor=n,r}return R_(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var e=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return _d(function(){var r=t instanceof kE?e.faceFeatureExtractor.forwardInput(t):t;return JE(r.as2D(r.shape[0],-1),n.fc)})},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),n=e.params,r=e.paramMappings;this._params=n,this._paramMappings=r},e.prototype.extractClassifierParams=function(t){return function(t,e,n){var r=[],i=KE(t),o=i.extractWeights,a=i.getRemainingWeights,s=UE(o,r)(e,n,"fc");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:s}}}(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var e=QE(t),n=e.featureExtractorMap,r=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(t){var e,n=[],r=qE(t,n),i={fc:(e="fc",{weights:r(e+"/weights",2),bias:r(e+"/bias",1)})};return zE(t,n),{params:i,paramMappings:n}}(r)},e.prototype.extractParams=function(t){var e=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*e+n,i=t.slice(0,t.length-r),o=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},e}(OE),eC=["neutral","happy","sad","angry","fearful","disgusted","surprised"],nC=function(){function t(t){var e=this;if(7!==t.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);eC.forEach(function(n,r){e[n]=t[r]})}return t.prototype.asSortedArray=function(){var t=this;return eC.map(function(e){return{expression:e,probability:t[e]}}).sort(function(t,e){return e.probability-t.probability})},t}(),rC=function(t){function e(e){return void 0===e&&(e=new YE),t.call(this,"FaceExpressionNet",e)||this}return R_(e,t),e.prototype.forwardInput=function(t){var e=this;return _d(function(){return uf(e.runNet(t))})},e.prototype.forward=function(t){return P_(this,0,void 0,function(){var e;return D_(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,TE(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.predictExpressions=function(t){return P_(this,0,void 0,function(){var e,n,r,i,o=this;return D_(this,function(a){switch(a.label){case 0:return[4,TE(t)];case 1:return e=a.sent(),[4,this.forwardInput(e)];case 2:return n=a.sent(),[4,Promise.all(Hp(n).map(function(t){return P_(o,0,void 0,function(){var e;return D_(this,function(n){switch(n.label){case 0:return[4,t.data()];case 1:return e=n.sent(),t.dispose(),[2,e]}})})}))];case 3:return r=a.sent(),n.dispose(),i=r.map(function(t){return new nC(t)}),[2,e.isBatchInput?i:i[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(tC);function iC(t,e){var n={expressions:e};return Object.assign({},t,n)}function oC(t){return function(t){return t.detection instanceof X_}(t)&&t.landmarks instanceof nE&&t.unshiftedLandmarks instanceof nE&&t.alignedRect instanceof X_}function aC(t,e){var n=t.detection.box,r=e.shiftBy(n.x,n.y),i=r.align(),o=t.detection.imageDims,a={landmarks:r,unshiftedLandmarks:e,alignedRect:new X_(t.detection.score,i.rescale(o.reverse()),o)};return Object.assign({},t,a)}function sC(t,e){var n=[],r=KE(t),i=r.extractWeights,o=r.getRemainingWeights,a=function(t,e){var n=WE(t,e),r=HE(t,e);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(t,e,i){return{separable_conv0:r(t,e,i+"/separable_conv0"),separable_conv1:r(e,e,i+"/separable_conv1"),expansion_conv:n(t,e,1,i+"/expansion_conv")}},extractMainBlockParams:function(t,e){return{separable_conv0:r(t,t,e+"/separable_conv0"),separable_conv1:r(t,t,e+"/separable_conv1"),separable_conv2:r(t,t,e+"/separable_conv2")}}}}(i,n),s=a.extractConvParams,u=a.extractSeparableConvParams,c=a.extractReductionBlockParams,l=a.extractMainBlockParams,h={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},d={};U_(e,0,1).forEach(function(t){d["main_block_"+t]=l(128,"middle_flow/main_block_"+t)});var p={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{entry_flow:h,middle_flow:d,exit_flow:p}}}function uC(t,e){var n=[],r=function(t,e){var n=qE(t,e),r=XE(n),i=GE(n);return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:function(t){return{separable_conv0:i(t+"/separable_conv0"),separable_conv1:i(t+"/separable_conv1"),expansion_conv:r(t+"/expansion_conv")}},extractMainBlockParams:function(t){return{separable_conv0:i(t+"/separable_conv0"),separable_conv1:i(t+"/separable_conv1"),separable_conv2:i(t+"/separable_conv2")}}}}(t,n),i=r.extractConvParams,o=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,u={conv_in:i("entry_flow/conv_in"),reduction_block_0:a("entry_flow/reduction_block_0"),reduction_block_1:a("entry_flow/reduction_block_1")},c={};U_(e,0,1).forEach(function(t){c["main_block_"+t]=s("middle_flow/main_block_"+t)});var l={reduction_block:a("exit_flow/reduction_block"),separable_conv:o("exit_flow/separable_conv")};return zE(t,n),{params:{entry_flow:u,middle_flow:c,exit_flow:l},paramMappings:n}}function cC(t,e,n){return Sy(px(t,e.filters,n,"same"),e.bias)}function lC(t,e,n){void 0===n&&(n=!0);var r=n?ib(t):t;return r=LE(r,e.separable_conv0,[1,1]),r=LE(ib(r),e.separable_conv1,[1,1]),r=Dx(r,[3,3],[2,2],"same"),r=Sy(r,cC(t,e.expansion_conv,[2,2]))}var hC,dC,pC=function(t){function e(e){var n=t.call(this,"TinyXception")||this;return n._numMainBlocks=e,n}return R_(e,t),e.prototype.forwardInput=function(t){var e=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return _d(function(){var r=J_(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Vd(256)),i=ib(cC(r,n.entry_flow.conv_in,[2,2]));return i=lC(i,n.entry_flow.reduction_block_0,!1),i=lC(i,n.entry_flow.reduction_block_1),U_(e._numMainBlocks,0,1).forEach(function(t){i=function(t,e){var n=LE(ib(t),e.separable_conv0,[1,1]);return n=LE(ib(n),e.separable_conv1,[1,1]),n=LE(ib(n),e.separable_conv2,[1,1]),Sy(n,t)}(i,n.middle_flow["main_block_"+t])}),i=lC(i,n.exit_flow.reduction_block),i=ib(LE(i,n.exit_flow.separable_conv,[1,1]))})},e.prototype.forward=function(t){return P_(this,0,void 0,function(){var e;return D_(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,TE(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return uC(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return sC(t,this._numMainBlocks)},e}(OE);(dC=hC||(hC={})).FEMALE="female",dC.MALE="male";var fC=function(t){function e(e){void 0===e&&(e=new pC(2));var n=t.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=e,n}return R_(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var e=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return _d(function(){var r=t instanceof kE?e.faceFeatureExtractor.forwardInput(t):t,i=Mx(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:JE(i,n.fc.age).as1D(),gender:JE(i,n.fc.gender)}})},e.prototype.forwardInput=function(t){var e=this;return _d(function(){var n=e.runNet(t),r=n.age,i=n.gender;return{age:r,gender:uf(i)}})},e.prototype.forward=function(t){return P_(this,0,void 0,function(){var e;return D_(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,TE(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return P_(this,0,void 0,function(){var e,n,r,i,o,a,s=this;return D_(this,function(u){switch(u.label){case 0:return[4,TE(t)];case 1:return e=u.sent(),[4,this.forwardInput(e)];case 2:return n=u.sent(),r=Hp(n.age),i=Hp(n.gender),o=r.map(function(t,e){return{ageTensor:t,genderTensor:i[e]}}),[4,Promise.all(o.map(function(t){var e=t.ageTensor,n=t.genderTensor;return P_(s,0,void 0,function(){var t,r,i,o,a;return D_(this,function(s){switch(s.label){case 0:return[4,e.data()];case 1:return t=s.sent()[0],[4,n.data()];case 2:return r=s.sent()[0],o=(i=r>.5)?hC.MALE:hC.FEMALE,a=i?r:1-r,e.dispose(),n.dispose(),[2,{age:t,gender:o,genderProbability:a}]}})})}))];case 3:return a=u.sent(),n.age.dispose(),n.gender.dispose(),[2,e.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),n=e.params,r=e.paramMappings;this._params=n,this._paramMappings=r},e.prototype.extractClassifierParams=function(t){return function(t){var e=[],n=KE(t),r=n.extractWeights,i=n.getRemainingWeights,o=UE(r,e),a=o(512,1,"fc/age"),s=o(512,2,"fc/gender");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:a,gender:s}}}}(t)},e.prototype.extractParamsFromWeigthMap=function(t){var e=QE(t),n=e.featureExtractorMap,r=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(t){var e=[],n=qE(t,e);function r(t){return{weights:n(t+"/weights",2),bias:n(t+"/bias",1)}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return zE(t,e),{params:i,paramMappings:e}}(r)},e.prototype.extractParams=function(t){var e=t.slice(0,t.length-1539),n=t.slice(t.length-1539);return this.faceFeatureExtractor.extractWeights(e),this.extractClassifierParams(n)},e}(OE),mC=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R_(e,t),e.prototype.postProcess=function(t,e,n){var r=n.map(function(t){var n=t.width,r=t.height,i=e/Math.max(r,n);return{width:n*i,height:r*i}}),i=r.length;return _d(function(){var n=function(t,e){return Wp([$d([68],t),$d([68],e)],1).as2D(1,136).as1D()},o=function(t,e){var n=r[t],i=n.width,o=n.height;return e(i,o)?Math.abs(i-o)/2:0};return t.mul($d([i,136],e)).sub(Wp(Array.from(Array(i),function(t,e){return n(function(t){return o(t,function(t,e){return t<e})}(e),function(t){return o(t,function(t,e){return e<t})}(e))}))).div(Wp(Array.from(Array(i),function(t,e){return n(r[e].width,r[e].height)})))})},e.prototype.forwardInput=function(t){var e=this;return _d(function(){var n=e.runNet(t);return e.postProcess(n,t.inputSize,t.inputDimensions.map(function(t){return{height:t[0],width:t[1]}}))})},e.prototype.forward=function(t){return P_(this,0,void 0,function(){var e;return D_(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,TE(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.detectLandmarks=function(t){return P_(this,0,void 0,function(){var e,n,r,i=this;return D_(this,function(o){switch(o.label){case 0:return[4,TE(t)];case 1:return e=o.sent(),n=_d(function(){return Hp(i.forwardInput(e))}),[4,Promise.all(n.map(function(t,n){return P_(i,0,void 0,function(){var r,i,o,a,s;return D_(this,function(u){switch(u.label){case 0:return o=(i=Array).from,[4,t.data()];case 1:return r=o.apply(i,[u.sent()]),a=r.filter(function(t,e){return j_(e)}),s=r.filter(function(t,e){return!j_(e)}),[2,new iE(Array(68).fill(0).map(function(t,e){return new G_(a[e],s[e])}),{height:e.getInputHeight(n),width:e.getInputWidth(n)})]}})})}))];case 2:return r=o.sent(),n.forEach(function(t){return t.dispose()}),[2,e.isBatchInput?r:r[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(tC),vC=function(t){function e(e){return void 0===e&&(e=new YE),t.call(this,"FaceLandmark68Net",e)||this}return R_(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(mC);var gC=function(t){function e(){return t.call(this,"TinyFaceFeatureExtractor")||this}return R_(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("TinyFaceFeatureExtractor - load model before inference");return _d(function(){var n=BE(J_(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Vd(255)),e.dense0,!0);return n=BE(n,e.dense1),n=BE(n,e.dense2),n=Mx(n,[14,14],[2,2],"valid")})},e.prototype.forward=function(t){return P_(this,0,void 0,function(){var e;return D_(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,TE(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=$E(t,e).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return zE(t,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=KE(t),r=n.extractWeights,i=n.getRemainingWeights,o=ZE(r,e).extractDenseBlock3Params,a=o(3,32,"dense0",!0),s=o(32,64,"dense1"),u=o(64,128,"dense2");if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u}}}(t)},e}(OE),yC=function(t){function e(e){return void 0===e&&(e=new gC),t.call(this,"FaceLandmark68TinyNet",e)||this}return R_(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(mC);function xC(t,e,n,r,i){void 0===i&&(i="same");var o=e.conv,a=o.filters,s=o.bias,u=px(t,a,n,i);return u=function(t,e){return Sy(zy(t,e.weights),e.biases)}(u=Sy(u,s),e.scale),r?ib(u):u}function bC(t,e){return xC(t,e,[1,1],!1)}function wC(t,e){return xC(t,e,[2,2],!0,"valid")}function _C(t,e){function n(n,r,i,o){var a=function(e,n,r){var i=t(e),o=i.length/(n*r*r);if(o%1!=0)throw new Error("depth has to be an integer: "+o+", weights.length: "+i.length+", numFilters: "+n+", filterSize: "+r);return _d(function(){return sb(Kd(i,[n,o,r,r]),[2,3,1,0])})}(n,r,i),s=Hd(t(r));return e.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:a,bias:s}}function r(r,i,o,a){var s=n(r,i,o,a+"/conv"),u=function(n,r){var i=Hd(t(n)),o=Hd(t(n));return e.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:i,biases:o}}(i,a+"/scale");return{conv:s,scale:u}}return{extractConvLayerParams:r,extractResidualLayerParams:function(t,e,n,i,o){return void 0===o&&(o=!1),{conv1:r((o?.5:1)*t,e,n,i+"/conv1"),conv2:r(t,e,n,i+"/conv2")}}}}function EC(t,e){var n=qE(t,e);function r(t){var e=n(t+"/conv/filters",4),r=n(t+"/conv/bias",1),i=function(t){return{weights:n(t+"/scale/weights",1),biases:n(t+"/scale/biases",1)}}(t);return{conv:{filters:e,bias:r},scale:i}}return{extractConvLayerParams:r,extractResidualLayerParams:function(t){return{conv1:r(t+"/conv1"),conv2:r(t+"/conv2")}}}}function CC(t){var e=[],n=EC(t,e),r=n.extractConvLayerParams,i=n.extractResidualLayerParams,o=r("conv32_down"),a=i("conv32_1"),s=i("conv32_2"),u=i("conv32_3"),c=i("conv64_down"),l=i("conv64_1"),h=i("conv64_2"),d=i("conv64_3"),p=i("conv128_down"),f=i("conv128_1"),m=i("conv128_2"),v=i("conv256_down"),g=i("conv256_1"),y=i("conv256_2"),x=i("conv256_down_out"),b=t.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!L_(b,2))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+b);var w={conv32_down:o,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:h,conv64_3:d,conv128_down:p,conv128_1:f,conv128_2:m,conv256_down:v,conv256_1:g,conv256_2:y,conv256_down_out:x,fc:b};return zE(t,e),{params:w,paramMappings:e}}function IC(t,e){var n=function(t,e){return xC(t,e,[1,1],!0)}(t,e.conv1);return n=bC(n,e.conv2),n=Sy(n,t),n=ib(n)}function SC(t,e){var n=wC(t,e.conv1);n=bC(n,e.conv2);var r=Mx(t,2,2,"valid"),i=Xd(r.shape),o=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var a=M_(n.shape);a[1]=1;var s=Xd(a),u=M_((n=tp([n,s],1)).shape);u[2]=1;var c=Xd(u);n=tp([n,c],2)}return r=o?tp([r,i],3):r,n=Sy(r,n),n=ib(n)}!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}R_(e,t)}(vC);var kC=function(t){function e(){return t.call(this,"FaceRecognitionNet")||this}return R_(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("FaceRecognitionNet - load model before inference");return _d(function(){var n=wC(J_(t.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(Vd(256)),e.conv32_down);n=IC(n=Dx(n,3,2,"valid"),e.conv32_1),n=IC(n,e.conv32_2),n=IC(n,e.conv32_3),n=IC(n=SC(n,e.conv64_down),e.conv64_1),n=IC(n,e.conv64_2),n=IC(n,e.conv64_3),n=IC(n=SC(n,e.conv128_down),e.conv128_1),n=IC(n,e.conv128_2),n=IC(n=SC(n,e.conv256_down),e.conv256_1);var r=(n=SC(n=IC(n,e.conv256_2),e.conv256_down_out)).mean([1,2]);return Ex(r,e.fc)})},e.prototype.forward=function(t){return P_(this,0,void 0,function(){var e;return D_(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,TE(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return P_(this,0,void 0,function(){var e,n,r,i=this;return D_(this,function(o){switch(o.label){case 0:return[4,TE(t)];case 1:return e=o.sent(),n=_d(function(){return Hp(i.forwardInput(e))}),[4,Promise.all(n.map(function(t){return t.data()}))];case 2:return r=o.sent(),n.forEach(function(t){return t.dispose()}),[2,e.isBatchInput?r:r[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return CC(t)},e.prototype.extractParams=function(t){return function(t){var e=KE(t),n=e.extractWeights,r=e.getRemainingWeights,i=[],o=_C(n,i),a=o.extractConvLayerParams,s=o.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),h=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),p=s(36864,64,3,"conv64_1"),f=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),v=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),x=s(589824,256,3,"conv256_down",!0),b=s(589824,256,3,"conv256_1"),w=s(589824,256,3,"conv256_2"),_=s(589824,256,3,"conv256_down_out"),E=_d(function(){return sb(Gd(n(32768),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:h,conv64_down:d,conv64_1:p,conv64_2:f,conv64_3:m,conv128_down:v,conv128_1:g,conv128_2:y,conv256_down:x,conv256_1:b,conv256_2:w,conv256_down_out:_,fc:E},paramMappings:i}}(t)},e}(OE);function TC(t,e){var n={descriptor:e};return Object.assign({},t,n)}function NC(t,e){var n={age:e};return Object.assign({},t,n)}function RC(t,e,n){var r={gender:e,genderProbability:n};return Object.assign({},t,r)}var AC=function(){function t(t){var e=void 0===t?{}:t,n=e.minFaceSize,r=e.scaleFactor,i=e.maxNumScales,o=e.scoreThresholds,a=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=i||10,this._scoreThresholds=o||[.6,.7,.7],this._scaleSteps=a,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(t){return"number"!=typeof t}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(t){return"number"!=typeof t})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function PC(t,e){function n(n,r,i,o,a){var s=Kd(t(n*r*i*i),[i,i,n,r]),u=Hd(t(r));return e.push({paramPath:o+"/filters"},{paramPath:o+"/"+(a?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(t,e,r,i){var o=n(t,e,r,i,!0);return{filters:o.filters,batch_norm_offset:o.bias}}function i(n,i,o){var a=function(n,r){var i=Kd(t(9*n),[3,3,n,1]),o=Hd(t(n)),a=Hd(t(n)),s=Hd(t(n)),u=Hd(t(n));return e.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:i,batch_norm_scale:o,batch_norm_offset:a,batch_norm_mean:s,batch_norm_variance:u}}(n,o+"/depthwise_conv");return{depthwise_conv:a,pointwise_conv:r(n,i,1,o+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:i(32,64,"mobilenetv1/conv_1"),conv_2:i(64,128,"mobilenetv1/conv_2"),conv_3:i(128,128,"mobilenetv1/conv_3"),conv_4:i(128,256,"mobilenetv1/conv_4"),conv_5:i(256,256,"mobilenetv1/conv_5"),conv_6:i(256,512,"mobilenetv1/conv_6"),conv_7:i(512,512,"mobilenetv1/conv_7"),conv_8:i(512,512,"mobilenetv1/conv_8"),conv_9:i(512,512,"mobilenetv1/conv_9"),conv_10:i(512,512,"mobilenetv1/conv_10"),conv_11:i(512,512,"mobilenetv1/conv_11"),conv_12:i(512,1024,"mobilenetv1/conv_12"),conv_13:i(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function DC(t){var e=[],n=function(t,e){var n=qE(t,e);function r(t,e,r){return{filters:n(t+"/Conv2d_"+e+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(t+"/Conv2d_"+e+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function i(t){var e="mobilenetv1/conv_"+t,i="MobilenetV1/Conv2d_"+t+"_depthwise",o=e+"/depthwise_conv",a=e+"/pointwise_conv";return{depthwise_conv:{filters:n(i+"/depthwise_weights",4,o+"/filters"),batch_norm_scale:n(i+"/BatchNorm/gamma",1,o+"/batch_norm_scale"),batch_norm_offset:n(i+"/BatchNorm/beta",1,o+"/batch_norm_offset"),batch_norm_mean:n(i+"/BatchNorm/moving_mean",1,o+"/batch_norm_mean"),batch_norm_variance:n(i+"/BatchNorm/moving_variance",1,o+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",t,a)}}function o(t,e){return{filters:n(t+"/weights",4,e+"/filters"),bias:n(t+"/biases",1,e+"/bias")}}function a(t){return{box_encoding_predictor:o("Prediction/BoxPredictor_"+t+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+t+"/box_encoding_predictor"),class_predictor:o("Prediction/BoxPredictor_"+t+"/ClassPredictor","prediction_layer/box_predictor_"+t+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}}}(t,e),r=n.extractMobilenetV1Params,i=n.extractPredictionLayerParams,o=t["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!B_(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var a={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:o}};return zE(t,e),{params:a,paramMappings:e}}function MC(t,e,n){return _d(function(){var r=px(t,e.filters,n,"same");return r=Sy(r,e.batch_norm_offset),Mg(r,0,6)})}function OC(t,e){return _d(function(){var n=null,r=MC(t,e.conv_0,[2,2]);if([e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13].forEach(function(t,e){var i=e+1,o=function(t){return[2,4,6,12].some(function(e){return e===t})?[2,2]:[1,1]}(i);r=function(t,e,n){return _d(function(){var r=gx(t,e.filters,n,"same");return r=vy(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,.0010000000474974513),Mg(r,0,6)})}(r,t.depthwise_conv,o),r=MC(r,t.pointwise_conv,[1,1]),11===i&&(n=r)}),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function LC(t,e,n){var r=t.arraySync(),i=Math.min(r[e][0],r[e][2]),o=Math.min(r[e][1],r[e][3]),a=Math.max(r[e][0],r[e][2]),s=Math.max(r[e][1],r[e][3]),u=Math.min(r[n][0],r[n][2]),c=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),h=Math.max(r[n][1],r[n][3]),d=(a-i)*(s-o),p=(l-u)*(h-c);if(d<=0||p<=0)return 0;var f=Math.max(i,u),m=Math.max(o,c),v=Math.min(a,l),g=Math.min(s,h),y=Math.max(v-f,0)*Math.max(g-m,0);return y/(d+p-y)}function BC(t,e){var n=function(t){var e=Hp(sb(t,[1,0])),n=[Gy(e[2],e[0]),Gy(e[3],e[1])];return{sizes:n,centers:[Sy(e[0],Ry(n[0],Vd(2))),Sy(e[1],Ry(n[1],Vd(2)))]}}(t),r=n.sizes,i=n.centers,o=Hp(sb(e,[1,0])),a=Ry(zy(Fg(Ry(o[2],Vd(5))),r[0]),Vd(2)),s=Sy(zy(Ry(o[0],Vd(10)),r[0]),i[0]),u=Ry(zy(Fg(Ry(o[3],Vd(5))),r[1]),Vd(2)),c=Sy(zy(Ry(o[1],Vd(10)),r[1]),i[1]);return sb(Wp([Gy(s,a),Gy(c,u),Sy(s,a),Sy(c,u)]),[1,0])}function FC(t,e){return _d(function(){var n=t.shape[0];return{boxPredictionEncoding:Fp(jE(t,e.box_encoding_predictor),[n,-1,1,4]),classPrediction:Fp(jE(t,e.class_predictor),[n,-1,3])}})}var jC=function(){function t(t){var e=void 0===t?{}:t,n=e.minConfidence,r=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}(),zC=function(t){function e(){return t.call(this,"SsdMobilenetv1")||this}return R_(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("SsdMobilenetv1 - load model before inference");return _d(function(){var n=t.toBatchTensor(512,!1).toFloat(),r=OC(Gy(zy(n,Vd(.007843137718737125)),Vd(1)),e.mobilenetv1),i=function(t,e,n){return _d(function(){var r=MC(t,n.conv_0,[1,1]),i=MC(r,n.conv_1,[2,2]),o=MC(i,n.conv_2,[1,1]),a=MC(o,n.conv_3,[2,2]),s=MC(a,n.conv_4,[1,1]),u=MC(s,n.conv_5,[2,2]),c=MC(u,n.conv_6,[1,1]),l=MC(c,n.conv_7,[2,2]),h=FC(e,n.box_predictor_0),d=FC(t,n.box_predictor_1),p=FC(i,n.box_predictor_2),f=FC(a,n.box_predictor_3),m=FC(u,n.box_predictor_4),v=FC(l,n.box_predictor_5);return{boxPredictions:tp([h.boxPredictionEncoding,d.boxPredictionEncoding,p.boxPredictionEncoding,f.boxPredictionEncoding,m.boxPredictionEncoding,v.boxPredictionEncoding],1),classPredictions:tp([h.classPrediction,d.classPrediction,p.classPrediction,f.classPrediction,m.classPrediction,v.classPrediction],1)}})}(r.out,r.conv11,e.prediction_layer);return function(t,e,n){return _d(function(){var r=t.shape[0],i=BC(Fp(Up(n.extra_dim,[r,1,1]),[-1,4]),Fp(t,[-1,4]));i=Fp(i,[r,i.shape[0]/r,4]);var o=Zg(Fx(e,[0,0,1],[-1,-1,-1])),a=Fx(o,[0,0,0],[-1,-1,1]);return a=Fp(a,[r,a.shape[1]]),{boxes:Hp(i),scores:Hp(a)}})}(i.boxPredictions,i.classPredictions,e.output_layer)})},e.prototype.forward=function(t){return P_(this,0,void 0,function(){var e;return D_(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,TE(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.locateFaces=function(t,e){return void 0===e&&(e={}),P_(this,0,void 0,function(){var n,r,i,o,a,s,u,c,l,h,d,p,f,m,v,g,y,x,b,w;return D_(this,function(_){switch(_.label){case 0:return n=new jC(e),r=n.maxResults,i=n.minConfidence,[4,TE(t)];case 1:for(o=_.sent(),a=this.forwardInput(o),s=a.boxes,u=a.scores,c=s[0],l=u[0],h=1;h<s.length;h++)s[h].dispose(),u[h].dispose();return f=(p=Array).from,[4,l.data()];case 2:return d=f.apply(p,[_.sent()]),m=function(t,e,n,r,i){var o=t.shape[0],a=Math.min(n,o),s=e.map(function(t,e){return{score:t,boxIndex:e}}).filter(function(t){return t.score>i}).sort(function(t,e){return e.score-t.score}),u=function(t){return t<=r?1:0},c=[];return s.forEach(function(e){if(!(c.length>=a)){for(var n=e.score,r=c.length-1;r>=0;--r){var o=LC(t,e.boxIndex,c[r]);if(0!==o&&(e.score*=u(o),e.score<=i))break}n===e.score&&c.push(e.boxIndex)}}),c}(c,d,r,.5,i),v=o.getReshapedInputDimensions(0),g=o.inputSize,y=g/v.width,x=g/v.height,b=c.arraySync(),w=m.map(function(t){var e=[Math.max(0,b[t][0]),Math.min(1,b[t][2])].map(function(t){return t*x}),n=e[0],r=e[1],i=[Math.max(0,b[t][1]),Math.min(1,b[t][3])].map(function(t){return t*y}),a=i[0],s=i[1];return new X_(d[t],new eE(a,n,s-a,r-n),{height:o.getInputHeight(0),width:o.getInputWidth(0)})}),c.dispose(),l.dispose(),[2,w]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return DC(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=KE(t),r=n.extractWeights,i=n.getRemainingWeights,o=PC(r,e),a=o.extractMobilenetV1Params,s=o.extractPredictionLayerParams,u=a(),c=s(),l={extra_dim:qd(r(20472),[1,5118,4])};if(e.push({paramPath:"output_layer/extra_dim"}),0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:l},paramMappings:e}}(t)},e}(OE);!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}R_(e,t)}(zC);var WC,UC,VC=[new G_(.738768,.874946),new G_(2.42204,2.65704),new G_(4.30971,7.04493),new G_(10.246,4.59428),new G_(12.6868,11.8741)],HC=[new G_(1.603231,2.094468),new G_(6.041143,7.080126),new G_(2.882459,3.518061),new G_(4.266906,5.178857),new G_(9.041765,10.66308)],GC=[117.001,114.697,97.404],qC=function(t){return"number"==typeof t};function KC(t){return _d(function(){var e=zy(t,Vd(.10000000149011612));return Sy(ib(Gy(t,e)),e)})}function ZC(t,e){return _d(function(){var n=Np(t,[[0,0],[1,1],[1,1],[0,0]]);return n=px(n,e.conv.filters,[1,1],"valid"),n=Gy(n,e.bn.sub),n=zy(n,e.bn.truediv),KC(n=Sy(n,e.conv.bias))})}function XC(t,e){return _d(function(){var n=Np(t,[[0,0],[1,1],[1,1],[0,0]]);return n=bx(n,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),KC(n=Sy(n,e.bias))})}function $C(t,e){var n=WE(t,e);var r=HE(t,e);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,i,o){var a=n(r,i,3,o+"/conv"),s=function(n,r){var i=Hd(t(n)),o=Hd(t(n));return e.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:i,truediv:o}}(i,o+"/bn");return{conv:a,bn:s}},extractSeparableConvParams:r}}function YC(t,e){var n=qE(t,e);function r(t){return{filters:n(t+"/filters",4),bias:n(t+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(t){var e=r(t+"/conv"),i=function(t){return{sub:n(t+"/sub",1),truediv:n(t+"/truediv",1)}}(t+"/bn");return{conv:e,bn:i}},extractSeparableConvParams:GE(n)}}(UC=WC||(WC={}))[UC.XS=224]="XS",UC[UC.SM=320]="SM",UC[UC.MD=416]="MD",UC[UC.LG=608]="LG";var JC=function(){function t(t){var e=void 0===t?{}:t,n=e.inputSize,r=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}(),QC=function(t){function e(e){var n=t.call(this,"TinyYolov2")||this;return function(t){if(!t)throw new Error("invalid config: "+t);if("boolean"!=typeof t.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+t.withSeparableConvs);if(!qC(t.iouThreshold)||t.iouThreshold<0||t.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+t.iouThreshold);if(!Array.isArray(t.classes)||!t.classes.length||!t.classes.every(function(t){return"string"==typeof t}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(t.classes));if(!Array.isArray(t.anchors)||!t.anchors.length||!t.anchors.map(function(t){return t||{}}).every(function(t){return qC(t.x)&&qC(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(t.anchors));if(t.meanRgb&&(!Array.isArray(t.meanRgb)||3!==t.meanRgb.length||!t.meanRgb.every(qC)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(t.meanRgb))}(e),n._config=e,n}return R_(e,t),Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,e){var n=ZC(t,e.conv0);return n=ZC(n=Dx(n,[2,2],[2,2],"same"),e.conv1),n=ZC(n=Dx(n,[2,2],[2,2],"same"),e.conv2),n=ZC(n=Dx(n,[2,2],[2,2],"same"),e.conv3),n=ZC(n=Dx(n,[2,2],[2,2],"same"),e.conv4),n=ZC(n=Dx(n,[2,2],[2,2],"same"),e.conv5),n=ZC(n=Dx(n,[2,2],[1,1],"same"),e.conv6),jE(n=ZC(n,e.conv7),e.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,e){var n=this.config.isFirstLayerConv2d?KC(jE(t,e.conv0,"valid",!1)):XC(t,e.conv0);return n=XC(n=Dx(n,[2,2],[2,2],"same"),e.conv1),n=XC(n=Dx(n,[2,2],[2,2],"same"),e.conv2),n=XC(n=Dx(n,[2,2],[2,2],"same"),e.conv3),n=XC(n=Dx(n,[2,2],[2,2],"same"),e.conv4),n=XC(n=Dx(n,[2,2],[2,2],"same"),e.conv5),n=Dx(n,[2,2],[1,1],"same"),n=e.conv6?XC(n,e.conv6):n,jE(n=e.conv7?XC(n,e.conv7):n,e.conv8,"valid",!1)},e.prototype.forwardInput=function(t,e){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return _d(function(){var i=t.toBatchTensor(e,!1).toFloat();return i=(i=n.config.meanRgb?J_(i,n.config.meanRgb):i).div(Vd(256)),n.config.withSeparableConvs?n.runMobilenet(i,r):n.runTinyYolov2(i,r)})},e.prototype.forward=function(t,e){return P_(this,0,void 0,function(){var n;return D_(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,TE(t)];case 1:return[4,n.apply(this,[r.sent(),e])];case 2:return[2,r.sent()]}})})},e.prototype.detect=function(t,e){return void 0===e&&(e={}),P_(this,0,void 0,function(){var n,r,i,o,a,s,u,c,l,h,d,p,f,m=this;return D_(this,function(v){switch(v.label){case 0:return n=new JC(e),r=n.inputSize,i=n.scoreThreshold,[4,TE(t)];case 1:return o=v.sent(),[4,this.forwardInput(o,r)];case 2:return a=v.sent(),s=_d(function(){return Hp(a)[0].expandDims()}),u={width:o.getInputWidth(0),height:o.getInputHeight(0)},[4,this.extractBoxes(s,o.getReshapedInputDimensions(0),i)];case 3:return c=v.sent(),a.dispose(),s.dispose(),l=c.map(function(t){return t.box}),h=c.map(function(t){return t.score}),d=c.map(function(t){return t.classScore}),p=c.map(function(t){return m.config.classes[t.label]}),f=Y_(l.map(function(t){return t.rescale(r)}),h,this.config.iouThreshold,!0),[2,f.map(function(t){return new Z_(h[t],d[t],p[t],l[t],u)})]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return function(t,e){var n,r=[],i=YC(t,r),o=i.extractConvParams,a=i.extractConvWithBatchNormParams,s=i.extractSeparableConvParams;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;n={conv0:e.isFirstLayerConv2d?o("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:o("conv8")}}else n={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:o("conv8")};return zE(t,r),{params:n,paramMappings:r}}(t,this.config)},e.prototype.extractParams=function(t){var n=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(t,e,n,r){var i,o=KE(t),a=o.extractWeights,s=o.getRemainingWeights,u=[],c=$C(a,u),l=c.extractConvParams,h=c.extractConvWithBatchNormParams,d=c.extractSeparableConvParams;if(e.withSeparableConvs){var p=r[0],f=r[1],m=r[2],v=r[3],g=r[4],y=r[5],x=r[6],b=r[7],w=r[8];i={conv0:e.isFirstLayerConv2d?l(p,f,3,"conv0"):d(p,f,"conv0"),conv1:d(f,m,"conv1"),conv2:d(m,v,"conv2"),conv3:d(v,g,"conv3"),conv4:d(g,y,"conv4"),conv5:d(y,x,"conv5"),conv6:b?d(x,b,"conv6"):void 0,conv7:w?d(b,w,"conv7"):void 0,conv8:l(w||b||x,5*n,1,"conv8")}}else p=r[0],f=r[1],m=r[2],v=r[3],g=r[4],y=r[5],x=r[6],b=r[7],w=r[8],i={conv0:h(p,f,"conv0"),conv1:h(f,m,"conv1"),conv2:h(m,v,"conv2"),conv3:h(v,g,"conv3"),conv4:h(g,y,"conv4"),conv5:h(y,x,"conv5"),conv6:h(x,b,"conv6"),conv7:h(b,w,"conv7"),conv8:l(w,5*n,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:i,paramMappings:u}}(t,this.config,this.boxEncodingSize,n)},e.prototype.extractBoxes=function(t,e,n){return P_(this,0,void 0,function(){var r,i,o,a,s,u,c,l,h,d,p,f,m,v,g,y,x,b,w,_,E,C,I,S,k,T,N,R,A,P=this;return D_(this,function(D){switch(D.label){case 0:return r=e.width,i=e.height,o=Math.max(r,i),a=o/r,s=o/i,u=t.shape[1],c=this.config.anchors.length,l=_d(function(){var e=t.reshape([u,u,c,P.boxEncodingSize]);return[e.slice([0,0,0,0],[u,u,c,4]),e.slice([0,0,0,4],[u,u,c,1]),P.withClassScores?uf(e.slice([0,0,0,5],[u,u,c,P.config.classes.length]),3):Vd(0)]}),h=l[0],d=l[1],p=l[2],f=[],[4,d.array()];case 1:return m=D.sent(),[4,h.array()];case 2:v=D.sent(),g=0,D.label=3;case 3:if(!(g<u))return[3,12];y=0,D.label=4;case 4:if(!(y<u))return[3,11];x=0,D.label=5;case 5:return x<c?(b=Q_(m[g][y][x][0]),!n||b>n?(w=(y+Q_(v[g][y][x][0]))/u*a,_=(g+Q_(v[g][y][x][1]))/u*s,E=Math.exp(v[g][y][x][2])*this.config.anchors[x].x/u*a,C=Math.exp(v[g][y][x][3])*this.config.anchors[x].y/u*s,I=w-E/2,S=_-C/2,k={row:g,col:y,anchor:x},this.withClassScores?[4,this.extractPredictedClass(p,k)]:[3,7]):[3,9]):[3,10];case 6:return A=D.sent(),[3,8];case 7:A={classScore:1,label:0},D.label=8;case 8:N=(T=A).classScore,R=T.label,f.push(A_({box:new K_(I,S,I+E,S+C),score:b,classScore:b*N,label:R},k)),D.label=9;case 9:return x++,[3,5];case 10:return y++,[3,4];case 11:return g++,[3,3];case 12:return h.dispose(),d.dispose(),p.dispose(),[2,f]}})})},e.prototype.extractPredictedClass=function(t,e){return P_(this,0,void 0,function(){var n,r,i,o;return D_(this,function(a){switch(a.label){case 0:return n=e.row,r=e.col,i=e.anchor,[4,t.array()];case 1:return o=a.sent(),[2,Array(this.config.classes.length).fill(0).map(function(t,e){return o[n][r][i][e]}).map(function(t,e){return{classScore:t,label:e}}).reduce(function(t,e){return t.classScore>e.classScore?t:e})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(OE),tI=function(t){function e(e){void 0===e&&(e=!0);var n=Object.assign({},{withSeparableConvs:e,iouThreshold:.4,classes:["face"]},e?{anchors:HC,meanRgb:GC}:{anchors:VC,withClassScores:!0});return t.call(this,n)||this}return R_(e,t),Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return P_(this,0,void 0,function(){return D_(this,function(n){switch(n.label){case 0:return[4,this.detect(t,e)];case 1:return[2,n.sent().map(function(t){return new X_(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(QC),eI=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return R_(e,t),e}(JC),nI=function(){function t(){}return t.prototype.then=function(t){return P_(this,0,void 0,function(){var e;return D_(this,function(n){switch(n.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[n.sent()])]}})})},t.prototype.run=function(){return P_(this,0,void 0,function(){return D_(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},t}();function rI(t,e,n,r,i){return void 0===i&&(i=function(t){return t.alignedRect}),P_(this,0,void 0,function(){var o,a,s,u,c;return D_(this,function(l){switch(l.label){case 0:return o=t.map(function(t){return oC(t)?i(t):t.detection}),(s=r)?[3,5]:e instanceof Ch?[4,RE(e,o)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,NE(e,o)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return[4,n(a=s)];case 6:return c=l.sent(),a.forEach(function(t){return t instanceof Ch&&t.dispose()}),[2,c]}})})}function iI(t,e,n,r,i){return P_(this,0,void 0,function(){var o=this;return D_(this,function(a){return[2,rI([t],e,function(t){return P_(o,0,void 0,function(){return D_(this,function(e){return[2,n(t[0])]})})},r,i)]})})}function oI(t){var e=KE(t),n=e.extractWeights,r=e.getRemainingWeights,i=[],o=function(t,e){var n=WE(t,e),r=UE(t,e);function i(n,r){var i=Hd(t(n));return e.push({paramPath:r}),i}function o(t,e,r){return void 0===r&&(r=!1),{conv1:n(t[0],t[1],3,e+"/conv1"),prelu1_alpha:i(t[1],e+"/prelu1_alpha"),conv2:n(t[1],t[2],3,e+"/conv2"),prelu2_alpha:i(t[2],e+"/prelu2_alpha"),conv3:n(t[2],t[3],r?2:3,e+"/conv3"),prelu3_alpha:i(t[3],e+"/prelu3_alpha")}}return{extractPNetParams:function(){var t=o([3,10,16,32],"pnet"),e=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return A_(A_({},t),{conv4_1:e,conv4_2:r})},extractRNetParams:function(){var t=o([3,28,48,64],"rnet",!0),e=r(576,128,"rnet/fc1"),n=i(128,"rnet/prelu4_alpha"),a=r(128,2,"rnet/fc2_1"),s=r(128,4,"rnet/fc2_2");return A_(A_({},t),{fc1:e,prelu4_alpha:n,fc2_1:a,fc2_2:s})},extractONetParams:function(){var t=o([3,32,64,64],"onet"),e=n(64,128,2,"onet/conv4"),a=i(128,"onet/prelu4_alpha"),s=r(1152,256,"onet/fc1"),u=i(256,"onet/prelu5_alpha"),c=r(256,2,"onet/fc2_1"),l=r(256,4,"onet/fc2_2"),h=r(256,10,"onet/fc2_3");return A_(A_({},t),{conv4:e,prelu4_alpha:a,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:h})}}}(n,i),a=o.extractPNetParams,s=o.extractRNetParams,u=o.extractONetParams,c=a(),l=s(),h=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:l,onet:h},paramMappings:i}}function aI(t){var e=[],n=function(t,e){var n=qE(t,e);function r(t){return{filters:n(t+"/weights",4,t+"/filters"),bias:n(t+"/bias",1)}}function i(t){return{weights:n(t+"/weights",2),bias:n(t+"/bias",1)}}function o(t){return n(t,1)}function a(t){return{conv1:r(t+"/conv1"),prelu1_alpha:o(t+"/prelu1_alpha"),conv2:r(t+"/conv2"),prelu2_alpha:o(t+"/prelu2_alpha"),conv3:r(t+"/conv3"),prelu3_alpha:o(t+"/prelu3_alpha")}}return{extractPNetParams:function(){var t=a("pnet"),e=r("pnet/conv4_1"),n=r("pnet/conv4_2");return A_(A_({},t),{conv4_1:e,conv4_2:n})},extractRNetParams:function(){var t=a("rnet"),e=i("rnet/fc1"),n=o("rnet/prelu4_alpha"),r=i("rnet/fc2_1"),s=i("rnet/fc2_2");return A_(A_({},t),{fc1:e,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var t=a("onet"),e=r("onet/conv4"),n=o("onet/prelu4_alpha"),s=i("onet/fc1"),u=o("onet/prelu5_alpha"),c=i("onet/fc2_1"),l=i("onet/fc2_2"),h=i("onet/fc2_3");return A_(A_({},t),{conv4:e,prelu4_alpha:n,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:h})}}}(t,e),r=n.extractPNetParams,i=n.extractRNetParams,o=n.extractONetParams,a=r(),s=i(),u=o();return zE(t,e),{params:{pnet:a,rnet:s,onet:u},paramMappings:e}}function sI(t,e){var n=e[0],r=e[1];return{height:Math.floor(n*t),width:Math.floor(r*t)}}var uI=function(t){function e(e,n,r,i){return t.call(this,{left:e,top:n,right:r,bottom:i},!0)||this}return R_(e,t),e}(q_);function cI(t){return _d(function(){return zy(Gy(t,Vd(127.5)),Vd(.0078125))})}function lI(t,e){return _d(function(){return Sy(ib(t),zy(e,Hg(ib(Hg(t)))))})}function hI(t,e,n){return void 0===n&&(n=!1),_d(function(){var r=jE(t,e.conv1,"valid");return r=lI(r,e.prelu1_alpha),r=lI(r=jE(r=Dx(r,n?[2,2]:[3,3],[2,2],"same"),e.conv2,"valid"),e.prelu2_alpha),r=lI(r=jE(r=n?r:Dx(r,[3,3],[2,2],"valid"),e.conv3,"valid"),e.prelu3_alpha)})}function dI(t,e,n,r,i){i.stage1=[];var o=e.map(function(e){return _d(function(){var n={scale:e},i=function(t,e){return _d(function(){var n=sI(e,t.shape.slice(1)),r=n.height,i=n.width,o=cI(Qb.resizeBilinear(t,[r,i]));return sb(o,[0,2,1,3])})}(t,e),o=Date.now(),a=function(t,e){return _d(function(){var n=hI(t,e,!0),r=jE(n,e.conv4_1,"valid"),i=Ip(Xx(r,3),3);return{prob:uf(Gy(r,i),3),regions:jE(n,e.conv4_2,"valid")}})}(i,r),s=a.prob,u=a.regions;return n.pnet=Date.now()-o,{scoresTensor:Hp(Hp(s,3)[1])[0],regionsTensor:Hp(u)[0],scale:e,statsForScale:n}})}),a=o.map(function(t){var e=t.scoresTensor,r=t.regionsTensor,o=t.scale,a=t.statsForScale,s=function(t,e,n,r){for(var i=[],o=t.arraySync(),a=0;a<t.shape[0];a++)for(var s=0;s<t.shape[1];s++)o[a][s]>=r&&i.push(new G_(s,a));return i.map(function(t){var r=new K_(Math.round((2*t.y+1)/n),Math.round((2*t.x+1)/n),Math.round((2*t.y+12)/n),Math.round((2*t.x+12)/n)),i=o[t.y][t.x],a=e.arraySync();return{cell:r,score:i,region:new uI(a[t.y][t.x][0],a[t.y][t.x][1],a[t.y][t.x][2],a[t.y][t.x][3])}})}(e,r,o,n);if(e.dispose(),r.dispose(),!s.length)return i.stage1.push(a),[];var u=Date.now(),c=Y_(s.map(function(t){return t.cell}),s.map(function(t){return t.score}),.5);return a.nms=Date.now()-u,a.numBoxes=c.length,i.stage1.push(a),c.map(function(t){return s[t]})}),s=a.reduce(function(t,e){return t.concat(e)},[]),u=[],c=[];if(s.length>0){var l=Date.now(),h=Y_(s.map(function(t){return t.cell}),s.map(function(t){return t.score}),.7);i.stage1_nms=Date.now()-l,c=h.map(function(t){return s[t].score}),u=h.map(function(t){return s[t]}).map(function(t){var e=t.cell,n=t.region;return new K_(e.left+n.left*e.width,e.top+n.top*e.height,e.right+n.right*e.width,e.bottom+n.bottom*e.height).toSquare().round()})}return{boxes:u,scores:c}}function pI(t,e,n){var r=n.width,i=n.height;return P_(this,0,void 0,function(){var n,o,a,s=this;return D_(this,function(u){switch(u.label){case 0:return n=bE(t),[4,Promise.all(e.map(function(e){return P_(s,0,void 0,function(){var r,i,o,a,s,u,c,l;return D_(this,function(h){return r=e.padAtBorders(t.height,t.width),i=r.y,o=r.ey,a=r.x,s=r.ex,u=a-1,c=i-1,l=n.getImageData(u,c,s-u,o-c),[2,yE.isNodejs()?CE(l):createImageBitmap(l)]})})}))];case 1:return o=u.sent(),a=[],o.forEach(function(t){var e=bE(EE({width:r,height:i}));e.drawImage(t,0,0,r,i);for(var n=e.getImageData(0,0,r,i).data,o=[],s=0;s<n.length;s+=4)o.push(n[s+2]),o.push(n[s+1]),o.push(n[s]);a.push(o)}),[2,a.map(function(t){return _d(function(){return cI(sb(Kd(t,[1,r,i,3]),[0,2,1,3]).toFloat())})})]}})})}function fI(t,e,n,r,i){return P_(this,0,void 0,function(){var o,a,s,u,c,l,h,d,p,f,m,v,g,y;return D_(this,function(x){switch(x.label){case 0:return o=Date.now(),[4,pI(t,e,{width:24,height:24})];case 1:return a=x.sent(),i.stage2_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map(function(t){var e=function(t,e){return _d(function(){var n=hI(t,e),r=lI(JE(Fp(n,[n.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu4_alpha),i=JE(r,e.fc2_1),o=Ip(Xx(i,1),1),a=uf(Gy(i,o),1),s=JE(r,e.fc2_2);return{scores:Hp(a,1)[1],regions:s}})}(t,r);return t.dispose(),e}),i.stage2_rnet=Date.now()-o,u=s.length>1?tp(s.map(function(t){return t.scores})):s[0].scores,h=(l=Array).from,[4,u.data()];case 2:return c=h.apply(l,[x.sent()]),u.dispose(),d=c.map(function(t,e){return{score:t,idx:e}}).filter(function(t){return t.score>n}).map(function(t){return t.idx}),p=d.map(function(t){return e[t]}),f=d.map(function(t){return c[t]}),m=[],v=[],p.length>0&&(o=Date.now(),g=Y_(p,f,.7),i.stage2_nms=Date.now()-o,y=g.map(function(t){var e=s[d[t]].regions.arraySync();return new uI(e[0][0],e[0][1],e[0][2],e[0][3])}),v=g.map(function(t){return f[t]}),m=g.map(function(t,e){return p[t].calibrate(y[e])})),s.forEach(function(t){t.regions.dispose(),t.scores.dispose()}),[2,{boxes:m,scores:v}]}})})}function mI(t,e,n,r,i){return P_(this,0,void 0,function(){var o,a,s,u,c,l,h,d,p,f,m,v,g,y,x;return D_(this,function(b){switch(b.label){case 0:return o=Date.now(),[4,pI(t,e,{width:48,height:48})];case 1:return a=b.sent(),i.stage3_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map(function(t){var e=function(t,e){return _d(function(){var n=hI(t,e);n=lI(n=jE(n=Dx(n,[2,2],[2,2],"same"),e.conv4,"valid"),e.prelu4_alpha);var r=lI(JE(Fp(n,[n.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu5_alpha),i=JE(r,e.fc2_1),o=Ip(Xx(i,1),1),a=uf(Gy(i,o),1),s=JE(r,e.fc2_2),u=JE(r,e.fc2_3);return{scores:Hp(a,1)[1],regions:s,points:u}})}(t,r);return t.dispose(),e}),i.stage3_onet=Date.now()-o,u=s.length>1?tp(s.map(function(t){return t.scores})):s[0].scores,h=(l=Array).from,[4,u.data()];case 2:return c=h.apply(l,[b.sent()]),u.dispose(),d=c.map(function(t,e){return{score:t,idx:e}}).filter(function(t){return t.score>n}).map(function(t){return t.idx}),p=d.map(function(t){var e=s[t].regions.arraySync();return new uI(e[0][0],e[0][1],e[0][2],e[0][3])}),f=d.map(function(t,n){return e[t].calibrate(p[n])}),m=d.map(function(t){return c[t]}),v=[],g=[],y=[],f.length>0&&(o=Date.now(),x=Y_(f,m,.7,!1),i.stage3_nms=Date.now()-o,v=x.map(function(t){return f[t]}),g=x.map(function(t){return m[t]}),y=x.map(function(t,e){return Array(5).fill(0).map(function(n,r){var i=s[t].points.arraySync();return new G_(i[0][r]*(v[e].width+1)+v[e].left,i[0][r+5]*(v[e].height+1)+v[e].top)})})),s.forEach(function(t){t.regions.dispose(),t.scores.dispose(),t.points.dispose()}),[2,{boxes:v,scores:g,points:y}]}})})}var vI=function(t){function e(){return t.call(this,"Mtcnn")||this}return R_(e,t),e.prototype.load=function(e){return P_(this,0,void 0,function(){return D_(this,function(n){return[2,t.prototype.load.call(this,e)]})})},e.prototype.loadFromDisk=function(e){return P_(this,0,void 0,function(){return D_(this,function(n){return[2,t.prototype.loadFromDisk.call(this,e)]})})},e.prototype.forwardInput=function(t,e){return void 0===e&&(e={}),P_(this,0,void 0,function(){var n,r,i,o,a,s,u,c,l,h,d,p,f,m,v,g,y,x,b,w,_;return D_(this,function(E){switch(E.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=t.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return i={},o=Date.now(),a=_d(function(){return t=Ip(g_.fromPixels(r)).toFloat(),_d(function(){return Wp(Hp(t,3).reverse(),3)});var t}),s=function(t){return a.dispose(),i.total=Date.now()-o,t},u=a.shape.slice(1),c=u[0],l=u[1],h=new AC(e),d=h.minFaceSize,p=h.scaleFactor,f=h.maxNumScales,m=h.scoreThresholds,v=h.scaleSteps,g=(v||function(t,e,n){for(var r=n[0],i=n[1],o=12/t,a=[],s=Math.min(r,i)*o,u=0;s>=12;)a.push(o*Math.pow(e,u)),s*=e,u+=1;return a}(d,p,[c,l])).filter(function(t){var e=sI(t,[c,l]);return Math.min(e.width,e.height)>12}).slice(0,f),i.scales=g,i.pyramid=g.map(function(t){return sI(t,[c,l])}),y=Date.now(),[4,dI(a,g,m[0],n.pnet,i)];case 1:return x=E.sent(),i.total_stage1=Date.now()-y,x.boxes.length?(i.stage2_numInputBoxes=x.boxes.length,y=Date.now(),[4,fI(r,x.boxes,m[1],n.rnet,i)]):[2,s({results:[],stats:i})];case 2:return b=E.sent(),i.total_stage2=Date.now()-y,b.boxes.length?(i.stage3_numInputBoxes=b.boxes.length,y=Date.now(),[4,mI(r,b.boxes,m[2],n.onet,i)]):[2,s({results:[],stats:i})];case 3:return w=E.sent(),i.total_stage3=Date.now()-y,_=w.boxes.map(function(t,e){return aC(uE({},new X_(w.scores[e],new eE(t.left/l,t.top/c,t.width/l,t.height/c),{height:c,width:l})),new rE(w.points[e].map(function(e){return e.sub(new G_(t.left,t.top)).div(new G_(t.width,t.height))}),{width:t.width,height:t.height}))}),[2,s({results:_,stats:i})]}})})},e.prototype.forward=function(t,e){return void 0===e&&(e={}),P_(this,0,void 0,function(){var n;return D_(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,TE(t)];case 1:return[4,n.apply(this,[r.sent(),e])];case 2:return[2,r.sent().results]}})})},e.prototype.forwardWithStats=function(t,e){return void 0===e&&(e={}),P_(this,0,void 0,function(){var n;return D_(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,TE(t)];case 1:return[2,n.apply(this,[r.sent(),e])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return aI(t)},e.prototype.extractParams=function(t){return oI(t)},e}(OE),gI=[new G_(1.603231,2.094468),new G_(6.041143,7.080126),new G_(2.882459,3.518061),new G_(4.266906,5.178857),new G_(9.041765,10.66308)],yI=[117.001,114.697,97.404],xI=function(t){function e(){var e={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:gI,meanRgb:yI,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t.call(this,e)||this}return R_(e,t),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return P_(this,0,void 0,function(){return D_(this,function(n){switch(n.label){case 0:return[4,this.detect(t,e)];case 1:return[2,n.sent().map(function(t){return new X_(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(QC),bI={ssdMobilenetv1:new zC,tinyFaceDetector:new xI,tinyYolov2:new tI,mtcnn:new vI,faceLandmark68Net:new vC,faceLandmark68TinyNet:new yC,faceRecognitionNet:new kC,faceExpressionNet:new rC,ageGenderNet:new fC},wI=function(t){function e(e,n,r){var i=t.call(this)||this;return i.parentTask=e,i.input=n,i.extractedFaces=r,i}return R_(e,t),e}(nI),_I=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R_(e,t),e.prototype.run=function(){return P_(this,0,void 0,function(){var t,e,n=this;return D_(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,rI(t=r.sent(),this.input,function(t){return P_(n,0,void 0,function(){return D_(this,function(e){switch(e.label){case 0:return[4,Promise.all(t.map(function(t){return bI.faceExpressionNet.predictExpressions(t)}))];case 1:return[2,e.sent()]}})})},this.extractedFaces)];case 2:return e=r.sent(),[2,t.map(function(t,n){return iC(t,e[n])})]}})})},e.prototype.withAgeAndGender=function(){return new kI(this,this.input)},e}(wI),EI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R_(e,t),e.prototype.run=function(){return P_(this,0,void 0,function(){var t,e;return D_(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(t=n.sent())?[4,iI(t,this.input,function(t){return bI.faceExpressionNet.predictExpressions(t)},this.extractedFaces)]:[2];case 2:return e=n.sent(),[2,iC(t,e)]}})})},e.prototype.withAgeAndGender=function(){return new TI(this,this.input)},e}(wI),CI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R_(e,t),e.prototype.withAgeAndGender=function(){return new NI(this,this.input)},e.prototype.withFaceDescriptors=function(){return new PI(this,this.input)},e}(_I),II=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R_(e,t),e.prototype.withAgeAndGender=function(){return new RI(this,this.input)},e.prototype.withFaceDescriptor=function(){return new DI(this,this.input)},e}(EI),SI=function(t){function e(e,n,r){var i=t.call(this)||this;return i.parentTask=e,i.input=n,i.extractedFaces=r,i}return R_(e,t),e}(nI),kI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R_(e,t),e.prototype.run=function(){return P_(this,0,void 0,function(){var t,e,n=this;return D_(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,rI(t=r.sent(),this.input,function(t){return P_(n,0,void 0,function(){return D_(this,function(e){switch(e.label){case 0:return[4,Promise.all(t.map(function(t){return bI.ageGenderNet.predictAgeAndGender(t)}))];case 1:return[2,e.sent()]}})})},this.extractedFaces)];case 2:return e=r.sent(),[2,t.map(function(t,n){var r=e[n],i=r.age;return NC(RC(t,r.gender,r.genderProbability),i)})]}})})},e.prototype.withFaceExpressions=function(){return new _I(this,this.input)},e}(SI),TI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R_(e,t),e.prototype.run=function(){return P_(this,0,void 0,function(){var t,e,n,r,i;return D_(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return(t=o.sent())?[4,iI(t,this.input,function(t){return bI.ageGenderNet.predictAgeAndGender(t)},this.extractedFaces)]:[2];case 2:return e=o.sent(),n=e.age,r=e.gender,i=e.genderProbability,[2,NC(RC(t,r,i),n)]}})})},e.prototype.withFaceExpressions=function(){return new EI(this,this.input)},e}(SI),NI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R_(e,t),e.prototype.withFaceExpressions=function(){return new CI(this,this.input)},e.prototype.withFaceDescriptors=function(){return new PI(this,this.input)},e}(kI),RI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R_(e,t),e.prototype.withFaceExpressions=function(){return new II(this,this.input)},e.prototype.withFaceDescriptor=function(){return new DI(this,this.input)},e}(TI),AI=function(t){function e(e,n){var r=t.call(this)||this;return r.parentTask=e,r.input=n,r}return R_(e,t),e}(nI),PI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R_(e,t),e.prototype.run=function(){return P_(this,0,void 0,function(){var t;return D_(this,function(e){switch(e.label){case 0:return[4,this.parentTask];case 1:return[4,rI(t=e.sent(),this.input,function(t){return Promise.all(t.map(function(t){return bI.faceRecognitionNet.computeFaceDescriptor(t)}))},null,function(t){return t.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,e.sent().map(function(e,n){return TC(t[n],e)})]}})})},e.prototype.withFaceExpressions=function(){return new CI(this,this.input)},e.prototype.withAgeAndGender=function(){return new NI(this,this.input)},e}(AI),DI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R_(e,t),e.prototype.run=function(){return P_(this,0,void 0,function(){var t,e;return D_(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(t=n.sent())?[4,iI(t,this.input,function(t){return bI.faceRecognitionNet.computeFaceDescriptor(t)},null,function(t){return t.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return e=n.sent(),[2,TC(t,e)]}})})},e.prototype.withFaceExpressions=function(){return new II(this,this.input)},e.prototype.withAgeAndGender=function(){return new RI(this,this.input)},e}(AI),MI=function(t){function e(e,n,r){var i=t.call(this)||this;return i.parentTask=e,i.input=n,i.useTinyLandmarkNet=r,i}return R_(e,t),Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?bI.faceLandmark68TinyNet:bI.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(nI),OI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R_(e,t),e.prototype.run=function(){return P_(this,0,void 0,function(){var t,e,n,r,i,o=this;return D_(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),e=t.map(function(t){return t.detection}),this.input instanceof Ch?[4,RE(this.input,e)]:[3,3];case 2:return r=a.sent(),[3,5];case 3:return[4,NE(this.input,e)];case 4:r=a.sent(),a.label=5;case 5:return n=r,[4,Promise.all(n.map(function(t){return o.landmarkNet.detectLandmarks(t)}))];case 6:return i=a.sent(),n.forEach(function(t){return t instanceof Ch&&t.dispose()}),[2,t.map(function(t,e){return aC(t,i[e])})]}})})},e.prototype.withFaceExpressions=function(){return new CI(this,this.input)},e.prototype.withAgeAndGender=function(){return new NI(this,this.input)},e.prototype.withFaceDescriptors=function(){return new PI(this,this.input)},e}(MI),LI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R_(e,t),e.prototype.run=function(){return P_(this,0,void 0,function(){var t,e,n,r,i;return D_(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return(t=o.sent())?(e=t.detection,this.input instanceof Ch?[4,RE(this.input,[e])]:[3,3]):[2];case 2:return r=o.sent(),[3,5];case 3:return[4,NE(this.input,[e])];case 4:r=o.sent(),o.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return i=o.sent(),n.forEach(function(t){return t instanceof Ch&&t.dispose()}),[2,aC(t,i)]}})})},e.prototype.withFaceExpressions=function(){return new II(this,this.input)},e.prototype.withAgeAndGender=function(){return new RI(this,this.input)},e.prototype.withFaceDescriptor=function(){return new DI(this,this.input)},e}(MI),BI=function(t){function e(e,n){void 0===n&&(n=new jC);var r=t.call(this)||this;return r.input=e,r.options=n,r}return R_(e,t),e}(nI),FI=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return R_(e,t),e.prototype.run=function(){return P_(this,0,void 0,function(){var t,e,n,r;return D_(this,function(i){switch(i.label){case 0:return e=(t=this).input,(n=t.options)instanceof AC?[4,bI.mtcnn.forward(e,n)]:[3,2];case 1:return[2,i.sent().map(function(t){return t.detection})];case 2:if(!(r=n instanceof eI?function(t){return bI.tinyFaceDetector.locateFaces(t,n)}:n instanceof jC?function(t){return bI.ssdMobilenetv1.locateFaces(t,n)}:n instanceof JC?function(t){return bI.tinyYolov2.locateFaces(t,n)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(e)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(e){return P_(t,0,void 0,function(){var t;return D_(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return t=n.sent(),[2,e(t.map(function(t){return uE({},t)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new OI(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new _I(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new kI(this.runAndExtendWithFaceDetections(),this.input)},e}(BI);!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}R_(e,t),e.prototype.run=function(){return P_(this,0,void 0,function(){var t,e;return D_(this,function(n){switch(n.label){case 0:return[4,new FI(this.input,this.options)];case 1:return t=n.sent(),e=t[0],t.forEach(function(t){t.score>e.score&&(e=t)}),[2,e]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(e){return P_(t,0,void 0,function(){var t;return D_(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return t=n.sent(),[2,e(t?uE({},t):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new LI(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new EI(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new TI(this.runAndExtendWithFaceDetection(),this.input)}}(BI),function(){function t(t,e){void 0===e&&(e=.6),this._distanceThreshold=e;var n=Array.isArray(t)?t:[t];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,i=function(){return"person "+r++};this._labeledDescriptors=n.map(function(t){if(t instanceof sE)return t;if(t instanceof Float32Array)return new sE(i(),[t]);if(t.descriptor&&t.descriptor instanceof Float32Array)return new sE(i(),[t.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(t.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),t.prototype.computeMeanDistance=function(t,e){return e.map(function(e){return function(t,e){if(t.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(t),r=Array.from(e);return Math.sqrt(n.map(function(t,e){return t-r[e]}).reduce(function(t,e){return t+Math.pow(e,2)},0))}(e,t)}).reduce(function(t,e){return t+e},0)/(e.length||1)},t.prototype.matchDescriptor=function(t){var e=this;return this.labeledDescriptors.map(function(n){var r=n.descriptors,i=n.label;return new oE(i,e.computeMeanDistance(t,r))}).reduce(function(t,e){return t.distance<e.distance?t:e})},t.prototype.findBestMatch=function(t){var e=this.matchDescriptor(t);return e.distance<this.distanceThreshold?e:new oE("unknown",e.distance)},t.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},t.fromJSON=function(e){return new t(e.labeledDescriptors.map(function(t){return sE.fromJSON(t)}),e.distanceThreshold)}}();const jI=(t=!0)=>{const e=Se.useRef(null),n=Se.useRef(null),[r,i]=Se.useState({hasFace:!1,detections:0}),[o,a]=Se.useState(!0),[s,u]=Se.useState(!1),[c,l]=Se.useState(!1),h=Se.useRef(null),d=Se.useRef(null);return Se.useEffect(()=>{if(!t)return void a(!1);(async()=>{try{await bI.tinyFaceDetector.loadFromUri("/models"),l(!0),a(!1)}catch(t){const e=t instanceof Error?t.message:String(t);i(t=>({...t,error:`Model loading failed: ${e}`})),a(!1)}})()},[t]),Se.useEffect(()=>{if(!t||!e.current)return;const n=e.current;return navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"}}).then(t=>{d.current=t,n.srcObject=t,n.onloadedmetadata=()=>{n.play().then(()=>{u(!0)}).catch(t=>{i(t=>({...t,error:"Video playback failed"}))})}}).catch(t=>{i(e=>({...e,error:"NotAllowedError"===t.name?"Camera access denied":"NotFoundError"===t.name?"No camera found":"Camera unavailable"}))}),()=>{d.current&&(d.current.getTracks().forEach(t=>t.stop()),d.current=null)}},[t]),Se.useEffect(()=>{if(!(t&&c&&s&&e.current))return;const n=e.current;return h.current=window.setInterval(async()=>{try{if(n.readyState===n.HAVE_ENOUGH_DATA){const r=await(t=n,e=new eI({inputSize:224,scoreThreshold:.5}),void 0===e&&(e=new jC),new FI(t,e));i({hasFace:r.length>0,detections:r.length})}}catch(r){r instanceof Error?r.message:String(r);i(t=>({...t,error:"Detection error"}))}var t,e},100),()=>{h.current&&(clearInterval(h.current),h.current=null)}},[t,c,s]),{videoRef:e,canvasRef:n,result:r,isLoading:o}};let zI=null,WI=!1;const UI=()=>{if(!zI){const t=window.AudioContext||window.webkitAudioContext;t&&(zI=new t)}return zI},VI=()=>{const[t,e]=Se.useState(!1),[n,r]=Se.useState(null),i=Se.useRef([]),o=Se.useRef(new Map),a=Se.useRef(!1),s=Se.useRef(null),u=Se.useRef(null),c=Se.useCallback(()=>{const t=UI();if(t&&"suspended"===t.state)t.resume().then(()=>{WI=!0}).catch(t=>{});else if(t&&!WI){const e=t.createBuffer(1,1,22050),n=t.createBufferSource();n.buffer=e,n.connect(t.destination),n.start(0),WI=!0}},[]),l=async(t,e)=>{if(o.current.has(t)){const e=o.current.get(t);return o.current.delete(t),e}let n=0;for(;n<3;)try{const n=await fetch("/api/tts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t}),signal:e});if(!n.ok)throw new Error(`TTS API error: ${n.status}`);const r=await n.json();if(!r.success||!r.audio)throw new Error(r.error||"No audio returned");const i=window.atob(r.audio),o=i.length,a=new Uint8Array(o);for(let t=0;t<o;t++)a[t]=i.charCodeAt(t);return a.buffer}catch(r){if(null==e?void 0:e.aborted)throw r;if(n++,n>=3)throw r;await new Promise(t=>setTimeout(t,500*n))}throw new Error("Failed to fetch TTS")},h=Se.useCallback(()=>{if(i.current.length>0){const t=i.current[0];o.current.has(t)||l(t).then(e=>{o.current.set(t,e)}).catch(t=>{})}},[]),d=Se.useCallback(async()=>{if(0===i.current.length||a.current)return void(0===i.current.length&&e(!1));a.current=!0,e(!0);const t=i.current.shift();r(t),h();try{u.current=new AbortController;const e=await l(t,u.current.signal);u.current.signal.aborted||await(async t=>{const e=UI();if(!e)throw new Error("AudioContext not supported");"suspended"===e.state&&await e.resume();const n=await e.decodeAudioData(t.slice(0));return new Promise((t,r)=>{const i=e.createBufferSource();i.buffer=n,i.connect(e.destination),i.onended=()=>{s.current=null,t()},s.current=i,i.start(0)})})(e)}catch(n){n.name}finally{a.current=!1,s.current=null,u.current=null,d()}},[h]);return{speak:Se.useCallback((t,e=!1)=>{if(c(),e){if(i.current=[],r(null),s.current){try{s.current.stop(),s.current.disconnect()}catch(n){}s.current=null}u.current&&u.current.abort(),a.current=!1}i.current.push(t),a.current||d()},[d,c]),cancel:Se.useCallback(()=>{if(i.current=[],a.current=!1,r(null),s.current){try{s.current.stop(),s.current.disconnect()}catch(t){}s.current=null}u.current&&u.current.abort(),e(!1)},[]),isSpeaking:t,currentSentence:n,hasSupport:"undefined"!=typeof window&&!(!window.AudioContext&&!window.webkitAudioContext)}},HI=({isOpen:t,onClose:e})=>{const n=Se.useRef(!1),r=Se.useRef(null),i=Se.useRef(!1),o=Se.useRef(null),a=Se.useRef(null),[s,u]=Se.useState("idle"),[c,l]=Se.useState(0),[h,d]=Se.useState(!1),[p,f]=Se.useState(!1),[m,v]=Se.useState(""),{speak:g,cancel:y,isSpeaking:x,currentSentence:b,hasSupport:w}=VI(),{videoRef:_,result:E}=jI(t),{isListening:C,transcript:I,startListening:S,stopListening:k,hasSupport:T}=(({onResult:t,onEnd:e,language:n="th-TH",continuous:r=!1}={})=>{const[i,o]=Se.useState(!1),[a,s]=Se.useState(""),[u,c]=Se.useState(null),l=Se.useRef(null),h=Se.useRef(t),d=Se.useRef(e);return Se.useEffect(()=>{h.current=t,d.current=e},[t,e]),Se.useEffect(()=>{const t=window.SpeechRecognition||window.webkitSpeechRecognition;if(t){const e=new t;e.continuous=r,e.interimResults=!0,e.lang=n,e.onstart=()=>{o(!0),c(null)},e.onresult=t=>{let e="",n="";for(let i=t.resultIndex;i<t.results.length;++i){const r=t.results[i][0].transcript;t.results[i].isFinal?e+=r+" ":n+=r}const r=(e+n).trim();s(r),e&&h.current&&h.current(e.trim())},e.onerror=t=>{"not-allowed"===t.error?c(" Microphone permission denied. Please enable microphone access."):"no-speech"===t.error?c(" No speech detected. Please speak clearly and try again."):"network"===t.error?c(" Network error. Please check your connection."):"aborted"!==t.error&&c(` Error: ${t.error}`)},e.onend=()=>{o(!1),d.current&&d.current()},l.current=e}return()=>{if(l.current)try{l.current.stop()}catch(t){try{l.current.abort()}catch(e){}}}},[n,r]),{isListening:i,transcript:a,error:u,startListening:Se.useCallback(()=>{var t;if(l.current){c(null),s("");try{if(l.current)try{l.current.stop()}catch(e){}l.current.start()}catch(e){(null==(t=null==e?void 0:e.message)?void 0:t.includes("already started"))?o(!0):c("Failed to start voice input. Please try again.")}}else c("Speech recognition not supported on this browser. Try Chrome or Edge.")},[]),stopListening:Se.useCallback(()=>{if(l.current)try{l.current.stop()}catch(t){try{l.current.abort()}catch(e){}}},[]),hasSupport:!(!window.SpeechRecognition&&!window.webkitSpeechRecognition)}})({language:"th-TH",continuous:!0,onResult:t=>{o.current&&o.current(t)}}),{startVAD:N,stopVAD:R,isSpeaking:A}=((t={})=>{const{onSpeechEnd:e,onSpeechStart:n,silenceThreshold:r=1,checkInterval:i=100,sampleRate:o=16e3,aggressiveness:a=2,enabled:s=!0}=t,u=Se.useRef(null),c=Se.useRef(null),l=Se.useRef(null),h=Se.useRef(null),d=Se.useRef(!1),p=Se.useRef(!1),f=Se.useRef(null),m=Se.useRef(null),v=Se.useRef(!1),g=Se.useRef(null),y=Se.useCallback(t=>{let e=0;for(let n=0;n<t.length;n++)e+=t[n]*t[n];return Math.sqrt(e/t.length)>.01},[]),x=Se.useCallback(async()=>{try{const t=await fetch("/api/vad/status"),e=await t.json();return e.success&&e.available}catch(t){return!1}},[]),b=Se.useCallback(()=>{h.current&&(clearInterval(h.current),h.current=null),l.current&&(l.current.disconnect(),l.current=null),c.current&&(c.current.close(),c.current=null),u.current&&(u.current.getTracks().forEach(t=>t.stop()),u.current=null),d.current=!1,p.current=!1,f.current=null,m.current=null,v.current=!1},[]),w=Se.useCallback(async()=>{if(s)try{await x();const t=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:o}});u.current=t;const i=new(window.AudioContext||window.webkitAudioContext)({sampleRate:o});c.current=i;const a=i.createMediaStreamSource(t),h=4096,b=i.createScriptProcessor(h,1,1);l.current=b,b.onaudioprocess=t=>{if(!s||!d.current)return;const i=t.inputBuffer.getChannelData(0),o=y(i),a=Date.now();o?(p.current||(p.current=!0,m.current=a,v.current=!0,n&&n()),f.current=null):p.current&&(f.current||(f.current=a),(a-f.current)/1e3>=r&&(p.current=!1,e&&e(v.current),v.current=!1,f.current=null,m.current=null))},a.connect(b),b.connect(i.destination),d.current=!0,g.current=null}catch(t){throw g.current=t.message,b(),t}},[s,o,r,e,n,y,x,b]);return Se.useEffect(()=>()=>{b()},[b]),{startVAD:w,stopVAD:b,isDetecting:d.current,isSpeaking:p.current,error:g.current}})({onSpeechEnd:t=>{t&&C&&k()},onSpeechStart:()=>{},silenceThreshold:1.5,enabled:!0});Se.useEffect(()=>{if(!t)return d(!1),f(!1),u("idle"),y(),k(),R(),void(r.current&&clearTimeout(r.current));const e=setTimeout(async()=>{if(!C&&!x&&!i.current)try{await N(),S()}catch(t){}},100);return()=>clearTimeout(e)},[t,C,x,S,N,R,y,k]),Se.useEffect(()=>{if(t)if(E.hasFace&&!h){if(d(!0),!n.current){f(!0),n.current=!0;g(" "),r.current=window.setTimeout(()=>{f(!1)},5e3)}}else!E.hasFace&&h&&d(!1)},[t,E.hasFace,h,g]);const P=async e=>{if(e.trim()&&!i.current){u("processing"),i.current=!0,k();try{await M(e)}catch(n){g("  "),u("idle")}finally{i.current=!1,t&&!x&&setTimeout(()=>{try{S()}catch(t){}},500)}}};Se.useEffect(()=>{o.current=P},[P]);const D=()=>{a.current&&(a.current.abort(),a.current=null),y(),k(),R(),v(""),u("idle"),i.current=!1,e()},M=async e=>{v("");const n=new AbortController;a.current=n;const r=setTimeout(()=>n.abort(),6e4);try{const t=await fetch("/api/messages/stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,user_id:"voice-user",request_id:crypto.randomUUID()}),signal:n.signal});if(clearTimeout(r),!t.ok)throw new Error(`HTTP ${t.status}`);if(!t.body)throw new Error("No response body");const o=t.body.getReader(),a=new TextDecoder;let s="",c="";try{for(;;){const{done:t,value:e}=await o.read();if(t)break;s+=a.decode(e,{stream:!0});const n=s.split("\n\n");s=n.pop()||"";for(const r of n)if(r.startsWith("data: ")){const t=r.slice(6);try{const e=JSON.parse(t);if("text"===e.type||"chunk"===e.type){const t=e.text||e.chunk||"";v(e=>e+t),c+=t;let n=-1;if(!x&&c.length>20){const t=c.match(/[, ]/);t&&void 0!==t.index&&t.index>10&&(n=t.index+1)}if(-1===n&&c.length>50){const t=c.match(/[.!?\n]+(?=\s|$)/);t&&void 0!==t.index&&(n=t.index+t[0].length)}if(-1===n&&c.length>120){const t=c.lastIndexOf(" ");t>50&&(n=t+1)}if(-1!==n){const t=c.slice(0,n),e=c.slice(n);t.trim()&&(x||u("speaking"),g(t)),c=e}else c.length>250&&(x||u("speaking"),g(c),c="")}else if("error"===e.type)throw new Error(e.message||"Stream error")}catch(i){}}}c.trim()&&g(c)}finally{try{o.cancel()}catch(i){}}}catch(o){"AbortError"!==o.name&&g(" ")}finally{a.current=null,!x&&t?setTimeout(async()=>{try{await N(),S(),u("idle")}catch(i){u("idle")}},500):u("idle")}};if(Se.useEffect(()=>{C?u("listening"):x?u("speaking"):i.current||u("idle")},[C,x]),Se.useEffect(()=>{if(!t||"idle"===s)return void l(5);const e=setInterval(()=>{const t="processing"===s?10:40;l(("listening"===s?50:"speaking"===s?70:20)+Math.random()*t)},100);return()=>clearInterval(e)},[t,s]),!t)return null;const O=200+.5*c,L=20+.3*c;return $.jsxs("div",{className:"fixed inset-0 z-50 bg-gradient-to-br from-slate-950 via-blue-950 to-slate-950 flex flex-col overflow-hidden",children:[$.jsx("video",{ref:_,className:"hidden",autoPlay:!0,playsInline:!0,muted:!0}),$.jsx("div",{className:"absolute top-6 right-6 z-10",children:$.jsx(Pi,{variant:"ghost",size:"icon",onClick:D,className:"text-white/70 hover:text-white hover:bg-white/10 rounded-full w-12 h-12",children:$.jsx(lt,{className:"w-6 h-6"})})}),$.jsxs("div",{className:"pt-16 text-center animate-in slide-in-from-top duration-500",children:[$.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[$.jsx(Mt,{className:"w-5 h-5 text-cyan-400"}),$.jsx("span",{className:"text-cyan-400 text-sm font-medium tracking-widest uppercase",children:"NongPlatoo Voice AI"}),$.jsx(Mt,{className:"w-5 h-5 text-cyan-400"})]}),$.jsx("p",{className:"text-white/60 text-sm",children:""}),!T&&$.jsx("p",{className:"text-red-400 text-xs mt-2",children:"Browser doesn't support Speech Recognition"})]}),$.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center relative",children:[(I||m||b)&&$.jsx("div",{className:"absolute top-1/4 w-full max-w-2xl px-8 text-center z-20 pointer-events-none",children:$.jsx("p",{className:"text-2xl font-light transition-all duration-300 "+("listening"===s?"text-white opacity-100 scale-105":"text-white/50 scale-100"),children:"listening"===s?I:"speaking"===s?b||"...":""})}),$.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[...Array(20)].map((t,e)=>$.jsx("div",{className:"absolute w-1 h-1 bg-cyan-400/30 rounded-full animate-pulse",style:{left:100*Math.random()+"%",top:100*Math.random()+"%",animationDelay:2*Math.random()+"s",animationDuration:2+2*Math.random()+"s"}},e))}),$.jsxs("div",{className:"relative",children:[$.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full opacity-20",style:{width:O+100,height:O+100,background:`radial-gradient(circle, ${"listening"===s?"rgba(255, 100, 100, 0.3)":"rgba(34, 211, 238, 0.3)"} 0%, transparent 70%)`}}),$.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full border border-cyan-400/30 w-[300px] h-[300px] animate-[spin_8s_linear_infinite]"}),$.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full border border-blue-400/20 w-[260px] h-[260px] animate-[spin_6s_linear_infinite_reverse]"}),$.jsxs("div",{className:"relative rounded-full flex items-center justify-center transition-all duration-300 transform",style:{width:O,height:O,background:"listening"===s?"radial-gradient(circle, rgba(220, 38, 38, 0.8) 0%, rgba(69, 10, 10, 0.95) 100%)":"radial-gradient(circle, rgba(30, 58, 138, 0.9) 0%, rgba(15, 23, 42, 0.95) 100%)",boxShadow:`0 0 ${L}px ${"listening"===s?"rgba(220, 38, 38, 0.5)":"rgba(34, 211, 238, 0.5)"}`},children:[$.jsx("div",{className:"absolute rounded-full w-[70%] h-[70%] bg-white/10 animate-pulse"}),"listening"===s?$.jsx(Ot,{className:"w-16 h-16 text-white animate-pulse"}):"speaking"===s?$.jsx(Lt,{className:"w-16 h-16 text-cyan-400 animate-bounce"}):$.jsx(Bt,{className:"w-16 h-16 text-white/50"})]})]})]}),$.jsxs("div",{className:"pb-16 text-center animate-in slide-in-from-bottom duration-500",children:[$.jsxs("div",{className:"mb-8 h-8",children:["listening"===s&&A&&$.jsx("span",{className:"text-cyan-400 animate-pulse",children:" Speaking detected..."}),"listening"===s&&!A&&$.jsx("span",{className:"text-cyan-400/60",children:"Listening... (speak now)"}),"processing"===s&&$.jsx("span",{className:"text-yellow-400 animate-pulse",children:"Thinking..."}),"speaking"===s&&$.jsx("span",{className:"text-green-400 animate-pulse",children:"Speaking..."})]}),$.jsx("div",{className:"flex justify-center gap-4",children:$.jsxs("div",{className:"flex gap-4",children:[!C&&"processing"!==s&&"speaking"!==s&&$.jsxs(Pi,{variant:"outline",size:"lg",onClick:async()=>{await N(),S()},className:"rounded-full px-8 py-6 text-lg border-cyan-500 text-cyan-500 bg-cyan-500/10 hover:bg-cyan-500/20 hover:scale-105 transition-all duration-300",children:[$.jsx(Ot,{className:"w-5 h-5 mr-2"}),""]}),$.jsxs(Pi,{variant:"default",size:"lg",onClick:D,className:"rounded-full px-8 py-6 text-lg bg-red-600 hover:bg-red-700 text-white border-0 shadow-lg transition-all duration-300",children:[$.jsx(lt,{className:"w-5 h-5 mr-2"}),""]})]})}),$.jsxs("p",{className:"text-white/30 text-xs mt-4",children:["Powered by OpenAI & NongPlatoo AI",A&&$.jsx("span",{className:"ml-2 text-green-400",children:" VAD Active"})]})]})]})},GI=()=>{var t;const[e,n]=Se.useState(!1),[r,i]=Se.useState(!1),[o,a]=Se.useState(!1),s=Ne(),u=Re(),{toast:c}=$e(),{user:l,initializing:h,signOutUser:d}=_l();Se.useEffect(()=>{const t=()=>{n(window.scrollY>20)};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[]);const p=[{to:"/",label:"",labelEn:"Home",icon:Ut},{to:"/places",label:"",labelEn:"Places",icon:Vt},{to:"/chat",label:" NongPlatoo",labelEn:"Chat",icon:Ht}],f="/"===s.pathname,m=`?redirect=${encodeURIComponent(s.pathname)}`,v=async()=>{try{await d(),c({title:"",description:""}),"/auth"===s.pathname&&u("/")}catch{c({variant:"destructive",title:"",description:""})}};return $.jsxs("nav",{className:Vn("fixed top-0 left-0 right-0 z-50 transition-all duration-300",e||!f?"bg-card/95 backdrop-blur-md shadow-soft":"bg-transparent"),children:[$.jsx("div",{className:"container mx-auto px-4",children:$.jsxs("div",{className:"flex items-center justify-between h-16",children:[$.jsxs(Ae,{to:"/",className:"flex items-center gap-2",children:[$.jsx("img",{src:"/assets/%E0%B8%99%E0%B9%89%E0%B8%AD%E0%B8%87%E0%B8%9B%E0%B8%A5%E0%B8%B2%E0%B8%97%E0%B8%B9-elIqDDwR.png",alt:"NongPlatoo Logo",className:"w-10 h-10 rounded-xl object-cover"}),$.jsx("span",{className:Vn("font-display font-semibold text-lg hidden sm:block transition-colors",e||!f?"text-foreground":"text-primary-foreground"),children:"NongPlatoo.Ai"})]}),$.jsxs("div",{className:"hidden md:flex items-center gap-1",children:[p.map(t=>$.jsx(Ae,{to:t.to,children:$.jsxs(Pi,{variant:"ghost",className:Vn("gap-2 transition-colors",s.pathname===t.to?e||!f?"bg-primary/10 text-primary":"bg-primary-foreground/20 text-primary-foreground":e||!f?"text-foreground hover:text-primary hover:bg-primary/5":"text-primary-foreground/80 hover:text-primary-foreground hover:bg-primary-foreground/10"),children:[$.jsx(t.icon,{className:"w-4 h-4"}),$.jsx("span",{className:"font-thai",children:t.label})]})},t.to)),!h&&(l?$.jsxs(Di,{children:[$.jsx(Mi,{asChild:!0,children:$.jsxs(Pi,{variant:"outline",className:"ml-2 pl-2 pr-3 gap-3 border-primary/30 text-foreground hover:text-primary hover:border-primary/60",children:[$.jsx(ho,{className:"h-8 w-8 bg-primary/15 text-primary",children:$.jsx(po,{children:(l.displayName||l.email||"NP").slice(0,2).toUpperCase()})}),$.jsxs("div",{className:"text-left leading-tight hidden lg:block",children:[$.jsx("p",{className:"text-xs text-muted-foreground",children:""}),$.jsx("p",{className:"font-medium",children:l.displayName||(null==(t=l.email)?void 0:t.split("@")[0])||""})]})]})}),$.jsxs(Oi,{align:"end",className:"w-48",children:[$.jsx(Bi,{children:""}),$.jsxs(Li,{onClick:()=>u(`/auth${m}`),className:"cursor-pointer",children:[$.jsx(Ft,{className:"w-4 h-4 mr-2"}),""]}),$.jsx(Fi,{}),$.jsxs(Li,{onClick:v,className:"cursor-pointer text-destructive",children:[$.jsx(jt,{className:"w-4 h-4 mr-2"}),""]})]})]}):$.jsx(Ae,{to:`/auth${m}`,children:$.jsxs(Pi,{className:"ml-2 gap-2 bg-gradient-river text-primary-foreground shadow-soft hover:opacity-90",children:[$.jsx(zt,{className:"w-4 h-4"}),$.jsx("span",{className:"font-thai",children:""})]})}))]}),$.jsx(Pi,{variant:"ghost",size:"icon",className:Vn("md:hidden",e||!f?"text-foreground":"text-primary-foreground"),onClick:()=>i(!r),children:r?$.jsx(lt,{}):$.jsx(Wt,{})})]})}),r&&$.jsx("div",{className:"md:hidden bg-card/95 backdrop-blur-md border-t border-border animate-fade-in",children:$.jsxs("div",{className:"container mx-auto px-4 py-4 space-y-2",children:[p.map(t=>$.jsx(Ae,{to:t.to,onClick:()=>i(!1),children:$.jsxs(Pi,{variant:"ghost",className:Vn("w-full justify-start gap-3",s.pathname===t.to?"bg-primary/10 text-primary":"text-foreground"),children:[$.jsx(t.icon,{className:"w-5 h-5"}),$.jsx("span",{className:"font-thai",children:t.label}),$.jsxs("span",{className:"text-muted-foreground text-sm",children:["(",t.labelEn,")"]})]})},t.to)),!h&&$.jsx("div",{className:"pt-2 flex gap-2",children:l?$.jsxs(Pi,{variant:"outline",className:"w-full justify-center gap-2",onClick:()=>{v(),i(!1)},children:[$.jsx(jt,{className:"w-4 h-4"}),""]}):$.jsx(Ae,{to:`/auth${m}`,className:"w-full",onClick:()=>i(!1),children:$.jsxs(Pi,{className:"w-full justify-center gap-2 bg-gradient-river text-primary-foreground",children:[$.jsx(zt,{className:"w-4 h-4"}),""]})})})]})}),$.jsx(HI,{isOpen:o,onClose:()=>a(!1)})]})},qI=({title:t,titleTh:e,description:n,image:r,category:i,className:o})=>$.jsx(Ae,{to:`/places?category=${i}`,className:Vn("group block card-hover",o),children:$.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-card shadow-card",children:[$.jsx("div",{className:"aspect-square overflow-hidden",children:$.jsx("img",{src:r,alt:t,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"})}),$.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-foreground/80 via-foreground/20 to-transparent"}),$.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-5",children:[$.jsx("h3",{className:"font-display text-xl font-semibold text-primary-foreground mb-1",children:e}),$.jsx("p",{className:"text-primary-foreground/80 text-sm mb-2",children:t}),$.jsx("p",{className:"text-primary-foreground/60 text-xs line-clamp-2",children:n})]}),$.jsx("div",{className:"absolute inset-0 bg-primary/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})}),KI=()=>{const t=[{id:"tourism",name:"MOTS",label:"",image:"/assets/%E0%B8%81%E0%B8%A3%E0%B8%B0%E0%B8%97%E0%B8%A3%E0%B8%A7%E0%B8%87%E0%B8%81%E0%B8%B2%E0%B8%A3%E0%B8%97%E0%B9%88%E0%B8%AD%E0%B8%87%E0%B9%80%E0%B8%97%E0%B8%B5%E0%B9%88%E0%B8%A2%E0%B8%A7%E0%B9%81%E0%B8%A5%E0%B8%B0%E0%B8%81%E0%B8%B5%E0%B8%AC%E0%B8%B2-H0zXdO5R.png"},{id:"pr",name:"PR Samut",label:"\n",image:"/assets/%E0%B8%9B%E0%B8%A3%E0%B8%B0%E0%B8%8A%E0%B8%B2%E0%B8%AA%E0%B8%B1%E0%B8%A1%E0%B8%9E%E0%B8%B1%E0%B8%99%E0%B8%98%E0%B9%8C%E0%B8%88%E0%B8%B1%E0%B8%87%E0%B8%AB%E0%B8%A7%E0%B8%B1%E0%B8%94%E0%B8%AA%E0%B8%A1%E0%B8%B8%E0%B8%97%E0%B8%A3%E0%B8%AA%E0%B8%87%E0%B8%84%E0%B8%A3%E0%B8%B2%E0%B8%A1-CMknLaoe.png"},{id:"pao",name:"PAO",label:"\n",image:"/assets/%E0%B8%AD%E0%B8%87%E0%B8%84%E0%B9%8C%E0%B8%81%E0%B8%B2%E0%B8%A3%E0%B8%9A%E0%B8%A3%E0%B8%B4%E0%B8%AB%E0%B8%B2%E0%B8%99%E0%B8%AA%E0%B9%88%E0%B8%A7%E0%B8%99%E0%B8%88%E0%B8%B1%E0%B8%87%E0%B8%AB%E0%B8%A7%E0%B8%B1%E0%B8%94-DZbxWvxP.png"},{id:"local",name:"DLA",label:"\n",image:"/assets/%E0%B8%81%E0%B8%A3%E0%B8%A3%E0%B8%A1%E0%B8%AA%E0%B9%88%E0%B8%87%E0%B9%80%E0%B8%AA%E0%B8%A3%E0%B8%B4%E0%B8%A1%E0%B8%81%E0%B8%B2%E0%B8%A3%E0%B8%9B%E0%B8%81%E0%B8%84%E0%B8%A3%E0%B8%AD%E0%B8%87%E0%B8%97%E0%B9%89%E0%B8%AD%E0%B8%87%E0%B8%96%E0%B8%B7%E0%B9%88%E0%B8%99-wrB8VJhP.png"},{id:"nso",name:"NSO",label:"\n",image:"/assets/%E0%B8%AA%E0%B8%B3%E0%B8%99%E0%B8%B1%E0%B8%81%E0%B8%87%E0%B8%B2%E0%B8%99%E0%B8%AA%E0%B8%96%E0%B8%B4%E0%B8%95%E0%B8%B4%E0%B9%81%E0%B8%AB%E0%B9%88%E0%B8%87%E0%B8%8A%E0%B8%B2%E0%B8%95%E0%B8%B4%20%E0%B8%88%E0%B8%B1%E0%B8%87%E0%B8%AB%E0%B8%A7%E0%B8%B1%E0%B8%94%E0%B8%AA%E0%B8%A1%E0%B8%B8%E0%B8%97%E0%B8%A3%E0%B8%AA%E0%B8%87%E0%B8%84%E0%B8%A3%E0%B8%B2%E0%B8%A1-BbpBZhgn.jpg"}];return $.jsx("section",{className:"py-16 bg-muted/30 border-b border-border/50",children:$.jsxs("div",{className:"container mx-auto px-4",children:[$.jsxs("div",{className:"text-center mb-10",children:[$.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Logos"}),$.jsx("h3",{className:"text-2xl font-bold text-foreground",children:""})]}),$.jsx("div",{className:"flex flex-wrap justify-center gap-6 md:gap-8",children:t.map(t=>$.jsxs("div",{className:"w-48 h-48 bg-card rounded-2xl flex flex-col items-center justify-center p-6 shadow-sm hover:shadow-lg transition-all duration-300 group border border-border/50",children:[$.jsx("div",{className:"w-24 h-24 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-300",children:$.jsx("img",{src:t.image,alt:t.label,className:"w-full h-full object-contain"})}),$.jsx("p",{className:"text-sm text-center text-muted-foreground font-medium leading-tight min-h-[2.5rem] flex items-center justify-center whitespace-pre-line",children:t.label})]},t.id))})]})})},ZI=()=>$.jsxs("div",{className:"min-h-screen bg-background",children:[$.jsx(GI,{}),$.jsxs("section",{className:"relative min-h-screen flex items-center justify-center overflow-hidden",children:[$.jsxs("div",{className:"absolute inset-0",children:[$.jsx("img",{src:"/assets/%E0%B8%9B%E0%B8%81%E0%B9%80%E0%B8%A7%E0%B9%87%E0%B8%9A-C5HZZB4x.jpg",alt:"Amphawa Floating Market",className:"w-full h-full object-cover"}),$.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-primary/40 via-primary/50 to-primary/70"})]}),$.jsxs("div",{className:"relative z-10 container mx-auto px-4 text-center",children:[$.jsxs("div",{className:"max-w-3xl mx-auto animate-fade-in",children:[$.jsxs("h1",{className:"font-display text-4xl md:text-6xl lg:text-6xl font-bold text-primary-foreground mb-4 leading-tight",children:[$.jsx("span",{className:"block mb-3",children:""}),$.jsx("span",{className:"block text-golden",children:""}),$.jsx("span",{className:"block text-golden",children:""})]}),$.jsx("p",{className:"text-xl md:text-2xl text-primary-foreground/90 mb-4 font-display"}),$.jsx("p",{className:"text-lg text-primary-foreground/80 mb-8 max-w-xl mx-auto",children:'Nong Pla Too" Intelligent Travel Publicity with AI'}),$.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[$.jsx(Ae,{to:"/places",children:$.jsxs(Pi,{variant:"hero",size:"xl",className:"w-full sm:w-auto",children:[$.jsx(Vt,{className:"w-5 h-5"}),"",$.jsx(Gt,{className:"w-5 h-5"})]})}),$.jsx(Ae,{to:"/chat",children:$.jsxs(Pi,{variant:"heroOutline",size:"xl",className:"w-full sm:w-auto",children:[$.jsx(Ht,{className:"w-5 h-5"}),"Chat with NongPlatoo"]})})]})]}),$.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 animate-float",children:$.jsx("div",{className:"w-6 h-10 rounded-full border-2 border-primary-foreground/50 flex justify-center pt-2",children:$.jsx("div",{className:"w-1.5 h-3 bg-primary-foreground/70 rounded-full animate-pulse"})})})]})]}),$.jsx(KI,{}),$.jsx("section",{className:"py-20 bg-gradient-sky",children:$.jsxs("div",{className:"container mx-auto px-4",children:[$.jsxs("div",{className:"text-center mb-12 animate-slide-up",children:[$.jsx("h2",{className:"font-display text-3xl md:text-4xl font-bold text-foreground mb-3",children:""}),$.jsx("p",{className:"text-lg text-muted-foreground",children:"Featured Categories  Discover what awaits you"})]}),$.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto",children:[{title:"Floating Markets",titleTh:"",description:" ",image:"https://paimayang.com/wp-content/uploads/2020/02/82_20190826014648_1-840x560.jpg",category:"market"},{title:"Temples & Culture",titleTh:"",description:" ",image:"https://t1.blockdit.com/photos/2023/03/64053c674d188033c3a4bb5a_800x0xcover_Xv4jzo41.jpg",category:"temple"},{title:"Homestays & Gardens",titleTh:"",description:" ",image:"https://www.saitiew.com/upload/2024/11/3zkr3nr94bba.jpg",category:"homestay"}].map((t,e)=>$.jsx(qI,{...t,className:"animate-slide-up animation-delay-"+100*(e+1)},t.category))})]})}),$.jsx("section",{className:"py-20 bg-card",children:$.jsx("div",{className:"container mx-auto px-4",children:$.jsx("div",{className:"max-w-4xl mx-auto bg-gradient-river rounded-3xl p-8 md:p-12 shadow-elevated",children:$.jsxs("div",{className:"text-center",children:[$.jsx("div",{className:"w-16 h-16 bg-primary-foreground/20 rounded-2xl flex items-center justify-center mx-auto mb-6",children:$.jsx(Ht,{className:"w-8 h-8 text-primary-foreground"})}),$.jsx("h2",{className:"font-display text-2xl md:text-3xl font-bold text-primary-foreground mb-4",children:" NongPlatoo.Ai"}),$.jsx("p",{className:"text-primary-foreground/80 text-lg mb-8 max-w-xl mx-auto",children:" - "}),$.jsx(Ae,{to:"/chat",children:$.jsxs(Pi,{variant:"heroOutline",size:"lg",className:"bg-primary-foreground text-primary hover:bg-primary-foreground/90",children:["Start Chatting",$.jsx(Gt,{className:"w-5 h-5"})]})})]})})})}),$.jsx("footer",{className:"py-8 bg-muted border-t border-border",children:$.jsx("div",{className:"container mx-auto px-4 text-center",children:$.jsx("p",{className:"text-muted-foreground text-sm",children:" 2025   ."})})})]}),XI=Un("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function $I({className:t,variant:e,...n}){return $.jsx("div",{className:Vn(XI({variant:e}),t),...n})}const YI=Se.forwardRef(({className:t,...e},n)=>$.jsx("div",{ref:n,className:Vn("rounded-lg border bg-card text-card-foreground shadow-sm",t),...e}));YI.displayName="Card";const JI=Se.forwardRef(({className:t,...e},n)=>$.jsx("div",{ref:n,className:Vn("flex flex-col space-y-1.5 p-6",t),...e}));JI.displayName="CardHeader";const QI=Se.forwardRef(({className:t,...e},n)=>$.jsx("h3",{ref:n,className:Vn("text-2xl font-semibold leading-none tracking-tight",t),...e}));QI.displayName="CardTitle";Se.forwardRef(({className:t,...e},n)=>$.jsx("p",{ref:n,className:Vn("text-sm text-muted-foreground",t),...e})).displayName="CardDescription";const tS=Se.forwardRef(({className:t,...e},n)=>$.jsx("div",{ref:n,className:Vn("p-6 pt-0",t),...e}));tS.displayName="CardContent";Se.forwardRef(({className:t,...e},n)=>$.jsx("div",{ref:n,className:Vn("flex items-center p-6 pt-0",t),...e})).displayName="CardFooter";const eS=Se.forwardRef(({className:t,type:e,...n},r)=>$.jsx("input",{type:e,className:Vn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...n}));eS.displayName="Input";var nS=Se.forwardRef((t,e)=>$.jsx(Y.label,{...t,ref:e,onMouseDown:e=>{var n;e.target.closest("button, input, select, textarea")||(null==(n=t.onMouseDown)||n.call(t,e),!e.defaultPrevented&&e.detail>1&&e.preventDefault())}}));nS.displayName="Label";var rS=nS;const iS=Un("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),oS=Se.forwardRef(({className:t,...e},n)=>$.jsx(rS,{ref:n,className:Vn(iS(),t),...e}));oS.displayName=rS.displayName;var aS="Tabs",[sS,uS]=Q(aS,[qt]),cS=qt(),[lS,hS]=sS(aS),dS=Se.forwardRef((t,e)=>{const{__scopeTabs:n,value:r,onValueChange:i,defaultValue:o,orientation:a="horizontal",dir:s,activationMode:u="automatic",...c}=t,l=Kt(s),[h,d]=nt({prop:r,onChange:i,defaultProp:o??"",caller:aS});return $.jsx(lS,{scope:n,baseId:Zt(),value:h,onValueChange:d,orientation:a,dir:l,activationMode:u,children:$.jsx(Y.div,{dir:l,"data-orientation":a,...c,ref:e})})});dS.displayName=aS;var pS="TabsList",fS=Se.forwardRef((t,e)=>{const{__scopeTabs:n,loop:r=!0,...i}=t,o=hS(pS,n),a=cS(n);return $.jsx(Xt,{asChild:!0,...a,orientation:o.orientation,dir:o.dir,loop:r,children:$.jsx(Y.div,{role:"tablist","aria-orientation":o.orientation,...i,ref:e})})});fS.displayName=pS;var mS="TabsTrigger",vS=Se.forwardRef((t,e)=>{const{__scopeTabs:n,value:r,disabled:i=!1,...o}=t,a=hS(mS,n),s=cS(n),u=xS(a.baseId,r),c=bS(a.baseId,r),l=r===a.value;return $.jsx($t,{asChild:!0,...s,focusable:!i,active:l,children:$.jsx(Y.button,{type:"button",role:"tab","aria-selected":l,"aria-controls":c,"data-state":l?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:u,...o,ref:e,onMouseDown:ot(t.onMouseDown,t=>{i||0!==t.button||!1!==t.ctrlKey?t.preventDefault():a.onValueChange(r)}),onKeyDown:ot(t.onKeyDown,t=>{[" ","Enter"].includes(t.key)&&a.onValueChange(r)}),onFocus:ot(t.onFocus,()=>{const t="manual"!==a.activationMode;l||i||!t||a.onValueChange(r)})})})});vS.displayName=mS;var gS="TabsContent",yS=Se.forwardRef((t,e)=>{const{__scopeTabs:n,value:r,forceMount:i,children:o,...a}=t,s=hS(gS,n),u=xS(s.baseId,r),c=bS(s.baseId,r),l=r===s.value,h=Se.useRef(l);return Se.useEffect(()=>{const t=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(t)},[]),$.jsx(rt,{present:i||l,children:({present:n})=>$.jsx(Y.div,{"data-state":l?"active":"inactive","data-orientation":s.orientation,role:"tabpanel","aria-labelledby":u,hidden:!n,id:c,tabIndex:0,...a,ref:e,style:{...t.style,animationDuration:h.current?"0s":void 0},children:n&&o})})});function xS(t,e){return`${t}-trigger-${e}`}function bS(t,e){return`${t}-content-${e}`}yS.displayName=gS;var wS=fS,_S=vS,ES=yS;const CS=dS,IS=Se.forwardRef(({className:t,...e},n)=>$.jsx(wS,{ref:n,className:Vn("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...e}));IS.displayName=wS.displayName;const SS=Se.forwardRef(({className:t,...e},n)=>$.jsx(_S,{ref:n,className:Vn("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",t),...e}));SS.displayName=_S.displayName;const kS=Se.forwardRef(({className:t,...e},n)=>$.jsx(ES,{ref:n,className:Vn("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...e}));kS.displayName=ES.displayName;const TS=()=>{const{toast:t}=$e(),e=Re(),[n]=Pe(),r=Se.useMemo(()=>n.get("redirect")||"/",[n]),{user:i,initializing:o,authLoading:a,authError:s,signIn:u,signUp:c,resetAuthError:l}=_l(),[h,d]=Se.useState("login"),[p,f]=Se.useState(null),[m,v]=Se.useState({email:"",password:"",confirmPassword:"",displayName:""});Se.useEffect(()=>{i&&!o&&e(r,{replace:!0})},[i,o,e,r]);const g=async n=>{if(n.preventDefault(),f(null),l(),m.email&&m.password)if("register"!==h||m.password===m.confirmPassword)try{"login"===h?(await u(m.email,m.password),t({title:"",description:" "})):(await c({email:m.email,password:m.password,displayName:m.displayName.trim()||void 0}),t({title:"",description:" NongPlatoo.Ai "})),e(r,{replace:!0})}catch{}else f("");else f("")},y=[{title:" Firebase Auth",description:"  MFA ",icon:re},{title:" ",description:"",icon:Jt},{title:"",description:" ",icon:Mt}];return $.jsxs("div",{className:"min-h-screen bg-gradient-sky relative overflow-hidden",children:[$.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[$.jsx("div",{className:"absolute -top-20 -left-20 w-72 h-72 bg-primary/20 rounded-full blur-3xl"}),$.jsx("div",{className:"absolute -bottom-20 -right-12 w-80 h-80 bg-secondary/20 rounded-full blur-3xl"}),$.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-white/40 via-white/30 to-white/10 dark:from-background"})]}),$.jsx(GI,{}),$.jsx("div",{className:"container relative mx-auto px-4 pt-28 pb-16",children:$.jsxs("div",{className:"grid lg:grid-cols-2 gap-10 items-start",children:[$.jsxs("div",{className:"space-y-6",children:[$.jsx($I,{className:"bg-primary/15 text-primary border border-primary/20",children:""}),$.jsxs("div",{className:"space-y-4",children:[$.jsxs("p",{className:"text-sm uppercase tracking-[0.3em] text-primary font-semibold flex items-center gap-2",children:[$.jsx(Mt,{className:"w-4 h-4"})," Firebase Login"]}),$.jsx("h1",{className:"text-3xl sm:text-4xl font-bold leading-tight",children:" NongPlatoo.Ai"}),$.jsx("p",{className:"text-muted-foreground text-lg leading-relaxed",children:"  Firebase "})]}),$.jsx("div",{className:"grid sm:grid-cols-2 gap-4",children:y.map(t=>$.jsxs("div",{className:"glass p-4 rounded-2xl border border-border/80 shadow-soft flex gap-3",children:[$.jsx("div",{className:"h-10 w-10 rounded-xl bg-primary/10 text-primary flex items-center justify-center",children:$.jsx(t.icon,{className:"w-5 h-5"})}),$.jsxs("div",{className:"space-y-1",children:[$.jsx("h3",{className:"font-semibold",children:t.title}),$.jsx("p",{className:"text-sm text-muted-foreground",children:t.description})]})]},t.title))}),$.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[$.jsx(Yt,{className:"w-4 h-4 text-accent"}),""]})]}),$.jsxs(YI,{className:"glass shadow-elevated border border-primary/10 relative overflow-hidden",children:[$.jsx("div",{className:"absolute inset-x-0 top-0 h-1 bg-gradient-to-r from-primary via-secondary to-accent"}),$.jsx(JI,{className:"pb-4",children:$.jsxs(QI,{className:"flex items-center gap-3",children:[$.jsx("div",{className:"h-12 w-12 rounded-2xl bg-primary/10 text-primary flex items-center justify-center",children:$.jsx(Jt,{className:"w-6 h-6"})}),$.jsxs("div",{children:[$.jsx("p",{className:"text-sm text-muted-foreground",children:""}),$.jsx("span",{className:"text-xl font-semibold",children:"NongPlatoo Account"})]})]})}),$.jsxs(tS,{className:"space-y-6",children:[$.jsxs(CS,{value:h,onValueChange:t=>d(t),children:[$.jsxs(IS,{className:"grid grid-cols-2 w-full",children:[$.jsx(SS,{value:"login",children:""}),$.jsx(SS,{value:"register",children:""})]}),$.jsx(kS,{value:"login",className:"mt-6",children:$.jsxs("form",{className:"space-y-5",onSubmit:g,children:[$.jsxs("div",{className:"space-y-2",children:[$.jsxs(oS,{htmlFor:"email",className:"flex items-center gap-2",children:[$.jsx(Qt,{className:"w-4 h-4"})," "]}),$.jsx(eS,{id:"email",type:"email",placeholder:"you@example.com",value:m.email,onChange:t=>v({...m,email:t.target.value}),required:!0})]}),$.jsxs("div",{className:"space-y-2",children:[$.jsxs(oS,{htmlFor:"password",className:"flex items-center gap-2",children:[$.jsx(te,{className:"w-4 h-4"})," "]}),$.jsx(eS,{id:"password",type:"password",placeholder:"********",value:m.password,onChange:t=>v({...m,password:t.target.value}),required:!0})]}),(p||s)&&$.jsx("div",{className:"text-destructive bg-destructive/10 border border-destructive/30 rounded-lg px-3 py-2 text-sm",children:p||s}),$.jsx(Pi,{type:"submit",className:"w-full h-11 bg-gradient-river text-primary-foreground",disabled:a,children:a?$.jsxs($.Fragment,{children:[$.jsx(ee,{className:"w-4 h-4 mr-2 animate-spin"}),"..."]}):""})]})}),$.jsx(kS,{value:"register",className:"mt-6",children:$.jsxs("form",{className:"space-y-5",onSubmit:g,children:[$.jsxs("div",{className:"space-y-2",children:[$.jsxs(oS,{htmlFor:"displayName",className:"flex items-center gap-2",children:[$.jsx(ne,{className:"w-4 h-4"})," "]}),$.jsx(eS,{id:"displayName",placeholder:"",value:m.displayName,onChange:t=>v({...m,displayName:t.target.value})})]}),$.jsxs("div",{className:"space-y-2",children:[$.jsxs(oS,{htmlFor:"register-email",className:"flex items-center gap-2",children:[$.jsx(Qt,{className:"w-4 h-4"})," "]}),$.jsx(eS,{id:"register-email",type:"email",placeholder:"you@example.com",value:m.email,onChange:t=>v({...m,email:t.target.value}),required:!0})]}),$.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[$.jsxs("div",{className:"space-y-2",children:[$.jsxs(oS,{htmlFor:"register-password",className:"flex items-center gap-2",children:[$.jsx(te,{className:"w-4 h-4"})," "]}),$.jsx(eS,{id:"register-password",type:"password",placeholder:" 6 ",value:m.password,onChange:t=>v({...m,password:t.target.value}),required:!0})]}),$.jsxs("div",{className:"space-y-2",children:[$.jsxs(oS,{htmlFor:"confirm-password",className:"flex items-center gap-2",children:[$.jsx(re,{className:"w-4 h-4"})," "]}),$.jsx(eS,{id:"confirm-password",type:"password",placeholder:"",value:m.confirmPassword,onChange:t=>v({...m,confirmPassword:t.target.value}),required:!0})]})]}),(p||s)&&$.jsx("div",{className:"text-destructive bg-destructive/10 border border-destructive/30 rounded-lg px-3 py-2 text-sm",children:p||s}),$.jsx(Pi,{type:"submit",className:"w-full h-11 bg-gradient-river text-primary-foreground",disabled:a,children:a?$.jsxs($.Fragment,{children:[$.jsx(ee,{className:"w-4 h-4 mr-2 animate-spin"}),"..."]}):""})]})})]}),$.jsxs("div",{className:"text-sm text-muted-foreground text-center",children:[""," ",$.jsx(Ae,{to:"/",className:"text-primary hover:underline",children:""})," ",""," ",$.jsx(Ae,{to:"/",className:"text-primary hover:underline",children:""})]})]})]})]})})]})},NS="place_views",RS=()=>{try{const t=localStorage.getItem(NS);return t?JSON.parse(t):{}}catch(t){return{}}},AS=t=>RS()[t]||0,PS=()=>{var t;const e="https://nongplatoo.online".toString().trim();return e||("undefined"!=typeof window&&(null==(t=window.location)?void 0:t.origin)?window.location.origin:"")},DS="/assets/hero-floating-market-C9FyTcU2.jpg",MS=({id:t,name:e,nameTh:n,location:r,image:i,rating:o,tags:a,isOpen:s=!0,className:u})=>{const[c,l]=Se.useState(0),[h,d]=Se.useState(!1),p=PS();Se.useEffect(()=>{l(AS(t))},[t]);const f=h?DS:(t=>{if(!t)return DS;let e=String(t).trim();if(!e)return DS;if(e.startsWith("data:"))return e;e.startsWith("//")&&(e=`https:${e}`),(/^[a-zA-Z]:\\/.test(e)||e.includes("\\"))&&(e=e.replace(/\\/g,"/"));const n=e.toLowerCase(),r=n.lastIndexOf("/backend/static/");-1!==r&&(e=e.slice(r+16));const i=n.lastIndexOf("/static/");-1!==i&&(e=e.slice(i+8));const o=n.lastIndexOf("/public/");return-1!==o&&(e=e.slice(o+8)),/^https?:\/\//i.test(e)?(t=>t?["https://lh3.googleusercontent.com","https://lh5.googleusercontent.com","https://maps.googleapis.com","https://streetviewpixels-pa.googleapis.com"].some(e=>t.startsWith(e))?`${p}/api/image-proxy?url=${encodeURIComponent(t)}`:t:DS)(e):e.startsWith("/")?`${p}${e}`:`${p}/${e}`})(i);return $.jsx(Ae,{to:`/places/${t}`,onClick:()=>{const e=(t=>{try{const e=RS(),n=(e[t]||0)+1;return e[t]=n,localStorage.setItem(NS,JSON.stringify(e)),n}catch(e){return AS(t)}})(t);l(e)},className:Vn("group block card-hover",u),children:$.jsxs("div",{className:"bg-card rounded-2xl overflow-hidden shadow-card",children:[$.jsxs("div",{className:"relative aspect-[4/3] overflow-hidden",children:[$.jsx("img",{src:f,alt:n||e,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105",loading:"lazy",onError:()=>d(!0)}),$.jsx("div",{className:"absolute top-3 left-3",children:$.jsxs($I,{variant:s?"default":"secondary",className:Vn("flex items-center gap-1",s?"bg-accent text-accent-foreground":"bg-muted text-muted-foreground"),children:[$.jsx(ie,{className:"w-3 h-3"}),s?"":""]})}),$.jsxs("div",{className:"absolute top-3 right-3 flex flex-col gap-2",children:[null!=o&&$.jsxs("div",{className:"flex items-center gap-1 bg-card/90 backdrop-blur-sm px-2 py-1 rounded-full",children:[$.jsx(oe,{className:"w-3.5 h-3.5 fill-golden text-golden"}),$.jsx("span",{className:"text-sm font-medium text-foreground",children:o.toFixed(1)})]}),$.jsxs("div",{className:"flex items-center gap-1 bg-card/90 backdrop-blur-sm px-2 py-1 rounded-full",children:[$.jsx(ae,{className:"w-3.5 h-3.5 text-primary"}),$.jsx("span",{className:"text-xs font-medium text-foreground",children:(m=c,m>=1e6?`${(m/1e6).toFixed(1)}M`:m>=1e3?`${(m/1e3).toFixed(1)}K`:m.toString())})]})]})]}),$.jsxs("div",{className:"p-4",children:[$.jsx("h3",{className:"font-display text-lg font-semibold text-foreground mb-1 line-clamp-1 group-hover:text-primary transition-colors",children:n}),$.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:e}),$.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground text-sm mb-3",children:[$.jsx(Vt,{className:"w-4 h-4 text-secondary"}),$.jsx("span",{className:"line-clamp-1",children:r})]}),$.jsx("div",{className:"flex flex-wrap gap-1.5",children:a.slice(0,3).map(t=>$.jsx($I,{variant:"outline",className:"text-xs border-border text-muted-foreground",children:t},t))})]})]})});var m},OS=()=>{const[t,e]=Se.useState(!1),[n,r]=Se.useState([]),[i,o]=Se.useState(!0),[a,s]=Se.useState(null),[u,c]=Se.useState([]),[l,h]=Se.useState([]),{search:d,selectedDistrict:p,selectedCategory:f,setSearch:m,handleDistrictChange:v,handleCategoryChange:g,clearFilters:y,hasActiveFilters:x}=((t={})=>{const[e,n]=Pe(),[r,i]=Se.useState(""),[o,a]=Se.useState(t.initialDistrict||e.get("district")||""),[s,u]=Se.useState(t.initialCategory||e.get("category")||""),c=(t,e)=>{const r=new URLSearchParams;t&&r.set("district",t),e&&r.set("category",e),n(r)},l=Se.useMemo(()=>Boolean(o||s||r),[o,s,r]);return{search:r,selectedDistrict:o,selectedCategory:s,setSearch:i,handleDistrictChange:t=>{const e=o===t?"":t;a(e),c(e,s)},handleCategoryChange:t=>{const e=s===t?"":t;u(e),c(o,e)},clearFilters:()=>{a(""),u(""),i(""),n(new URLSearchParams)},hasActiveFilters:l}})();Se.useEffect(()=>{(async()=>{try{const t=PS(),[e,n]=await Promise.all([fetch(`${t}/api/filters/districts`),fetch(`${t}/api/filters/categories`)]);if(e.ok){const t=await e.json();t.success&&Array.isArray(t.districts)&&c(t.districts.map(t=>({value:t,label:t})))}if(n.ok){const t=await n.json();t.success&&Array.isArray(t.categories)&&h(t.categories.map(t=>({value:t,label:t})))}}catch(t){}})()},[]),Se.useEffect(()=>{(async()=>{try{o(!0),s(null);const t=PS(),e=await fetch(`${t}/api/places`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const n=await e.json();if(!n.success||!Array.isArray(n.places))throw new Error("Invalid response format");{const t=n.places.map(t=>{var e;let n="/placeholder.jpg";return Array.isArray(t.images)&&t.images.length>0?n=t.images[0]:t.image?n=t.image:t.image_url&&(n=t.image_url),{id:t.id||"",name:t.name||"Unknown",nameTh:t.name||"",description:t.description||"",descriptionTh:t.description||"",location:t.address||t.location||"",district:t.city||t.district||"",category:t.category||(null==(e=t.type)?void 0:e[0])||"",image:n,images:Array.isArray(t.images)?t.images:[n],rating:t.rating??null,tags:Array.isArray(t.tags)?t.tags:t.type||[],openTime:t.openTime||t.opening_hours||"",closeTime:t.closeTime||"",isOpen:!1!==t.isOpen,googleMapsUrl:t.googleMapsUrl||"",address:t.address||"",addressTh:t.addressTh||""}});r(t)}}catch(t){s(t instanceof Error?t.message:"Failed to load places")}finally{o(!1)}})()},[]);const b=Se.useMemo(()=>n.filter(t=>{if(p&&t.district!==p)return!1;if(f&&t.category!==f)return!1;if(d){const e=d.toLowerCase();return t.name.toLowerCase().includes(e)||t.nameTh.includes(d)||t.description.toLowerCase().includes(e)||t.descriptionTh.includes(d)||t.tags.some(t=>t.toLowerCase().includes(e))}return!0}),[n,p,f,d]);return $.jsxs("div",{className:"min-h-screen bg-background",children:[$.jsx(GI,{}),$.jsx("header",{className:"pt-24 pb-8 bg-gradient-sky",children:$.jsxs("div",{className:"container mx-auto px-4",children:[$.jsx("h1",{className:"font-display text-3xl md:text-4xl font-bold text-foreground mb-2",children:""}),$.jsxs("p",{className:"text-muted-foreground text-lg",children:["Explore Places  ",b.length," destinations to discover"]})]})}),$.jsx("div",{className:"sticky top-16 z-40 bg-card/95 backdrop-blur-md border-b border-border py-4",children:$.jsxs("div",{className:"container mx-auto px-4",children:[$.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[$.jsxs("div",{className:"relative flex-1",children:[$.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground"}),$.jsx(eS,{placeholder:"... (Search places)",value:d,onChange:t=>m(t.target.value),className:"pl-10 h-12 bg-background"})]}),$.jsxs(Pi,{variant:"outline",className:"md:hidden h-12",onClick:()=>e(!t),children:[$.jsx(ue,{className:"w-5 h-5 mr-2"}),"Filters",x&&$.jsx($I,{className:"ml-2 bg-primary text-primary-foreground",children:"Active"})]}),x&&$.jsxs(Pi,{variant:"ghost",onClick:y,className:"hidden md:flex h-12",children:[$.jsx(lt,{className:"w-4 h-4 mr-2"}),"Clear"]})]}),$.jsxs("div",{className:"mt-4 space-y-4 "+(t?"block":"hidden md:block"),children:[$.jsxs("div",{children:[$.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:" (District)"}),$.jsx("div",{className:"flex flex-wrap gap-2",children:u.map(t=>$.jsx(Pi,{variant:p===t.value?"default":"outline",size:"sm",onClick:()=>v(t.value),className:"rounded-full",children:t.label},t.value))})]}),$.jsxs("div",{children:[$.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:" (Category)"}),$.jsx("div",{className:"flex flex-wrap gap-2",children:l.map(t=>$.jsx(Pi,{variant:f===t.value?"sky":"outline",size:"sm",onClick:()=>g(t.value),className:"rounded-full",children:t.label},t.value))})]})]})]})}),$.jsx("main",{className:"py-8",children:$.jsx("div",{className:"container mx-auto px-4",children:i?$.jsxs("div",{className:"flex items-center justify-center py-20",children:[$.jsx(ce,{className:"w-8 h-8 animate-spin text-primary mr-2"}),$.jsx("p",{className:"text-muted-foreground",children:"Loading places..."})]}):a?$.jsxs("div",{className:"text-center py-20",children:[$.jsx("div",{className:"w-16 h-16 bg-destructive/10 rounded-full flex items-center justify-center mx-auto mb-4",children:$.jsx(se,{className:"w-8 h-8 text-destructive"})}),$.jsx("h3",{className:"font-display text-xl font-semibold text-foreground mb-2",children:"Error Loading Places"}),$.jsx("p",{className:"text-muted-foreground mb-4",children:a}),$.jsx(Pi,{variant:"outline",onClick:()=>window.location.reload(),children:"Retry"})]}):b.length>0?$.jsxs($.Fragment,{children:[$.jsxs("p",{className:"text-muted-foreground mb-6",children:[" ",b.length,"  (Found ",b.length," ","places)"]}),$.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:b.map((t,e)=>$.jsx(MS,{id:t.id,name:t.name,nameTh:t.nameTh,location:t.location,image:t.image,rating:t.rating,tags:t.tags,isOpen:t.isOpen,className:"animate-slide-up animation-delay-"+e%3*100},t.id))})]}):$.jsxs("div",{className:"text-center py-20",children:[$.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mx-auto mb-4",children:$.jsx(se,{className:"w-8 h-8 text-muted-foreground"})}),$.jsx("h3",{className:"font-display text-xl font-semibold text-foreground mb-2",children:""}),$.jsx("p",{className:"text-muted-foreground",children:"No places found. Try adjusting your filters."}),$.jsx(Pi,{variant:"outline",onClick:y,className:"mt-4",children:"Clear Filters"})]})})})]})};function LS(t,e){const n=Se.useRef(e);Se.useEffect(function(){e!==n.current&&null!=t.attributionControl&&(null!=n.current&&t.attributionControl.removeAttribution(n.current),null!=e&&t.attributionControl.addAttribution(e)),n.current=e},[t,e])}const BS=Se.createContext(null),FS=BS.Provider;function jS(){const t=Se.useContext(BS);if(null==t)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}function zS(t,e){const n=Se.useRef();Se.useEffect(function(){return null!=e&&t.instance.on(e),n.current=e,function(){null!=n.current&&t.instance.off(n.current),n.current=null}},[t,e])}function WS(t,e){const n=t.pane??e.pane;return n?{...t,pane:n}:t}var US={exports:{}};
/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */!function(t){var e="1.9.4";function n(t){var e,n,r,i;for(n=1,r=arguments.length;n<r;n++)for(e in i=arguments[n])t[e]=i[e];return t}var r=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}();function i(t,e){var n=Array.prototype.slice;if(t.bind)return t.bind.apply(t,n.call(arguments,1));var r=n.call(arguments,2);return function(){return t.apply(e,r.length?r.concat(n.call(arguments)):arguments)}}var o=0;function a(t){return"_leaflet_id"in t||(t._leaflet_id=++o),t._leaflet_id}function s(t,e,n){var r,i,o,a;return a=function(){r=!1,i&&(o.apply(n,i),i=!1)},o=function(){r?i=arguments:(t.apply(n,arguments),setTimeout(a,e),r=!0)},o}function u(t,e,n){var r=e[1],i=e[0],o=r-i;return t===r&&n?t:((t-i)%o+o)%o+i}function c(){return!1}function l(t,e){if(!1===e)return t;var n=Math.pow(10,void 0===e?6:e);return Math.round(t*n)/n}function h(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function d(t){return h(t).split(/\s+/)}function p(t,e){for(var n in Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?r(t.options):{}),e)t.options[n]=e[n];return t.options}function f(t,e,n){var r=[];for(var i in t)r.push(encodeURIComponent(n?i.toUpperCase():i)+"="+encodeURIComponent(t[i]));return(e&&-1!==e.indexOf("?")?"&":"?")+r.join("&")}var m=/\{ *([\w_ -]+) *\}/g;function v(t,e){return t.replace(m,function(t,n){var r=e[n];if(void 0===r)throw new Error("No value provided for variable "+t);return"function"==typeof r&&(r=r(e)),r})}var g=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function y(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1}var x="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function b(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var w=0;function _(t){var e=+new Date,n=Math.max(0,16-(e-w));return w=e+n,window.setTimeout(t,n)}var E=window.requestAnimationFrame||b("RequestAnimationFrame")||_,C=window.cancelAnimationFrame||b("CancelAnimationFrame")||b("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function I(t,e,n){if(!n||E!==_)return E.call(window,i(t,e));t.call(e)}function S(t){t&&C.call(window,t)}var k={__proto__:null,extend:n,create:r,bind:i,get lastId(){return o},stamp:a,throttle:s,wrapNum:u,falseFn:c,formatNum:l,trim:h,splitWords:d,setOptions:p,getParamString:f,template:v,isArray:g,indexOf:y,emptyImageUrl:x,requestFn:E,cancelFn:C,requestAnimFrame:I,cancelAnimFrame:S};function T(){}function N(t){if("undefined"!=typeof L&&L&&L.Mixin){t=g(t)?t:[t];for(var e=0;e<t.length;e++)t[e],L.Mixin.Events}}T.extend=function(t){var e=function(){p(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},i=e.__super__=this.prototype,o=r(i);for(var a in o.constructor=e,e.prototype=o,this)Object.prototype.hasOwnProperty.call(this,a)&&"prototype"!==a&&"__super__"!==a&&(e[a]=this[a]);return t.statics&&n(e,t.statics),t.includes&&(N(t.includes),n.apply(null,[o].concat(t.includes))),n(o,t),delete o.statics,delete o.includes,o.options&&(o.options=i.options?r(i.options):{},n(o.options,t.options)),o._initHooks=[],o.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&&i.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=o._initHooks.length;t<e;t++)o._initHooks[t].call(this)}},e},T.include=function(t){var e=this.prototype.options;return n(this.prototype,t),t.options&&(this.prototype.options=e,this.mergeOptions(t.options)),this},T.mergeOptions=function(t){return n(this.prototype.options,t),this},T.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),n="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(n),this};var R={on:function(t,e,n){if("object"==typeof t)for(var r in t)this._on(r,t[r],e);else for(var i=0,o=(t=d(t)).length;i<o;i++)this._on(t[i],e,n);return this},off:function(t,e,n){if(arguments.length)if("object"==typeof t)for(var r in t)this._off(r,t[r],e);else{t=d(t);for(var i=1===arguments.length,o=0,a=t.length;o<a;o++)i?this._off(t[o]):this._off(t[o],e,n)}else delete this._events;return this},_on:function(t,e,n,r){if("function"==typeof e&&!1===this._listens(t,e,n)){n===this&&(n=void 0);var i={fn:e,ctx:n};r&&(i.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(i)}},_off:function(t,e,n){var r,i,o;if(this._events&&(r=this._events[t]))if(1!==arguments.length){if("function"==typeof e){var a=this._listens(t,e,n);if(!1!==a){var s=r[a];this._firingCount&&(s.fn=c,this._events[t]=r=r.slice()),r.splice(a,1)}}}else{if(this._firingCount)for(i=0,o=r.length;i<o;i++)r[i].fn=c;delete this._events[t]}},fire:function(t,e,r){if(!this.listens(t,r))return this;var i=n({},e,{type:t,target:this,sourceTarget:e&&e.sourceTarget||this});if(this._events){var o=this._events[t];if(o){this._firingCount=this._firingCount+1||1;for(var a=0,s=o.length;a<s;a++){var u=o[a],c=u.fn;u.once&&this.off(t,c,u.ctx),c.call(u.ctx||this,i)}this._firingCount--}}return r&&this._propagateEvent(i),this},listens:function(t,e,n,r){var i=e;"function"!=typeof e&&(r=!!e,i=void 0,n=void 0);var o=this._events&&this._events[t];if(o&&o.length&&!1!==this._listens(t,i,n))return!0;if(r)for(var a in this._eventParents)if(this._eventParents[a].listens(t,e,n,r))return!0;return!1},_listens:function(t,e,n){if(!this._events)return!1;var r=this._events[t]||[];if(!e)return!!r.length;n===this&&(n=void 0);for(var i=0,o=r.length;i<o;i++)if(r[i].fn===e&&r[i].ctx===n)return i;return!1},once:function(t,e,n){if("object"==typeof t)for(var r in t)this._on(r,t[r],e,!0);else for(var i=0,o=(t=d(t)).length;i<o;i++)this._on(t[i],e,n,!0);return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[a(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[a(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,n({layer:t.target,propagatedFrom:t.target},t),!0)}};R.addEventListener=R.on,R.removeEventListener=R.clearAllEventListeners=R.off,R.addOneTimeEventListener=R.once,R.fireEvent=R.fire,R.hasEventListeners=R.listens;var A=T.extend(R);function P(t,e,n){this.x=n?Math.round(t):t,this.y=n?Math.round(e):e}var D=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};function M(t,e,n){return t instanceof P?t:g(t)?new P(t[0],t[1]):null==t?t:"object"==typeof t&&"x"in t&&"y"in t?new P(t.x,t.y):new P(t,e,n)}function O(t,e){if(t)for(var n=e?[t,e]:t,r=0,i=n.length;r<i;r++)this.extend(n[r])}function B(t,e){return!t||t instanceof O?t:new O(t,e)}function F(t,e){if(t)for(var n=e?[t,e]:t,r=0,i=n.length;r<i;r++)this.extend(n[r])}function j(t,e){return t instanceof F?t:new F(t,e)}function z(t,e,n){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==n&&(this.alt=+n)}function W(t,e,n){return t instanceof z?t:g(t)&&"object"!=typeof t[0]?3===t.length?new z(t[0],t[1],t[2]):2===t.length?new z(t[0],t[1]):null:null==t?t:"object"==typeof t&&"lat"in t?new z(t.lat,"lng"in t?t.lng:t.lon,t.alt):void 0===e?null:new z(t,e,n)}P.prototype={clone:function(){return new P(this.x,this.y)},add:function(t){return this.clone()._add(M(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(M(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new P(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new P(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=D(this.x),this.y=D(this.y),this},distanceTo:function(t){var e=(t=M(t)).x-this.x,n=t.y-this.y;return Math.sqrt(e*e+n*n)},equals:function(t){return(t=M(t)).x===this.x&&t.y===this.y},contains:function(t){return t=M(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+l(this.x)+", "+l(this.y)+")"}},O.prototype={extend:function(t){var e,n;if(!t)return this;if(t instanceof P||"number"==typeof t[0]||"x"in t)e=n=M(t);else if(e=(t=B(t)).min,n=t.max,!e||!n)return this;return this.min||this.max?(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(n.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(n.y,this.max.y)):(this.min=e.clone(),this.max=n.clone()),this},getCenter:function(t){return M((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return M(this.min.x,this.max.y)},getTopRight:function(){return M(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,n;return(t="number"==typeof t[0]||t instanceof P?M(t):B(t))instanceof O?(e=t.min,n=t.max):e=n=t,e.x>=this.min.x&&n.x<=this.max.x&&e.y>=this.min.y&&n.y<=this.max.y},intersects:function(t){t=B(t);var e=this.min,n=this.max,r=t.min,i=t.max,o=i.x>=e.x&&r.x<=n.x,a=i.y>=e.y&&r.y<=n.y;return o&&a},overlaps:function(t){t=B(t);var e=this.min,n=this.max,r=t.min,i=t.max,o=i.x>e.x&&r.x<n.x,a=i.y>e.y&&r.y<n.y;return o&&a},isValid:function(){return!(!this.min||!this.max)},pad:function(t){var e=this.min,n=this.max,r=Math.abs(e.x-n.x)*t,i=Math.abs(e.y-n.y)*t;return B(M(e.x-r,e.y-i),M(n.x+r,n.y+i))},equals:function(t){return!!t&&(t=B(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight()))}},F.prototype={extend:function(t){var e,n,r=this._southWest,i=this._northEast;if(t instanceof z)e=t,n=t;else{if(!(t instanceof F))return t?this.extend(W(t)||j(t)):this;if(e=t._southWest,n=t._northEast,!e||!n)return this}return r||i?(r.lat=Math.min(e.lat,r.lat),r.lng=Math.min(e.lng,r.lng),i.lat=Math.max(n.lat,i.lat),i.lng=Math.max(n.lng,i.lng)):(this._southWest=new z(e.lat,e.lng),this._northEast=new z(n.lat,n.lng)),this},pad:function(t){var e=this._southWest,n=this._northEast,r=Math.abs(e.lat-n.lat)*t,i=Math.abs(e.lng-n.lng)*t;return new F(new z(e.lat-r,e.lng-i),new z(n.lat+r,n.lng+i))},getCenter:function(){return new z((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new z(this.getNorth(),this.getWest())},getSouthEast:function(){return new z(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof z||"lat"in t?W(t):j(t);var e,n,r=this._southWest,i=this._northEast;return t instanceof F?(e=t.getSouthWest(),n=t.getNorthEast()):e=n=t,e.lat>=r.lat&&n.lat<=i.lat&&e.lng>=r.lng&&n.lng<=i.lng},intersects:function(t){t=j(t);var e=this._southWest,n=this._northEast,r=t.getSouthWest(),i=t.getNorthEast(),o=i.lat>=e.lat&&r.lat<=n.lat,a=i.lng>=e.lng&&r.lng<=n.lng;return o&&a},overlaps:function(t){t=j(t);var e=this._southWest,n=this._northEast,r=t.getSouthWest(),i=t.getNorthEast(),o=i.lat>e.lat&&r.lat<n.lat,a=i.lng>e.lng&&r.lng<n.lng;return o&&a},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return!!t&&(t=j(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}},z.prototype={equals:function(t,e){return!!t&&(t=W(t),Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng))<=(void 0===e?1e-9:e))},toString:function(t){return"LatLng("+l(this.lat,t)+", "+l(this.lng,t)+")"},distanceTo:function(t){return H.distance(this,W(t))},wrap:function(){return H.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return j([this.lat-e,this.lng-n],[this.lat+e,this.lng+n])},clone:function(){return new z(this.lat,this.lng,this.alt)}};var U,V={latLngToPoint:function(t,e){var n=this.projection.project(t),r=this.scale(e);return this.transformation._transform(n,r)},pointToLatLng:function(t,e){var n=this.scale(e),r=this.transformation.untransform(t,n);return this.projection.unproject(r)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,n=this.scale(t);return new O(this.transformation.transform(e.min,n),this.transformation.transform(e.max,n))},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?u(t.lng,this.wrapLng,!0):t.lng;return new z(this.wrapLat?u(t.lat,this.wrapLat,!0):t.lat,e,t.alt)},wrapLatLngBounds:function(t){var e=t.getCenter(),n=this.wrapLatLng(e),r=e.lat-n.lat,i=e.lng-n.lng;if(0===r&&0===i)return t;var o=t.getSouthWest(),a=t.getNorthEast();return new F(new z(o.lat-r,o.lng-i),new z(a.lat-r,a.lng-i))}},H=n({},V,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var n=Math.PI/180,r=t.lat*n,i=e.lat*n,o=Math.sin((e.lat-t.lat)*n/2),a=Math.sin((e.lng-t.lng)*n/2),s=o*o+Math.cos(r)*Math.cos(i)*a*a,u=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return this.R*u}}),G=6378137,q={R:G,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,n=this.MAX_LATITUDE,r=Math.max(Math.min(n,t.lat),-n),i=Math.sin(r*e);return new P(this.R*t.lng*e,this.R*Math.log((1+i)/(1-i))/2)},unproject:function(t){var e=180/Math.PI;return new z((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:(U=G*Math.PI,new O([-U,-U],[U,U]))};function K(t,e,n,r){if(g(t))return this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3]);this._a=t,this._b=e,this._c=n,this._d=r}function Z(t,e,n,r){return new K(t,e,n,r)}K.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new P((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};var X,$=n({},H,{code:"EPSG:3857",projection:q,transformation:(X=.5/(Math.PI*q.R),Z(X,.5,-X,.5))}),Y=n({},$,{code:"EPSG:900913"});function J(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Q(t,e){var n,r,i,o,a,s,u="";for(n=0,i=t.length;n<i;n++){for(r=0,o=(a=t[n]).length;r<o;r++)u+=(r?"L":"M")+(s=a[r]).x+" "+s.y;u+=e?jt.svg?"z":"x":""}return u||"M0 0"}var tt,et=document.documentElement.style,nt="ActiveXObject"in window,rt=nt&&!document.addEventListener,it="msLaunchUri"in navigator&&!("documentMode"in document),ot=Ft("webkit"),at=Ft("android"),st=Ft("android 2")||Ft("android 3"),ut=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ct=at&&Ft("Google")&&ut<537&&!("AudioNode"in window),lt=!!window.opera,ht=!it&&Ft("chrome"),dt=Ft("gecko")&&!ot&&!lt&&!nt,pt=!ht&&Ft("safari"),ft=Ft("phantom"),mt="OTransition"in et,vt=0===navigator.platform.indexOf("Win"),gt=nt&&"transition"in et,yt="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!st,xt="MozPerspective"in et,bt=!window.L_DISABLE_3D&&(gt||yt||xt)&&!mt&&!ft,wt="undefined"!=typeof orientation||Ft("mobile"),_t=wt&&ot,Et=wt&&yt,Ct=!window.PointerEvent&&window.MSPointerEvent,It=!(!window.PointerEvent&&!Ct),St="ontouchstart"in window||!!window.TouchEvent,kt=!window.L_NO_TOUCH&&(St||It),Tt=wt&&lt,Nt=wt&&dt,Rt=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,At=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",c,e),window.removeEventListener("testPassiveEventSupport",c,e)}catch(n){}return t}(),Pt=!!document.createElement("canvas").getContext,Dt=!(!document.createElementNS||!J("svg").createSVGRect),Mt=!!Dt&&((tt=document.createElement("div")).innerHTML="<svg/>","http://www.w3.org/2000/svg"===(tt.firstChild&&tt.firstChild.namespaceURI)),Ot=!Dt&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(n){return!1}}(),Lt=0===navigator.platform.indexOf("Mac"),Bt=0===navigator.platform.indexOf("Linux");function Ft(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var jt={ie:nt,ielt9:rt,edge:it,webkit:ot,android:at,android23:st,androidStock:ct,opera:lt,chrome:ht,gecko:dt,safari:pt,phantom:ft,opera12:mt,win:vt,ie3d:gt,webkit3d:yt,gecko3d:xt,any3d:bt,mobile:wt,mobileWebkit:_t,mobileWebkit3d:Et,msPointer:Ct,pointer:It,touch:kt,touchNative:St,mobileOpera:Tt,mobileGecko:Nt,retina:Rt,passiveEvents:At,canvas:Pt,svg:Dt,vml:Ot,inlineSvg:Mt,mac:Lt,linux:Bt},zt=jt.msPointer?"MSPointerDown":"pointerdown",Wt=jt.msPointer?"MSPointerMove":"pointermove",Ut=jt.msPointer?"MSPointerUp":"pointerup",Vt=jt.msPointer?"MSPointerCancel":"pointercancel",Ht={touchstart:zt,touchmove:Wt,touchend:Ut,touchcancel:Vt},Gt={touchstart:ee,touchmove:te,touchend:te,touchcancel:te},qt={},Kt=!1;function Zt(t,e,n){return"touchstart"===e&&Qt(),Gt[e]?(n=Gt[e].bind(this,n),t.addEventListener(Ht[e],n,!1),n):c}function Xt(t,e,n){Ht[e]&&t.removeEventListener(Ht[e],n,!1)}function $t(t){qt[t.pointerId]=t}function Yt(t){qt[t.pointerId]&&(qt[t.pointerId]=t)}function Jt(t){delete qt[t.pointerId]}function Qt(){Kt||(document.addEventListener(zt,$t,!0),document.addEventListener(Wt,Yt,!0),document.addEventListener(Ut,Jt,!0),document.addEventListener(Vt,Jt,!0),Kt=!0)}function te(t,e){if(e.pointerType!==(e.MSPOINTER_TYPE_MOUSE||"mouse")){for(var n in e.touches=[],qt)e.touches.push(qt[n]);e.changedTouches=[e],t(e)}}function ee(t,e){e.MSPOINTER_TYPE_TOUCH&&e.pointerType===e.MSPOINTER_TYPE_TOUCH&&$e(e),te(t,e)}function ne(t){var e,n,r={};for(n in t)e=t[n],r[n]=e&&e.bind?e.bind(t):e;return t=r,r.type="dblclick",r.detail=2,r.isTrusted=!1,r._simulated=!0,r}var re=200;function ie(t,e){t.addEventListener("dblclick",e);var n,r=0;function i(t){if(1===t.detail){if("mouse"!==t.pointerType&&(!t.sourceCapabilities||t.sourceCapabilities.firesTouchEvents)){var i=Je(t);if(!i.some(function(t){return t instanceof HTMLLabelElement&&t.attributes.for})||i.some(function(t){return t instanceof HTMLInputElement||t instanceof HTMLSelectElement})){var o=Date.now();o-r<=re?2===++n&&e(ne(t)):n=1,r=o}}}else n=t.detail}return t.addEventListener("click",i),{dblclick:e,simDblclick:i}}function oe(t,e){t.removeEventListener("dblclick",e.dblclick),t.removeEventListener("click",e.simDblclick)}var ae,se,ue,ce,le,he=Te(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),de=Te(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),pe="webkitTransition"===de||"OTransition"===de?de+"End":"transitionend";function fe(t){return"string"==typeof t?document.getElementById(t):t}function me(t,e){var n=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!n||"auto"===n)&&document.defaultView){var r=document.defaultView.getComputedStyle(t,null);n=r?r[e]:null}return"auto"===n?null:n}function ve(t,e,n){var r=document.createElement(t);return r.className=e||"",n&&n.appendChild(r),r}function ge(t){var e=t.parentNode;e&&e.removeChild(t)}function ye(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function xe(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function be(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function we(t,e){if(void 0!==t.classList)return t.classList.contains(e);var n=Ie(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)}function _e(t,e){if(void 0!==t.classList)for(var n=d(e),r=0,i=n.length;r<i;r++)t.classList.add(n[r]);else if(!we(t,e)){var o=Ie(t);Ce(t,(o?o+" ":"")+e)}}function Ee(t,e){void 0!==t.classList?t.classList.remove(e):Ce(t,h((" "+Ie(t)+" ").replace(" "+e+" "," ")))}function Ce(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e}function Ie(t){return t.correspondingElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function Se(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&ke(t,e)}function ke(t,e){var n=!1,r="DXImageTransform.Microsoft.Alpha";try{n=t.filters.item(r)}catch(i){if(1===e)return}e=Math.round(100*e),n?(n.Enabled=100!==e,n.Opacity=e):t.style.filter+=" progid:"+r+"(opacity="+e+")"}function Te(t){for(var e=document.documentElement.style,n=0;n<t.length;n++)if(t[n]in e)return t[n];return!1}function Ne(t,e,n){var r=e||new P(0,0);t.style[he]=(jt.ie3d?"translate("+r.x+"px,"+r.y+"px)":"translate3d("+r.x+"px,"+r.y+"px,0)")+(n?" scale("+n+")":"")}function Re(t,e){t._leaflet_pos=e,jt.any3d?Ne(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function Ae(t){return t._leaflet_pos||new P(0,0)}if("onselectstart"in document)ae=function(){ze(window,"selectstart",$e)},se=function(){Ue(window,"selectstart",$e)};else{var Pe=Te(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ae=function(){if(Pe){var t=document.documentElement.style;ue=t[Pe],t[Pe]="none"}},se=function(){Pe&&(document.documentElement.style[Pe]=ue,ue=void 0)}}function De(){ze(window,"dragstart",$e)}function Me(){Ue(window,"dragstart",$e)}function Oe(t){for(;-1===t.tabIndex;)t=t.parentNode;t.style&&(Le(),ce=t,le=t.style.outlineStyle,t.style.outlineStyle="none",ze(window,"keydown",Le))}function Le(){ce&&(ce.style.outlineStyle=le,ce=void 0,le=void 0,Ue(window,"keydown",Le))}function Be(t){do{t=t.parentNode}while(!(t.offsetWidth&&t.offsetHeight||t===document.body));return t}function Fe(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}var je={__proto__:null,TRANSFORM:he,TRANSITION:de,TRANSITION_END:pe,get:fe,getStyle:me,create:ve,remove:ge,empty:ye,toFront:xe,toBack:be,hasClass:we,addClass:_e,removeClass:Ee,setClass:Ce,getClass:Ie,setOpacity:Se,testProp:Te,setTransform:Ne,setPosition:Re,getPosition:Ae,get disableTextSelection(){return ae},get enableTextSelection(){return se},disableImageDrag:De,enableImageDrag:Me,preventOutline:Oe,restoreOutline:Le,getSizedParentNode:Be,getScale:Fe};function ze(t,e,n,r){if(e&&"object"==typeof e)for(var i in e)Ge(t,i,e[i],n);else for(var o=0,a=(e=d(e)).length;o<a;o++)Ge(t,e[o],n,r);return this}var We="_leaflet_events";function Ue(t,e,n,r){if(1===arguments.length)Ve(t),delete t[We];else if(e&&"object"==typeof e)for(var i in e)qe(t,i,e[i],n);else if(e=d(e),2===arguments.length)Ve(t,function(t){return-1!==y(e,t)});else for(var o=0,a=e.length;o<a;o++)qe(t,e[o],n,r);return this}function Ve(t,e){for(var n in t[We]){var r=n.split(/\d/)[0];e&&!e(r)||qe(t,r,null,null,n)}}var He={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Ge(t,e,n,r){var i=e+a(n)+(r?"_"+a(r):"");if(t[We]&&t[We][i])return this;var o=function(e){return n.call(r||t,e||window.event)},s=o;!jt.touchNative&&jt.pointer&&0===e.indexOf("touch")?o=Zt(t,e,o):jt.touch&&"dblclick"===e?o=ie(t,o):"addEventListener"in t?"touchstart"===e||"touchmove"===e||"wheel"===e||"mousewheel"===e?t.addEventListener(He[e]||e,o,!!jt.passiveEvents&&{passive:!1}):"mouseenter"===e||"mouseleave"===e?(o=function(e){e=e||window.event,nn(t,e)&&s(e)},t.addEventListener(He[e],o,!1)):t.addEventListener(e,s,!1):t.attachEvent("on"+e,o),t[We]=t[We]||{},t[We][i]=o}function qe(t,e,n,r,i){i=i||e+a(n)+(r?"_"+a(r):"");var o=t[We]&&t[We][i];if(!o)return this;!jt.touchNative&&jt.pointer&&0===e.indexOf("touch")?Xt(t,e,o):jt.touch&&"dblclick"===e?oe(t,o):"removeEventListener"in t?t.removeEventListener(He[e]||e,o,!1):t.detachEvent("on"+e,o),t[We][i]=null}function Ke(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function Ze(t){return Ge(t,"wheel",Ke),this}function Xe(t){return ze(t,"mousedown touchstart dblclick contextmenu",Ke),t._leaflet_disable_click=!0,this}function $e(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Ye(t){return $e(t),Ke(t),this}function Je(t){if(t.composedPath)return t.composedPath();for(var e=[],n=t.target;n;)e.push(n),n=n.parentNode;return e}function Qe(t,e){if(!e)return new P(t.clientX,t.clientY);var n=Fe(e),r=n.boundingClientRect;return new P((t.clientX-r.left)/n.x-e.clientLeft,(t.clientY-r.top)/n.y-e.clientTop)}var tn=jt.linux&&jt.chrome?window.devicePixelRatio:jt.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function en(t){return jt.edge?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/tn:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}function nn(t,e){var n=e.relatedTarget;if(!n)return!0;try{for(;n&&n!==t;)n=n.parentNode}catch(r){return!1}return n!==t}var rn={__proto__:null,on:ze,off:Ue,stopPropagation:Ke,disableScrollPropagation:Ze,disableClickPropagation:Xe,preventDefault:$e,stop:Ye,getPropagationPath:Je,getMousePosition:Qe,getWheelDelta:en,isExternalTarget:nn,addListener:ze,removeListener:Ue},on=A.extend({run:function(t,e,n,r){this.stop(),this._el=t,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(r||.5,.2),this._startPos=Ae(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=I(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,n=1e3*this._duration;e<n?this._runFrame(this._easeOut(e/n),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var n=this._startPos.add(this._offset.multiplyBy(t));e&&n._round(),Re(this._el,n),this.fire("step")},_complete:function(){S(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),an=A.extend({options:{crs:$,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=p(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=i(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(W(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=de&&jt.any3d&&!jt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),ze(this._proxy,pe,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,r){return e=void 0===e?this._zoom:this._limitZoom(e),t=this._limitCenter(W(t),e,this.options.maxBounds),r=r||{},this._stop(),this._loaded&&!r.reset&&!0!==r&&(void 0!==r.animate&&(r.zoom=n({animate:r.animate},r.zoom),r.pan=n({animate:r.animate,duration:r.duration},r.pan)),this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,r.zoom):this._tryAnimatedPan(t,r.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(t,e,r.pan&&r.pan.noMoveStart),this)},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(jt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(jt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,n){var r=this.getZoomScale(e),i=this.getSize().divideBy(2),o=(t instanceof P?t:this.latLngToContainerPoint(t)).subtract(i).multiplyBy(1-1/r),a=this.containerPointToLatLng(i.add(o));return this.setView(a,e,{zoom:n})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():j(t);var n=M(e.paddingTopLeft||e.padding||[0,0]),r=M(e.paddingBottomRight||e.padding||[0,0]),i=this.getBoundsZoom(t,!1,n.add(r));if((i="number"==typeof e.maxZoom?Math.min(e.maxZoom,i):i)===1/0)return{center:t.getCenter(),zoom:i};var o=r.subtract(n).divideBy(2),a=this.project(t.getSouthWest(),i),s=this.project(t.getNorthEast(),i);return{center:this.unproject(a.add(s).divideBy(2).add(o),i),zoom:i}},fitBounds:function(t,e){if(!(t=j(t)).isValid())throw new Error("Bounds are not valid.");var n=this._getBoundsCenterZoom(t,e);return this.setView(n.center,n.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(e=e||{},!(t=M(t).round()).x&&!t.y)return this.fire("moveend");if(!0!==e.animate&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new on,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),!1!==e.animate){_e(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,n,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,n){if(!1===(n=n||{}).animate||!jt.any3d)return this.setView(t,e,n);this._stop();var r=this.project(this.getCenter()),i=this.project(t),o=this.getSize(),a=this._zoom;t=W(t),e=void 0===e?a:e;var s=Math.max(o.x,o.y),u=s*this.getZoomScale(a,e),c=i.distanceTo(r)||1,l=1.42,h=l*l;function d(t){var e=(u*u-s*s+(t?-1:1)*h*h*c*c)/(2*(t?u:s)*h*c),n=Math.sqrt(e*e+1)-e;return n<1e-9?-18:Math.log(n)}function p(t){return(Math.exp(t)-Math.exp(-t))/2}function f(t){return(Math.exp(t)+Math.exp(-t))/2}function m(t){return p(t)/f(t)}var v=d(0);function g(t){return s*(f(v)/f(v+l*t))}function y(t){return s*(f(v)*m(v+l*t)-p(v))/h}function x(t){return 1-Math.pow(1-t,1.5)}var b=Date.now(),w=(d(1)-v)/l,_=n.duration?1e3*n.duration:1e3*w*.8;function E(){var n=(Date.now()-b)/_,o=x(n)*w;n<=1?(this._flyToFrame=I(E,this),this._move(this.unproject(r.add(i.subtract(r).multiplyBy(y(o)/c)),a),this.getScaleZoom(s/g(o),a),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}return this._moveStart(!0,n.noMoveStart),E.call(this),this},flyToBounds:function(t,e){var n=this._getBoundsCenterZoom(t,e);return this.flyTo(n.center,n.zoom,e)},setMaxBounds:function(t){return t=j(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var n=this.getCenter(),r=this._limitCenter(n,this._zoom,j(t));return n.equals(r)||this.panTo(r,e),this._enforcingBounds=!1,this},panInside:function(t,e){var n=M((e=e||{}).paddingTopLeft||e.padding||[0,0]),r=M(e.paddingBottomRight||e.padding||[0,0]),i=this.project(this.getCenter()),o=this.project(t),a=this.getPixelBounds(),s=B([a.min.add(n),a.max.subtract(r)]),u=s.getSize();if(!s.contains(o)){this._enforcingBounds=!0;var c=o.subtract(s.getCenter()),l=s.extend(o).getSize().subtract(u);i.x+=c.x<0?-l.x:l.x,i.y+=c.y<0?-l.y:l.y,this.panTo(this.unproject(i),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=n({animate:!1,pan:!0},!0===t?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var r=this.getSize(),o=e.divideBy(2).round(),a=r.divideBy(2).round(),s=o.subtract(a);return s.x||s.y?(t.animate&&t.pan?this.panBy(s):(t.pan&&this._rawPanBy(s),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(i(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:r})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=n({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=i(this._handleGeolocationResponse,this),r=i(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,r,t):navigator.geolocation.getCurrentPosition(e,r,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var e=t.code,n=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+n+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var e=new z(t.coords.latitude,t.coords.longitude),n=e.toBounds(2*t.coords.accuracy),r=this._locateOptions;if(r.setView){var i=this.getBoundsZoom(n);this.setView(e,r.maxZoom?Math.min(i,r.maxZoom):i)}var o={latlng:e,bounds:n,timestamp:t.timestamp};for(var a in t.coords)"number"==typeof t.coords[a]&&(o[a]=t.coords[a]);this.fire("locationfound",o)}},addHandler:function(t,e){if(!e)return this;var n=this[t]=new e(this);return this._handlers.push(n),this.options[t]&&n.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(e){this._container._leaflet_id=void 0,this._containerId=void 0}var t;for(t in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),ge(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(S(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[t].remove();for(t in this._panes)ge(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var n=ve("div","leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),e||this._mapPane);return t&&(this._panes[t]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds();return new F(this.unproject(t.getBottomLeft()),this.unproject(t.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,n){t=j(t),n=M(n||[0,0]);var r=this.getZoom()||0,i=this.getMinZoom(),o=this.getMaxZoom(),a=t.getNorthWest(),s=t.getSouthEast(),u=this.getSize().subtract(n),c=B(this.project(s,r),this.project(a,r)).getSize(),l=jt.any3d?this.options.zoomSnap:1,h=u.x/c.x,d=u.y/c.y,p=e?Math.max(h,d):Math.min(h,d);return r=this.getScaleZoom(p,r),l&&(r=Math.round(r/(l/100))*(l/100),r=e?Math.ceil(r/l)*l:Math.floor(r/l)*l),Math.max(i,Math.min(o,r))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new P(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var n=this._getTopLeftPoint(t,e);return new O(n,n.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var n=this.options.crs;return e=void 0===e?this._zoom:e,n.scale(t)/n.scale(e)},getScaleZoom:function(t,e){var n=this.options.crs;e=void 0===e?this._zoom:e;var r=n.zoom(t*n.scale(e));return isNaN(r)?1/0:r},project:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.latLngToPoint(W(t),e)},unproject:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.pointToLatLng(M(t),e)},layerPointToLatLng:function(t){var e=M(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){return this.project(W(t))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(W(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(j(t))},distance:function(t,e){return this.options.crs.distance(W(t),W(e))},containerPointToLayerPoint:function(t){return M(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return M(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(M(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(W(t)))},mouseEventToContainerPoint:function(t){return Qe(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=fe(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");ze(e,"scroll",this._onScroll,this),this._containerId=a(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&jt.any3d,_e(t,"leaflet-container"+(jt.touch?" leaflet-touch":"")+(jt.retina?" leaflet-retina":"")+(jt.ielt9?" leaflet-oldie":"")+(jt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=me(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&"sticky"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Re(this._mapPane,new P(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(_e(t.markerPane,"leaflet-zoom-hide"),_e(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e,n){Re(this._mapPane,new P(0,0));var r=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var i=this._zoom!==e;this._moveStart(i,n)._move(t,e)._moveEnd(i),this.fire("viewreset"),r&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,n,r){void 0===e&&(e=this._zoom);var i=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),r?n&&n.pinch&&this.fire("zoom",n):((i||n&&n.pinch)&&this.fire("zoom",n),this.fire("move",n)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return S(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){Re(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[a(this._container)]=this;var e=t?Ue:ze;e(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),jt.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){S(this._resizeRequest),this._resizeRequest=I(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var n,r=[],i="mouseout"===e||"mouseover"===e,o=t.target||t.srcElement,s=!1;o;){if((n=this._targets[a(o)])&&("click"===e||"preclick"===e)&&this._draggableMoved(n)){s=!0;break}if(n&&n.listens(e,!0)){if(i&&!nn(o,t))break;if(r.push(n),i)break}if(o===this._container)break;o=o.parentNode}return r.length||s||i||!this.listens(e,!0)||(r=[this]),r},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var e=t.target||t.srcElement;if(!(!this._loaded||e._leaflet_disable_events||"click"===t.type&&this._isClickDisabled(e))){var n=t.type;"mousedown"===n&&Oe(e),this._fireDOMEvent(t,n)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,e,r){if("click"===t.type){var i=n({},t);i.type="preclick",this._fireDOMEvent(i,i.type,r)}var o=this._findEventTargets(t,e);if(r){for(var a=[],s=0;s<r.length;s++)r[s].listens(e,!0)&&a.push(r[s]);o=a.concat(o)}if(o.length){"contextmenu"===e&&$e(t);var u=o[0],c={originalEvent:t};if("keypress"!==t.type&&"keydown"!==t.type&&"keyup"!==t.type){var l=u.getLatLng&&(!u._radius||u._radius<=10);c.containerPoint=l?this.latLngToContainerPoint(u.getLatLng()):this.mouseEventToContainerPoint(t),c.layerPoint=this.containerPointToLayerPoint(c.containerPoint),c.latlng=l?u.getLatLng():this.layerPointToLatLng(c.layerPoint)}for(s=0;s<o.length;s++)if(o[s].fire(e,c,!0),c.originalEvent._stopped||!1===o[s].options.bubblingMouseEvents&&-1!==y(this._mouseEvents,e))return}},_draggableMoved:function(t){return(t=t.dragging&&t.dragging.enabled()?t:this).dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return Ae(this._mapPane)||new P(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){return(t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var n=this.getSize()._divideBy(2);return this.project(t,e)._subtract(n)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,n){var r=this._getNewPixelOrigin(n,e);return this.project(t,e)._subtract(r)},_latLngBoundsToNewLayerBounds:function(t,e,n){var r=this._getNewPixelOrigin(n,e);return B([this.project(t.getSouthWest(),e)._subtract(r),this.project(t.getNorthWest(),e)._subtract(r),this.project(t.getSouthEast(),e)._subtract(r),this.project(t.getNorthEast(),e)._subtract(r)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,n){if(!n)return t;var r=this.project(t,e),i=this.getSize().divideBy(2),o=new O(r.subtract(i),r.add(i)),a=this._getBoundsOffset(o,n,e);return Math.abs(a.x)<=1&&Math.abs(a.y)<=1?t:this.unproject(r.add(a),e)},_limitOffset:function(t,e){if(!e)return t;var n=this.getPixelBounds(),r=new O(n.min.add(t),n.max.add(t));return t.add(this._getBoundsOffset(r,e))},_getBoundsOffset:function(t,e,n){var r=B(this.project(e.getNorthEast(),n),this.project(e.getSouthWest(),n)),i=r.min.subtract(t.min),o=r.max.subtract(t.max);return new P(this._rebound(i.x,-o.x),this._rebound(i.y,-o.y))},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),n=this.getMaxZoom(),r=jt.any3d?this.options.zoomSnap:1;return r&&(t=Math.round(t/r)*r),Math.max(e,Math.min(n,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Ee(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var n=this._getCenterOffset(t)._trunc();return!(!0!==(e&&e.animate)&&!this.getSize().contains(n)||(this.panBy(n,e),0))},_createAnimProxy:function(){var t=this._proxy=ve("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(t){var e=he,n=this._proxy.style[e];Ne(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),n===this._proxy.style[e]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){ge(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),e=this.getZoom();Ne(this._proxy,this.project(t,e),this.getZoomScale(e,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,n){if(this._animatingZoom)return!0;if(n=n||{},!this._zoomAnimated||!1===n.animate||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var r=this.getZoomScale(e),i=this._getCenterOffset(t)._divideBy(1-1/r);return!(!0!==n.animate&&!this.getSize().contains(i)||(I(function(){this._moveStart(!0,n.noMoveStart||!1)._animateZoom(t,e,!0)},this),0))},_animateZoom:function(t,e,n,r){this._mapPane&&(n&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,_e(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:r}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(i(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Ee(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function sn(t,e){return new an(t,e)}var un=T.extend({options:{position:"topright"},initialize:function(t){p(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),n=this.getPosition(),r=t._controlCorners[n];return _e(e,"leaflet-control"),-1!==n.indexOf("bottom")?r.insertBefore(e,r.firstChild):r.appendChild(e),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(ge(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),cn=function(t){return new un(t)};an.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",n=this._controlContainer=ve("div",e+"control-container",this._container);function r(r,i){var o=e+r+" "+e+i;t[r+i]=ve("div",o,n)}r("top","left"),r("top","right"),r("bottom","left"),r("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)ge(this._controlCorners[t]);ge(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var ln=un.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,n,r){return n<r?-1:r<n?1:0}},initialize:function(t,e,n){for(var r in p(this,n),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,t)this._addLayer(t[r],r);for(r in e)this._addLayer(e[r],r,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return un.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(a(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){_e(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(_e(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):Ee(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Ee(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=ve("div",t),n=this.options.collapsed;e.setAttribute("aria-haspopup",!0),Xe(e),Ze(e);var r=this._section=ve("section",t+"-list");n&&(this._map.on("click",this.collapse,this),ze(e,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var i=this._layersLink=ve("a",t+"-toggle",e);i.href="#",i.title="Layers",i.setAttribute("role","button"),ze(i,{keydown:function(t){13===t.keyCode&&this._expandSafely()},click:function(t){$e(t),this._expandSafely()}},this),n||this.expand(),this._baseLayersList=ve("div",t+"-base",r),this._separator=ve("div",t+"-separator",r),this._overlaysList=ve("div",t+"-overlays",r),e.appendChild(r)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&a(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,n){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:n}),this.options.sortLayers&&this._layers.sort(i(function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ye(this._baseLayersList),ye(this._overlaysList),this._layerControlInputs=[];var t,e,n,r,i=0;for(n=0;n<this._layers.length;n++)r=this._layers[n],this._addItem(r),e=e||r.overlay,t=t||!r.overlay,i+=r.overlay?0:1;return this.options.hideSingleBase&&(t=t&&i>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(a(t.target)),n=e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;n&&this._map.fire(n,e)},_createRadioElement:function(t,e){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",r=document.createElement("div");return r.innerHTML=n,r.firstChild},_addItem:function(t){var e,n=document.createElement("label"),r=this._map.hasLayer(t.layer);t.overlay?((e=document.createElement("input")).type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=r):e=this._createRadioElement("leaflet-base-layers_"+a(this),r),this._layerControlInputs.push(e),e.layerId=a(t.layer),ze(e,"click",this._onInputClick,this);var i=document.createElement("span");i.innerHTML=" "+t.name;var o=document.createElement("span");return n.appendChild(o),o.appendChild(e),o.appendChild(i),(t.overlay?this._overlaysList:this._baseLayersList).appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){if(!this._preventClick){var t,e,n=this._layerControlInputs,r=[],i=[];this._handlingClick=!0;for(var o=n.length-1;o>=0;o--)t=n[o],e=this._getLayer(t.layerId).layer,t.checked?r.push(e):t.checked||i.push(e);for(o=0;o<i.length;o++)this._map.hasLayer(i[o])&&this._map.removeLayer(i[o]);for(o=0;o<r.length;o++)this._map.hasLayer(r[o])||this._map.addLayer(r[o]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var t,e,n=this._layerControlInputs,r=this._map.getZoom(),i=n.length-1;i>=0;i--)t=n[i],e=this._getLayer(t.layerId).layer,t.disabled=void 0!==e.options.minZoom&&r<e.options.minZoom||void 0!==e.options.maxZoom&&r>e.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var t=this._section;this._preventClick=!0,ze(t,"click",$e),this.expand();var e=this;setTimeout(function(){Ue(t,"click",$e),e._preventClick=!1})}}),hn=function(t,e,n){return new ln(t,e,n)},dn=un.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",n=ve("div",e+" leaflet-bar"),r=this.options;return this._zoomInButton=this._createButton(r.zoomInText,r.zoomInTitle,e+"-in",n,this._zoomIn),this._zoomOutButton=this._createButton(r.zoomOutText,r.zoomOutTitle,e+"-out",n,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),n},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,n,r,i){var o=ve("a",n,r);return o.innerHTML=t,o.href="#",o.title=e,o.setAttribute("role","button"),o.setAttribute("aria-label",e),Xe(o),ze(o,"click",Ye),ze(o,"click",i,this),ze(o,"click",this._refocusOnMap,this),o},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";Ee(this._zoomInButton,e),Ee(this._zoomOutButton,e),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(_e(this._zoomOutButton,e),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(_e(this._zoomInButton,e),this._zoomInButton.setAttribute("aria-disabled","true"))}});an.mergeOptions({zoomControl:!0}),an.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new dn,this.addControl(this.zoomControl))});var pn=function(t){return new dn(t)},fn=un.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",n=ve("div",e),r=this.options;return this._addScales(r,e+"-line",n),t.on(r.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),n},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,n){t.metric&&(this._mScale=ve("div",e,n)),t.imperial&&(this._iScale=ve("div",e,n))},_update:function(){var t=this._map,e=t.getSize().y/2,n=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(n)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),n=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,n,e/t)},_updateImperial:function(t){var e,n,r,i=3.2808399*t;i>5280?(e=i/5280,n=this._getRoundNum(e),this._updateScale(this._iScale,n+" mi",n/e)):(r=this._getRoundNum(i),this._updateScale(this._iScale,r+" ft",r/i))},_updateScale:function(t,e,n){t.style.width=Math.round(this.options.maxWidth*n)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return e*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}}),mn=function(t){return new fn(t)},vn='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',gn=un.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(jt.inlineSvg?vn+" ":"")+"Leaflet</a>"},initialize:function(t){p(this,t),this._attributions={}},onAdd:function(t){for(var e in t.attributionControl=this,this._container=ve("div","leaflet-control-attribution"),Xe(this._container),t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",function(){this.removeAttribution(t.layer.getAttribution())},this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var n=[];this.options.prefix&&n.push(this.options.prefix),t.length&&n.push(t.join(", ")),this._container.innerHTML=n.join(' <span aria-hidden="true">|</span> ')}}});an.mergeOptions({attributionControl:!0}),an.addInitHook(function(){this.options.attributionControl&&(new gn).addTo(this)});var yn=function(t){return new gn(t)};un.Layers=ln,un.Zoom=dn,un.Scale=fn,un.Attribution=gn,cn.layers=hn,cn.zoom=pn,cn.scale=mn,cn.attribution=yn;var xn=T.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});xn.addTo=function(t,e){return t.addHandler(e,this),this};var bn={Events:R},wn=jt.touch?"touchstart mousedown":"mousedown",_n=A.extend({options:{clickTolerance:3},initialize:function(t,e,n,r){p(this,r),this._element=t,this._dragStartTarget=e||t,this._preventOutline=n},enable:function(){this._enabled||(ze(this._dragStartTarget,wn,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(_n._dragging===this&&this.finishDrag(!0),Ue(this._dragStartTarget,wn,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!we(this._element,"leaflet-zoom-anim")))if(t.touches&&1!==t.touches.length)_n._dragging===this&&this.finishDrag();else if(!(_n._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(_n._dragging=this,this._preventOutline&&Oe(this._element),De(),ae(),this._moving))){this.fire("down");var e=t.touches?t.touches[0]:t,n=Be(this._element);this._startPoint=new P(e.clientX,e.clientY),this._startPos=Ae(this._element),this._parentScale=Fe(n);var r="mousedown"===t.type;ze(document,r?"mousemove":"touchmove",this._onMove,this),ze(document,r?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(t){if(this._enabled)if(t.touches&&t.touches.length>1)this._moved=!0;else{var e=t.touches&&1===t.touches.length?t.touches[0]:t,n=new P(e.clientX,e.clientY)._subtract(this._startPoint);(n.x||n.y)&&(Math.abs(n.x)+Math.abs(n.y)<this.options.clickTolerance||(n.x/=this._parentScale.x,n.y/=this._parentScale.y,$e(t),this._moved||(this.fire("dragstart"),this._moved=!0,_e(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),_e(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(n),this._moving=!0,this._lastEvent=t,this._updatePosition()))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),Re(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){Ee(document.body,"leaflet-dragging"),this._lastTarget&&(Ee(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Ue(document,"mousemove touchmove",this._onMove,this),Ue(document,"mouseup touchend touchcancel",this._onUp,this),Me(),se();var e=this._moved&&this._moving;this._moving=!1,_n._dragging=!1,e&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)})}});function En(t,e,n){var r,i,o,a,s,u,c,l,h,d=[1,4,2,8];for(i=0,c=t.length;i<c;i++)t[i]._code=Ln(t[i],e);for(a=0;a<4;a++){for(l=d[a],r=[],i=0,o=(c=t.length)-1;i<c;o=i++)s=t[i],u=t[o],s._code&l?u._code&l||((h=On(u,s,l,e,n))._code=Ln(h,e),r.push(h)):(u._code&l&&((h=On(u,s,l,e,n))._code=Ln(h,e),r.push(h)),r.push(s));t=r}return t}function Cn(t,e){var n,r,i,o,a,s,u,c,l;if(!t||0===t.length)throw new Error("latlngs not passed");jn(t)||(t=t[0]);var h=W([0,0]),d=j(t);d.getNorthWest().distanceTo(d.getSouthWest())*d.getNorthEast().distanceTo(d.getNorthWest())<1700&&(h=In(t));var p=t.length,f=[];for(n=0;n<p;n++){var m=W(t[n]);f.push(e.project(W([m.lat-h.lat,m.lng-h.lng])))}for(s=u=c=0,n=0,r=p-1;n<p;r=n++)i=f[n],o=f[r],a=i.y*o.x-o.y*i.x,u+=(i.x+o.x)*a,c+=(i.y+o.y)*a,s+=3*a;l=0===s?f[0]:[u/s,c/s];var v=e.unproject(M(l));return W([v.lat+h.lat,v.lng+h.lng])}function In(t){for(var e=0,n=0,r=0,i=0;i<t.length;i++){var o=W(t[i]);e+=o.lat,n+=o.lng,r++}return W([e/r,n/r])}var Sn,kn={__proto__:null,clipPolygon:En,polygonCenter:Cn,centroid:In};function Tn(t,e){if(!e||!t.length)return t.slice();var n=e*e;return t=An(t=Dn(t,n),n)}function Nn(t,e,n){return Math.sqrt(Fn(t,e,n,!0))}function Rn(t,e,n){return Fn(t,e,n)}function An(t,e){var n=t.length,r=new("undefined"!=typeof Uint8Array?Uint8Array:Array)(n);r[0]=r[n-1]=1,Pn(t,r,e,0,n-1);var i,o=[];for(i=0;i<n;i++)r[i]&&o.push(t[i]);return o}function Pn(t,e,n,r,i){var o,a,s,u=0;for(a=r+1;a<=i-1;a++)(s=Fn(t[a],t[r],t[i],!0))>u&&(o=a,u=s);u>n&&(e[o]=1,Pn(t,e,n,r,o),Pn(t,e,n,o,i))}function Dn(t,e){for(var n=[t[0]],r=1,i=0,o=t.length;r<o;r++)Bn(t[r],t[i])>e&&(n.push(t[r]),i=r);return i<o-1&&n.push(t[o-1]),n}function Mn(t,e,n,r,i){var o,a,s,u=r?Sn:Ln(t,n),c=Ln(e,n);for(Sn=c;;){if(!(u|c))return[t,e];if(u&c)return!1;s=Ln(a=On(t,e,o=u||c,n,i),n),o===u?(t=a,u=s):(e=a,c=s)}}function On(t,e,n,r,i){var o,a,s=e.x-t.x,u=e.y-t.y,c=r.min,l=r.max;return 8&n?(o=t.x+s*(l.y-t.y)/u,a=l.y):4&n?(o=t.x+s*(c.y-t.y)/u,a=c.y):2&n?(o=l.x,a=t.y+u*(l.x-t.x)/s):1&n&&(o=c.x,a=t.y+u*(c.x-t.x)/s),new P(o,a,i)}function Ln(t,e){var n=0;return t.x<e.min.x?n|=1:t.x>e.max.x&&(n|=2),t.y<e.min.y?n|=4:t.y>e.max.y&&(n|=8),n}function Bn(t,e){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r}function Fn(t,e,n,r){var i,o=e.x,a=e.y,s=n.x-o,u=n.y-a,c=s*s+u*u;return c>0&&((i=((t.x-o)*s+(t.y-a)*u)/c)>1?(o=n.x,a=n.y):i>0&&(o+=s*i,a+=u*i)),s=t.x-o,u=t.y-a,r?s*s+u*u:new P(o,a)}function jn(t){return!g(t[0])||"object"!=typeof t[0][0]&&void 0!==t[0][0]}function zn(t){return jn(t)}function Wn(t,e){var n,r,i,o,a,s,u,c;if(!t||0===t.length)throw new Error("latlngs not passed");jn(t)||(t=t[0]);var l=W([0,0]),h=j(t);h.getNorthWest().distanceTo(h.getSouthWest())*h.getNorthEast().distanceTo(h.getNorthWest())<1700&&(l=In(t));var d=t.length,p=[];for(n=0;n<d;n++){var f=W(t[n]);p.push(e.project(W([f.lat-l.lat,f.lng-l.lng])))}for(n=0,r=0;n<d-1;n++)r+=p[n].distanceTo(p[n+1])/2;if(0===r)c=p[0];else for(n=0,o=0;n<d-1;n++)if(a=p[n],s=p[n+1],(o+=i=a.distanceTo(s))>r){u=(o-r)/i,c=[s.x-u*(s.x-a.x),s.y-u*(s.y-a.y)];break}var m=e.unproject(M(c));return W([m.lat+l.lat,m.lng+l.lng])}var Un={__proto__:null,simplify:Tn,pointToSegmentDistance:Nn,closestPointOnSegment:Rn,clipSegment:Mn,_getEdgeIntersection:On,_getBitCode:Ln,_sqClosestPointOnSegment:Fn,isFlat:jn,_flat:zn,polylineCenter:Wn},Vn={project:function(t){return new P(t.lng,t.lat)},unproject:function(t){return new z(t.y,t.x)},bounds:new O([-180,-90],[180,90])},Hn={R:6378137,R_MINOR:6356752.314245179,bounds:new O([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,n=this.R,r=t.lat*e,i=this.R_MINOR/n,o=Math.sqrt(1-i*i),a=o*Math.sin(r),s=Math.tan(Math.PI/4-r/2)/Math.pow((1-a)/(1+a),o/2);return r=-n*Math.log(Math.max(s,1e-10)),new P(t.lng*e*n,r)},unproject:function(t){for(var e,n=180/Math.PI,r=this.R,i=this.R_MINOR/r,o=Math.sqrt(1-i*i),a=Math.exp(-t.y/r),s=Math.PI/2-2*Math.atan(a),u=0,c=.1;u<15&&Math.abs(c)>1e-7;u++)e=o*Math.sin(s),e=Math.pow((1-e)/(1+e),o/2),s+=c=Math.PI/2-2*Math.atan(a*e)-s;return new z(s*n,t.x*n/r)}},Gn={__proto__:null,LonLat:Vn,Mercator:Hn,SphericalMercator:q},qn=n({},H,{code:"EPSG:3395",projection:Hn,transformation:function(){var t=.5/(Math.PI*Hn.R);return Z(t,.5,-t,.5)}()}),Kn=n({},H,{code:"EPSG:4326",projection:Vn,transformation:Z(1/180,1,-1/180,.5)}),Zn=n({},V,{projection:Vn,transformation:Z(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var n=e.lng-t.lng,r=e.lat-t.lat;return Math.sqrt(n*n+r*r)},infinite:!0});V.Earth=H,V.EPSG3395=qn,V.EPSG3857=$,V.EPSG900913=Y,V.EPSG4326=Kn,V.Simple=Zn;var Xn=A.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[a(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[a(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var n=this.getEvents();e.on(n,this),this.once("remove",function(){e.off(n,this)},this)}this.onAdd(e),this.fire("add"),e.fire("layeradd",{layer:this})}}});an.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=a(t);return this._layers[e]||(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t)),this},removeLayer:function(t){var e=a(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return a(t)in this._layers},eachLayer:function(t,e){for(var n in this._layers)t.call(e,this._layers[n]);return this},_addLayers:function(t){for(var e=0,n=(t=t?g(t)?t:[t]:[]).length;e<n;e++)this.addLayer(t[e])},_addZoomLimit:function(t){isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[a(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=a(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,n=this._getZoomSpan();for(var r in this._zoomBoundLayers){var i=this._zoomBoundLayers[r].options;t=void 0===i.minZoom?t:Math.min(t,i.minZoom),e=void 0===i.maxZoom?e:Math.max(e,i.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var $n=Xn.extend({initialize:function(t,e){var n,r;if(p(this,e),this._layers={},t)for(n=0,r=t.length;n<r;n++)this.addLayer(t[n])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return("number"==typeof t?t:this.getLayerId(t))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e,n,r=Array.prototype.slice.call(arguments,1);for(e in this._layers)(n=this._layers[e])[t]&&n[t].apply(n,r);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var n in this._layers)t.call(e,this._layers[n]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return a(t)}}),Yn=function(t,e){return new $n(t,e)},Jn=$n.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),$n.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),$n.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new F;for(var e in this._layers){var n=this._layers[e];t.extend(n.getBounds?n.getBounds():n.getLatLng())}return t}}),Qn=function(t,e){return new Jn(t,e)},tr=T.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){p(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var n=this._getIconUrl(t);if(!n){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var r=this._createImg(n,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(r,t),(this.options.crossOrigin||""===this.options.crossOrigin)&&(r.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),r},_setIconStyles:function(t,e){var n=this.options,r=n[e+"Size"];"number"==typeof r&&(r=[r,r]);var i=M(r),o=M("shadow"===e&&n.shadowAnchor||n.iconAnchor||i&&i.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(n.className||""),o&&(t.style.marginLeft=-o.x+"px",t.style.marginTop=-o.y+"px"),i&&(t.style.width=i.x+"px",t.style.height=i.y+"px")},_createImg:function(t,e){return(e=e||document.createElement("img")).src=t,e},_getIconUrl:function(t){return jt.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}});function er(t){return new tr(t)}var nr=tr.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return"string"!=typeof nr.imagePath&&(nr.imagePath=this._detectIconPath()),(this.options.imagePath||nr.imagePath)+tr.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var e=function(t,e,n){var r=e.exec(t);return r&&r[n]};return(t=e(t,/^url\((['"])?(.+)\1\)$/,2))&&e(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=ve("div","leaflet-default-icon-path",document.body),e=me(t,"background-image")||me(t,"backgroundImage");if(document.body.removeChild(t),e=this._stripUrl(e))return e;var n=document.querySelector('link[href$="leaflet.css"]');return n?n.href.substring(0,n.href.length-11-1):""}}),rr=xn.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new _n(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),_e(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Ee(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,n=e._map,r=this._marker.options.autoPanSpeed,i=this._marker.options.autoPanPadding,o=Ae(e._icon),a=n.getPixelBounds(),s=n.getPixelOrigin(),u=B(a.min._subtract(s).add(i),a.max._subtract(s).subtract(i));if(!u.contains(o)){var c=M((Math.max(u.max.x,o.x)-u.max.x)/(a.max.x-u.max.x)-(Math.min(u.min.x,o.x)-u.min.x)/(a.min.x-u.min.x),(Math.max(u.max.y,o.y)-u.max.y)/(a.max.y-u.max.y)-(Math.min(u.min.y,o.y)-u.min.y)/(a.min.y-u.min.y)).multiplyBy(r);n.panBy(c,{animate:!1}),this._draggable._newPos._add(c),this._draggable._startPos._add(c),Re(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=I(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(S(this._panRequest),this._panRequest=I(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,n=e._shadow,r=Ae(e._icon),i=e._map.layerPointToLatLng(r);n&&Re(n,r),e._latlng=i,t.latlng=i,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){S(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),ir=Xn.extend({options:{icon:new nr,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){p(this,e),this._latlng=W(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=W(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),n=t.icon.createIcon(this._icon),r=!1;n!==this._icon&&(this._icon&&this._removeIcon(),r=!0,t.title&&(n.title=t.title),"IMG"===n.tagName&&(n.alt=t.alt||"")),_e(n,e),t.keyboard&&(n.tabIndex="0",n.setAttribute("role","button")),this._icon=n,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ze(n,"focus",this._panOnFocus,this);var i=t.icon.createShadow(this._shadow),o=!1;i!==this._shadow&&(this._removeShadow(),o=!0),i&&(_e(i,e),i.alt=""),this._shadow=i,t.opacity<1&&this._updateOpacity(),r&&this.getPane().appendChild(this._icon),this._initInteraction(),i&&o&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ue(this._icon,"focus",this._panOnFocus,this),ge(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&ge(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&Re(this._icon,t),this._shadow&&Re(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(_e(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),rr)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new rr(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&Se(this._icon,t),this._shadow&&Se(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var e=this.options.icon.options,n=e.iconSize?M(e.iconSize):M(0,0),r=e.iconAnchor?M(e.iconAnchor):M(0,0);t.panInside(this._latlng,{paddingTopLeft:r,paddingBottomRight:n.subtract(r)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function or(t,e){return new ir(t,e)}var ar=Xn.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return p(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),sr=ar.extend({options:{fill:!0,radius:10},initialize:function(t,e){p(this,e),this._latlng=W(t),this._radius=this.options.radius},setLatLng:function(t){var e=this._latlng;return this._latlng=W(t),this.redraw(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return ar.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,n=this._clickTolerance(),r=[t+n,e+n];this._pxBounds=new O(this._point.subtract(r),this._point.add(r))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function ur(t,e){return new sr(t,e)}var cr=sr.extend({initialize:function(t,e,r){if("number"==typeof e&&(e=n({},r,{radius:e})),p(this,e),this._latlng=W(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new F(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:ar.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,n=this._map,r=n.options.crs;if(r.distance===H.distance){var i=Math.PI/180,o=this._mRadius/H.R/i,a=n.project([e+o,t]),s=n.project([e-o,t]),u=a.add(s).divideBy(2),c=n.unproject(u).lat,l=Math.acos((Math.cos(o*i)-Math.sin(e*i)*Math.sin(c*i))/(Math.cos(e*i)*Math.cos(c*i)))/i;(isNaN(l)||0===l)&&(l=o/Math.cos(Math.PI/180*e)),this._point=u.subtract(n.getPixelOrigin()),this._radius=isNaN(l)?0:u.x-n.project([c,t-l]).x,this._radiusY=u.y-a.y}else{var h=r.unproject(r.project(this._latlng).subtract([this._mRadius,0]));this._point=n.latLngToLayerPoint(this._latlng),this._radius=this._point.x-n.latLngToLayerPoint(h).x}this._updateBounds()}});function lr(t,e,n){return new cr(t,e,n)}var hr=ar.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){p(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,n,r=1/0,i=null,o=Fn,a=0,s=this._parts.length;a<s;a++)for(var u=this._parts[a],c=1,l=u.length;c<l;c++){var h=o(t,e=u[c-1],n=u[c],!0);h<r&&(r=h,i=o(t,e,n))}return i&&(i.distance=Math.sqrt(r)),i},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Wn(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=W(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new F,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return jn(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],n=jn(t),r=0,i=t.length;r<i;r++)n?(e[r]=W(t[r]),this._bounds.extend(e[r])):e[r]=this._convertLatLngs(t[r]);return e},_project:function(){var t=new O;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),e=new P(t,t);this._rawPxBounds&&(this._pxBounds=new O([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)]))},_projectLatlngs:function(t,e,n){var r,i,o=t[0]instanceof z,a=t.length;if(o){for(i=[],r=0;r<a;r++)i[r]=this._map.latLngToLayerPoint(t[r]),n.extend(i[r]);e.push(i)}else for(r=0;r<a;r++)this._projectLatlngs(t[r],e,n)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else{var e,n,r,i,o,a,s,u=this._parts;for(e=0,r=0,i=this._rings.length;e<i;e++)for(n=0,o=(s=this._rings[e]).length;n<o-1;n++)(a=Mn(s[n],s[n+1],t,n,!0))&&(u[r]=u[r]||[],u[r].push(a[0]),a[1]===s[n+1]&&n!==o-2||(u[r].push(a[1]),r++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,n=0,r=t.length;n<r;n++)t[n]=Tn(t[n],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var n,r,i,o,a,s,u=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(n=0,o=this._parts.length;n<o;n++)for(r=0,i=(a=(s=this._parts[n]).length)-1;r<a;i=r++)if((e||0!==r)&&Nn(t,s[i],s[r])<=u)return!0;return!1}});function dr(t,e){return new hr(t,e)}hr._flat=zn;var pr=hr.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Cn(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var e=hr.prototype._convertLatLngs.call(this,t),n=e.length;return n>=2&&e[0]instanceof z&&e[0].equals(e[n-1])&&e.pop(),e},_setLatLngs:function(t){hr.prototype._setLatLngs.call(this,t),jn(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return jn(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,n=new P(e,e);if(t=new O(t.min.subtract(n),t.max.add(n)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t))if(this.options.noClip)this._parts=this._rings;else for(var r,i=0,o=this._rings.length;i<o;i++)(r=En(this._rings[i],t,!0)).length&&this._parts.push(r)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e,n,r,i,o,a,s,u,c=!1;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(i=0,s=this._parts.length;i<s;i++)for(o=0,a=(u=(e=this._parts[i]).length)-1;o<u;a=o++)n=e[o],r=e[a],n.y>t.y!=r.y>t.y&&t.x<(r.x-n.x)*(t.y-n.y)/(r.y-n.y)+n.x&&(c=!c);return c||hr.prototype._containsPoint.call(this,t,!0)}});function fr(t,e){return new pr(t,e)}var mr=Jn.extend({initialize:function(t,e){p(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,n,r,i=g(t)?t:t.features;if(i){for(e=0,n=i.length;e<n;e++)((r=i[e]).geometries||r.geometry||r.features||r.coordinates)&&this.addData(r);return this}var o=this.options;if(o.filter&&!o.filter(t))return this;var a=vr(t,o);return a?(a.feature=Er(t),a.defaultOptions=a.options,this.resetStyle(a),o.onEachFeature&&o.onEachFeature(t,a),this.addLayer(a)):this},resetStyle:function(t){return void 0===t?this.eachLayer(this.resetStyle,this):(t.options=n({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){t.setStyle&&("function"==typeof e&&(e=e(t.feature)),t.setStyle(e))}});function vr(t,e){var n,r,i,o,a="Feature"===t.type?t.geometry:t,s=a?a.coordinates:null,u=[],c=e&&e.pointToLayer,l=e&&e.coordsToLatLng||yr;if(!s&&!a)return null;switch(a.type){case"Point":return gr(c,t,n=l(s),e);case"MultiPoint":for(i=0,o=s.length;i<o;i++)n=l(s[i]),u.push(gr(c,t,n,e));return new Jn(u);case"LineString":case"MultiLineString":return r=xr(s,"LineString"===a.type?0:1,l),new hr(r,e);case"Polygon":case"MultiPolygon":return r=xr(s,"Polygon"===a.type?1:2,l),new pr(r,e);case"GeometryCollection":for(i=0,o=a.geometries.length;i<o;i++){var h=vr({geometry:a.geometries[i],type:"Feature",properties:t.properties},e);h&&u.push(h)}return new Jn(u);case"FeatureCollection":for(i=0,o=a.features.length;i<o;i++){var d=vr(a.features[i],e);d&&u.push(d)}return new Jn(u);default:throw new Error("Invalid GeoJSON object.")}}function gr(t,e,n,r){return t?t(e,n):new ir(n,r&&r.markersInheritOptions&&r)}function yr(t){return new z(t[1],t[0],t[2])}function xr(t,e,n){for(var r,i=[],o=0,a=t.length;o<a;o++)r=e?xr(t[o],e-1,n):(n||yr)(t[o]),i.push(r);return i}function br(t,e){return void 0!==(t=W(t)).alt?[l(t.lng,e),l(t.lat,e),l(t.alt,e)]:[l(t.lng,e),l(t.lat,e)]}function wr(t,e,n,r){for(var i=[],o=0,a=t.length;o<a;o++)i.push(e?wr(t[o],jn(t[o])?0:e-1,n,r):br(t[o],r));return!e&&n&&i.length>0&&i.push(i[0].slice()),i}function _r(t,e){return t.feature?n({},t.feature,{geometry:e}):Er(e)}function Er(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}var Cr={toGeoJSON:function(t){return _r(this,{type:"Point",coordinates:br(this.getLatLng(),t)})}};function Ir(t,e){return new mr(t,e)}ir.include(Cr),cr.include(Cr),sr.include(Cr),hr.include({toGeoJSON:function(t){var e=!jn(this._latlngs);return _r(this,{type:(e?"Multi":"")+"LineString",coordinates:wr(this._latlngs,e?1:0,!1,t)})}}),pr.include({toGeoJSON:function(t){var e=!jn(this._latlngs),n=e&&!jn(this._latlngs[0]),r=wr(this._latlngs,n?2:e?1:0,!0,t);return e||(r=[r]),_r(this,{type:(n?"Multi":"")+"Polygon",coordinates:r})}}),$n.include({toMultiPoint:function(t){var e=[];return this.eachLayer(function(n){e.push(n.toGeoJSON(t).geometry.coordinates)}),_r(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===e)return this.toMultiPoint(t);var n="GeometryCollection"===e,r=[];return this.eachLayer(function(e){if(e.toGeoJSON){var i=e.toGeoJSON(t);if(n)r.push(i.geometry);else{var o=Er(i);"FeatureCollection"===o.type?r.push.apply(r,o.features):r.push(o)}}}),n?_r(this,{geometries:r,type:"GeometryCollection"}):{type:"FeatureCollection",features:r}}});var Sr=Ir,kr=Xn.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,n){this._url=t,this._bounds=j(e),p(this,n)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(_e(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){ge(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&xe(this._image),this},bringToBack:function(){return this._map&&be(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=j(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,e=this._image=t?this._url:ve("img");_e(e,"leaflet-image-layer"),this._zoomAnimated&&_e(e,"leaflet-zoom-animated"),this.options.className&&_e(e,this.options.className),e.onselectstart=c,e.onmousemove=c,e.onload=i(this.fire,this,"load"),e.onerror=i(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(e.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t?this._url=e.src:(e.src=this._url,e.alt=this.options.alt)},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;Ne(this._image,n,e)},_reset:function(){var t=this._image,e=new O(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),n=e.getSize();Re(t,e.min),t.style.width=n.x+"px",t.style.height=n.y+"px"},_updateOpacity:function(){Se(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}}),Tr=function(t,e,n){return new kr(t,e,n)},Nr=kr.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t="VIDEO"===this._url.tagName,e=this._image=t?this._url:ve("video");if(_e(e,"leaflet-image-layer"),this._zoomAnimated&&_e(e,"leaflet-zoom-animated"),this.options.className&&_e(e,this.options.className),e.onselectstart=c,e.onmousemove=c,e.onloadeddata=i(this.fire,this,"load"),t){for(var n=e.getElementsByTagName("source"),r=[],o=0;o<n.length;o++)r.push(n[o].src);this._url=n.length>0?r:[e.src]}else{g(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(e.style,"objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop,e.muted=!!this.options.muted,e.playsInline=!!this.options.playsInline;for(var a=0;a<this._url.length;a++){var s=ve("source");s.src=this._url[a],e.appendChild(s)}}}});function Rr(t,e,n){return new Nr(t,e,n)}var Ar=kr.extend({_initImage:function(){var t=this._image=this._url;_e(t,"leaflet-image-layer"),this._zoomAnimated&&_e(t,"leaflet-zoom-animated"),this.options.className&&_e(t,this.options.className),t.onselectstart=c,t.onmousemove=c}});function Pr(t,e,n){return new Ar(t,e,n)}var Dr=Xn.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,e){t&&(t instanceof z||g(t))?(this._latlng=W(t),p(this,e)):(p(this,t),this._source=e),this.options.content&&(this._content=this.options.content)},openOn:function(t){return(t=arguments.length?t:this._source._map).hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&Se(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&Se(this._container,1),this.bringToFront(),this.options.interactive&&(_e(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(Se(this._container,0),this._removeTimeout=setTimeout(i(ge,void 0,this._container),200)):ge(this._container),this.options.interactive&&(Ee(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=W(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&xe(this._container),this},bringToBack:function(){return this._map&&be(this._container),this},_prepareOpen:function(t){var e=this._source;if(!e._map)return!1;if(e instanceof Jn){e=null;var n=this._source._layers;for(var r in n)if(n[r]._map){e=n[r];break}if(!e)return!1;this._source=e}if(!t)if(e.getCenter)t=e.getCenter();else if(e.getLatLng)t=e.getLatLng();else{if(!e.getBounds)throw new Error("Unable to get source layer LatLng.");t=e.getBounds().getCenter()}return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=M(this.options.offset),n=this._getAnchor();this._zoomAnimated?Re(this._container,t.add(n)):e=e.add(t).add(n);var r=this._containerBottom=-e.y,i=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=r+"px",this._container.style.left=i+"px"}},_getAnchor:function(){return[0,0]}});an.include({_initOverlay:function(t,e,n,r){var i=e;return i instanceof t||(i=new t(r).setContent(e)),n&&i.setLatLng(n),i}}),Xn.include({_initOverlay:function(t,e,n,r){var i=n;return i instanceof t?(p(i,r),i._source=this):(i=e&&!r?e:new t(r,this)).setContent(n),i}});var Mr=Dr.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return!(t=arguments.length?t:this._source._map).hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,Dr.prototype.openOn.call(this,t)},onAdd:function(t){Dr.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof ar||this._source.on("preclick",Ke))},onRemove:function(t){Dr.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof ar||this._source.off("preclick",Ke))},getEvents:function(){var t=Dr.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",e=this._container=ve("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),n=this._wrapper=ve("div",t+"-content-wrapper",e);if(this._contentNode=ve("div",t+"-content",n),Xe(e),Ze(this._contentNode),ze(e,"contextmenu",Ke),this._tipContainer=ve("div",t+"-tip-container",e),this._tip=ve("div",t+"-tip",this._tipContainer),this.options.closeButton){var r=this._closeButton=ve("a",t+"-close-button",e);r.setAttribute("role","button"),r.setAttribute("aria-label","Close popup"),r.href="#close",r.innerHTML='<span aria-hidden="true">&#215;</span>',ze(r,"click",function(t){$e(t),this.close()},this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var n=t.offsetWidth;n=Math.min(n,this.options.maxWidth),n=Math.max(n,this.options.minWidth),e.width=n+1+"px",e.whiteSpace="",e.height="";var r=t.offsetHeight,i=this.options.maxHeight,o="leaflet-popup-scrolled";i&&r>i?(e.height=i+"px",_e(t,o)):Ee(t,o),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),n=this._getAnchor();Re(this._container,e.add(n))},_adjustPan:function(){if(this.options.autoPan)if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)this._autopanning=!1;else{var t=this._map,e=parseInt(me(this._container,"marginBottom"),10)||0,n=this._container.offsetHeight+e,r=this._containerWidth,i=new P(this._containerLeft,-n-this._containerBottom);i._add(Ae(this._container));var o=t.layerPointToContainerPoint(i),a=M(this.options.autoPanPadding),s=M(this.options.autoPanPaddingTopLeft||a),u=M(this.options.autoPanPaddingBottomRight||a),c=t.getSize(),l=0,h=0;o.x+r+u.x>c.x&&(l=o.x+r-c.x+u.x),o.x-l-s.x<0&&(l=o.x-s.x),o.y+n+u.y>c.y&&(h=o.y+n-c.y+u.y),o.y-h-s.y<0&&(h=o.y-s.y),(l||h)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([l,h]))}},_getAnchor:function(){return M(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Or=function(t,e){return new Mr(t,e)};an.mergeOptions({closePopupOnClick:!0}),an.include({openPopup:function(t,e,n){return this._initOverlay(Mr,t,e,n).openOn(this),this},closePopup:function(t){return(t=arguments.length?t:this._popup)&&t.close(),this}}),Xn.include({bindPopup:function(t,e){return this._popup=this._initOverlay(Mr,this._popup,t,e),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&(this instanceof Jn||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(this._popup&&this._map){Ye(t);var e=t.layer||t.target;this._popup._source!==e||e instanceof ar?(this._popup._source=e,this.openPopup(t.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var Lr=Dr.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){Dr.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){Dr.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=Dr.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ve("div",t),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+a(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e,n,r=this._map,i=this._container,o=r.latLngToContainerPoint(r.getCenter()),a=r.layerPointToContainerPoint(t),s=this.options.direction,u=i.offsetWidth,c=i.offsetHeight,l=M(this.options.offset),h=this._getAnchor();"top"===s?(e=u/2,n=c):"bottom"===s?(e=u/2,n=0):"center"===s?(e=u/2,n=c/2):"right"===s?(e=0,n=c/2):"left"===s?(e=u,n=c/2):a.x<o.x?(s="right",e=0,n=c/2):(s="left",e=u+2*(l.x+h.x),n=c/2),t=t.subtract(M(e,n,!0)).add(l).add(h),Ee(i,"leaflet-tooltip-right"),Ee(i,"leaflet-tooltip-left"),Ee(i,"leaflet-tooltip-top"),Ee(i,"leaflet-tooltip-bottom"),_e(i,"leaflet-tooltip-"+s),Re(i,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&Se(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return M(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Br=function(t,e){return new Lr(t,e)};an.include({openTooltip:function(t,e,n){return this._initOverlay(Lr,t,e,n).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),Xn.include({bindTooltip:function(t,e){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Lr,this._tooltip,t,e),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",n={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?n.add=this._openTooltip:(n.mouseover=this._openTooltip,n.mouseout=this.closeTooltip,n.click=this._openTooltip,this._map?this._addFocusListeners():n.add=this._addFocusListeners),this._tooltip.options.sticky&&(n.mousemove=this._moveTooltip),this[e](n),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&(this instanceof Jn||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var e="function"==typeof t.getElement&&t.getElement();e&&(ze(e,"focus",function(){this._tooltip._source=t,this.openTooltip()},this),ze(e,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var e="function"==typeof t.getElement&&t.getElement();e&&e.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){if(this._tooltip&&this._map)if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var e=this;this._map.once("moveend",function(){e._openOnceFlag=!1,e._openTooltip(t)})}else this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0)},_moveTooltip:function(t){var e,n,r=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),n=this._map.containerPointToLayerPoint(e),r=this._map.layerPointToLatLng(n)),this._tooltip.setLatLng(r)}});var Fr=tr.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:document.createElement("div"),n=this.options;if(n.html instanceof Element?(ye(e),e.appendChild(n.html)):e.innerHTML=!1!==n.html?n.html:"",n.bgPos){var r=M(n.bgPos);e.style.backgroundPosition=-r.x+"px "+-r.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});function jr(t){return new Fr(t)}tr.Default=nr;var zr=Xn.extend({options:{tileSize:256,opacity:1,updateWhenIdle:jt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){p(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),ge(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(xe(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(be(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=s(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof P?t:new P(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,n=this.getPane().children,r=-t(-1/0,1/0),i=0,o=n.length;i<o;i++)e=n[i].style.zIndex,n[i]!==this._container&&e&&(r=t(r,+e));isFinite(r)&&(this.options.zIndex=r+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!jt.ielt9){Se(this._container,this.options.opacity);var t=+new Date,e=!1,n=!1;for(var r in this._tiles){var i=this._tiles[r];if(i.current&&i.loaded){var o=Math.min(1,(t-i.loaded)/200);Se(i.el,o),o<1?e=!0:(i.active?n=!0:this._onOpaqueTile(i),i.active=!0)}}n&&!this._noPrune&&this._pruneTiles(),e&&(S(this._fadeFrame),this._fadeFrame=I(this._updateOpacity,this))}},_onOpaqueTile:c,_initContainer:function(){this._container||(this._container=ve("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var n in this._levels)n=Number(n),this._levels[n].el.children.length||n===t?(this._levels[n].el.style.zIndex=e-Math.abs(t-n),this._onUpdateLevel(n)):(ge(this._levels[n].el),this._removeTilesAtZoom(n),this._onRemoveLevel(n),delete this._levels[n]);var r=this._levels[t],i=this._map;return r||((r=this._levels[t]={}).el=ve("div","leaflet-tile-container leaflet-zoom-animated",this._container),r.el.style.zIndex=e,r.origin=i.project(i.unproject(i.getPixelOrigin()),t).round(),r.zoom=t,this._setZoomTransform(r,i.getCenter(),i.getZoom()),c(r.el.offsetWidth),this._onCreateLevel(r)),this._level=r,r}},_onUpdateLevel:c,_onRemoveLevel:c,_onCreateLevel:c,_pruneTiles:function(){if(this._map){var t,e,n=this._map.getZoom();if(n>this.options.maxZoom||n<this.options.minZoom)this._removeAllTiles();else{for(t in this._tiles)(e=this._tiles[t]).retain=e.current;for(t in this._tiles)if((e=this._tiles[t]).current&&!e.active){var r=e.coords;this._retainParent(r.x,r.y,r.z,r.z-5)||this._retainChildren(r.x,r.y,r.z,r.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)ge(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,n,r){var i=Math.floor(t/2),o=Math.floor(e/2),a=n-1,s=new P(+i,+o);s.z=+a;var u=this._tileCoordsToKey(s),c=this._tiles[u];return c&&c.active?(c.retain=!0,!0):(c&&c.loaded&&(c.retain=!0),a>r&&this._retainParent(i,o,a,r))},_retainChildren:function(t,e,n,r){for(var i=2*t;i<2*t+2;i++)for(var o=2*e;o<2*e+2;o++){var a=new P(i,o);a.z=n+1;var s=this._tileCoordsToKey(a),u=this._tiles[s];u&&u.active?u.retain=!0:(u&&u.loaded&&(u.retain=!0),n+1<r&&this._retainChildren(i,o,n+1,r))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,n,r){var i=Math.round(e);i=void 0!==this.options.maxZoom&&i>this.options.maxZoom||void 0!==this.options.minZoom&&i<this.options.minZoom?void 0:this._clampZoom(i);var o=this.options.updateWhenZooming&&i!==this._tileZoom;r&&!o||(this._tileZoom=i,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==i&&this._update(t),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var n in this._levels)this._setZoomTransform(this._levels[n],t,e)},_setZoomTransform:function(t,e,n){var r=this._map.getZoomScale(n,t.zoom),i=t.origin.multiplyBy(r).subtract(this._map._getNewPixelOrigin(e,n)).round();jt.any3d?Ne(t.el,i,r):Re(t.el,i)},_resetGrid:function(){var t=this._map,e=t.options.crs,n=this._tileSize=this.getTileSize(),r=this._tileZoom,i=this._map.getPixelWorldBounds(this._tileZoom);i&&(this._globalTileRange=this._pxBoundsToTileRange(i)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],r).x/n.x),Math.ceil(t.project([0,e.wrapLng[1]],r).x/n.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],r).y/n.x),Math.ceil(t.project([e.wrapLat[1],0],r).y/n.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,n=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),r=e.getZoomScale(n,this._tileZoom),i=e.project(t,this._tileZoom).floor(),o=e.getSize().divideBy(2*r);return new O(i.subtract(o),i.add(o))},_update:function(t){var e=this._map;if(e){var n=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter()),void 0!==this._tileZoom){var r=this._getTiledPixelBounds(t),i=this._pxBoundsToTileRange(r),o=i.getCenter(),a=[],s=this.options.keepBuffer,u=new O(i.getBottomLeft().subtract([s,-s]),i.getTopRight().add([s,-s]));if(!(isFinite(i.min.x)&&isFinite(i.min.y)&&isFinite(i.max.x)&&isFinite(i.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var c in this._tiles){var l=this._tiles[c].coords;l.z===this._tileZoom&&u.contains(new P(l.x,l.y))||(this._tiles[c].current=!1)}if(Math.abs(n-this._tileZoom)>1)this._setView(t,n);else{for(var h=i.min.y;h<=i.max.y;h++)for(var d=i.min.x;d<=i.max.x;d++){var p=new P(d,h);if(p.z=this._tileZoom,this._isValidTile(p)){var f=this._tiles[this._tileCoordsToKey(p)];f?f.current=!0:a.push(p)}}if(a.sort(function(t,e){return t.distanceTo(o)-e.distanceTo(o)}),0!==a.length){this._loading||(this._loading=!0,this.fire("loading"));var m=document.createDocumentFragment();for(d=0;d<a.length;d++)this._addTile(a[d],m);this._level.el.appendChild(m)}}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var n=this._globalTileRange;if(!e.wrapLng&&(t.x<n.min.x||t.x>n.max.x)||!e.wrapLat&&(t.y<n.min.y||t.y>n.max.y))return!1}if(!this.options.bounds)return!0;var r=this._tileCoordsToBounds(t);return j(this.options.bounds).overlaps(r)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,n=this.getTileSize(),r=t.scaleBy(n),i=r.add(n);return[e.unproject(r,t.z),e.unproject(i,t.z)]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),n=new F(e[0],e[1]);return this.options.noWrap||(n=this._map.wrapLatLngBounds(n)),n},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),n=new P(+e[0],+e[1]);return n.z=+e[2],n},_removeTile:function(t){var e=this._tiles[t];e&&(ge(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){_e(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=c,t.onmousemove=c,jt.ielt9&&this.options.opacity<1&&Se(t,this.options.opacity)},_addTile:function(t,e){var n=this._getTilePos(t),r=this._tileCoordsToKey(t),o=this.createTile(this._wrapCoords(t),i(this._tileReady,this,t));this._initTile(o),this.createTile.length<2&&I(i(this._tileReady,this,t,null,o)),Re(o,n),this._tiles[r]={el:o,coords:t,current:!0},e.appendChild(o),this.fire("tileloadstart",{tile:o,coords:t})},_tileReady:function(t,e,n){e&&this.fire("tileerror",{error:e,tile:n,coords:t});var r=this._tileCoordsToKey(t);(n=this._tiles[r])&&(n.loaded=+new Date,this._map._fadeAnimated?(Se(n.el,0),S(this._fadeFrame),this._fadeFrame=I(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),e||(_e(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),jt.ielt9||!this._map._fadeAnimated?I(this._pruneTiles,this):setTimeout(i(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new P(this._wrapX?u(t.x,this._wrapX):t.x,this._wrapY?u(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new O(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}});function Wr(t){return new zr(t)}var Ur=zr.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,e){this._url=t,(e=p(this,e)).detectRetina&&jt.retina&&e.maxZoom>0?(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom=Math.min(e.maxZoom,e.minZoom+1)):(e.zoomOffset++,e.maxZoom=Math.max(e.minZoom,e.maxZoom-1)),e.minZoom=Math.max(0,e.minZoom)):e.zoomReverse?e.minZoom=Math.min(e.maxZoom,e.minZoom):e.maxZoom=Math.max(e.minZoom,e.maxZoom),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&void 0===e&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var n=document.createElement("img");return ze(n,"load",i(this._tileOnLoad,this,e,n)),ze(n,"error",i(this._tileOnError,this,e,n)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(n.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"==typeof this.options.referrerPolicy&&(n.referrerPolicy=this.options.referrerPolicy),n.alt="",n.src=this.getTileUrl(t),n},getTileUrl:function(t){var e={r:jt.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var r=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=r),e["-y"]=r}return v(this._url,n(e,this.options))},_tileOnLoad:function(t,e){jt.ielt9?setTimeout(i(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,n){var r=this.options.errorTileUrl;r&&e.getAttribute("src")!==r&&(e.src=r),t(n,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom;return this.options.zoomReverse&&(t=e-t),t+this.options.zoomOffset},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&((e=this._tiles[t].el).onload=c,e.onerror=c,!e.complete)){e.src=x;var n=this._tiles[t].coords;ge(e),delete this._tiles[t],this.fire("tileabort",{tile:e,coords:n})}},_removeTile:function(t){var e=this._tiles[t];if(e)return e.el.setAttribute("src",x),zr.prototype._removeTile.call(this,t)},_tileReady:function(t,e,n){if(this._map&&(!n||n.getAttribute("src")!==x))return zr.prototype._tileReady.call(this,t,e,n)}});function Vr(t,e){return new Ur(t,e)}var Hr=Ur.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var r=n({},this.defaultWmsParams);for(var i in e)i in this.options||(r[i]=e[i]);var o=(e=p(this,e)).detectRetina&&jt.retina?2:1,a=this.getTileSize();r.width=a.x*o,r.height=a.y*o,this.wmsParams=r},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,Ur.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),n=this._crs,r=B(n.project(e[0]),n.project(e[1])),i=r.min,o=r.max,a=(this._wmsVersion>=1.3&&this._crs===Kn?[i.y,i.x,o.y,o.x]:[i.x,i.y,o.x,o.y]).join(","),s=Ur.prototype.getTileUrl.call(this,t);return s+f(this.wmsParams,s,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+a},setParams:function(t,e){return n(this.wmsParams,t),e||this.redraw(),this}});function Gr(t,e){return new Hr(t,e)}Ur.WMS=Hr,Vr.wms=Gr;var qr=Xn.extend({options:{padding:.1},initialize:function(t){p(this,t),a(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),_e(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var n=this._map.getZoomScale(e,this._zoom),r=this._map.getSize().multiplyBy(.5+this.options.padding),i=this._map.project(this._center,e),o=r.multiplyBy(-n).add(i).subtract(this._map._getNewPixelOrigin(t,e));jt.any3d?Ne(this._container,o,n):Re(this._container,o)},_reset:function(){for(var t in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),n=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new O(n,n.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Kr=qr.extend({options:{tolerance:0},getEvents:function(){var t=qr.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){qr.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");ze(t,"mousemove",this._onMouseMove,this),ze(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),ze(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){S(this._redrawRequest),delete this._ctx,ge(this._container),Ue(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var t in this._redrawBounds=null,this._layers)this._layers[t]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){qr.prototype._update.call(this);var t=this._bounds,e=this._container,n=t.getSize(),r=jt.retina?2:1;Re(e,t.min),e.width=r*n.x,e.height=r*n.y,e.style.width=n.x+"px",e.style.height=n.y+"px",jt.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){qr.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[a(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,n=e.next,r=e.prev;n?n.prev=r:this._drawLast=r,r?r.next=n:this._drawFirst=n,delete t._order,delete this._layers[a(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if("string"==typeof t.options.dashArray){var e,n,r=t.options.dashArray.split(/[, ]+/),i=[];for(n=0;n<r.length;n++){if(e=Number(r[n]),isNaN(e))return;i.push(e)}t.options._dashArray=i}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||I(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new O,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var n=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,n.x,n.y),this._ctx.clip()}this._drawing=!0;for(var r=this._drawFirst;r;r=r.next)t=r.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var n,r,i,o,a=t._parts,s=a.length,u=this._ctx;if(s){for(u.beginPath(),n=0;n<s;n++){for(r=0,i=a[n].length;r<i;r++)o=a[n][r],u[r?"lineTo":"moveTo"](o.x,o.y);e&&u.closePath()}this._fillStroke(u,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,n=this._ctx,r=Math.max(Math.round(t._radius),1),i=(Math.max(Math.round(t._radiusY),1)||r)/r;1!==i&&(n.save(),n.scale(1,i)),n.beginPath(),n.arc(e.x,e.y/i,r,0,2*Math.PI,!1),1!==i&&n.restore(),this._fillStroke(n,t)}},_fillStroke:function(t,e){var n=e.options;n.fill&&(t.globalAlpha=n.fillOpacity,t.fillStyle=n.fillColor||n.color,t.fill(n.fillRule||"evenodd")),n.stroke&&0!==n.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=n.opacity,t.lineWidth=n.weight,t.strokeStyle=n.color,t.lineCap=n.lineCap,t.lineJoin=n.lineJoin,t.stroke())},_onClick:function(t){for(var e,n,r=this._map.mouseEventToLayerPoint(t),i=this._drawFirst;i;i=i.next)(e=i.layer).options.interactive&&e._containsPoint(r)&&("click"!==t.type&&"preclick"!==t.type||!this._map._draggableMoved(e))&&(n=e);this._fireEvent(!!n&&[n],t)},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(Ee(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,e){if(!this._mouseHoverThrottled){for(var n,r,o=this._drawFirst;o;o=o.next)(n=o.layer).options.interactive&&n._containsPoint(e)&&(r=n);r!==this._hoveredLayer&&(this._handleMouseOut(t),r&&(_e(this._container,"leaflet-interactive"),this._fireEvent([r],t,"mouseover"),this._hoveredLayer=r)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],t),this._mouseHoverThrottled=!0,setTimeout(i(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(t,e,n){this._map._fireDOMEvent(e,n||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var n=e.next,r=e.prev;n&&(n.prev=r,r?r.next=n:n&&(this._drawFirst=n),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))}},_bringToBack:function(t){var e=t._order;if(e){var n=e.next,r=e.prev;r&&(r.next=n,n?n.prev=r:r&&(this._drawLast=r),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}});function Zr(t){return jt.canvas?new Kr(t):null}var Xr=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),$r={_initContainer:function(){this._container=ve("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(qr.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=Xr("shape");_e(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=Xr("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[a(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;ge(e),t.removeInteractiveTarget(e),delete this._layers[a(t)]},_updateStyle:function(t){var e=t._stroke,n=t._fill,r=t.options,i=t._container;i.stroked=!!r.stroke,i.filled=!!r.fill,r.stroke?(e||(e=t._stroke=Xr("stroke")),i.appendChild(e),e.weight=r.weight+"px",e.color=r.color,e.opacity=r.opacity,r.dashArray?e.dashStyle=g(r.dashArray)?r.dashArray.join(" "):r.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=r.lineCap.replace("butt","flat"),e.joinstyle=r.lineJoin):e&&(i.removeChild(e),t._stroke=null),r.fill?(n||(n=t._fill=Xr("fill")),i.appendChild(n),n.color=r.fillColor||r.color,n.opacity=r.fillOpacity):n&&(i.removeChild(n),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),n=Math.round(t._radius),r=Math.round(t._radiusY||n);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+n+","+r+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){xe(t._container)},_bringToBack:function(t){be(t._container)}},Yr=jt.vml?Xr:J,Jr=qr.extend({_initContainer:function(){this._container=Yr("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Yr("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){ge(this._container),Ue(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){qr.prototype._update.call(this);var t=this._bounds,e=t.getSize(),n=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,n.setAttribute("width",e.x),n.setAttribute("height",e.y)),Re(n,t.min),n.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=Yr("path");t.options.className&&_e(e,t.options.className),t.options.interactive&&_e(e,"leaflet-interactive"),this._updateStyle(t),this._layers[a(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){ge(t._path),t.removeInteractiveTarget(t._path),delete this._layers[a(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,n=t.options;e&&(n.stroke?(e.setAttribute("stroke",n.color),e.setAttribute("stroke-opacity",n.opacity),e.setAttribute("stroke-width",n.weight),e.setAttribute("stroke-linecap",n.lineCap),e.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?e.setAttribute("stroke-dasharray",n.dashArray):e.removeAttribute("stroke-dasharray"),n.dashOffset?e.setAttribute("stroke-dashoffset",n.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),n.fill?(e.setAttribute("fill",n.fillColor||n.color),e.setAttribute("fill-opacity",n.fillOpacity),e.setAttribute("fill-rule",n.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,Q(t._parts,e))},_updateCircle:function(t){var e=t._point,n=Math.max(Math.round(t._radius),1),r="a"+n+","+(Math.max(Math.round(t._radiusY),1)||n)+" 0 1,0 ",i=t._empty()?"M0 0":"M"+(e.x-n)+","+e.y+r+2*n+",0 "+r+2*-n+",0 ";this._setPath(t,i)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){xe(t._path)},_bringToBack:function(t){be(t._path)}});function Qr(t){return jt.svg||jt.vml?new Jr(t):null}jt.vml&&Jr.include($r),an.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&Zr(t)||Qr(t)}});var ti=pr.extend({initialize:function(t,e){pr.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return[(t=j(t)).getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});function ei(t,e){return new ti(t,e)}Jr.create=Yr,Jr.pointsToPath=Q,mr.geometryToLayer=vr,mr.coordsToLatLng=yr,mr.coordsToLatLngs=xr,mr.latLngToCoords=br,mr.latLngsToCoords=wr,mr.getFeature=_r,mr.asFeature=Er,an.mergeOptions({boxZoom:!0});var ni=xn.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){ze(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ue(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){ge(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||1!==t.which&&1!==t.button)return!1;this._clearDeferredResetState(),this._resetState(),ae(),De(),this._startPoint=this._map.mouseEventToContainerPoint(t),ze(document,{contextmenu:Ye,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=ve("div","leaflet-zoom-box",this._container),_e(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new O(this._point,this._startPoint),n=e.getSize();Re(this._box,e.min),this._box.style.width=n.x+"px",this._box.style.height=n.y+"px"},_finish:function(){this._moved&&(ge(this._box),Ee(this._container,"leaflet-crosshair")),se(),Me(),Ue(document,{contextmenu:Ye,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(i(this._resetState,this),0);var e=new F(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});an.addInitHook("addHandler","boxZoom",ni),an.mergeOptions({doubleClickZoom:!0});var ri=xn.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,n=e.getZoom(),r=e.options.zoomDelta,i=t.originalEvent.shiftKey?n-r:n+r;"center"===e.options.doubleClickZoom?e.setZoom(i):e.setZoomAround(t.containerPoint,i)}});an.addInitHook("addHandler","doubleClickZoom",ri),an.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var ii=xn.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new _n(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}_e(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Ee(this._map._container,"leaflet-grab"),Ee(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=j(this._map.options.maxBounds);this._offsetLimit=B(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,n=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(n),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),n=this._initialWorldOffset,r=this._draggable._newPos.x,i=(r-e+n)%t+e-n,o=(r+e+n)%t-e-n,a=Math.abs(i+n)<Math.abs(o+n)?i:o;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=a},_onDragEnd:function(t){var e=this._map,n=e.options,r=!n.inertia||t.noInertia||this._times.length<2;if(e.fire("dragend",t),r)e.fire("moveend");else{this._prunePositions(+new Date);var i=this._lastPos.subtract(this._positions[0]),o=(this._lastTime-this._times[0])/1e3,a=n.easeLinearity,s=i.multiplyBy(a/o),u=s.distanceTo([0,0]),c=Math.min(n.inertiaMaxSpeed,u),l=s.multiplyBy(c/u),h=c/(n.inertiaDeceleration*a),d=l.multiplyBy(-h/2).round();d.x||d.y?(d=e._limitOffset(d,e.options.maxBounds),I(function(){e.panBy(d,{duration:h,easeLinearity:a,noMoveStart:!0,animate:!0})})):e.fire("moveend")}}});an.addInitHook("addHandler","dragging",ii),an.mergeOptions({keyboard:!0,keyboardPanDelta:80});var oi=xn.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),ze(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ue(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,n=t.scrollTop||e.scrollTop,r=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(r,n)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,n,r=this._panKeys={},i=this.keyCodes;for(e=0,n=i.left.length;e<n;e++)r[i.left[e]]=[-1*t,0];for(e=0,n=i.right.length;e<n;e++)r[i.right[e]]=[t,0];for(e=0,n=i.down.length;e<n;e++)r[i.down[e]]=[0,t];for(e=0,n=i.up.length;e<n;e++)r[i.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,n,r=this._zoomKeys={},i=this.keyCodes;for(e=0,n=i.zoomIn.length;e<n;e++)r[i.zoomIn[e]]=t;for(e=0,n=i.zoomOut.length;e<n;e++)r[i.zoomOut[e]]=-t},_addHooks:function(){ze(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ue(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,n=t.keyCode,r=this._map;if(n in this._panKeys){if(!r._panAnim||!r._panAnim._inProgress)if(e=this._panKeys[n],t.shiftKey&&(e=M(e).multiplyBy(3)),r.options.maxBounds&&(e=r._limitOffset(M(e),r.options.maxBounds)),r.options.worldCopyJump){var i=r.wrapLatLng(r.unproject(r.project(r.getCenter()).add(e)));r.panTo(i)}else r.panBy(e)}else if(n in this._zoomKeys)r.setZoom(r.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[n]);else{if(27!==n||!r._popup||!r._popup.options.closeOnEscapeKey)return;r.closePopup()}Ye(t)}}});an.addInitHook("addHandler","keyboard",oi),an.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ai=xn.extend({addHooks:function(){ze(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ue(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=en(t),n=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var r=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(i(this._performZoom,this),r),Ye(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),n=this._map.options.zoomSnap||0;t._stop();var r=this._delta/(4*this._map.options.wheelPxPerZoomLevel),i=4*Math.log(2/(1+Math.exp(-Math.abs(r))))/Math.LN2,o=n?Math.ceil(i/n)*n:i,a=t._limitZoom(e+(this._delta>0?o:-o))-e;this._delta=0,this._startTime=null,a&&("center"===t.options.scrollWheelZoom?t.setZoom(e+a):t.setZoomAround(this._lastMousePos,e+a))}});an.addInitHook("addHandler","scrollWheelZoom",ai);var si=600;an.mergeOptions({tapHold:jt.touchNative&&jt.safari&&jt.mobile,tapTolerance:15});var ui=xn.extend({addHooks:function(){ze(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ue(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),1===t.touches.length){var e=t.touches[0];this._startPos=this._newPos=new P(e.clientX,e.clientY),this._holdTimeout=setTimeout(i(function(){this._cancel(),this._isTapValid()&&(ze(document,"touchend",$e),ze(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",e))},this),si),ze(document,"touchend touchcancel contextmenu",this._cancel,this),ze(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){Ue(document,"touchend",$e),Ue(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),Ue(document,"touchend touchcancel contextmenu",this._cancel,this),Ue(document,"touchmove",this._onMove,this)},_onMove:function(t){var e=t.touches[0];this._newPos=new P(e.clientX,e.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,e){var n=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY});n._simulated=!0,e.target.dispatchEvent(n)}});an.addInitHook("addHandler","tapHold",ui),an.mergeOptions({touchZoom:jt.touch,bounceAtZoomLimits:!0});var ci=xn.extend({addHooks:function(){_e(this._map._container,"leaflet-touch-zoom"),ze(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Ee(this._map._container,"leaflet-touch-zoom"),Ue(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var n=e.mouseEventToContainerPoint(t.touches[0]),r=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),"center"!==e.options.touchZoom&&(this._pinchStartLatLng=e.containerPointToLatLng(n.add(r)._divideBy(2))),this._startDist=n.distanceTo(r),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),ze(document,"touchmove",this._onTouchMove,this),ze(document,"touchend touchcancel",this._onTouchEnd,this),$e(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,n=e.mouseEventToContainerPoint(t.touches[0]),r=e.mouseEventToContainerPoint(t.touches[1]),o=n.distanceTo(r)/this._startDist;if(this._zoom=e.getScaleZoom(o,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&o<1||this._zoom>e.getMaxZoom()&&o>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===o)return}else{var a=n._add(r)._divideBy(2)._subtract(this._centerPoint);if(1===o&&0===a.x&&0===a.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(a),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),S(this._animRequest);var s=i(e._move,e,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=I(s,this,!0),$e(t)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,S(this._animRequest),Ue(document,"touchmove",this._onTouchMove,this),Ue(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});an.addInitHook("addHandler","touchZoom",ci),an.BoxZoom=ni,an.DoubleClickZoom=ri,an.Drag=ii,an.Keyboard=oi,an.ScrollWheelZoom=ai,an.TapHold=ui,an.TouchZoom=ci,t.Bounds=O,t.Browser=jt,t.CRS=V,t.Canvas=Kr,t.Circle=cr,t.CircleMarker=sr,t.Class=T,t.Control=un,t.DivIcon=Fr,t.DivOverlay=Dr,t.DomEvent=rn,t.DomUtil=je,t.Draggable=_n,t.Evented=A,t.FeatureGroup=Jn,t.GeoJSON=mr,t.GridLayer=zr,t.Handler=xn,t.Icon=tr,t.ImageOverlay=kr,t.LatLng=z,t.LatLngBounds=F,t.Layer=Xn,t.LayerGroup=$n,t.LineUtil=Un,t.Map=an,t.Marker=ir,t.Mixin=bn,t.Path=ar,t.Point=P,t.PolyUtil=kn,t.Polygon=pr,t.Polyline=hr,t.Popup=Mr,t.PosAnimation=on,t.Projection=Gn,t.Rectangle=ti,t.Renderer=qr,t.SVG=Jr,t.SVGOverlay=Ar,t.TileLayer=Ur,t.Tooltip=Lr,t.Transformation=K,t.Util=k,t.VideoOverlay=Nr,t.bind=i,t.bounds=B,t.canvas=Zr,t.circle=lr,t.circleMarker=ur,t.control=cn,t.divIcon=jr,t.extend=n,t.featureGroup=Qn,t.geoJSON=Ir,t.geoJson=Sr,t.gridLayer=Wr,t.icon=er,t.imageOverlay=Tr,t.latLng=W,t.latLngBounds=j,t.layerGroup=Yn,t.map=sn,t.marker=or,t.point=M,t.polygon=fr,t.polyline=dr,t.popup=Or,t.rectangle=ei,t.setOptions=p,t.stamp=a,t.svg=Qr,t.svgOverlay=Pr,t.tileLayer=Vr,t.tooltip=Br,t.transformation=Z,t.version=e,t.videoOverlay=Rr;var li=window.L;t.noConflict=function(){return window.L=li,this},window.L=t}(US.exports);var VS=US.exports;const HS=Me(VS);function GS(t,e,n){return Object.freeze({instance:t,context:e,container:n})}function qS(t,e){return null==e?function(e,n){const r=Se.useRef();return r.current||(r.current=t(e,n)),r}:function(n,r){const i=Se.useRef();i.current||(i.current=t(n,r));const o=Se.useRef(n),{instance:a}=i.current;return Se.useEffect(function(){o.current!==n&&(e(a,n,o.current),o.current=n)},[a,n,r]),i}}function KS(t){return function(e){const n=jS(),r=t(WS(e,n),n);return LS(n.map,e.attribution),zS(r.current,e.eventHandlers),function(t,e){Se.useEffect(function(){return(e.layerContainer??e.map).addLayer(t.instance),function(){var n;null==(n=e.layerContainer)||n.removeLayer(t.instance),e.map.removeLayer(t.instance)}},[e,t])}(r.current,n),r}}function ZS(){return ZS=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ZS.apply(this,arguments)}function XS({bounds:t,boundsOptions:e,center:n,children:r,className:i,id:o,placeholder:a,style:s,whenReady:u,zoom:c,...l},h){const[d]=Se.useState({className:i,id:o,style:s}),[p,f]=Se.useState(null);Se.useImperativeHandle(h,()=>(null==p?void 0:p.map)??null,[p]);const m=Se.useCallback(r=>{if(null!==r&&null===p){const i=new VS.Map(r,l);null!=n&&null!=c?i.setView(n,c):null!=t&&i.fitBounds(t,e),null!=u&&i.whenReady(u),f(function(t){return Object.freeze({__version:1,map:t})}(i))}},[]);Se.useEffect(()=>()=>{null==p||p.map.remove()},[p]);const v=p?ke.createElement(FS,{value:p},r):a??null;return ke.createElement("div",ZS({},d,{ref:m}),v)}const $S=Se.forwardRef(XS),YS=function(t){function e(e,n){const{instance:r,context:i}=t(e).current;return Se.useImperativeHandle(n,()=>r),null==e.children?null:ke.createElement(FS,{value:i},e.children)}return Se.forwardRef(e)}(KS(qS(function({position:t,...e},n){const r=new VS.Marker(t,e);return GS(r,(i=n,o={overlayContainer:r},Object.freeze({...i,...o})));var i,o},function(t,e,n){e.position!==n.position&&t.setLatLng(e.position),null!=e.icon&&e.icon!==n.icon&&t.setIcon(e.icon),null!=e.zIndexOffset&&e.zIndexOffset!==n.zIndexOffset&&t.setZIndexOffset(e.zIndexOffset),null!=e.opacity&&e.opacity!==n.opacity&&t.setOpacity(e.opacity),null!=t.dragging&&e.draggable!==n.draggable&&(!0===e.draggable?t.dragging.enable():t.dragging.disable())})));const JS=function(t,e){const n=function(t,e){return function(n,r){const i=jS(),o=t(WS(n,i),i);return LS(i.map,n.attribution),zS(o.current,n.eventHandlers),e(o.current,i,n,r),o}}(qS(t),e);return function(t){function e(e,n){const[r,i]=Se.useState(!1),{instance:o}=t(e,i).current;Se.useImperativeHandle(n,()=>o),Se.useEffect(function(){r&&o.update()},[o,r,e.children]);const a=o._contentNode;return a?Ie.createPortal(e.children,a):null}return Se.forwardRef(e)}(n)}(function(t,e){return GS(new VS.Popup(t,e.overlayContainer),e)},function(t,e,{position:n},r){Se.useEffect(function(){const{instance:i}=t;function o(t){t.popup===i&&(i.update(),r(!0))}function a(t){t.popup===i&&r(!1)}return e.map.on({popupopen:o,popupclose:a}),null==e.overlayContainer?(null!=n&&i.setLatLng(n),i.openOn(e.map)):e.overlayContainer.bindPopup(i),function(){var t;e.map.off({popupopen:o,popupclose:a}),null==(t=e.overlayContainer)||t.unbindPopup(),e.map.removeLayer(i)}},[t,e,r,n])}),QS=function(t,e){return function(t){function e(e,n){const{instance:r}=t(e).current;return Se.useImperativeHandle(n,()=>r),null}return Se.forwardRef(e)}(KS(qS(t,e)))}(function({url:t,...e},n){return GS(new VS.TileLayer(t,WS(e,n)),n)},function(t,e,n){!function(t,e,n){const{opacity:r,zIndex:i}=e;null!=r&&r!==n.opacity&&t.setOpacity(r),null!=i&&i!==n.zIndex&&t.setZIndex(i)}(t,e,n);const{url:r}=e;null!=r&&r!==n.url&&t.setUrl(r)}),tk=HS.icon({iconUrl:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII=",import.meta.url).toString(),iconRetinaUrl:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAABSCAMAAAAhFXfZAAAC91BMVEVMaXEzeak2f7I4g7g3g7cua5gzeKg8hJo3grY4g7c3grU0gLI2frE0daAubJc2gbQwd6QzeKk2gLMtd5sxdKIua5g1frA2f7IydaM0e6w2fq41fK01eqo3grgubJgta5cxdKI1f7AydaQydaMxc6EubJgvbJkwcZ4ubZkwcJwubZgubJcydqUydKIxapgubJctbJcubZcubJcvbJYubJcvbZkubJctbJctbZcubJg2f7AubJcrbZcubJcubJcua5g3grY0fq8ubJcubJdEkdEwhsw6i88vhswuhcsuhMtBjMgthMsrg8srgss6is8qgcs8i9A9iMYtg8spgcoogMo7hcMngMonf8olfso4gr8kfck5iM8jfMk4iM8he8k1fro7itAgesk2hs8eecgzfLcofssdeMg0hc4cd8g2hcsxeLQbdsgZdcgxeLImfcszhM0vda4xgckzhM4xg84wf8Yxgs4udKsvfcQucqhUndROmdM1fK0wcZ8vb5w0eqpQm9MzeKhXoNVcpdYydKNWn9VZotVKltJFjsIwcJ1Rms9OlslLmtH///8+kc9epdYzd6dbo9VHkMM2f7FHmNBClM8ydqVcpNY9hro3gLM9hLczealQmcw3fa46f7A8gLMxc6I3eagyc6FIldJMl9JSnNRSntNNl9JPnNJFi75UnM9ZodVKksg8kM45jc09e6ZHltFBk883gbRBh7pDk9EwcaBzn784g7dKkcY2i81Om9M7j85Llc81is09g7Q4grY/j9A0eqxKmdFFltBEjcXf6fFImdBCiLxJl9FGlNFBi78yiMxVndEvbpo6js74+vx+psPP3+o/ks5HkcpGmNCjwdZCkNDM3ehYoNJEls+lxNkxh8xHks0+jdC1zd5Lg6r+/v/H2ufz9/o3jM3t8/edvdM/k89Th61OiLBSjbZklbaTt9BfptdjmL1AicBHj8hGk9FAgK1dkLNTjLRekrdClc/k7fM0icy0y9tgp9c4jc2NtM9Dlc8zicxeXZn3AAAAQ3RSTlMAHDdTb4yPA+LtnEQmC4L2EmHqB7XA0d0sr478x4/Yd5i1zOfyPkf1sLVq4Nh3FvjxopQ2/STNuFzUwFIwxKaejILpIBEV9wAABhVJREFUeF6s1NdyFEcYBeBeoQIhRAkLlRDGrhIgY3BJL8CVeKzuyXFzzjkn5ZxzzuScg3PO8cKzu70JkO0LfxdTU//pM9vTu7Xgf6KqOVTb9X7toRrVEfBf1HTVjZccrT/2by1VV928Yty9ZbVuucdz90frG8DBjl9pVApbOstvmMuvVgaNXSfAAd6pGxpy6yxf5ph43pS/4f3uoaGm2rdu72S9xzOvMymkZFq/ptDrk90mhW7e4zl7HLzhxGWPR20xmSxJ/VqldG5m9XhaVOA1DadsNh3Pu5L2N6QtPO/32JpqQBVVk20oy/Pi2s23WEvyfHbe1thadVQttvm7Llf65gGmXK67XtupyoM7HQhmXdLS8oGWJNeOJ3C5fG5XCEJnkez3/oFdsvgJ4l2ANZwhrJKk/7OSXa+3Vw2WJMlKnGkobouYk6T0TyX30klOUnTD9HJ5qpckL3EW/w4XF3Xd0FGywXUrstrclVsqz5Pd/sXFYyDnPdrLcQODmGOK47IZb4CmibmMn+MYRzFZ5jg33ZL/EJrWcszHmANy3ARBK/IXtciJy8VsitPSdE3uuHxzougojcUdr8/32atnz/ev3f/K5wtpxUTpcaI45zusVDpYtZi+jg0oU9b3x74h7+n9ABvYEZeKaVq0sh0AtLKsFtqNBdeT0MrSzwwlq9+x6xAO4tgOtSzbCjrNQQiNvQUbUEubvzBUeGw26yDCsRHCoLkTHDa7IdOLIThs/gHvChszh2CimE8peRs47cxANI0lYNB5y1DljpOF0IhzBDPOZnDOqYYbeGKECbPzWnXludPphw5c2YBq5zlwXphIbO4VDCZ0gnPfUO1TwZoYwAs2ExPCedAu9DAjfQUjzITQb3jNj0KG2Sgt6BHaQUdYzWz+XmBktOHwanXjaSTcwwziBcuMOtwBmqPrTOxFQR/DRKKPqyur0aiW6cULYsx6tBm0jXpR/AUWR6HRq9WVW6MRhIq5jLyjbaCTDCijyYJNpCajdyobP/eTw0iexBAKkJ3gA5KcQb2zBXsIBckn+xVv8jkZSaEFHE+jFEleAEfayRU0MouNoBmB/L50Ai/HSLIHxcrpCvnhSQAuakKp2C/YbCylJjXRVy/z3+Kv/RrNcCo+WUzlVEhzKffnTQnxeN9fWF88fiNCUdSTsaufaChKWInHeysygfpIqagoakW+vV20J8uyl6TyNKEZWV4oRSPyCkWpgOLSbkCObT8o2r6tlG58HQquf6O0v50tB7JM7F4EORd2dx/K0w/KHsVkLPaoYrwgP/y7krr3SSMA4zj+OBgmjYkxcdIJQyQRKgg2viX9Hddi9UBb29LrKR7CVVEEEXWojUkXNyfTNDE14W9gbHJNuhjDettN3ZvbOvdOqCD3Jp/9l+/wJE+9PkYGjx/fqkys3S2rMozM/o2106rfMUINo6hVqz+eu/hd1c4xTg0TAfy5kV+4UG6+IthHTU9woWmxuKNbTfuCSfovBCxq7EtHqvYL4Sm6F8GVxsSXHMQ07TOi1DKtZxjWaaIyi4CXWjxPccUw8WVbMYY5wxC1mzEyXMJWkllpRloi+Kkoq69sxBTlElF6aAxYUbjXNlhlDZilDnM4U5SlN5biRsRHnbx3mbeWjEh4mEyiuJDl5XcWVmX5GvNkFgLWZM5qwsop4/AWfLhU1cR7k1VVvcYCWRkOI6Xy5gmnphCYIkvzuNYzHzosq2oNk2RtSs8khfUOfHIDgR6ysYBaMpl4uEgk2U/oJTs9AaTSwma7dT69geAE2ZpEjUsn2ieJNHeKfrI3EcAGJ2ZaNgVuC8EBctCLc57P5u5led6IOBkIYkuQMrmmjChs4VkfOerHqSBkPzZlhe06RslZ3zMjk2sscqKwY0RcjKK+LWbzd7KiHhkncs/siFJ+V5eXxD34B8nVuJEpGJNmxN2gH3vSvp7J70tF+D1Ej8qUJD1TkErAND2GZwTFg/LubvmgiBG3SOvdlsqFQrkEzJCL1rstlnVFROixZoDDSuXQFHESwVGlcuQcMb/b42NgjLowh5MTDFE3vNB5qStRIErdCQEh6pLPR92anSUb/wAIhldAaDMpGgAAAABJRU5ErkJggg==",import.meta.url).toString(),shadowUrl:new URL("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC",import.meta.url).toString(),iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});HS.Marker.prototype.options.icon=tk;const ek={id:" (ID)",name:" (Name)",place_name:"",nameTh:"",description:" (Description)",descriptionTh:"",address:" (Address)",addressTh:"",latitude:" (Latitude)",longitude:" (Longitude)",opening_hours:"- (Opening Hours)",openTime:"",closeTime:"",price_range:" (Price Range)",category:" (Category)",attraction_type:" (Type)",type:"",tags:" (Tags)",highlights:"",rating:" (Rating)",reviews:" (Reviews)",city:" (City)",district:" (District)",province:" (Province)",images:" (Images)",image:"",image_url:"URL ",googleMapsUrl:"Google Maps URL",isOpen:"- (Status)",place_information:"",source:" (Source)",description_embedding:"Vector Embedding"},nk=()=>{const{id:t}=Oe(),e=Re(),[n,r]=Se.useState(!1),[i,o]=Se.useState(null),[a,s]=Se.useState(!0),[u,c]=Se.useState(null),l=PS();Se.useEffect(()=>{t?(async()=>{try{s(!0),c(null);const e=PS(),n=await fetch(`${e}/api/places/${t}`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const r=await n.json();if(!r.success||!r.place)throw new Error("Place not found");o(r.place)}catch(e){c(e instanceof Error?e.message:"Failed to load place")}finally{s(!1)}})():(s(!1),c("Invalid place ID"))},[t]);const h=t=>{if(!t)return DS;let e=String(t).trim();if(!e)return DS;if(e.startsWith("data:"))return e;e.startsWith("//")&&(e=`https:${e}`),(/^[a-zA-Z]:\\/.test(e)||e.includes("\\"))&&(e=e.replace(/\\/g,"/"));const n=e.toLowerCase(),r=n.lastIndexOf("/backend/static/");-1!==r&&(e=e.slice(r+16));const i=n.lastIndexOf("/static/");-1!==i&&(e=e.slice(i+8));const o=n.lastIndexOf("/public/");-1!==o&&(e=e.slice(o+8));return["https://lh3.googleusercontent.com","https://lh5.googleusercontent.com","https://maps.googleapis.com","https://streetviewpixels-pa.googleapis.com"].some(t=>e.startsWith(t))?`${l}/api/image-proxy?url=${encodeURIComponent(e)}`:/^https?:\/\//i.test(e)?e:e.startsWith("/")?`${l}${e}`:`${l}/${e}`},d=Se.useMemo(()=>{if(!i)return DS;const t=i.images;return Array.isArray(t)&&t.length>0?h(String(t[0])):i.image_url?h(String(i.image_url)):i.image?h(String(i.image)):DS},[i,l]),p=Se.useMemo(()=>{if(!i)return null;const t=i.latitude??i.lat??i.location_lat,e=Number(t);return Number.isFinite(e)?e:null},[i]),f=Se.useMemo(()=>{if(!i)return null;const t=i.longitude??i.lng??i.location_lng,e=Number(t);return Number.isFinite(e)?e:null},[i]);return a?$.jsxs("div",{className:"min-h-screen bg-background",children:[$.jsx(GI,{}),$.jsx("div",{className:"pt-24 container mx-auto px-4 text-center",children:$.jsxs("div",{className:"flex items-center justify-center py-20",children:[$.jsx(ce,{className:"w-8 h-8 animate-spin text-primary mr-2"}),$.jsx("p",{className:"text-muted-foreground",children:"Loading place..."})]})})]}):u||!i?$.jsxs("div",{className:"min-h-screen bg-background",children:[$.jsx(GI,{}),$.jsxs("div",{className:"pt-24 container mx-auto px-4 text-center",children:[$.jsx("h1",{className:"font-display text-2xl font-bold text-foreground mb-4",children:""}),$.jsx("p",{className:"text-muted-foreground mb-8",children:u||"Place not found"}),$.jsx(Ae,{to:"/places",children:$.jsx(Pi,{children:"Back to Places"})})]})]}):$.jsxs("div",{className:"min-h-screen bg-background",children:[$.jsx(GI,{}),$.jsxs("div",{className:"relative h-[40vh] min-h-[320px]",children:[$.jsx("img",{src:d,alt:String(i.nameTh||i.name||"Place"),className:"w-full h-full object-cover"}),$.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background via-background/20 to-transparent"}),$.jsx(Pi,{variant:"ghost",size:"icon",onClick:()=>e(-1),className:"absolute top-20 left-4 bg-card/80 backdrop-blur-sm hover:bg-card",children:$.jsx(le,{className:"w-5 h-5"})}),null!==i.rating&&void 0!==i.rating&&$.jsx("div",{className:"absolute top-20 right-4",children:$.jsxs("div",{className:"flex items-center gap-1 bg-card/90 backdrop-blur-sm px-3 py-1.5 rounded-full shadow-soft",children:[$.jsx(oe,{className:"w-4 h-4 fill-golden text-golden"}),$.jsx("span",{className:"font-medium text-foreground",children:Number(i.rating).toFixed(1)})]})})]}),$.jsxs("main",{className:"container mx-auto px-4 -mt-16 relative z-10 pb-12",children:[$.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[$.jsxs("div",{className:"bg-card rounded-2xl shadow-elevated p-6 md:p-8",children:[$.jsxs("div",{className:"mb-6",children:[$.jsxs("div",{className:"flex items-start justify-between gap-4 mb-3",children:[$.jsxs("div",{children:[$.jsx("h1",{className:"font-display text-2xl md:text-3xl font-bold text-foreground mb-1",children:String(i.nameTh||i.name||"")}),$.jsx("p",{className:"text-muted-foreground text-lg",children:String(i.name||"")})]}),$.jsxs($I,{variant:i.isOpen?"default":"secondary",className:i.isOpen?"bg-accent text-accent-foreground":"bg-muted text-muted-foreground",children:[$.jsx(ie,{className:"w-3 h-3 mr-1"}),i.isOpen?"":""]})]}),Array.isArray(i.tags)&&i.tags.length>0&&$.jsx("div",{className:"flex flex-wrap gap-2",children:i.tags.map(t=>$.jsx($I,{variant:"outline",className:"border-border text-muted-foreground",children:String(t)},String(t)))})]}),$.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[$.jsxs("div",{className:"space-y-2",children:[$.jsxs("h3",{className:"font-medium text-foreground flex items-center gap-2",children:[$.jsx(Vt,{className:"w-4 h-4 text-secondary"})," (Address)"]}),$.jsx("p",{className:"text-muted-foreground text-sm",children:String(i.addressTh||"")}),$.jsx("p",{className:"text-muted-foreground text-sm",children:String(i.address||"")})]}),$.jsxs("div",{className:"space-y-2",children:[$.jsxs("h3",{className:"font-medium text-foreground flex items-center gap-2",children:[$.jsx(ie,{className:"w-4 h-4 text-secondary"}),"- (Hours)"]}),$.jsxs("p",{className:"text-muted-foreground",children:[String(i.openTime||i.opening_hours||""),i.closeTime?` - ${i.closeTime}`:""]})]})]}),i.googleMapsUrl&&$.jsx("a",{href:String(i.googleMapsUrl),target:"_blank",rel:"noopener noreferrer",children:$.jsxs(Pi,{variant:"outline",className:"w-full md:w-auto mb-6",children:[$.jsx(Vt,{className:"w-4 h-4"}),"Open in Google Maps",$.jsx(he,{className:"w-4 h-4"})]})}),$.jsxs("div",{className:"border-t border-border pt-6",children:[$.jsx("h3",{className:"font-medium text-foreground mb-3",children:" (Description)"}),$.jsxs("div",{className:`text-muted-foreground leading-relaxed ${!n&&"line-clamp-3"}`,children:[$.jsx("p",{className:"mb-3",children:String(i.descriptionTh||"")}),$.jsx("p",{children:String(i.description||"")})]}),$.jsx(Pi,{variant:"ghost",size:"sm",onClick:()=>r(!n),className:"mt-2 text-primary",children:n?$.jsxs($.Fragment,{children:[$.jsx(de,{className:"w-4 h-4"}),"Show Less"]}):$.jsxs($.Fragment,{children:[$.jsx(pe,{className:"w-4 h-4"}),"Read More"]})})]}),$.jsxs("div",{className:"border-t border-border pt-6 mt-6",children:[$.jsx("h3",{className:"font-medium text-foreground mb-3",children:" (Full Place Data)"}),$.jsx("div",{className:"divide-y divide-border rounded-lg border border-border",children:Object.entries(i).filter(([t])=>!["name","nameTh","place_name","description","descriptionTh","address","addressTh","openTime","closeTime","opening_hours","tags","rating","isOpen","place_information","image","images","image_url"].includes(t)).map(([t,e])=>$.jsxs("div",{className:"grid grid-cols-3 gap-4 p-3 text-sm",children:[$.jsx("div",{className:"font-medium text-foreground break-words",children:ek[t]||t}),$.jsx("div",{className:"col-span-2 text-muted-foreground break-words",children:Array.isArray(e)?e.map(t=>String(t)).join(", "):"object"==typeof e&&null!==e?JSON.stringify(e,null,2):String(e??"")})]},t))})]})]}),$.jsxs("div",{className:"bg-card rounded-2xl shadow-elevated p-4 md:p-6 h-fit",children:[$.jsx("h3",{className:"font-medium text-foreground mb-3",children:" (Map)"}),null!==p&&null!==f?$.jsx("div",{className:"h-[500px] w-full overflow-hidden rounded-xl border border-border",children:$.jsxs($S,{center:[p,f],zoom:15,scrollWheelZoom:!0,style:{height:"100%",width:"100%"},children:[$.jsx(QS,{attribution:' <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),$.jsx(YS,{position:[p,f],children:$.jsx(JS,{children:String(i.name||"Place")})})]})}):$.jsx("div",{className:"h-[500px] w-full rounded-xl border border-border flex items-center justify-center text-muted-foreground",children:$.jsxs("div",{className:"text-center",children:[$.jsx("p",{className:"mb-2",children:" (Map not available)"}),$.jsxs("p",{className:"text-xs",children:["Latitude: ",String(i.latitude??"null"),", Longitude: ",String(i.longitude??"null")]})]})})]})]}),$.jsx("div",{className:"mt-6 bg-gradient-river rounded-2xl p-6 shadow-elevated",children:$.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-4 text-center md:text-left",children:[$.jsx("div",{className:"w-12 h-12 bg-primary-foreground/20 rounded-xl flex items-center justify-center flex-shrink-0",children:$.jsx(Ht,{className:"w-6 h-6 text-primary-foreground"})}),$.jsxs("div",{className:"flex-1",children:[$.jsx("h3",{className:"font-display text-lg font-semibold text-primary-foreground mb-1",children:" AI "}),$.jsx("p",{className:"text-primary-foreground/80 text-sm",children:"Get tips, recommendations, and plan your visit with our AI assistant"})]}),$.jsx(Ae,{to:`/chat?place=${String(i.id||"")}`,children:$.jsx(Pi,{variant:"heroOutline",className:"bg-primary-foreground text-primary hover:bg-primary-foreground/90",children:"Ask AI Guide"})})]})})]})]})},rk=PS(),ik=t=>{if(!t)return"";if("string"==typeof t)return t;return[t.district||"",t.province||""].filter(Boolean).join(", ")},ok=t=>{if(t)return Array.isArray(t)?t.join(", "):t},ak=({place:t,fallback:e})=>{const[n,r]=Se.useState(!1),i=t.place_name||t.name||"",o=t.short_description||t.description||"",a=t.category||ok(t.type),s=ik(t.location)||t.address,u=(t=>{if(!t)return[];if(Array.isArray(t))return t.filter(t=>t&&String(t).trim()).map(t=>String(t).trim());if("string"==typeof t){const n=t.trim();if(n.startsWith("["))try{const t=JSON.parse(n);if(Array.isArray(t))return t.filter(t=>t&&String(t).trim()).map(t=>String(t).trim())}catch(e){}return n?[n]:[]}return[]})(t.images),c=u.length>0?u[0]:null,l=!c||n?e:(h=c)?h.startsWith("https://lh3.googleusercontent.com")?`${rk}/api/image-proxy?url=${encodeURIComponent(h)}`:h:e;var h;return $.jsx("div",{className:"rounded-xl border border-border bg-muted/40 p-3",children:$.jsxs("div",{className:"flex items-start gap-3",children:[$.jsx("img",{src:l,alt:i,className:"w-16 h-16 rounded-lg object-cover flex-shrink-0",loading:"lazy",onError:()=>{r(!0)}}),$.jsxs("div",{className:"space-y-1",children:[$.jsx("p",{className:"font-semibold text-foreground leading-tight",children:i}),a&&$.jsx("p",{className:"text-xs text-muted-foreground",children:a}),$.jsx("p",{className:"text-sm text-foreground/80 leading-relaxed line-clamp-3",children:o}),s&&$.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[$.jsx(Vt,{className:"w-3.5 h-3.5"}),$.jsx("span",{children:s})]}),t.opening_hours&&$.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[$.jsx(ie,{className:"w-3.5 h-3.5"}),$.jsx("span",{children:t.opening_hours})]}),t.contact&&$.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[$.jsx(ve,{className:"w-3.5 h-3.5"}),$.jsx("span",{children:t.contact})]})]})]})})},sk=({place:t,fallback:e})=>{const[n,r]=Se.useState(!1),i=t.place_name||t.name||"",o=t.short_description||t.description||"",a=t.category||ok(t.type),s=ik(t.location)||t.address,u=(t=>{if(!t)return[];if(Array.isArray(t))return t.filter(t=>t&&String(t).trim()).map(t=>String(t).trim());if("string"==typeof t){const n=t.trim();if(n.startsWith("["))try{const t=JSON.parse(n);if(Array.isArray(t))return t.filter(t=>t&&String(t).trim()).map(t=>String(t).trim())}catch(e){}return n?[n]:[]}return[]})(t.images),c=u.length>0?u[0]:null,l=!c||n?e:(h=c)?h.startsWith("https://lh3.googleusercontent.com")?`${rk}/api/image-proxy?url=${encodeURIComponent(h)}`:h:e;var h;return $.jsxs("div",{className:"rounded-2xl border border-border bg-card overflow-hidden shadow-lg",children:[$.jsx("div",{className:"relative aspect-video overflow-hidden bg-muted",children:$.jsx("img",{src:l,alt:i,className:"w-full h-full object-cover",loading:"lazy",onError:()=>{r(!0)}})}),$.jsxs("div",{className:"p-4 space-y-3",children:[a&&$.jsx("p",{className:"text-sm font-medium text-primary",children:a}),$.jsx("h3",{className:"text-xl font-bold text-foreground",children:i}),$.jsx("p",{className:"text-sm text-foreground/80 leading-relaxed",children:o}),$.jsxs("div",{className:"space-y-2 pt-2",children:[s&&$.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[$.jsx(Vt,{className:"w-4 h-4 flex-shrink-0"}),$.jsx("span",{children:s})]}),t.opening_hours&&$.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[$.jsx(ie,{className:"w-4 h-4 flex-shrink-0"}),$.jsx("span",{children:t.opening_hours})]}),t.contact&&$.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[$.jsx(ve,{className:"w-4 h-4 flex-shrink-0"}),$.jsx("span",{children:t.contact})]})]})]})]})},uk=({places:t})=>{if(!t.length)return null;const e=t[0],n=t.slice(1);return $.jsxs("div",{className:"mt-4 space-y-4",children:[$.jsx(sk,{place:e,fallback:DS}),n.length>0&&$.jsxs("div",{children:[$.jsx("p",{className:"text-sm font-semibold text-muted-foreground mb-2",children:" "}),$.jsx("div",{className:"space-y-2",children:n.map((t,e)=>$.jsx(ak,{place:t,fallback:DS},t.id||`${t.place_name||t.name||"place"}-${e}`))})]})]})},ck=({message:t,isUser:e,timestamp:n,structuredData:r=[],meta:i,messageId:o,chatLogId:a,userMessage:s})=>{const[u,c]=Se.useState(null),[l,h]=Se.useState(!1),d=async t=>{const e=a||o;if(e&&!l){h(!0);try{(await fetch(`${rk}/api/feedback`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chat_log_id:e,type:t,comment:""})})).ok&&c(t)}catch(n){}finally{h(!1)}}};return $.jsxs("div",{className:Vn("flex gap-3 animate-slide-up",e?"flex-row-reverse":"flex-row"),children:[$.jsx("div",{className:Vn("flex-shrink-0 w-9 h-9 rounded-full flex items-center justify-center overflow-hidden",e?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground"),children:e?$.jsx(Ft,{className:"w-5 h-5"}):$.jsx("img",{src:"/assets/logochat%E0%B8%99%E0%B9%89%E0%B8%AD%E0%B8%87%E0%B8%9B%E0%B8%A5%E0%B8%B2%E0%B8%97%E0%B8%B9-DvqOaGyL.png",alt:"NongPlatoo",className:"w-full h-full object-cover"})}),$.jsxs("div",{className:Vn("max-w-[80%] rounded-2xl px-4 py-3",e?"bg-primary text-primary-foreground rounded-br-sm":"bg-card shadow-soft border border-border rounded-bl-sm"),children:[$.jsx("p",{className:Vn("text-sm leading-relaxed whitespace-pre-wrap",e?"text-primary-foreground":"text-foreground"),children:t}),r.length>0&&$.jsx(uk,{places:r}),!e&&(a||o)&&$.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-2 border-t border-border",children:[$.jsxs(Pi,{variant:"ghost",size:"sm",className:Vn("h-7 px-2 text-xs","like"===u&&"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"),onClick:()=>d("like"),disabled:l||null!==u,children:[$.jsx(fe,{className:"w-3.5 h-3.5 mr-1"}),"Helpful"]}),$.jsxs(Pi,{variant:"ghost",size:"sm",className:Vn("h-7 px-2 text-xs","dislike"===u&&"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"),onClick:()=>d("dislike"),disabled:l||null!==u,children:[$.jsx(me,{className:"w-3.5 h-3.5 mr-1"}),"Not helpful"]})]}),(n||(null==i?void 0:i.source))&&$.jsxs("p",{className:Vn("text-xs mt-1.5 flex items-center gap-2",e?"text-primary-foreground/60":"text-muted-foreground"),children:[n,(null==i?void 0:i.source)&&$.jsx("span",{className:"rounded-full bg-muted px-2 py-0.5 text-[11px] border border-border",children:i.source})]})]})]})},lk=()=>{const t=navigator.userAgent.toLowerCase(),e=/iphone|ipad|ipod/.test(t),n=/ipad/.test(t),r=/android/.test(t),i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),o=/chrome|chromium|crios/.test(t),a=/firefox/.test(t),s=/edg/.test(t),u=!(!window.SpeechRecognition&&!window.webkitSpeechRecognition),c=!!window.MediaRecorder,l=!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),h=!(!window.AudioContext&&!window.webkitAudioContext),d=!(!window.WebGL2RenderingContext&&!window.WebGLRenderingContext),p=u&&!n&&!i,f=d&&l&&!n,m=p&&l,v=hk();return{chat:!0,tts:h,speechRecognition:u,mediaRecorder:c,camera:l,webgl:d,isIOS:e,isIPad:n,isAndroid:r,isSafari:i,isChrome:o,isFirefox:a,isEdge:s,canUseVoiceAI:m,canUseSpeechRecognition:p,canUseFaceDetection:f,recommendTTSGesture:e&&v<14.5}},hk=()=>{const t=navigator.userAgent.match(/OS (\d+)_(\d+)?/);return t?parseInt(t[1],10):0},dk=({onClose:t,showOnceOnly:e=!0,minimized:n=!1})=>{const[r,i]=Se.useState(null),[o,a]=Se.useState(!n),[s,u]=Se.useState(n);if(Se.useEffect(()=>{const t=lk();i(t),t.isChrome&&!t.isAndroid&&!t.isIPad&&t.canUseVoiceAI&&t.tts&&a(!1)},[]),!r||!o)return(o||n)&&s&&!o?$.jsx("div",{className:"fixed bottom-4 right-4 z-40",children:$.jsxs("button",{onClick:()=>a(!0),className:"bg-gray-100 text-gray-600 px-2 py-1 rounded-md shadow-sm hover:bg-gray-200 hover:text-gray-700 flex items-center gap-1.5 text-xs border border-gray-300 transition-colors",title:"View device compatibility info",children:[$.jsx(ge,{className:"w-3 h-3"}),$.jsx("span",{className:"hidden sm:inline",children:"Device"})]})}):null;const c=(()=>{const t=lk(),e=[];return t.isIPad&&(e.push(" You're using iPad - some features may be limited"),e.push(" Speech Recognition is not available on iPad"),e.push(" Voice AI features may not work well")),t.isSafari&&!t.isIPad&&e.push(" Speech Recognition support is experimental in Safari"),t.isFirefox&&e.push(" Speech Recognition not available in Firefox"),t.recommendTTSGesture&&e.push(" Please tap the screen to enable audio playback"),t.isIPad&&t.webgl&&e.push(" Face Detection may be slow on iPad"),e})(),l=(()=>{const t=lk(),e=[];return e.push(" Text Chat"),e.push(" AI Responses"),t.tts?e.push(" Text-to-Speech (Audio)"):e.push(" Text-to-Speech (Audio not supported)"),t.canUseSpeechRecognition?e.push(" Speech Recognition"):t.isIPad?e.push(" Speech Recognition (Not supported on iPad)"):t.isSafari?e.push(" Speech Recognition (Not supported on Safari)"):e.push(" Speech Recognition (Not supported)"),t.camera?e.push(" Camera Access"):e.push(" Camera Access"),t.canUseFaceDetection?e.push(" Face Detection"):t.isIPad?e.push(" Face Detection (Slow on iPad)"):t.camera?e.push(" Face Detection (Not supported)"):e.push(" Face Detection (No camera)"),t.canUseVoiceAI?e.push(" Voice AI Interface"):e.push(" Voice AI Interface (Not supported)"),e})(),h=c.length>0;return $.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-md",children:$.jsxs("div",{className:`rounded-lg shadow-xl border ${h?"bg-amber-50 border-amber-200":"bg-blue-50 border-blue-200"} p-4`,children:[$.jsxs("div",{className:"flex items-start justify-between mb-3",children:[$.jsxs("div",{className:"flex items-center gap-2",children:[h?$.jsx(ye,{className:"w-5 h-5 text-amber-600 flex-shrink-0"}):$.jsx(ge,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),$.jsx("h3",{className:"font-semibold "+(h?"text-amber-900":"text-blue-900"),children:h?"Feature Limitations":"Device Compatibility"})]}),$.jsx("button",{onClick:()=>{a(!1),null==t||t()},className:"text-gray-400 hover:text-gray-600",children:""})]}),h&&$.jsx("div",{className:"mb-4 space-y-2",children:c.map((t,e)=>$.jsxs("div",{className:"text-sm text-amber-800 flex items-start gap-2",children:[$.jsx("span",{className:"flex-shrink-0 mt-0.5",children:""}),$.jsx("span",{children:t})]},e))}),$.jsxs("div",{children:[$.jsx("h4",{className:"font-medium text-sm mb-2 "+(h?"text-amber-900":"text-blue-900"),children:"Available Features:"}),$.jsx("div",{className:"space-y-1 text-sm",children:l.map((t,e)=>$.jsxs("div",{className:"flex items-center gap-2 "+(t.startsWith("")?"text-green-700":t.startsWith("")?"text-red-700":"text-amber-700"),children:[t.startsWith("")&&$.jsx(Yt,{className:"w-4 h-4 flex-shrink-0"}),t.startsWith("")&&$.jsx(xe,{className:"w-4 h-4 flex-shrink-0"}),t.startsWith("")&&$.jsx(be,{className:"w-4 h-4 flex-shrink-0"}),$.jsx("span",{children:t})]},e))})]}),r.isIPad&&$.jsxs("div",{className:"mt-4 pt-4 border-t border-amber-200",children:[$.jsx("h4",{className:"font-medium text-sm text-amber-900 mb-2",children:"iPad Tips:"}),$.jsxs("ul",{className:"text-xs text-amber-800 space-y-1 list-disc list-inside",children:[$.jsx("li",{children:"Text chat works perfectly "}),$.jsx("li",{children:"AI responses work perfectly "}),$.jsx("li",{children:"For audio: tap the play button to unlock sound first"}),$.jsx("li",{children:"Speech input is not available on iPad Safari"}),$.jsx("li",{children:"Voice AI features won't work due to no speech input"})]})]}),!n&&$.jsx("button",{onClick:()=>{u(!0),a(!1)},className:"mt-3 w-full text-xs text-gray-600 hover:text-gray-700 py-1 border-t border-amber-200 pt-2",children:"Minimize"})]})})},pk=[{id:"1",name:"Amphawa Floating Market",nameTh:"",description:"The famous floating market where you can enjoy fresh seafood and local snacks from boats along the canal. Best visited in the evening for the magical firefly boat tours.",descriptionTh:" .",location:"Amphawa, Samut Songkhram",district:"amphawa",category:"market",image:"https://lh3.googleusercontent.com/gps-cs-s/AG0ilSyXKuL_MwFh65YglyMBCuKbkad-RoGiGp9rq5fYmkKy_4e4YreVx2orjwR6cQhL2X23HGOqPIgaT1Ong0nNe8Lp60Re9i7611FP1j1qwwrLrAfFyIl7mTeE_8JvEj5uPazBLy1gJ364Ng9W=s1024",rating:4.7,tags:[""],openTime:"09:00",closeTime:"18:00",isOpen:!0,googleMapsUrl:"https://maps.google.com/?q=Amphawa+Floating+Market",address:"Amphawa Sub-district, Amphawa District, Samut Songkhram 75110",addressTh:"   75110"},{id:"2",name:"Wat Bang Kung",nameTh:"",description:"An ancient temple enshrined within the roots of a massive banyan tree. Also known as the Church in the Tree, it's a mystical and serene place.",descriptionTh:".",location:"Bang Khonthi, Samut Songkhram",district:"bang-khonthi",category:"temple",image:"https://lh3.googleusercontent.com/gps-cs-s/AG0ilSwtz9nw17SvBPqD_5v1gma9tYikz-_VoHO_7j3O1DsCvFHvTL4hXAToAc9p9Pj8zkDpu0_UYHZHmQGHnXd6B889HilNRr2gE0zhAbNPXAxNujRgWcx9vZ1bt3a08XGofo66_xqvhg=s1024",rating:4.8,tags:["","",""],openTime:"09:00",closeTime:"18:00",isOpen:!0,googleMapsUrl:"https://maps.google.com/?q=Wat+Bang+Kung",address:"Bang Kung Sub-district, Bang Khonthi District, Samut Songkhram 75120",addressTh:"   75120"},{id:"3",name:"Maeklong Railway Market",nameTh:"",description:"Witness the incredible sight of vendors quickly clearing their stalls as the train passes through this unique market built on the railway tracks.",descriptionTh:".",location:"Mueang, Samut Songkhram",district:"mueang",category:"market",image:"https://umbrella-perfect.com/wp-content/uploads/2021/02/%E0%B8%9B%E0%B8%A3%E0%B8%B0%E0%B8%A7%E0%B8%B1%E0%B8%95%E0%B8%B4%E0%B8%84%E0%B8%A7%E0%B8%B2%E0%B8%A1%E0%B9%80%E0%B8%9B%E0%B9%87%E0%B8%99%E0%B8%A1%E0%B8%B2%E0%B8%82%E0%B8%AD%E0%B8%87%E0%B8%95%E0%B8%A5%E0%B8%B2%E0%B8%94%E0%B8%A3%E0%B9%88%E0%B8%A1%E0%B8%AB%E0%B8%B8%E0%B8%9A.jpg",rating:4.6,tags:["","",""],openTime:"06:00",closeTime:"18:00",isOpen:!0,googleMapsUrl:"https://maps.google.com/?q=Maeklong+Railway+Market",address:"Mae Klong Sub-district, Mueang District, Samut Songkhram 75000",addressTh:"   75000"},{id:"4",name:"Baan Rak Amphawa",nameTh:"",description:"A charming riverside homestay offering authentic Thai hospitality. Wake up to the gentle sounds of the river and enjoy homemade breakfast.",descriptionTh:" ",location:"Amphawa, Samut Songkhram",district:"amphawa",category:"homestay",image:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQBEDoWOCGL2pGknXKGIDciMMpSheTRGgATjw&s",rating:4.9,tags:["","",""],openTime:"00:00",closeTime:"23:59",isOpen:!0,googleMapsUrl:"https://maps.google.com/?q=Baan+Rak+Amphawa",address:"Amphawa Sub-district, Amphawa District, Samut Songkhram 75110",addressTh:"   75110"},{id:"5",name:"Caf Kantary",nameTh:" ",description:"A beautiful riverside caf with stunning views of the Mae Klong river. Perfect for enjoying coffee while watching traditional boats pass by.",descriptionTh:" ",location:"Amphawa, Samut Songkhram",district:"amphawa",category:"cafe",image:"https://chillpainai.com/src/wewakeup/scoop/images/91e3f6e28fb58b74b0e8820ec1d513c588488830.jpg",rating:4.5,tags:["","",""],openTime:"08:00",closeTime:"20:00",isOpen:!0,googleMapsUrl:"https://maps.google.com/?q=Cafe+Kantary+Amphawa",address:"Amphawa Sub-district, Amphawa District, Samut Songkhram 75110",addressTh:"   75110"},{id:"6",name:"Don Hoi Lot",nameTh:"",description:"A unique sandbar formation home to the razor clam. Visit during low tide to walk on the exposed sandbar and see these fascinating creatures.",descriptionTh:" ",location:"Bang Tabun, Samut Songkhram",district:"bang-khonthi",category:"photo-spot",image:"https://cms.dmpcdn.com/travel/2020/06/16/76365890-afa1-11ea-b79d-0ddf2d8ccf90_original.jpg",rating:4.3,tags:["","",""],openTime:"06:00",closeTime:"18:00",isOpen:!0,googleMapsUrl:"https://maps.google.com/?q=Don+Hoi+Lot",address:"Bang Tabun Sub-district, Bang Khonthi District, Samut Songkhram 75120",addressTh:"   75120"}],fk=PS(),mk=["","","","","",""],vk=()=>{const[t]=Pe(),e=t.get("place"),n=e?(r=e,pk.find(t=>t.id===r)):null;var r;const[i,o]=Se.useState([{id:"welcome",content:n?`! I see you're interested in ${n.nameTh} (${n.name}). I'd be happy to help you learn more about this place or plan your visit. What would you like to know?`:"!      ",isUser:!1,timestamp:(new Date).toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit"})}]),[a,s]=Se.useState(""),[u,c]=Se.useState(!1),[l,h]=Se.useState(null),[d,p]=Se.useState(!1),[f,m]=Se.useState(""),[v,g]=Se.useState(!1),[y,x]=Se.useState(!1),[b,w]=Se.useState(null),[_,E]=Se.useState(!1),[C,I]=Se.useState(null),[S,k]=Se.useState(!1),T=Se.useRef(null),N=Se.useRef(""),R=Se.useRef(null),A=Se.useRef(null),P=Se.useRef(null);Se.useEffect(()=>{var t;null==(t=A.current)||t.scrollIntoView({behavior:"smooth"})},[i]),Se.useEffect(()=>{if("undefined"==typeof window)return;const t=lk();I(t);const e=window,n=e.SpeechRecognition||e.webkitSpeechRecognition;return g(Boolean(n)&&t.canUseSpeechRecognition),t.recommendTTSGesture&&k(!0),()=>{if(T.current)try{T.current.stop()}catch(t){try{T.current.abort()}catch(e){}}if(P.current)try{P.current.close()}catch(t){}if(b)try{b.pause()}catch(t){}}},[b]);const D=()=>(new Date).toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit"}),M=async t=>{const e=t||a;if(!e.trim())return;const n={id:Date.now().toString(),content:e,isUser:!0,timestamp:D()};o(t=>[...t,n]),s(""),c(!0),h(null);const r=new AbortController;R.current=r;try{const t=setTimeout(()=>r.abort(),45e3),n=await fetch(`${fk}/api/messages`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","Cache-Control":"no-cache"},body:JSON.stringify({text:e,user_id:"web"}),signal:r.signal});if(clearTimeout(t),!n.ok){const t=await n.text();throw new Error(t||"Unable to reach AI service")}const i=await n.json();(null==i?void 0:i.assistant)?o(t=>{return[...t,(n=i.assistant,r=e,{id:`${Date.now()}-assistant`,content:n.text,structuredData:n.structured_data,isUser:!1,timestamp:n.createdAt||(new Date).toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit"}),meta:{source:n.source,intent:n.intent},userMessage:r})];var n,r}):o(t=>[...t,{id:`${Date.now()}-fallback`,content:"  ",isUser:!1,timestamp:D()}])}catch(i){"AbortError"===i.name?h(""):h(" AI  "),o(t=>[...t,{id:`${Date.now()}-error`,content:"AbortError"===i.name?"":"  AI  ",isUser:!1,timestamp:D()}])}finally{c(!1),R.current=null}},O=async(t,e=0)=>{var n,r;const i=t||a;if(!i.trim())return;const u={id:Date.now().toString(),content:i,isUser:!0,timestamp:D()};s("");const l=`${Date.now()}-assistant`,d={id:l,content:"",isUser:!1,timestamp:D(),isStreaming:!0};o(t=>[...t,u,d]),c(!0),h(null);const p=new AbortController;R.current=p;try{const t=setTimeout(()=>p.abort(),6e4),e=await fetch(`${fk}/api/messages/stream`,{method:"POST",headers:{"Content-Type":"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({text:i,user_id:"web"}),signal:p.signal});if(clearTimeout(t),!e.ok)return o(t=>t.filter(t=>t.id!==l)),void(await M(i));if(!e.body||"function"!=typeof e.body.getReader)return o(t=>t.filter(t=>t.id!==l)),void(await M(i));const n=e.body.getReader(),r=new TextDecoder;let a="",s=[],u="",c=Date.now();const h=50;if(n)for(;;){const{done:t,value:e}=await n.read();if(t)break;const i=r.decode(e).split("\n");for(const n of i)if(n.startsWith("data: "))try{const t=JSON.parse(n.slice(6));if("intent"===t.type)u=t.intent_type;else if("structured_data"===t.type)s=t.data;else if("text"===t.type){a+=t.text;const e=Date.now();(e-c>h||t.text.includes(" "))&&(c=e,o(t=>t.map(t=>t.id===l?{...t,content:a}:t)))}else if("done"===t.type)o(e=>e.map(e=>e.id===l?{...e,content:a,structuredData:s,meta:{intent_type:u,source:"streaming"},isStreaming:!1,chatLogId:t.chat_log_id}:e));else if("error"===t.type)throw new Error(t.message)}catch(f){}}}catch(m){const t="AbortError"===m.name,a=(null==(n=m.message)?void 0:n.includes("network"))||(null==(r=m.message)?void 0:r.includes("fetch"));if(t)h(""),o(t=>t.filter(t=>t.id!==l));else if(a&&e<2)o(t=>t.filter(t=>t.id!==l)),setTimeout(()=>{O(i,e+1)},1e3*(e+1));else{o(t=>t.filter(t=>t.id!==l));try{await M(i)}catch(v){h(" AI  "),o(t=>[...t,{id:`${Date.now()}-error`,content:"  AI   ",isUser:!1,timestamp:D()}])}}}finally{c(!1),R.current=null}},L=()=>{var t;null==(t=T.current)||t.stop()};return $.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[$.jsx(GI,{}),d&&$.jsx("div",{className:"fixed inset-0 z-40 bg-background/60 backdrop-blur-sm flex items-end md:items-center justify-center px-4 pb-10",children:$.jsxs("div",{className:"w-full max-w-lg bg-gradient-to-br from-primary via-primary/80 to-primary-foreground text-primary-foreground rounded-3xl p-6 shadow-2xl border border-primary/40",children:[$.jsxs("div",{className:"flex items-center justify-between gap-3",children:[$.jsxs("div",{className:"flex items-center gap-4",children:[$.jsxs("div",{className:"relative",children:[$.jsx("div",{className:"absolute inset-0 rounded-2xl bg-primary-foreground/20 animate-ping"}),$.jsx("div",{className:"relative w-12 h-12 rounded-2xl bg-primary-foreground/30 flex items-center justify-center",children:$.jsx(Mt,{className:"w-6 h-6"})})]}),$.jsxs("div",{children:[$.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-primary-foreground/70",children:"Voice to Text"}),$.jsx("p",{className:"text-lg font-semibold",children:"..."}),$.jsx("p",{className:"text-sm text-primary-foreground/80",children:""})]})]}),$.jsxs(Pi,{size:"sm",variant:"secondary",onClick:L,className:"bg-primary-foreground text-primary hover:bg-primary-foreground/90",children:[$.jsx(we,{className:"w-4 h-4"}),""]})]}),$.jsxs("div",{className:"mt-5 bg-white/10 border border-white/20 rounded-2xl p-4 min-h-[92px]",children:[$.jsx("p",{className:"text-sm text-primary-foreground/80",children:f||"..."}),f&&$.jsx("p",{className:"text-xs text-primary-foreground/60 mt-2",children:"  "}),$.jsxs("div",{className:"mt-4 flex items-center gap-1",children:[$.jsx("span",{className:"w-1.5 h-6 bg-white/40 rounded-full animate-[pulse_1s_ease-in-out_infinite]"}),$.jsx("span",{className:"w-1.5 h-9 bg-white/60 rounded-full animate-[pulse_1.2s_ease-in-out_infinite]"}),$.jsx("span",{className:"w-1.5 h-4 bg-white/30 rounded-full animate-[pulse_0.9s_ease-in-out_infinite]"}),$.jsx("span",{className:"w-1.5 h-7 bg-white/50 rounded-full animate-[pulse_1.1s_ease-in-out_infinite]"})]})]})]})}),$.jsx("main",{className:"flex-1 overflow-y-auto pt-16",children:$.jsxs("div",{className:"container mx-auto px-4 py-6 max-w-3xl",children:[l&&$.jsxs("div",{className:"mb-4 inline-flex items-center gap-2 text-sm text-red-500 bg-red-50 border border-red-200 rounded-xl px-3 py-2",children:[$.jsx(be,{className:"w-4 h-4"}),$.jsx("span",{children:l})]}),$.jsxs("div",{className:"space-y-4",children:[i.map(t=>$.jsx(ck,{message:t.content,isUser:t.isUser,timestamp:t.timestamp,structuredData:t.structuredData,meta:t.meta,messageId:t.id,chatLogId:t.chatLogId,userMessage:t.userMessage},t.id)),u&&$.jsxs("div",{className:"flex gap-3 animate-slide-up",children:[$.jsx("div",{className:"w-9 h-9 bg-secondary rounded-full flex items-center justify-center",children:$.jsx(Mt,{className:"w-5 h-5 text-secondary-foreground animate-pulse"})}),$.jsx("div",{className:"bg-card shadow-soft border border-border rounded-2xl rounded-bl-sm px-4 py-3 min-w-[200px]",children:$.jsxs("div",{className:"space-y-2",children:[$.jsx("div",{className:"h-3 bg-muted rounded w-3/4 skeleton-pulse"}),$.jsx("div",{className:"h-3 bg-muted rounded w-full skeleton-pulse animation-delay-100"}),$.jsx("div",{className:"h-3 bg-muted rounded w-5/6 skeleton-pulse animation-delay-200"})]})})]}),$.jsx("div",{ref:A})]})]})}),i.length<=2&&$.jsx("div",{className:"border-t border-border bg-muted/50",children:$.jsxs("div",{className:"container mx-auto px-4 py-3 max-w-3xl",children:[$.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:":"}),$.jsx("div",{className:"flex flex-wrap gap-2",children:mk.map(t=>$.jsx(Pi,{variant:"outline",size:"sm",className:"rounded-full text-xs",onClick:()=>O(t),children:t},t))})]})}),$.jsx("div",{className:"border-t border-border bg-card sticky bottom-0",children:$.jsxs("div",{className:"container mx-auto px-4 py-4 max-w-3xl",children:[$.jsxs("div",{className:"flex gap-3 items-center",children:[C&&$.jsxs($.Fragment,{children:[C.canUseSpeechRecognition?$.jsx(Pi,{type:"button",variant:d?"destructive":"secondary",size:"icon",onClick:d?L:async()=>{var t;if("undefined"==typeof window)return;if(!C||!C.canUseSpeechRecognition)return void((null==C?void 0:C.isIPad)?h(" Speech recognition is not available on iPad. Please use text input instead."):(null==C?void 0:C.isSafari)?h(" Speech recognition is not supported in Safari. Try Chrome or Edge."):h("This browser doesn't support speech recognition. Try Chrome or Edge."));const e=window,n=e.SpeechRecognition||e.webkitSpeechRecognition;if(!n)return void h("Speech recognition not available. Please use text input.");null==(t=T.current)||t.abort();const r=new n;r.lang="th-TH",r.interimResults=!0,r.continuous=!1,r.maxAlternatives=1,T.current=r;let i="";N.current="",m(""),p(!0),h(null),r.onresult=t=>{var e;let n="";for(let o=t.resultIndex;o<t.results.length;o++){const r=(null==(e=t.results[o][0])?void 0:e.transcript)||"";t.results[o].isFinal?i+=r:n+=r}const r=`${i} ${n}`.trim();N.current=r,m(r)},r.onerror=t=>{p(!1),"network"===t.error?h("Network error. Please check your connection and try again."):"no-speech"===t.error?h("No sound detected. Please speak clearly and try again."):"not-allowed"===t.error?h(" Microphone permission denied. Check Settings > Safari > Microphone."):h("Microphone error. Please try again or use text input.")},r.onend=()=>{p(!1);const t=(N.current||i).trim();t?(s(t),m("")):h("No speech detected. Please try again.")},r.start()},disabled:u,className:d?"animate-pulse shadow-elevated":"",title:"Voice to Text - Convert speech to text",children:$.jsx(Ot,{className:"w-5 h-5"})}):$.jsx(Pi,{type:"button",variant:"secondary",size:"icon",disabled:!0,className:"opacity-50 cursor-not-allowed",title:C.isIPad?"Speech not supported on iPad":C.isSafari?"Speech not supported in Safari":"Speech not supported in this browser",children:$.jsx(Ot,{className:"w-5 h-5"})}),C.canUseVoiceAI?$.jsx(Pi,{type:"button",variant:"outline",size:"icon",onClick:()=>E(!0),disabled:u,className:"border-cyan-500/50 text-cyan-600 hover:bg-cyan-500/10 hover:text-cyan-500",title:"Voice AI Assistant",children:$.jsx(_e,{className:"w-5 h-5"})}):$.jsx(Pi,{type:"button",variant:"outline",size:"icon",disabled:!0,className:"opacity-50 cursor-not-allowed border-gray-300",title:C.isIPad?"Voice AI not supported on iPad":"Voice AI requires microphone access",children:$.jsx(_e,{className:"w-5 h-5"})})]}),$.jsx(eS,{value:a,onChange:t=>s(t.target.value),onKeyDown:t=>{"Enter"!==t.key||t.shiftKey||(t.preventDefault(),O())},placeholder:"... (Type a message)",className:"flex-1 h-12 bg-background rounded-xl",disabled:u}),y&&$.jsx(Pi,{type:"button",onClick:()=>{try{b&&(b.pause(),b.currentTime=0,w(null))}catch(t){}if(x(!1),"speechSynthesis"in window)try{window.speechSynthesis.cancel()}catch(t){}},variant:"outline",size:"icon",className:"h-12 w-12 rounded-xl",children:$.jsx(Ee,{className:"w-5 h-5"})}),u?$.jsxs(Pi,{type:"button",onClick:()=>{var t,e;null==(t=R.current)||t.abort(),R.current=null,null==(e=P.current)||e.close(),P.current=null,c(!1)},variant:"destructive",className:"h-12 px-4 rounded-xl",children:[$.jsx(we,{className:"w-5 h-5"}),""]}):$.jsx(Pi,{onClick:()=>O(),disabled:!a.trim(),className:"h-12 w-12 rounded-xl",children:$.jsx(Ce,{className:"w-5 h-5"})})]}),C&&$.jsxs($.Fragment,{children:[S&&!C.isAndroid&&$.jsxs("p",{className:"mt-2 text-xs text-amber-700 bg-amber-50 px-3 py-2 rounded inline-flex items-center gap-1 border border-amber-200",children:[$.jsx(be,{className:"w-3 h-3"})," Tap to enable audio playback on first message"]}),C.isIPad&&!C.canUseSpeechRecognition&&$.jsxs("p",{className:"mt-2 text-xs text-blue-700 bg-blue-50 px-3 py-2 rounded inline-flex items-center gap-1 border border-blue-200",children:[$.jsx(be,{className:"w-3 h-3"})," iPad: Text chat & AI work great! Speech input not available on this device."]}),!v&&!C.isIPad&&$.jsxs("p",{className:"mt-2 text-xs text-muted-foreground inline-flex items-center gap-1",children:[$.jsx(be,{className:"w-3 h-3"}),"Speech not available in this browser. Try Chrome, Edge, or Safari."]})]})]})}),$.jsx(HI,{isOpen:_,onClose:()=>E(!1)}),$.jsx(dk,{minimized:!0})]})},gk=()=>{const t=Ne();return Se.useEffect(()=>{},[t.pathname]),$.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:$.jsxs("div",{className:"text-center",children:[$.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),$.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),$.jsx("a",{href:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},yk=new Ti,xk=()=>$.jsx(Ri,{client:yk,children:$.jsx(Gr,{children:$.jsxs(wl,{children:[$.jsx(Yn,{}),$.jsx(br,{}),$.jsx(Le,{children:$.jsxs(Be,{children:[$.jsx(Fe,{path:"/",element:$.jsx(ZI,{})}),$.jsx(Fe,{path:"/auth",element:$.jsx(TS,{})}),$.jsx(Fe,{path:"/places",element:$.jsx(OS,{})}),$.jsx(Fe,{path:"/places/:id",element:$.jsx(nk,{})}),$.jsx(Fe,{path:"/chat",element:$.jsx(vk,{})}),$.jsx(Fe,{path:"*",element:$.jsx(gk,{})})]})})]})})});U(document.getElementById("root")).render($.jsx(xk,{}));
